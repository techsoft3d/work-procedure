var __awaiter=this&&this.__awaiter||function(d,h,f,a){return new (f||(f=Promise))(function(e,c){function b(b){try{k(a.next(b))}catch(n){c(n)}}function g(b){try{k(a["throw"](b))}catch(n){c(n)}}function k(c){c.done?e(c.value):(new f(function(b){b(c.value)})).then(b,g)}k((a=a.apply(d,h||[])).next())})},__generator=this&&this.__generator||function(d,h){function f(b){return function(c){return a([b,c])}}function a(a){if(c)throw new TypeError("Generator is already executing.");for(;e;)try{if(c=1,b&&(g=a[0]&
2?b["return"]:a[0]?b["throw"]||((g=b["return"])&&g.call(b),0):b.next)&&!(g=g.call(b,a[1])).done)return g;if(b=0,g)a=[a[0]&2,g.value];switch(a[0]){case 0:case 1:g=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++;b=a[1];a=[0];continue;case 7:a=e.ops.pop();e.trys.pop();continue;default:if(!(g=e.trys,g=0<g.length&&g[g.length-1])&&(6===a[0]||2===a[0])){e=0;continue}if(3===a[0]&&(!g||a[1]>g[0]&&a[1]<g[3]))e.label=a[1];else if(6===a[0]&&e.label<g[1])e.label=g[1],g=a;else if(g&&e.label<
g[2])e.label=g[2],e.ops.push(a);else{g[2]&&e.ops.pop();e.trys.pop();continue}}a=h.call(d,e)}catch(n){a=[6,n],b=0}finally{c=g=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var e={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},c,b,g,k;return k={next:f(0),"throw":f(1),"return":f(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k},Communicator;
(function(d){var h;(function(a){a[a.Unknown=0]="Unknown";a[a.v1_0=1]="v1_0";a[a.v2_0=2]="v2_0";a[a.v2_1=3]="v2_1"})(h=d.BCFVersion||(d.BCFVersion={}));(function(a){a[a.Unknown=0]="Unknown";a[a.TopicFolder=1]="TopicFolder";a[a.Version=2]="Version";a[a.Markup=3]="Markup";a[a.Snapshot=4]="Snapshot";a[a.Viewpoint=5]="Viewpoint";a[a.Schema=6]="Schema";a[a.Project=7]="Project"})(d.BCFFileType||(d.BCFFileType={}));var f=function(){function a(a,c){this._version=h.Unknown;this._topicsMap=new Map;this._bcfFileName=
a;this._id=c}a.prototype.exportBCF=function(a){return __awaiter(this,void 0,void 0,function(){var c,b;return __generator(this,function(g){switch(g.label){case 0:return c=new XMLSerializer,b=new JSZip,b.file("bcf.version",'<?xml version="1.0" encoding="UTF-8"?><Version VersionId="2.1" xsi:noNamespaceSchemaLocation="version.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><DetailedVersion>2.1</DetailedVersion></Version>'),this._topicsMap.forEach(function(g,a){var k=b.folder(a);a=c.serializeToString(g.getMarkup().export());
k.file("markup.bcf",a);g.getViewpointMap().forEach(function(b,g){b=c.serializeToString(b.export());k.file(g,b)});g.getSnapshotMap().forEach(function(b,c){k.file(c,b.getData())})}),[4,b.generateAsync({type:"blob"}).then(function(b){saveAs(b,a+".bcf")})];case 1:return g.sent(),[2]}})})};a.prototype.addTopic=function(a,c){this._topicsMap.set(a,c)};a.prototype.getTopics=function(){return this._topicsMap};a.prototype.getTopic=function(a){return this._topicsMap.get(a)||null};a.prototype.getVersion=function(){return this._version};
a.prototype.setVersion=function(a){this._version=a};a.prototype.getFilename=function(){return this._bcfFileName};a.prototype.getId=function(){return this._id};return a}();d.BCFData=f})(Communicator||(Communicator={}));
(function(d){function h(b,c,g){void 0!==g&&null!==g&&b.setAttribute(c,g)}function f(b,c,g,a){b=b.createElement(g);b.innerHTML=a;c.appendChild(b)}function a(b,c,g,a){void 0!==a&&null!==a&&f(b,c,g,a)}function e(b){return void 0===b||null===b?null:b.toISOString()}function c(b){return void 0===b||null===b?null:b.toString()}function b(b){return void 0===b||null===b?null:b?"true":"false"}var g=function(){function b(b,c,g,a,k,e){this._ifcProject=b;this._ifcSpatialStructureElement=c;this._isExternal=g;this._filename=
a;this._date=k;this._reference=e}b.prototype.getIfcProject=function(){return this._ifcProject||null};b.prototype.getIfcSpacialStructureElement=function(){return this._ifcSpatialStructureElement||null};b.prototype.getIsExternal=function(){return this._isExternal||null};b.prototype.getBimFilename=function(){return this._filename||null};b.prototype.getBimDate=function(){return this._date||null};b.prototype.getReference=function(){return this._reference||null};return b}();d.BCFMarkupHeaderFile=g;var k=
function(){function b(b,c,g,a){this._index=this._snapshotFilename=this._viewpointFilename=void 0;this._guid=b;this._viewpointFilename=c;this._snapshotFilename=g;void 0!==a&&(this._index=parseInt(a,10))}b.prototype.getGuid=function(){return this._guid};b.prototype.getViewpointFilename=function(){return this._viewpointFilename||null};b.prototype.getSnapshotFilename=function(){return this._snapshotFilename||null};b.prototype.getIndex=function(){return this._index||null};return b}();d.BCFMarkupViewpoint=
k;var l=function(){function b(b,c,g,a,k,e,d){this._guid=b;this._date=c;this._author=g;this._text=a;this._viewpointGuid=k;this._modifiedDate=e;this._modifiedAuthor=d}b.prototype.getId=function(){return this._guid};b.prototype.getDate=function(){return this._date};b.prototype.setDate=function(b){this._date=b};b.prototype.getAuthor=function(){return this._author};b.prototype.setAuthor=function(b){this._author=b};b.prototype.getText=function(){return this._text};b.prototype.setText=function(b){this._text=
b};b.prototype.getViewpointGuid=function(){return this._viewpointGuid||null};b.prototype.setViewpointGuid=function(b){this._viewpointGuid=null!==b?b:void 0};b.prototype.getModifiedDate=function(){return this._modifiedDate||null};b.prototype.setModifiedDate=function(b){this._modifiedDate=null!==b?b:void 0};b.prototype.getModifiedAuthor=function(){return this._modifiedAuthor||null};b.prototype.setModifiedAuthor=function(b){this._modifiedAuthor=null!==b?b:void 0};return b}();d.BCFComment=l;var n=function(){function n(b,
c,g){this._markupHeaderFiles=[];this._topic={guid:"",title:"",creationDate:new Date,creationAuthor:""};this._comments=new Map;this._viewpoints=new Map;this._filename=b;this._bcfTopic=g;this._parseDocument(c)}n.prototype._parseDocument=function(b){if(null!==b)for(b=b.documentElement.firstElementChild;null!==b;){var c=b.localName;if(null===c)break;switch(c){case "Header":this._parseHeader(b);break;case "Topic":this._parseTopic(b);break;case "Comment":this._parseComment(b);break;case "Viewpoints":this._parseViewpoint(b)}b=
b.nextElementSibling}};n.prototype._exportHeader=function(c){var g=c.createElement("Header");h(g,"ProjectGuid",this._projectGuid);this._markupHeaderFiles.forEach(function(k){var d=c.createElement("File");h(d,"IfcProject",k.getIfcProject());h(d,"IfcSpatialStructureElement",k.getIfcSpacialStructureElement());h(d,"isExternal",b(k.getIsExternal()));a(c,d,"Filename",k.getBimFilename());a(c,d,"Date",e(k.getBimDate()));a(c,d,"Reference",k.getReference());g.appendChild(d)});return g};n.prototype._exportTopicData=
function(b){var g=b.createElement("Topic");g.setAttribute("Guid",this._topic.guid);h(g,"TopicType",this._topic.topicType);h(g,"TopicStatus",this._topic.topicStatus);f(b,g,"Title",this._topic.title);f(b,g,"CreationDate",this._topic.creationDate.toISOString());f(b,g,"CreationAuthor",this._topic.creationAuthor);a(b,g,"ReferenceLink",this._topic.referenceLink);a(b,g,"Priority",this._topic.priority);a(b,g,"Index",c(this._topic.index));a(b,g,"ModifiedDate",e(this._topic.modifiedDate));a(b,g,"ModifiedAuthor",
this._topic.modifiedAuthor);a(b,g,"DueDate",e(this._topic.dueDate));a(b,g,"AssignedTo",this._topic.assignedTo);a(b,g,"Description",this._topic.description);a(b,g,"Stage",this._topic.stage);if(this._topic.labels){var k=b.createElement("Labels");this._topic.labels.forEach(function(c){f(b,k,"Label",c)});g.appendChild(k)}return g};n.prototype._exportBimSnippet=function(c,g){var k=c.createElement("BimSnippet");k.setAttribute("SnippetType",g.snippetType);h(k,"isExternal",b(g.isExternal));f(c,k,"Reference",
g.reference);a(c,k,"ReferenceSchema",g.referenceSchema);return k};n.prototype._exportDocumentReference=function(c,g){var k=c.createElement("DocumentReference");h(k,"Guid",g.guid);h(k,"isExternal",b(g.isExternal));a(c,k,"ReferencedDocument",g.referencedDocument);a(c,k,"Description",g.description);return k};n.prototype._exportRelatedTopic=function(b,c){b=b.createElement("RelatedTopic");b.setAttribute("Guid",c.guid);return b};n.prototype._exportTopic=function(b){var c=this,g=this._exportTopicData(b);
this._topic.bimSnippets&&this._topic.bimSnippets.forEach(function(a){g.appendChild(c._exportBimSnippet(b,a))});this._topic.documentReferences&&this._topic.documentReferences.forEach(function(a){g.appendChild(c._exportDocumentReference(b,a))});this._topic.relatedTopics&&this._topic.relatedTopics.forEach(function(a){g.appendChild(c._exportRelatedTopic(b,a))});return g};n.prototype._exportComment=function(b,c){var g=b.createElement("Comment");g.setAttribute("Guid",c.getId());f(b,g,"Date",c.getDate().toISOString());
f(b,g,"Author",c.getAuthor());f(b,g,"Comment",c.getText());a(b,g,"ModifiedDate",e(c.getModifiedDate()));a(b,g,"ModifiedAuthor",c.getModifiedAuthor());if(c=c.getViewpointGuid())b=b.createElement("Viewpoint"),b.setAttribute("Guid",c),g.appendChild(b);return g};n.prototype._exportViewpoint=function(b,g){var k=b.createElement("Viewpoints");k.setAttribute("Guid",g.getGuid());a(b,k,"Viewpoint",g.getViewpointFilename());a(b,k,"Snapshot",g.getSnapshotFilename());a(b,k,"Index",c(g.getIndex()));return k};n.prototype.export=
function(){var b=this,c=document.implementation.createDocument("","",null),g=c.createElement("Markup");g.appendChild(this._exportHeader(c));g.appendChild(this._exportTopic(c));this._comments.forEach(function(a){g.appendChild(b._exportComment(c,a))});this._viewpoints.forEach(function(a){g.appendChild(b._exportViewpoint(c,a))});c.appendChild(g);return c};n.prototype.getIfcProject=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getIfcProject()||void 0};n.prototype.getIfcSpacialStructureElement=
function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getIfcSpacialStructureElement()||void 0};n.prototype.getIsExternal=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getIsExternal()||void 0};n.prototype.getBimFilename=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getBimFilename()||void 0};n.prototype.getBimDate=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getBimDate()||void 0};n.prototype.getReference=function(){var b=this._markupHeaderFiles[0];
if(void 0!==b)return b.getReference()||void 0};n.prototype.getProjectGuid=function(){return this._projectGuid||null};n.prototype.getMarkupHeaderFiles=function(){return this._markupHeaderFiles};n.prototype.getFilename=function(){return this._filename};n.prototype.getTopicType=function(){return this._topic.topicType||null};n.prototype.setTopicType=function(b){this._topic.topicType=null!==b?b:void 0};n.prototype.getTopicStatus=function(){return this._topic.topicStatus||null};n.prototype.setTopicStatus=
function(b){this._topic.topicStatus=null!==b?b:void 0};n.prototype.getTopicTitle=function(){return this._topic.title};n.prototype.setTopicTitle=function(b){this._topic.title=b};n.prototype.getTopicCreationDate=function(){return this._topic.creationDate};n.prototype.setTopicCreationDate=function(b){this._topic.creationDate=b};n.prototype.getTopicCreationAuthor=function(){return this._topic.creationAuthor};n.prototype.setTopicCreationAuthor=function(b){this._topic.creationAuthor=b};n.prototype.getTopicReferenceLink=
function(){return this._topic.referenceLink||null};n.prototype.setTopicReferenceLink=function(b){this._topic.referenceLink=null===b?void 0:b};n.prototype.getTopicPriority=function(){return this._topic.priority||null};n.prototype.setTopicPriority=function(b){this._topic.priority=null===b?void 0:b};n.prototype.getTopicIndex=function(){return this._topic.index||null};n.prototype.setTopicIndex=function(b){this._topic.index=null===b?void 0:b};n.prototype.getTopicLabels=function(){return void 0===this._topic.labels?
[]:this._topic.labels.slice()};n.prototype.setTopicLabels=function(b){this._topic.labels=b.slice()};n.prototype.getTopicModifiedDate=function(){return this._topic.modifiedDate||null};n.prototype.setTopicModifiedDate=function(b){this._topic.modifiedDate=null===b?void 0:b};n.prototype.getTopicModifiedAuthor=function(){return this._topic.modifiedAuthor||null};n.prototype.setTopicModifiedAuthor=function(b){this._topic.modifiedAuthor=null===b?void 0:b};n.prototype.getTopicDueDate=function(){return this._topic.dueDate||
null};n.prototype.setTopicDueDate=function(b){this._topic.dueDate=null===b?void 0:b};n.prototype.getTopicAssignedTo=function(){return this._topic.assignedTo||null};n.prototype.setTopicAssignedTo=function(b){this._topic.assignedTo=null===b?void 0:b};n.prototype.getTopicDescription=function(){return this._topic.description||null};n.prototype.setTopicDescription=function(b){this._topic.description=null===b?void 0:b};n.prototype.getTopicStage=function(){return this._topic.stage||null};n.prototype.setTopicState=
function(b){this._topic.stage=null===b?void 0:b};n.prototype.getComments=function(){return this._comments};n.prototype.addComment=function(b,c,g,a,k,e){var n=d.GUID.create();b=new l(n,b,c,g,a,k,e);this._comments.set(n,b);return b};n.prototype.updateComment=function(b){var c=b.getId();this._comments.set(c,b)};n.prototype.deleteComment=function(b){this._comments.delete(b)};n.prototype.getViewpoints=function(){return this._viewpoints};n.prototype._addFile=function(b){var c=this._getElementAttributes(b),
a=this._getChildData(b);b=a.get("Date");b=void 0===b?void 0:new Date(b);var k=a.get("Filename");a=a.get("Reference");var e=c.get("IfcProject"),d=c.get("IfcSpatialStructureElement");c="true"===c.get("isExternal");this._markupHeaderFiles.push(new g(e,d,c,k,b,a))};n.prototype._parseHeader=function(b){var c=this._getElementAttributes(b).get("ProjectGuid");void 0!==c&&(this._projectGuid=c);b=b.firstElementChild;null!==b&&this._addFile(b)};n.prototype._parseTopic=function(b){var c=this._getElementAttributes(b),
g=c.get("Guid");if(void 0!==g&&(this._topic.guid=g,this._topic.topicType=c.get("TopicType")||c.get("Status"),this._topic.topicStatus=c.get("TopicStatus")||c.get("VerbalStatus"),b=b.firstElementChild,null!==b))for(;null!==b;){var a=b.localName;if(null===a)break;c=this._getChildData(b);g=this._getElementAttributes(b);switch(a){case "BimSnippet":void 0===this._topic.bimSnippets&&(this._topic.bimSnippets=[]);a=c.get("Reference");var k=g.get("SnippetType");void 0!==a&&void 0!==k&&(a={snippetType:k,reference:a},
g.get("isExternal")&&(a.isExternal="true"===g.get("isExternal")),c.get("ReferenceSchema")&&(a.referenceSchema=c.get("ReferenceSchema")),this._topic.bimSnippets.push(a));break;case "DocumentReference":void 0===this._topic.documentReferences&&(this._topic.documentReferences=[]);g={};c.get("Guid")&&(g.guid=c.get("Guid"));c.get("isExternal")&&(g.isExternal="true"===c.get("isExternal"));c.get("Description")&&(g.description=c.get("Description"));c.get("ReferencedDocument")&&(g.referencedDocument=c.get("ReferencedDocument"));
this._topic.documentReferences.push(g);break;case "RelatedTopic":void 0===this._topic.relatedTopics&&(this._topic.relatedTopics=[]);c=c.get("Guid");void 0!==c&&this._topic.relatedTopics.push({guid:c});break;case "ReferenceLink":b.textContent&&(this._topic.referenceLink=b.textContent);break;case "Title":b.textContent&&(this._topic.title=b.textContent);break;case "Priority":b.textContent&&(this._topic.priority=b.textContent);break;case "Index":b.textContent&&(this._topic.index=parseInt(b.textContent,
10));break;case "Labels":b.textContent&&(void 0===this._topic.labels&&(this._topic.labels=[]),this._topic.labels.push(b.textContent));break;case "CreationDate":b.textContent&&(this._topic.creationDate=new Date(b.textContent));break;case "CreationAuthor":b.textContent&&(this._topic.creationAuthor=b.textContent);break;case "ModifiedDate":b.textContent&&(this._topic.modifiedDate=new Date(b.textContent));break;case "ModifiedAuthor":b.textContent&&(this._topic.modifiedAuthor=b.textContent);break;case "DueDate":b.textContent&&
(this._topic.dueDate=new Date(b.textContent));break;case "AssignedTo":b.textContent&&(this._topic.assignedTo=b.textContent);break;case "Description":b.textContent&&(this._topic.description=b.textContent);break;case "Stage":b.textContent&&(this._topic.stage=b.textContent)}b=b.nextElementSibling}};n.prototype._parseComment=function(b){var c=new Date,g="",a="",k,e=this._getElementAttributes(b).get("Guid");if(e){b=b.firstElementChild;if(null!==b)for(;null!==b;){var d=b.localName;if(null===d)break;switch(d){case "Date":b.textContent&&
(c=new Date(b.textContent));break;case "Author":b.textContent&&(g=b.textContent);break;case "Comment":b.textContent&&(a=b.textContent);break;case "Viewpoint":var n=this._getElementAttributes(b).get("Guid");break;case "ModifiedDate":b.textContent&&(k=new Date(b.textContent));break;case "ModifiedAuthor":if(b.textContent)var f=b.textContent}b=b.nextElementSibling}c=new l(e,c,g,a,n,k,f);this._comments.set(e,c)}};n.prototype._parseViewpoint=function(b){var c=this._getElementAttributes(b).get("Guid");if(void 0!==
c){var g=this._getChildData(b);b=g.get("Viewpoint");var a=g.get("Snapshot");g=g.get("Index");this.addViewpoint(c,b,a,g)}};n.prototype.addViewpoint=function(b,c,g,a){this._viewpoints.set(b,new k(b,c,g,a))};n.prototype._getChildData=function(b){var c=new Map;for(b=b.firstElementChild;null!==b;){var g=b.localName,a=null;null===b.firstElementChild&&(a=b.textContent);null!==g&&null!==a&&c.set(g,a);b=b.nextElementSibling}return c};n.prototype._getElementAttributes=function(b){b=b.attributes;for(var c=new Map,
g=0;g<b.length;++g){var a=b[g];c.set(a.name,a.value)}return c};return n}();d.BCFMarkup=n})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,e){this._filename=a;this._data=e}d.createFromImage=function(a,e){e=d.snapshotDataFromImage(e);return new d(a,e)};d.prototype.getFilename=function(){return this._filename};d.prototype.getData=function(){return this._data};d.prototype.getUrl=function(){var a=new Blob([this._data],{type:"image/png"});return URL.createObjectURL(a,{oneTimeOnly:!0})};d.snapshotDataFromImage=function(a){return d._convertDataURIToBinary(a.src)};d._convertDataURIToBinary=function(a){var e=
a.indexOf(";base64,")+8;a=window.atob(a.substring(e));return Uint8Array.from(Array.prototype.map.call(a,function(c){return c.charCodeAt(0)}))};return d}();d.BCFSnapshot=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(a,e,c,b){this._viewpointMap=new Map;this._snapshotMap=new Map;this._viewer=b;this._topicId=c;this._bcfDataId=a;this._bcfFilename=e}f.createTopic=function(a,e,c,b,g){void 0===g&&(g=null);return __awaiter(this,void 0,void 0,function(){var k,l,n,m,p,r,h,u,t;return __generator(this,function(q){switch(q.label){case 0:return k=d.GUID.create(),l=new f(e,c,k,a),n=l.addMarkup("markup.bcf",null),n.setTopicTitle(b),m="viewpoint.bcfv",[4,d.BCFViewpoint.createViewpoint(a,
m,g)];case 1:return p=q.sent(),l.setViewpoint(m,p),r="snapshot.png",(u=null!==g?g.getSnapshotImage():null)?[3,3]:[4,a.takeSnapshot()];case 2:u=q.sent(),q.label=3;case 3:return h=u,t=d.BCFSnapshot.createFromImage(r,h),l.setSnapshot(r,t),[2,l]}})})};f.prototype.getTopicId=function(){return this._topicId};f.prototype.addMarkup=function(a,e){return this._markup=new d.BCFMarkup(a,e,this)};f.prototype.getMarkup=function(){return this._markup};f.prototype.addViewpoint=function(a,e,c,b,g){e=new d.BCFViewpoint(a,
e,c,b,g,this._viewer);this.setViewpoint(a,e);return e};f.prototype.setViewpoint=function(a,e){this._viewpointMap.set(a,e)};f.prototype.getViewpointMap=function(){return this._viewpointMap};f.prototype.getViewpoint=function(a){return this._viewpointMap.get(a)||null};f.prototype.addSnapshot=function(a,e){e=new d.BCFSnapshot(a,e);this.setSnapshot(a,e)};f.prototype.setSnapshot=function(a,e){this._snapshotMap.set(a,e)};f.prototype.getSnapshotMap=function(){return this._snapshotMap};f.prototype.getSnapshot=
function(a){return this._snapshotMap.get(this._massageSnapshotFilename(a))||null};f.prototype._massageSnapshotFilename=function(a){if("viewpoint.bcfv"===a)return"snapshot.png";var e=a.split(".");return"bcfv"===e[1]?e[0]+".png":a};return f}();d.BCFTopic=h})(Communicator||(Communicator={}));
(function(d){function h(b){return b?"true":"false"}function f(b,c){b=b.createElement("Component");b.setAttribute("IfcGuid",c.ifcGuid);c.originatingSystem&&b.setAttribute("OriginatingSystem",c.originatingSystem);c.authoringToolId&&b.setAttribute("AuthoringToolId",c.authoringToolId);return b}function a(b){return 1===b.length?"0"+b:b}function e(b,c){c=c?a(Math.round(c).toString(16)):"";var g=a(Math.round(b.r).toString(16)),k=a(Math.round(b.g).toString(16));b=a(Math.round(b.b).toString(16));return""+
c+g+k+b}function c(b,c,a){var g=b.createElement("X"),k=b.createElement("Y");b=b.createElement("Z");g.innerHTML=a.x.toString();k.innerHTML=a.y.toString();b.innerHTML=a.z.toString();c.appendChild(g);c.appendChild(k);c.appendChild(b)}var b=function(){function b(b,c,g,a,e,f){this._version=d.BCFVersion.Unknown;this._components={};this._lines=[];this._clippingPlanes=[];this._viewer=f;this._filename=b;this._version=g;this._modelBounding=a;this._unitScale=1E3/e;this._parseDocument(c)}b.createViewpoint=function(c,
g,a){void 0===a&&(a=null);return __awaiter(this,void 0,void 0,function(){var k,e,l,n,f,h,v,w,z,y,x,A,B,D,C,E;return __generator(this,function(m){switch(m.label){case 0:return k=function(b){var c=[];b.forEach(function(b){for(var g=null;null!==b&&null===g;)g=e.getNodeGenericId(b),b=e.getNodeParent(b);null!==g&&c.push(g)});return c},e=c.model,l=e.getAbsoluteRootNode(),[4,c.model.getVisibilityState(l)];case 1:return n=m.sent(),[4,e.getNodeColorMap(l,d.ElementType.Faces)];case 2:return f=m.sent(),[4,e.getModelBounding(!0,
!1)];case 3:return h=m.sent(),v=e.getNodeUnitMultiplier(l),w=new b(g,null,d.BCFVersion.v2_1,h,v,c),w.setDefaultVisibility(n.defaultVisibility),z=n.visibilityExceptions,y=[],z.forEach(function(b){y.push(b)}),x=k(y),w.setVisibilityExceptions(x),A=c.selectionManager.getResults(),B=A.map(function(b){return b.getNodeId()}),D=k(B),w.setSelection(D),C=new Map,0<f.size&&f.forEach(function(b,c){c=e.getNodeGenericId(c);if(null!==c){var g=C.get(b);void 0===g&&(g=new Set,C.set(b,g));g.add(c)}}),w.setColors(C),
w.setCamera(c.view.getCamera()),null!==a&&(E=b._markupRedlineToBcf(a.getMarkup(),c.view),w.setLines(E)),[2,w]}})})};b._markupRedlineToBcf=function(b,c){var g=function(b){b=c.projectPoint(b);return c.unprojectPoint(d.Point2.fromPoint3(b),0)},a=function(b,c,g){for(var a=2*Math.PI/g,k=[],e=0;e<=g;e++){var l=e*a;k.push(new d.Point2(b.x+Math.cos(l)*c,b.y+Math.sin(l)*c))}return k},k=function(b){for(var c=0;c<b.length-1;++c){var g=b[c],a=b[c+1];null!==g&&null!==a&&(g=[g.copy().scale(.001),a.copy().scale(.001)],
l.push(g))}},e=function(b){for(var c=0;c<b.length;++c){var g=b[c],a=b[(c+1)%b.length];null!==g&&null!==a&&(g=[g.copy().scale(.001),a.copy().scale(.001)],l.push(g))}},l=[];b.forEach(function(b){if(b instanceof d.Markup.Redline.RedlinePolyline){var l=b.getPoints().map(g);k(l)}else if(b instanceof d.Markup.Redline.RedlineCircle){l=b.getCenter();var n=b.getRadiusPoint();b=d.Point2.fromPoint3(c.projectPoint(l));l=d.Point2.fromPoint3(c.projectPoint(n));l=d.Point2.subtract(l,b).length();l=a(b,l,40).map(function(b){return c.unprojectPoint(b,
0)});e(l)}else b instanceof d.Markup.Redline.RedlineRectangle&&(l=b.getPoint1(),n=b.getPoint2(),b=d.Point2.fromPoint3(c.projectPoint(l)),n=d.Point2.fromPoint3(c.projectPoint(n)),l=[],l.push(c.unprojectPoint(b,0)),l.push(c.unprojectPoint(new d.Point2(b.x,n.y),0)),l.push(c.unprojectPoint(n,0)),l.push(c.unprojectPoint(new d.Point2(n.x,b.y),0)),e(l))});return l};b.prototype._parseDocument=function(b){if(null!==b){b=b.documentElement;var c=b.attributes.getNamedItem("Guid");null!==c&&(this._viewpointGuid=
c.value);for(b=b.firstElementChild;null!==b;){c=b.localName;if(null===c)break;switch(c){case "Components":this._version>=d.BCFVersion.v2_1?this._parseComponents(b):this._parseComponentsV2_0(b);break;case "OrthogonalCamera":this._parseOrthogonalCamera(b);break;case "PerspectiveCamera":this._parsePerspectiveCamera(b);break;case "Lines":this._parseLines(b);break;case "ClippingPlanes":this._parseClippingPlanes(b)}b=b.nextElementSibling}}};b.prototype._exportComponents=function(b){var c=b.createElement("Components"),
g=b.createElement("ViewSetupHints"),a=this._components.viewSetupHints;a&&(c.setAttribute("SpacesVisible",h(a.spacesVisible)),c.setAttribute("SpaceBoundariesVisible",h(a.spaceBoundariesVisible)),c.setAttribute("OpeningsVisible",h(a.openingsVisible)));c.appendChild(g);var k=b.createElement("Selection");(g=this._components.selection)&&g.forEach(function(c){k.appendChild(f(b,c))});c.appendChild(k);g=b.createElement("Visibility");a=this._components.defaultVisibility;var d=this._components.visibilityExceptions;
if(void 0!==a&&void 0!==d){g.setAttribute("DefaultVisibility",h(a));var q=b.createElement("Exceptions");d.forEach(function(c){q.appendChild(f(b,c))});g.appendChild(q)}c.appendChild(g);var u=b.createElement("Coloring");(g=this._components.coloring)&&g.forEach(function(c){var g=b.createElement("Color");g.setAttribute("Color",e(c.color,c.alpha));c.components.forEach(function(c){g.appendChild(f(b,c))});u.appendChild(g)});c.appendChild(u);return c};b.prototype._exportOrthogonalCamera=function(b,g){var a=
b.createElement("OrthogonalCamera"),k=b.createElement("CameraViewPoint"),e=b.createElement("CameraViewPoint"),d=b.createElement("CameraViewPoint");c(b,k,g.cameraViewPoint);c(b,e,g.cameraDirection);c(b,d,g.cameraUpVector);b=b.createElement("ViewToWorldScale");b.innerHTML=g.viewToWorldScale.toString();a.appendChild(k);a.appendChild(e);a.appendChild(d);a.appendChild(b);return a};b.prototype._exportPerspectiveCamera=function(b,g){var a=b.createElement("PerspectiveCamera"),k=b.createElement("CameraViewPoint"),
e=b.createElement("CameraViewPoint"),d=b.createElement("CameraViewPoint");c(b,k,g.cameraViewPoint);c(b,e,g.cameraDirection);c(b,d,g.cameraUpVector);b=b.createElement("FieldOfView");b.innerHTML=g.fieldOfView.toString();a.appendChild(k);a.appendChild(e);a.appendChild(d);a.appendChild(b);return a};b.prototype._exportLines=function(b){var g=b.createElement("Lines");this._lines.forEach(function(a){var k=b.createElement("Line"),e=b.createElement("StartPoint"),d=b.createElement("EndPoint");c(b,e,a.startPoint);
c(b,d,a.endPoint);k.appendChild(e);k.appendChild(d);g.appendChild(k)});return g};b.prototype._exportClippingPlanes=function(b){var g=b.createElement("ClippingPlanes");this._clippingPlanes.forEach(function(a){var k=b.createElement("ClippingPlane"),e=b.createElement("Location"),d=b.createElement("Direction");c(b,e,a.location);c(b,d,a.direction);k.appendChild(e);k.appendChild(d);g.appendChild(k)});return g};b.prototype.export=function(){var b=document.implementation.createDocument("","",null),c=b.createElement("VisualizationInfo");
c.appendChild(this._exportComponents(b));void 0!==this._viewpointGuid&&c.setAttribute("Guid",this._viewpointGuid);this._orthogonalCamera?c.appendChild(this._exportOrthogonalCamera(b,this._orthogonalCamera)):this._perspectiveCamera&&c.appendChild(this._exportPerspectiveCamera(b,this._perspectiveCamera));0<this._lines.length&&c.appendChild(this._exportLines(b));0<this._clippingPlanes.length&&c.appendChild(this._exportClippingPlanes(b));b.appendChild(c);return b};b.prototype.activate=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._activateCamera(),[4,this._activateComponentsVisibility()];case 1:return b.sent(),[4,this._activateMarkup()];case 2:return b.sent(),[4,this._activateCuttingPlanes()];case 3:return b.sent(),this._activateSelected(),[4,this._activateColors()];case 4:return b.sent(),[2]}})})};b.prototype._activateCamera=function(){var b=this.getCamera();null!==b&&this._viewer.view.setCamera(b,800)};b.prototype._activateComponentsVisibility=
function(){return __awaiter(this,void 0,void 0,function(){var b,c,g;return __generator(this,function(a){switch(a.label){case 0:return b=this._viewer.model,c=this._getDefaultVisibility(),g=b.getNodeIdsByGenericIds(this.getVisibilityExceptions()),g.length?[4,b.setNodesVisibility([-2],c)]:[3,3];case 1:return a.sent(),[4,b.setNodesVisibility(g,!c)];case 2:return a.sent(),[3,5];case 3:return[4,b.reset()];case 4:a.sent(),a.label=5;case 5:return[2]}})})};b.prototype._activateMarkup=function(){return __awaiter(this,
void 0,void 0,function(){var b,c,g,a,e;return __generator(this,function(k){switch(k.label){case 0:return b=this._viewer.lineManager,[4,b.removeAllLines()];case 1:k.sent();c=[];for(g=0;g<this._lines.length;++g)a=this._lines[g],e=new d.Markup.Line.LineMarkup(this._viewer,a.startPoint.copy().scale(1E3),a.endPoint.copy().scale(1E3)),c.push(b.addLine(e));return[4,Promise.all(c)];case 2:return k.sent(),[2]}})})};b.prototype._activateCuttingPlanes=function(){return __awaiter(this,void 0,void 0,function(){var b,
c,g,a,e,f,h,u,t,v;return __generator(this,function(k){switch(k.label){case 0:return b=this._viewer.model,[4,b.getModelBounding(!0,!1)];case 1:return c=k.sent(),g=this._viewer.cuttingManager,[4,g.deactivateCuttingSections(!0)];case 2:k.sent(),a=0,k.label=3;case 3:if(!(a<this._clippingPlanes.length))return[3,7];e=g.getCuttingSection(a);return[4,e.clear()];case 4:return k.sent(),f=this._clippingPlanes[a],h=f.location.copy().scale(1E3),u=f.direction.normalize(),t=d.Plane.createFromPointAndNormal(h,u),
v=g.createReferenceGeometryFromFaceNormal(u,h,c),[4,e.addPlane(t,v)];case 5:k.sent(),k.label=6;case 6:return++a,[3,3];case 7:return[4,g.activateCuttingSections()];case 8:return k.sent(),[2]}})})};b.prototype._activateSelected=function(){var b=this._getGenericIdsFromComponents(this._components.selection);if(b){b=this._viewer.model.getNodeIdsByGenericIds(b);this._viewer.selectionManager.clear();for(var c=0;c<b.length;++c)this._viewer.selectionManager.selectNode(b[c],d.SelectionMode.Add)}};b.prototype._activateColors=
function(){return __awaiter(this,void 0,void 0,function(){var b,c,g,a,e;return __generator(this,function(k){switch(k.label){case 0:return b=this._viewer.model,[4,b.resetNodesColor()];case 1:k.sent();if(void 0===this._components.coloring)return[3,3];c=new Map;g=function(g){var k=a._components.coloring[g];g=a._getGenericIdsFromComponents(k.components);b.getNodeIdsByGenericIds(g).forEach(function(b){c.set(b,k.color)})};a=this;for(e=0;e<this._components.coloring.length;++e)g(e);return[4,this._viewer.model.setNodesColors(c)];
case 2:k.sent(),k.label=3;case 3:return[2]}})})};b.prototype.getFilename=function(){return this._filename};b.prototype.getViewpointGuid=function(){return this._viewpointGuid||null};b.prototype._fromBCFPerspectiveCamera=function(b,c){var g=new d.Camera;g.setProjection(d.Projection.Perspective);var a=b.cameraViewPoint.copy().scale(this._unitScale);c=b.cameraDirection.copy().normalize().scale(c);c=d.Point3.add(a,c);var k=b.cameraUpVector.copy().normalize();g.setPosition(a);g.setTarget(c);g.setUp(k);
b=d.Util.degreesToRadians(b.fieldOfView);b=Math.tan(b/2);b*=2*d.Point3.subtract(g.getTarget(),g.getPosition()).length();g.setWidth(b);g.setHeight(b);return g};b.prototype._fromBCFOrthogonalCamera=function(b,c){var g=new d.Camera;g.setProjection(d.Projection.Orthographic);var a=b.cameraViewPoint.copy().scale(this._unitScale);c=b.cameraDirection.copy().normalize().scale(c);c=d.Point3.add(a,c);var k=b.cameraUpVector.copy().normalize();g.setPosition(a);g.setTarget(c);g.setUp(k);b=b.viewToWorldScale*this._unitScale*
2;g.setWidth(b);g.setHeight(b);return g};b.prototype.getCamera=function(){var b=this._modelBounding.extents().length();return this._perspectiveCamera?this._fromBCFPerspectiveCamera(this._perspectiveCamera,b/40):this._orthogonalCamera?this._fromBCFOrthogonalCamera(this._orthogonalCamera,b):null};b.prototype.setCamera=function(b){b.getProjection()===d.Projection.Perspective?(this._perspectiveCamera=this._toBCFPerspectiveCamera(b),this._orthogonalCamera=void 0):(this._orthogonalCamera=this._toBCFOrthogonalCamera(b),
this._perspectiveCamera=void 0)};b.prototype._toBCFOrthogonalCamera=function(b){var c=b.getPosition(),g=b.getTarget();g=d.Point3.subtract(g,c).normalize();var a=b.getUp().normalize();c=c.copy().scale(1/this._unitScale);b=b.getWidth()/(2*this._unitScale);return{cameraDirection:g,cameraUpVector:a,cameraViewPoint:c,viewToWorldScale:b}};b.prototype._toBCFPerspectiveCamera=function(b){var c=b.getPosition(),g=b.getTarget();g=d.Point3.subtract(g,c).normalize();var a=b.getUp().normalize();c=c.copy().scale(1/
this._unitScale);var k=b.getWidth();b=d.Point3.subtract(b.getTarget(),b.getPosition()).length();b=d.Util.radiansToDegrees(2*Math.atan(k/(2*b)));return{cameraDirection:g,cameraUpVector:a,cameraViewPoint:c,fieldOfView:b}};b.prototype.setDefaultVisibility=function(b){this._components.defaultVisibility=b};b.prototype._getDefaultVisibility=function(){return void 0!==this._components.defaultVisibility?this._components.defaultVisibility:!0};b.prototype.setVisibilityExceptions=function(b){b=b.map(function(b){return{ifcGuid:b}});
this._components.visibilityExceptions=b};b.prototype.getVisibilityExceptions=function(){return this._getGenericIdsFromComponents(this._components.visibilityExceptions)};b.prototype.setColors=function(b){var c=[];b.forEach(function(b,g){var a=[];b.forEach(function(b){a.push({ifcGuid:b})});c.push({color:g,components:a})});this._components.coloring=c};b.prototype.getColors=function(){var b=new Map,c=this._components.coloring;void 0!==c&&c.forEach(function(c){var g=c.color.copy(),a=new Set;c.components.map(function(b){a.add(b.ifcGuid)});
b.set(g,a)});return b};b.prototype.setLines=function(b){var c=this;this._lines=[];b.forEach(function(b){b={startPoint:b[0].copy(),endPoint:b[1].copy()};c._lines.push(b)})};b.prototype.getLines=function(){var b=[];this._lines.forEach(function(c){b.push([c.startPoint.copy(),c.endPoint.copy()])});return b};b.prototype.setClippingPlanes=function(b){var c=this;this._clippingPlanes=[];b.forEach(function(b){b={location:b[0].copy(),direction:b[1].copy()};c._clippingPlanes.push(b)})};b.prototype.getClippingPlanes=
function(){var b=[];this._clippingPlanes.forEach(function(c){b.push([c.location.copy(),c.direction.copy()])});return b};b.prototype.setSelection=function(b){b=b.map(function(b){return{ifcGuid:b}});this._components.selection=b};b.prototype.getSelection=function(){var b=[],c=this._components.selection;void 0!==c&&c.forEach(function(c){b.push(c.ifcGuid)});return b};b.prototype._getGenericIdsFromComponents=function(b){if(!b)return[];for(var c=[],g=0;g<b.length;++g)c.push(b[g].ifcGuid);return c};b.prototype._parseComponentsV2_0=
function(b){console.assert(this._version<=d.BCFVersion.v2_0);var c=[],g=[],a=[],e=!0;for(b=b.firstElementChild;null!==b;){var k=b.localName;if(null===k)break;switch(k){case "Component":var f=b.attributes,h=f.getNamedItem("IfcGuid");k=f.getNamedItem("Selected");var t=f.getNamedItem("Visible");f=f.getNamedItem("Color");null!==h&&h.value&&(h={ifcGuid:h.value},null!==k&&"true"===k.value&&c.push(h),e=!1,null!==t&&"false"===t.value||g.push(h),null!==f&&f.value&&a.push(this._colorFromArgb(f.value,[h])))}b=
b.nextElementSibling}this._components={defaultVisibility:e,selection:c,visibilityExceptions:g,coloring:a}};b.prototype._parseComponents=function(b){console.assert(this._version>=d.BCFVersion.v2_1);b=b.firstElementChild;for(var c={spacesVisible:!1,spaceBoundariesVisible:!1,openingsVisible:!1},g=[],a=!0,e=[],k=[];null!==b;){var f=b.localName;if(null===f)break;var h=b.attributes;switch(f){case "ViewSetupHints":f=h.getNamedItem("SpacesVisible");var t=h.getNamedItem("SpaceBoundariesVisible");h=h.getNamedItem("OpeningsVisible");
null!==f&&(c.spacesVisible="true"===f.value);null!==t&&(c.spaceBoundariesVisible="true"===t.value);null!==h&&(c.openingsVisible="true"===h.value);break;case "Selection":g=this._getComponents(b);break;case "Visibility":(h=h.getNamedItem("DefaultVisibility"))&&(a="true"===h.value);h=b.firstElementChild;null!==h&&(e=this._getComponents(h));break;case "Coloring":k=this._getColoring(b)}b=b.nextElementSibling}this._components={viewSetupHints:c,selection:g,defaultVisibility:a,visibilityExceptions:e,coloring:k}};
b.prototype._getCameraData=function(b){var c=[];for(b=b.firstElementChild;null!==b;)switch(b.nodeName){case "FieldOfView":case "ViewToWorldScale":b=b.textContent;null!==b&&c.push(parseFloat(b));b=null;break;default:c.push(this._getPoint(b)),b=b.nextElementSibling}return c};b.prototype._parseOrthogonalCamera=function(b){b=this._getCameraData(b);4===b.length&&(this._orthogonalCamera={cameraViewPoint:b[0],cameraDirection:b[1],cameraUpVector:b[2],viewToWorldScale:b[3]})};b.prototype._parsePerspectiveCamera=
function(b){b=this._getCameraData(b);4===b.length&&(this._perspectiveCamera={cameraViewPoint:b[0],cameraDirection:b[1],cameraUpVector:b[2],fieldOfView:b[3]})};b.prototype._parseLines=function(b){for(b=b.firstElementChild;null!==b;)this._lines.push(this._getLine(b)),b=b.nextElementSibling};b.prototype._parseClippingPlanes=function(b){for(b=b.firstElementChild;null!==b;)this._clippingPlanes.push(this._getClippingPlane(b)),b=b.nextElementSibling};b.prototype._getClippingPlane=function(b){b=b.firstElementChild;
var c=d.Point3.zero(),g=d.Point3.zero();null!==b&&(c=this._getPoint(b),b=b.nextElementSibling,null!==b&&(g=this._getPoint(b)));return{location:c,direction:g}};b.prototype._getLine=function(b){b=b.firstElementChild;var c=d.Point3.zero(),g=d.Point3.zero();null!==b&&(c=this._getPoint(b),b=b.nextElementSibling,null!==b&&(g=this._getPoint(b)));return{startPoint:c,endPoint:g}};b.prototype._getPoint=function(b){var c=[];for(b=b.firstElementChild;null!==b;){var g=b.firstChild;null!==g&&c.push(parseFloat(g.wholeText));
b=b.nextElementSibling}console.assert(3===c.length);return new d.Point3(c[0],c[1],c[2])};b.prototype._colorFromArgb=function(b,c){c={color:d.Color.black(),components:c};for(var g=[],a=0;a<b.length;a+=2){var e=b.substr(a,2);g.push(parseInt(e,16))}3===g.length?c.color.set(g[0],g[1],g[2]):4===g.length&&(c.alpha=g[0],c.color.set(g[1],g[2],g[3]));return c};b.prototype._getColoring=function(b){var c=[];for(b=b.firstElementChild;null!==b;){var g=b.attributes.getNamedItem("Color"),a=this._getComponents(b);
g&&a.length&&c.push(this._colorFromArgb(g.value,a));b=b.nextElementSibling}return c};b.prototype._getComponents=function(b){var c=[];for(b=b.firstElementChild;null!==b;){var g=b.attributes,a=g.getNamedItem("IfcGuid"),e=g.getNamedItem("OriginatingSystem");g=g.getNamedItem("AuthoringToolId");null!==a&&(a={ifcGuid:a.value},null!==e&&(a.originatingSystem=e.value),null!==g&&(a.authoringToolId=g.value),c.push(a));b=b.nextElementSibling}return c};return b}();d.BCFViewpoint=b})(Communicator||(Communicator=
{}));
(function(d){var h=function(){function d(a,e,c){this.x=a;this.y=e;this.z=c}d.prototype.assign=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};d.prototype.set=function(a,e,c){this.x=a;this.y=e;this.z=c;return this};d.prototype.toArray=function(a){a[0]=this.x;a[1]=this.y;a[2]=this.z};d.prototype.fromArray=function(a){this.x=a[0];this.y=a[1];this.z=a[2];return this};d.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};d.prototype.subtract=function(a){this.x-=a.x;this.y-=
a.y;this.z-=a.z;return this};d.prototype.copy=function(){return new d(this.x,this.y,this.z)};d.fromJson=function(a){return new d(a.x,a.y,a.z)};d.construct=function(a){return d.fromJson(a)};d.prototype.toJson=function(){return this._toJson()};d.prototype._toJson=function(){return{x:this.x,y:this.y,z:this.z}};d.prototype.forJson=function(){return this.toJson()};d.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z};d.prototype.equalsWithTolerance=function(a,e){return this.x-
a.x<e&&this.x-a.x>-e&&this.y-a.y<e&&this.y-a.y>-e&&this.z-a.z<e&&this.z-a.z>-e};d.prototype.isAxis=function(){return 1===Math.abs(this.x)&&0===this.y&&0===this.z||0===this.x&&1===Math.abs(this.y)&&0===this.z||0===this.x&&0===this.y&&1===Math.abs(this.z)};d.prototype.length=function(){return Math.sqrt(this.squaredLength())};d.prototype.squaredLength=function(){return this.x*this.x+this.y*this.y+this.z*this.z};d.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};d.prototype.normalize=
function(){return this.scale(1/this.length())};d.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};d.zero=function(){return new d(0,0,0)};d.add=function(a,e){return new d(a.x+e.x,a.y+e.y,a.z+e.z)};d.subtract=function(a,e){return new d(a.x-e.x,a.y-e.y,a.z-e.z)};d.dot=function(a,e){return a.x*e.x+a.y*e.y+a.z*e.z};d.cross=function(a,e){return new d(a.y*e.z-a.z*e.y,a.z*e.x-a.x*e.z,a.x*e.y-a.y*e.x)};d.distance=function(a,e){return d.subtract(e,a).length()};d.scale=function(a,
e){return a.copy().scale(e)};d.createFromArray=function(a){return new d(a[0],a[1],a[2])};return d}();d.Point3=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(){this.loadIdentity()}f.prototype.loadIdentity=function(){this.m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return this};f.prototype.isIdentity=function(){var a=this.m;return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&0===a[12]&&0===a[13]&&0===a[14]&&1===a[15]};f.prototype.equals=function(a){for(var e=0;16>e;++e)if(this.m[e]!==a.m[e])return!1;return!0};f.prototype.equalsWithTolerance=function(a,
e){e=Math.abs(e);for(var c=0;16>c;++c)if(Math.abs(this.m[c]-a.m[c])>e)return!1;return!0};f.prototype.setScaleComponent=function(a,e,c){this.m[0]=a;this.m[5]=e;this.m[10]=c;return this};f.prototype.setTranslationComponent=function(a,e,c){this.m[12]=a;this.m[13]=e;this.m[14]=c;return this};f.prototype.copy=function(){var a=new f;a.m=this.m.slice();return a};f.prototype.assign=function(a){for(var e=0;e<a.m.length;e++)this.m[e]=a.m[e];return this};f.prototype.scale=function(a){for(var e=0;16>e;e++)this.m[e]*=
a;return this};f.prototype.transform=function(a,e){if(void 0===e)return e=d.Point3.zero(),this.transform(a,e),e;e.set(a.x*this.m[0]+a.y*this.m[4]+a.z*this.m[8]+this.m[12],a.x*this.m[1]+a.y*this.m[5]+a.z*this.m[9]+this.m[13],a.x*this.m[2]+a.y*this.m[6]+a.z*this.m[10]+this.m[14])};f.prototype.transform4=function(a,e){if(void 0===e)return e=d.Point4.zero(),this.transform4(a,e),e;e.set(a.x*this.m[0]+a.y*this.m[4]+a.z*this.m[8]+this.m[12]*a.w,a.x*this.m[1]+a.y*this.m[5]+a.z*this.m[9]+this.m[13]*a.w,a.x*
this.m[2]+a.y*this.m[6]+a.z*this.m[10]+this.m[14]*a.w,a.x*this.m[3]+a.y*this.m[7]+a.z*this.m[11]+this.m[15]*a.w)};f.prototype.transformArray=function(a,e){for(var c=0;c<a.length;c++){var b=a[c];b=new d.Point3(b.x*this.m[0]+b.y*this.m[4]+b.z*this.m[8]+this.m[12],b.x*this.m[1]+b.y*this.m[5]+b.z*this.m[9]+this.m[13],b.x*this.m[2]+b.y*this.m[6]+b.z*this.m[10]+this.m[14]);e[c]=b}};f.prototype.transformBox=function(a){if(a.isDegenerate())return d.Box.invalid();a=a.getCorners();for(var e=0;e<a.length;e++){var c=
a[e];this.transform(c,c)}e=new d.Box(a[0],a[0]);for(var b=1;b<a.length;++b)c=a[b],e.addPoint(c);return e};f.prototype.transpose=function(){var a=this.m[1];this.m[1]=this.m[4];this.m[4]=a;a=this.m[2];this.m[2]=this.m[8];this.m[8]=a;a=this.m[3];this.m[3]=this.m[12];this.m[12]=a;a=this.m[6];this.m[6]=this.m[9];this.m[9]=a;a=this.m[7];this.m[7]=this.m[13];this.m[13]=a;a=this.m[11];this.m[11]=this.m[14];this.m[14]=a;return this};f.createFromArray=function(a){var e=new f;e.m=a.slice();return e};f.createFromOffAxisRotation=
function(a,e){var c=Math.PI/180*e;e=Math.sin(c);c=Math.cos(c);var b=new f;a=a.copy().normalize();var g=1-c,k=g*a.x*a.y,d=g*a.x*a.z,n=g*a.y*a.z;b.m[0]=g*a.x*a.x+c;b.m[1]=e*a.z+k;b.m[2]=d-e*a.y;b.m[3]=0;b.m[4]=k-e*a.z;b.m[5]=g*a.y*a.y+c;b.m[6]=e*a.x+n;b.m[7]=0;b.m[8]=e*a.y+d;b.m[9]=n-e*a.x;b.m[10]=g*a.z*a.z+c;b.m[11]=0;b.m[12]=0;b.m[13]=0;b.m[14]=0;b.m[15]=1;return b};f.createFromBasis=function(a,e,c){var b=new f;b.m[0]=a.x;b.m[1]=a.y;b.m[2]=a.z;b.m[4]=e.x;b.m[5]=e.y;b.m[6]=e.z;b.m[8]=c.x;b.m[9]=c.y;
b.m[10]=c.z;return b};f.multiply=function(a,e){var c=new f;c.m[0]=a.m[0]*e.m[0]+a.m[1]*e.m[4]+a.m[2]*e.m[8]+a.m[3]*e.m[12];c.m[1]=a.m[0]*e.m[1]+a.m[1]*e.m[5]+a.m[2]*e.m[9]+a.m[3]*e.m[13];c.m[2]=a.m[0]*e.m[2]+a.m[1]*e.m[6]+a.m[2]*e.m[10]+a.m[3]*e.m[14];c.m[3]=a.m[0]*e.m[3]+a.m[1]*e.m[7]+a.m[2]*e.m[11]+a.m[3]*e.m[15];c.m[4]=a.m[4]*e.m[0]+a.m[5]*e.m[4]+a.m[6]*e.m[8]+a.m[7]*e.m[12];c.m[5]=a.m[4]*e.m[1]+a.m[5]*e.m[5]+a.m[6]*e.m[9]+a.m[7]*e.m[13];c.m[6]=a.m[4]*e.m[2]+a.m[5]*e.m[6]+a.m[6]*e.m[10]+a.m[7]*
e.m[14];c.m[7]=a.m[4]*e.m[3]+a.m[5]*e.m[7]+a.m[6]*e.m[11]+a.m[7]*e.m[15];c.m[8]=a.m[8]*e.m[0]+a.m[9]*e.m[4]+a.m[10]*e.m[8]+a.m[11]*e.m[12];c.m[9]=a.m[8]*e.m[1]+a.m[9]*e.m[5]+a.m[10]*e.m[9]+a.m[11]*e.m[13];c.m[10]=a.m[8]*e.m[2]+a.m[9]*e.m[6]+a.m[10]*e.m[10]+a.m[11]*e.m[14];c.m[11]=a.m[8]*e.m[3]+a.m[9]*e.m[7]+a.m[10]*e.m[11]+a.m[11]*e.m[15];c.m[12]=a.m[12]*e.m[0]+a.m[13]*e.m[4]+a.m[14]*e.m[8]+a.m[15]*e.m[12];c.m[13]=a.m[12]*e.m[1]+a.m[13]*e.m[5]+a.m[14]*e.m[9]+a.m[15]*e.m[13];c.m[14]=a.m[12]*e.m[2]+
a.m[13]*e.m[6]+a.m[14]*e.m[10]+a.m[15]*e.m[14];c.m[15]=a.m[12]*e.m[3]+a.m[13]*e.m[7]+a.m[14]*e.m[11]+a.m[15]*e.m[15];return c};f.prototype.inverseAndDeterminant=function(){var a=this.m[4]*this.m[9]-this.m[5]*this.m[8],e=this.m[4]*this.m[10]-this.m[6]*this.m[8],c=this.m[4]*this.m[11]-this.m[7]*this.m[8],b=this.m[4]*this.m[13]-this.m[5]*this.m[12],g=this.m[4]*this.m[14]-this.m[6]*this.m[12],k=this.m[4]*this.m[15]-this.m[7]*this.m[12],d=this.m[5]*this.m[10]-this.m[6]*this.m[9],n=this.m[5]*this.m[11]-
this.m[7]*this.m[9],m=this.m[5]*this.m[14]-this.m[6]*this.m[13],p=this.m[5]*this.m[15]-this.m[7]*this.m[13],h=this.m[6]*this.m[11]-this.m[7]*this.m[10],q=this.m[6]*this.m[15]-this.m[7]*this.m[14],u=this.m[8]*this.m[13]-this.m[9]*this.m[12],t=this.m[8]*this.m[14]-this.m[10]*this.m[12],v=this.m[8]*this.m[15]-this.m[11]*this.m[12],w=this.m[9]*this.m[14]-this.m[10]*this.m[13],z=this.m[9]*this.m[15]-this.m[11]*this.m[13],y=this.m[10]*this.m[15]-this.m[11]*this.m[14],x=new f;x.m[0]=this.m[5]*y-this.m[6]*
z+this.m[7]*w;x.m[1]=this.m[2]*z-this.m[3]*w-this.m[1]*y;x.m[2]=this.m[1]*q-this.m[2]*p+this.m[3]*m;x.m[3]=this.m[2]*n-this.m[3]*d-this.m[1]*h;x.m[4]=this.m[6]*v-this.m[7]*t-this.m[4]*y;x.m[5]=this.m[0]*y-this.m[2]*v+this.m[3]*t;x.m[6]=this.m[2]*k-this.m[3]*g-this.m[0]*q;x.m[7]=this.m[0]*h-this.m[2]*c+this.m[3]*e;x.m[8]=this.m[4]*z-this.m[5]*v+this.m[7]*u;x.m[9]=this.m[1]*v-this.m[3]*u-this.m[0]*z;x.m[10]=this.m[0]*p-this.m[1]*k+this.m[3]*b;x.m[11]=this.m[1]*c-this.m[3]*a-this.m[0]*n;x.m[12]=this.m[5]*
t-this.m[6]*u-this.m[4]*w;x.m[13]=this.m[0]*w-this.m[1]*t+this.m[2]*u;x.m[14]=this.m[1]*g-this.m[2]*b-this.m[0]*m;x.m[15]=this.m[0]*d-this.m[1]*e+this.m[2]*a;a=this.m[0]*x.m[0]-this.m[1]*-x.m[4]+this.m[2]*x.m[8]-this.m[3]*-x.m[12];if(0===a)return[null,0];x.scale(1/a);return[x,a]};f.inverse=function(a){return a.inverseAndDeterminant()[0]};f.prototype.upperLeft3x3Determinant=function(){return this.m[0]*(this.m[5]*this.m[10]-this.m[9]*this.m[6])-this.m[4]*(this.m[1]*this.m[10]-this.m[9]*this.m[2])+this.m[8]*
(this.m[1]*this.m[6]-this.m[5]*this.m[2])};f.prototype.normalMatrix=function(){var a=this.copy().setTranslationComponent(0,0,0).inverseAndDeterminant()[0];return a?a.transpose():null};f.prototype.toJson=function(){return this.m.slice()};f.prototype.forJson=function(){return this.toJson()};f.fromJson=function(a){return f.createFromArray(a)};f.construct=function(a){return f.fromJson(a)};f.toMatrix12=function(a){return[a[0],a[1],a[2],a[4],a[5],a[6],a[8],a[9],a[10],a[12],a[13],a[14]]};f.xAxisRotation=
function(a){var e=new f,c=d.Util.degreesToRadians(a);a=Math.cos(c);c=Math.sin(c);e.m[5]=a;e.m[6]=-c;e.m[9]=c;e.m[10]=a;return e};f.yAxisRotation=function(a){var e=new f,c=d.Util.degreesToRadians(a);a=Math.cos(c);c=Math.sin(c);e.m[0]=a;e.m[2]=c;e.m[8]=-c;e.m[10]=a;return e};f.zAxisRotation=function(a){var e=new f,c=d.Util.degreesToRadians(a);a=Math.cos(c);c=Math.sin(c);e.m[0]=a;e.m[1]=-c;e.m[4]=c;e.m[5]=a;return e};return f}();d.Matrix=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,e,c){this.r=a;this.g=e;this.b=c}d.prototype.assign=function(a){this.set(a.r,a.g,a.b);return this};d.prototype.copy=function(){return new d(this.r,this.g,this.b)};d.prototype.equals=function(a){return this.r===a.r&&this.g===a.g&&this.b===a.b};d.prototype.set=function(a,e,c){this.r=a;this.g=e;this.b=c};d.prototype.setFromFloat=function(a,e,c){this.r=Math.round(255*a);this.g=Math.round(255*e);this.b=Math.round(255*c)};d.prototype.fromFloatArray=function(a){return this.setFromFloat(a[0],
a[1],a[2])};d.prototype.getFloatArray=function(){return[this.r/255,this.g/255,this.b/255]};d.prototype.toFloatArray=function(a){a[0]=this.r/255;a[1]=this.g/255;a[2]=this.b/255};d.fromJson=function(a){return new d(a.r,a.g,a.b)};d.prototype.toJson=function(){return this._toJson()};d.prototype._toJson=function(){return{r:this.r,g:this.g,b:this.b}};d.prototype.forJson=function(){return this.toJson()};d.createFromFloat=function(a,e,c){var b=d.black();b.setFromFloat(a,e,c);return b};d.createFromFloatArray=
function(a){var e=d.black();e.fromFloatArray(a);return e};d.red=function(){return new d(255,0,0)};d.green=function(){return new d(0,255,0)};d.blue=function(){return new d(0,0,255)};d.yellow=function(){return new d(255,255,0)};d.white=function(){return new d(255,255,255)};d.black=function(){return new d(0,0,0)};return d}();d.Color=h;h=function(){return function(d,a){this.top=d;this.bottom=a}}();d.VerticalGradient=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(a){var e=this;this._position=new d.Point2(0,0);this._viewportSize=new d.Point2(200,200);this._anchor=d.OverlayAnchor.LowerLeftCorner;this._instanceKeys=[];this._firstAttachment=this._enabled=!1;this._sceneReadyCompleted=d.Util.OpenPromise.create();this._geometryCreated=!1;this._viewer=a;this._viewer.setCallbacks({sceneReady:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._createViewport(),
this._updateVisibility(),[4,this._createGeometry()];case 1:return c.sent(),this._sceneReadyCompleted.resolve(),[2]}})})},_assemblyTreeReady:function(){return __awaiter(e,void 0,void 0,function(){var c,b,g,a,e;return __generator(this,function(d){switch(d.label){case 0:return[4,this._sceneReadyCompleted];case 1:d.sent();c=this._viewer.model;b=0;for(g=this._instanceKeys;b<g.length;b++)a=g[b],e=c._getNodeFromInstanceInc(!0,0,a,!0),c._preventNodeDeletion(e);return[2]}})})},_firstAttachment:function(){return __awaiter(e,
void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._firstAttachment=!0,[4,this._onCameraUpdate()];case 1:return c.sent(),this._updateVisibility(),[2]}})})},modelSwitchStart:function(){e._firstAttachment=!1}})}f.prototype.setAxisColor=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,g;return __generator(this,function(k){switch(k.label){case 0:return[4,this._sceneReadyCompleted];case 1:k.sent();switch(a){case d.Axis.X:c=this._instanceKeys[0];
b=this._instanceKeys[3];break;case d.Axis.Y:c=this._instanceKeys[1];b=this._instanceKeys[4];break;case d.Axis.Z:c=this._instanceKeys[2];b=this._instanceKeys[5];break;default:return[2]}g=this._getScEngine();g.setPartColor([0,c],d.ElementType.Faces,e);g.setPartColor([0,b],d.ElementType.Lines,e);return[2]}})})};f.prototype.setAnchor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this._anchor=a,[4,this._sceneReadyCompleted];
case 1:return e.sent(),[2,this._updateViewport()]}})})};f.prototype.getAnchor=function(){return this._anchor};f.prototype.enable=function(){this._enabled=!0;this._updateVisibility();return Promise.resolve()};f.prototype.disable=function(){this._enabled=!1;this._updateVisibility();return Promise.resolve()};f.prototype._updateVisibility=function(){this._enabled&&this._firstAttachment?this._showOverlay():this._hideOverlay()};f.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.AxisTriad,
!1)};f.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.AxisTriad,!0)};f.prototype.getEnabled=function(){return this._enabled};f.prototype.getOverlayId=function(){return d.BuiltinOverlayIndex.AxisTriad};f.prototype._updateViewport=function(){this._viewer.overlayManager.setViewport(d.BuiltinOverlayIndex.AxisTriad,this._anchor,this._position.x,d.OverlayUnit.Pixels,this._position.y,d.OverlayUnit.Pixels,this._viewportSize.x,d.OverlayUnit.Pixels,this._viewportSize.y,
d.OverlayUnit.Pixels)};f.prototype._createViewport=function(){var a=this._viewer.overlayManager;this._updateViewport();var e=new d.Camera;e.setPosition(new d.Point3(0,0,10));e.setTarget(d.Point3.zero());e.setUp(new d.Point3(0,1,0));e.setWidth(f._fieldSize);e.setHeight(f._fieldSize);e.setProjection(d.Projection.Orthographic);a.setCamera(d.BuiltinOverlayIndex.AxisTriad,e)};f.prototype._createGeometry=function(){return __awaiter(this,void 0,void 0,function(){var a,e,c,b,g,k,l;return __generator(this,
function(n){switch(n.label){case 0:if(this._geometryCreated)return[2];a=[this._createAxis(f._xRotMatrix,0,f._xColor),this._createAxis(f._yRotMatrix,1,f._yColor),this._createAxis(f._zRotMatrix,2,f._zColor),this._createAxisLabel(d.Axis.X,f._xColor,3),this._createAxisLabel(d.Axis.Y,f._yColor,4),this._createAxisLabel(d.Axis.Z,f._zColor,5)];return[4,Promise.all(a)];case 1:e=n.sent();this._onCameraUpdate();c=[];b=0;for(g=e;b<g.length;b++)k=g[b],c.push(0,k);l=this._getScEngine();l.setPartVisibility(c,!0,
!0);this._createGeomCallbacks();this._geometryCreated=!0;return[2]}})})};f.prototype._createGeomCallbacks=function(){var a=this;this._viewer.setCallbacks({camera:function(){a._onCameraUpdate()}})};f.prototype._geometryHasBeenCreated=function(){return this._geometryCreated};f.prototype._insideOverlay=function(a){var e=this._viewer.view.getCanvasSize(),c=d.Point2.zero();if(this._anchor===d.OverlayAnchor.LowerRightCorner||this._anchor===d.OverlayAnchor.UpperRightCorner||this._anchor===d.OverlayAnchor.RightCenter)c.x=
e.x-this._viewportSize.x;else if(this._anchor===d.OverlayAnchor.Center||this._anchor===d.OverlayAnchor.TopCenter||this._anchor===d.OverlayAnchor.BottomCenter)c.x=.5*(e.x-this._viewportSize.x);if(this._anchor===d.OverlayAnchor.LowerLeftCorner||this._anchor===d.OverlayAnchor.LowerRightCorner||this._anchor===d.OverlayAnchor.BottomCenter)c.y=e.y-this._viewportSize.y;else if(this._anchor===d.OverlayAnchor.Center||this._anchor===d.OverlayAnchor.LeftCenter||this._anchor===d.OverlayAnchor.RightCenter)c.y=
.5*(e.y-this._viewportSize.y);return a.x>=c.x&&a.x<=this._viewportSize.x+c.x&&a.y>=c.y&&a.y<=this._viewportSize.y+c.y};f.prototype._getOverlayOffset=function(){return this._viewer.overlayManager._getOverlayOffset(this._anchor,this._viewportSize)};f.prototype._getViewportSize=function(){return this._viewportSize};f.prototype.getSelectionAxis=function(a){console.assert(this._enabled);if(null===a||!a.isFaceSelection()||a.overlayIndex()!==d.BuiltinOverlayIndex.AxisTriad)return null;var e=this._viewer.model;
a=a.getNodeId();e=e._gatherInstanceIncsFromNodeIds([a],1);if(2!==e.length||0!==e[0])return null;e=e[1];for(a=0;a<this._instanceKeys.length;++a)if(this._instanceKeys[a]===e)switch(a%3){case 0:return d.Axis.X;case 1:return d.Axis.Y;case 2:return d.Axis.Z}return null};f.prototype._onClickSelection=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,g,k,l,f;return __generator(this,function(n){switch(n.label){case 0:e=this.getSelectionAxis(a);if(null===e)return[2];c=this._viewer.model;
b=this._viewer.view;switch(e){case d.Axis.X:g=34;break;case d.Axis.Y:g=68;break;case d.Axis.Z:g=24}return[4,c.getModelBounding(!0,!1)];case 1:return k=n.sent(),l=b.getCamera(),f=this._alignedFitBounding(g,!1,!1,k),l.equals(f)&&(f=this._alignedFitBounding(g,!0,!1,k)),[2,b._setCameraPromise(f,d.DefaultTransitionDuration)]}})})};f.prototype._getScEngine=function(){return this._viewer._getScEngine()};f.prototype._createInstance=function(a,e,c,b,g,k){return __awaiter(this,void 0,void 0,function(){var l,
f,m,p,h;return __generator(this,function(n){switch(n.label){case 0:return[4,this._viewer.model.createMesh(a)];case 1:return l=n.sent(),f=new d.MeshInstanceData(l),f.setCreationFlags(k|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.Invisible),f.setOverlayIndex(d.BuiltinOverlayIndex.AxisTriad),f.setFaceColor(c),f.setLineColor(b),f.setMatrix(g),m=this._getScEngine(),[4,m.createMeshInstance(f)];case 2:return p=
n.sent(),h=p[1],this._instanceKeys[e]=h,[2,h]}})})};f.prototype._createAxis=function(a,e,c){var b=d.Util.generateConeCylinderMeshData(.2,20,2,.4,.5,.1);return this._createInstance(b,e,c,d.Color.black(),a,d.MeshInstanceCreationFlags.None)};f.prototype._createAxisLabel=function(a,e,c){var b=new d.MeshData;b.setFaceWinding(d.FaceWinding.Clockwise);var g=new d.Matrix;a===d.Axis.X?(b.addPolyline([.15,.25,0,-.15,-.25,0]),b.addPolyline([-.15,.25,0,.15,-.25,0]),g.setTranslationComponent(3.1,0,0)):a===d.Axis.Y?
(b.addPolyline([-.15,.25,0,0,0,0]),b.addPolyline([0,0,0,.15,.25,0]),b.addPolyline([0,0,0,0,-.3125,0]),g.setTranslationComponent(0,3.1,0)):a===d.Axis.Z&&(b.addPolyline([-.15,.25,0,.15,.25,0]),b.addPolyline([.15,.25,0,-.15,-.25,0]),b.addPolyline([-.15,-.25,0,.15,-.25,0]),g.setTranslationComponent(0,0,3.1));return this._createInstance(b,c,d.Color.black(),e,g,d.MeshInstanceCreationFlags.ScreenOriented)};f.prototype._onCameraUpdate=function(){var a=new d.Camera,e=this._viewer.view.getCamera();a.setPosition(e.getPosition().subtract(e.getTarget()).normalize());
a.setTarget(d.Point3.zero());a.setUp(e.getUp());a.setProjection(d.Projection.Orthographic);a.setWidth(f._fieldSize);a.setHeight(f._fieldSize);this._viewer.overlayManager.setCamera(d.BuiltinOverlayIndex.AxisTriad,a)};f.prototype._alignedFitBounding=function(a,e,c,b){var g=d.Point3.subtract(b.max,b.min).length();b=d.Point3.add(d.Point3.scale(b.min,.5),d.Point3.scale(b.max,.5));var k=new d.Point3(b.x,b.y,b.z+g);k=d.Point3.subtract(b,k);var l=-k.length();c=c?-1:1;0===a?(a=new d.Point3(0,c,0),e&&k.negate()):
(e&&(l=-l),0!==(a&2)?k=new d.Point3(l,0,0):0!==(a&4)?k=new d.Point3(0,l,0):(console.assert(0!==(a&8)),k=new d.Point3(0,0,l)),0!==(a&16)?a=new d.Point3(c,0,0):0!==(a&32)?a=new d.Point3(0,c,0):(console.assert(0!==(a&64)),a=new d.Point3(0,0,c)));e=d.Point3.subtract(b,k);c=this._viewer.view.getCamera();return d.Camera.create(e,b,a,c.getProjection(),g,g,c.getNearLimit())};f._xRotMatrix=d.Matrix.createFromOffAxisRotation(new d.Point3(0,0,1),-90);f._yRotMatrix=new d.Matrix;f._zRotMatrix=d.Matrix.createFromOffAxisRotation(new d.Point3(1,
0,0),90);f._xColor=new d.Color(168,56,59);f._yColor=new d.Color(96,166,50);f._zColor=new d.Color(41,81,185);f._fieldSize=8;return f}();d.AxisTriad=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(a){this._id=0;this._bcfMap=new Map;this._viewer=a}f.prototype._getId=function(){return++this._id};f.prototype.getBCFMap=function(){return this._bcfMap};f.prototype.getBCFData=function(a){return this._bcfMap.get(a)||null};f.prototype.removeBCFData=function(a){this._bcfMap.delete(a);this._viewer.trigger("bcfRemoved",a)};f.prototype.createBCFData=function(a){var e=this._getId();a=new d.BCFData(a,e);this._bcfMap.set(e,a);this._viewer.trigger("bcfLoaded",a.getId(),
a.getFilename());return a};f.prototype.addBCFFromFile=function(a){return __awaiter(this,void 0,void 0,function(){var e,c;return __generator(this,function(b){switch(b.label){case 0:return e=this.createBCFData(a),[4,new JSZip.external.Promise(function(b,c){JSZipUtils.getBinaryContent(a,function(g,a){g?c(g):b(a)})})];case 1:return c=b.sent(),[4,this._loadBCFData(c,e)];case 2:return b.sent(),[2]}})})};f.prototype.addBCFFromBuffer=function(a,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,
function(b){switch(b.label){case 0:return c=this.createBCFData(e),[4,this._loadBCFData(a,c)];case 1:return b.sent(),[2]}})})};f.prototype._getVersion=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,g;return __generator(this,function(k){switch(k.label){case 0:return e=a.file("bcf.version"),null!==e?[3,1]:[2,d.BCFVersion.v1_0];case 1:return[4,this._getDocument(e)];case 2:c=k.sent();b=c.documentElement;g=b.firstElementChild;if(null!==g&&null!==g.textContent)switch(g.textContent){case "2.0 RC":return[2,
d.BCFVersion.v2_0];case "2.1":return[2,d.BCFVersion.v2_1]}return[2,d.BCFVersion.Unknown]}})})};f.prototype._loadBCFData=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,g,k,l,f,m,p,h,q=this;return __generator(this,function(n){switch(n.label){case 0:return c=this._viewer.model,[4,c.getModelBounding(!0,!1)];case 1:return b=n.sent(),g=c.getNodeUnitMultiplier(c.getAbsoluteRootNode()),k=e.getId(),l=e.getFilename(),[4,JSZip.loadAsync(a)];case 2:return f=n.sent(),p=(m=e).setVersion,[4,
this._getVersion(f)];case 3:return p.apply(m,[n.sent()]),h=[],f.forEach(function(c){return __awaiter(q,void 0,void 0,function(){var a,n,m,p,r,q,u,t,C,E,F,G,I,J,K,H,L;return __generator(this,function(v){switch(v.label){case 0:a=d.Util.OpenPromise.create();h.push(a);n=this._getFileType(c);if(n!==d.BCFFileType.Markup&&n!==d.BCFFileType.Snapshot&&n!==d.BCFFileType.Viewpoint)return[3,7];m=c.split("/");p=m[0];r=m[1];q=e.getTopic(p);null===q&&(q=new d.BCFTopic(k,l,p,this._viewer),e.addTopic(p,q));if(!r.length)return[3,
7];u=f.file(c);if(null===u)return[3,7];t=n;switch(t){case d.BCFFileType.Markup:return[3,1];case d.BCFFileType.Viewpoint:return[3,3];case d.BCFFileType.Snapshot:return[3,5]}return[3,7];case 1:return E=(C=q).addMarkup,F=[r],[4,this._getDocument(u)];case 2:return E.apply(C,F.concat([v.sent()])),[3,7];case 3:return I=(G=q).addViewpoint,J=[r],[4,this._getDocument(u)];case 4:return I.apply(G,J.concat([v.sent(),e.getVersion(),b,g])),[3,7];case 5:return H=(K=q).addSnapshot,L=[r],[4,u.async("uint8array")];
case 6:return H.apply(K,L.concat([v.sent()])),[3,7];case 7:return a.resolve(),[2]}})})}),[4,d.Util.waitForAll(h)];case 4:return n.sent(),this._viewer.trigger("bcfLoaded",k,l),[2]}})})};f.prototype._getDocument=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(g){switch(g.label){case 0:return e=new DOMParser,b=(c=e).parseFromString,[4,a.async("text")];case 1:return[2,b.apply(c,[g.sent(),"application/xml"])]}})})};f.prototype._getFileType=function(a){if("/"===
a.slice(-1))return d.BCFFileType.TopicFolder;a=a.split(".");console.assert(2===a.length);switch(a[1]){case "bcf":return d.BCFFileType.Markup;case "bcfv":return d.BCFFileType.Viewpoint;case "png":return d.BCFFileType.Snapshot;case "version":return d.BCFFileType.Version;case "xsd":return d.BCFFileType.Schema;case "bcfp":return d.BCFFileType.Project}return d.BCFFileType.Unknown};return f}();d.BCFManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(a,e){void 0===a&&(a=d.Point3.zero());void 0===e&&(e=d.Point3.zero());this.min=a.copy();this.max=e.copy()}f.prototype.copy=function(){return new f(this.min,this.max)};f.prototype.equals=function(a){return this.min.equals(a.min)&&this.max.equals(a.max)};f.prototype.center=function(){var a=d.Point3.add(this.min,this.max);a.scale(.5);return a};f.prototype.extents=function(){return d.Point3.subtract(this.max,this.min)};f.prototype.addBox=function(a){a.isDegenerate()||
(this.addPoint(a.min),this.addPoint(a.max))};f.prototype.addPoint=function(a){a.x<this.min.x&&(this.min.x=a.x);a.y<this.min.y&&(this.min.y=a.y);a.z<this.min.z&&(this.min.z=a.z);a.x>this.max.x&&(this.max.x=a.x);a.y>this.max.y&&(this.max.y=a.y);a.z>this.max.z&&(this.max.z=a.z)};f.prototype.toJson=function(){return this._toJson()};f.prototype._toJson=function(){return{min:this.min.toJson(),max:this.max.toJson()}};f.prototype.forJson=function(){return this.toJson()};f.fromJson=function(a){var e=d.Point3.fromJson(a.min);
a=d.Point3.fromJson(a.max);return new f(e,a)};f.construct=function(a){return f.fromJson(a)};f.prototype.getCorners=function(){var a=[];a[0]=this.min.copy();a[1]=this.min.copy();a[2]=this.min.copy();a[1].x=this.max.x;a[2].y=this.max.y;a[3]=a[2].copy();a[3].x=this.max.x;a[4]=a[0].copy();a[5]=a[1].copy();a[6]=a[2].copy();a[7]=a[3].copy();a[4].z=this.max.z;a[5].z=this.max.z;a[6].z=this.max.z;a[7].z=this.max.z;return a};f.invalid=function(){return new f(new d.Point3(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,
Number.POSITIVE_INFINITY),new d.Point3(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY))};f.prototype.isDegenerate=function(){return this.min.x>this.max.x||this.min.y>this.max.y||this.min.z>this.max.z};return f}();d.Box=h})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function a(){var a=this;this._aliasMap=new Map;this._callbackMap=new Map;this._activeTriggerDepth=0;this._pendingClearUnboundFilteredNames=new Set;this._aliasMap.set("sceneRendered","frameDrawn");this.bind({selectionArray:function(c){a._triggerDeprecatedSelectionCallback(c)},incrementalSelectionBatchBegin:function(){return a.unsafeTrigger("volumeSelectionBatchBegin")},incrementalSelectionBatchEnd:function(){return a.unsafeTrigger("volumeSelectionBatchEnd")},
incrementalSelectionEnd:function(){return a.unsafeTrigger("volumeSelectionEnd")},visibilityChanged:function(c,b){a.unsafeTrigger("partsVisibilityShown",c);a.unsafeTrigger("partsVisibilityHidden",b)}})}a.prototype._triggerDeprecatedSelectionCallback=function(a){if(0===a.length)this.unsafeTrigger("selection",[d.Event.NodeSelectionEvent._createNull()]);else if(100>=a.length)this.unsafeTrigger("selection",a);else{var c=0;for(a=h.chunkify(a,100);c<a.length;c++)this.unsafeTrigger("selection",a[c])}};a.prototype._filterName=
function(a){var c=this._aliasMap.get(a);return void 0===c?a:c};a.prototype.bind=function(a,c){for(var b=0,g=Object.keys(a);b<g.length;b++){var e=g[b],d=a[e];if("function"===typeof d){e=this._filterName(e);var f=this._callbackMap.get(e);void 0===f?this._callbackMap.set(e,[d]):c?f.unshift(d):f.push(d)}}};a.prototype.unbind=function(a){for(var c=0,b=Object.keys(a);c<b.length;c++){var g=b[c],e=this._filterName(g),d=this._callbackMap.get(e);if(void 0!==d){g=a[g];for(var f=0;f<d.length;f++)d[f]===g&&(d[f]=
null,this._pendingClearUnboundFilteredNames.add(e))}}this._clearUnboundCallbacks()};a.prototype._clearUnboundCallbacks=function(){var a=this;0!==this._pendingClearUnboundFilteredNames.size&&0===this._activeTriggerDepth&&(this._pendingClearUnboundFilteredNames.forEach(function(c){var b=a._callbackMap.get(c);void 0!==b&&(b=b.filter(function(b){return null!==b}),0===b.length?a._callbackMap.delete(c):a._callbackMap.set(c,b))}),this._pendingClearUnboundFilteredNames.clear())};a.prototype.promiseTrigger=
function(a,c){for(var b=[],g=2;g<arguments.length;g++)b[g-2]=arguments[g];return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(e){switch(e.label){case 0:console.assert(a!==c),e.label=1;case 1:return e.trys.push([1,3,4,5]),[4,this._unsafePromiseTrigger(a,b)];case 2:return e.sent(),[3,5];case 3:return g=e.sent(),console.log("Rejected promise in '"+a+"' callback:"),console.log(g),[3,5];case 4:return null!==c&&this.unsafeTrigger(c,b),[7];case 5:return[2]}})})};a.prototype._unsafePromiseTrigger=
function(a,c){var b=this._filterName(a);b=this._callbackMap.get(b);var g=[];if(void 0!==b){++this._activeTriggerDepth;for(var e=0;e<b.length;e++){var l=b[e];if(null!==l)try{g.push(l.apply(null,c))}catch(n){console.log("Unhandled exception in '"+a+"' callback:"),console.log(n)}}--this._activeTriggerDepth;this._clearUnboundCallbacks()}return d.Util.waitForAll(g)};a.prototype.trigger=function(a){for(var c=[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];this.unsafeTrigger(a,c)};a.prototype.unsafeTrigger=
function(a,c){var b=this._filterName(a);b=this._callbackMap.get(b);if(void 0!==b){++this._activeTriggerDepth;for(var g=0;g<b.length;g++){var e=b[g];if(null!==e)try{e.apply(null,c)}catch(l){console.log("Unhandled exception in '"+a+"' callback:"),console.log(l)}}--this._activeTriggerDepth;this._clearUnboundCallbacks()}};return a}();h.CallbackManager=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(a){a[a.LoadModel=0]="LoadModel";a[a.CreateNode=1]="CreateNode";a[a.CreateInstance=2]="CreateInstance";a[a.CreatePmi=3]="CreatePmi"})(d.NodeSource||(d.NodeSource={}));(function(a){a[a.Desktop=0]="Desktop";a[a.Mobile=1]="Mobile"})(d.ScreenConfiguration||(d.ScreenConfiguration={}));(function(a){a[a.Faces=0]="Faces";a[a.Lines=1]="Lines";a[a.Points=2]="Points"})(d.ElementType||(d.ElementType={}));(function(a){a[a.Orthographic=0]="Orthographic";a[a.Perspective=1]="Perspective"})(d.Projection||
(d.Projection={}));(function(a){a[a.Top=0]="Top";a[a.Bottom=1]="Bottom";a[a.Left=2]="Left";a[a.Right=3]="Right";a[a.Front=4]="Front";a[a.Back=5]="Back";a[a.Iso=6]="Iso";a[a.TopRightFront=7]="TopRightFront";a[a.TopLeftFront=8]="TopLeftFront";a[a.TopLeftBack=9]="TopLeftBack";a[a.TopRightBack=10]="TopRightBack";a[a.TopBack=11]="TopBack";a[a.TopFront=12]="TopFront";a[a.TopLeft=13]="TopLeft";a[a.TopRight=14]="TopRight";a[a.BottomRightBack=15]="BottomRightBack";a[a.BottomLeftBack=16]="BottomLeftBack";a[a.BottomLeftFront=
17]="BottomLeftFront";a[a.BottomRightFront=18]="BottomRightFront";a[a.BottomFront=19]="BottomFront";a[a.BottomBack=20]="BottomBack";a[a.BottomLeft=21]="BottomLeft";a[a.BottomRight=22]="BottomRight";a[a.RightBottomBack=23]="RightBottomBack";a[a.RightBottomFront=24]="RightBottomFront";a[a.RightTopFront=25]="RightTopFront";a[a.RightTopBack=26]="RightTopBack";a[a.RightTop=27]="RightTop";a[a.RightBottom=28]="RightBottom";a[a.RightFront=29]="RightFront";a[a.RightBack=30]="RightBack";a[a.LeftBottomFront=
31]="LeftBottomFront";a[a.LeftBottomBack=32]="LeftBottomBack";a[a.LeftTopBack=33]="LeftTopBack";a[a.LeftTopFront=34]="LeftTopFront";a[a.LeftTop=35]="LeftTop";a[a.LeftBottom=36]="LeftBottom";a[a.LeftBack=37]="LeftBack";a[a.LeftFront=38]="LeftFront";a[a.FrontBottomRight=39]="FrontBottomRight";a[a.FrontTopRight=40]="FrontTopRight";a[a.FrontTopLeft=41]="FrontTopLeft";a[a.FrontBottomLeft=42]="FrontBottomLeft";a[a.FrontRight=43]="FrontRight";a[a.FrontLeft=44]="FrontLeft";a[a.FrontTop=45]="FrontTop";a[a.FrontBottom=
46]="FrontBottom";a[a.BackTopRight=47]="BackTopRight";a[a.BackBottomRight=48]="BackBottomRight";a[a.BackBottomLeft=49]="BackBottomLeft";a[a.BackTopLeft=50]="BackTopLeft";a[a.BackLeft=51]="BackLeft";a[a.BackRight=52]="BackRight";a[a.BackBottom=53]="BackBottom";a[a.BackTop=54]="BackTop"})(d.ViewOrientation||(d.ViewOrientation={}));(function(a){a[a.X=0]="X";a[a.Y=1]="Y";a[a.Z=2]="Z"})(d.Axis||(d.Axis={}));(function(a){a[a.None=-1]="None";a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right"})(d.Button||
(d.Button={}));(function(a){a[a.None=0]="None";a[a.Left=1]="Left";a[a.Right=2]="Right";a[a.Middle=4]="Middle"})(d.Buttons||(d.Buttons={}));(function(a){a[a.Axis=0]="Axis";a[a.Plane=1]="Plane";a[a.ViewPlane=2]="ViewPlane";a[a.Rotate=3]="Rotate"})(d.HandleType||(d.HandleType={}));(function(a){a[a.Translate=0]="Translate";a[a.Rotate=1]="Rotate"})(d.HandleEventType||(d.HandleEventType={}));(function(a){a[a.Invalid=-1]="Invalid";a[a.None=0]="None";a[a.Navigate=1]="Navigate";a[a.Orbit=2]="Orbit";a[a.Pan=
3]="Pan";a[a.Zoom=4]="Zoom";a[a.Walk=5]="Walk";a[a.KeyboardWalk=6]="KeyboardWalk";a[a.WalkMode=7]="WalkMode";a[a.Turntable=8]="Turntable";a[a.Select=9]="Select";a[a.AreaSelect=10]="AreaSelect";a[a.RayDrillSelect=11]="RayDrillSelect";a[a.RedlineCircle=12]="RedlineCircle";a[a.RedlineText=13]="RedlineText";a[a.RedlineRectangle=14]="RedlineRectangle";a[a.RedlinePolyline=15]="RedlinePolyline";a[a.MeasureEdgeLength=16]="MeasureEdgeLength";a[a.MeasureFaceFaceDistance=17]="MeasureFaceFaceDistance";a[a.MeasurePointPointDistance=
18]="MeasurePointPointDistance";a[a.MeasureFaceFaceAngle=19]="MeasureFaceFaceAngle";a[a.Note=20]="Note";a[a.Cutting=21]="Cutting";a[a.Handle=22]="Handle";a[a.NavCube=23]="NavCube";a[a.AxisTriad=24]="AxisTriad"})(d.OperatorId||(d.OperatorId={}));(function(a){a[a.MouseDown=0]="MouseDown";a[a.MouseMove=1]="MouseMove";a[a.MouseUp=2]="MouseUp";a[a.Mousewheel=3]="Mousewheel";a[a.TouchStart=4]="TouchStart";a[a.TouchMove=5]="TouchMove";a[a.TouchEnd=6]="TouchEnd";a[a.KeyDown=7]="KeyDown";a[a.KeyUp=8]="KeyUp";
a[a.ViewOrientationChange=9]="ViewOrientationChange"})(d.EventType||(d.EventType={}));(function(a){a[a.None=0]="None";a[a.Shift=2]="Shift";a[a.Alt=4]="Alt";a[a.Control=8]="Control";a[a.Command=16]="Command"})(d.KeyModifiers||(d.KeyModifiers={}));(function(a){a[a.Down=0]="Down";a[a.Up=1]="Up";a[a.Move=2]="Move";a[a.Wheel=3]="Wheel"})(d.MouseInputType||(d.MouseInputType={}));(function(a){a[a.Start=0]="Start";a[a.Move=1]="Move";a[a.End=2]="End"})(d.TouchInputType||(d.TouchInputType={}));(function(a){a[a.Down=
0]="Down";a[a.Up=1]="Up"})(d.KeyInputType||(d.KeyInputType={}));(function(a){a[a.Forward=0]="Forward";a[a.Backward=1]="Backward";a[a.Left=2]="Left";a[a.Right=3]="Right";a[a.Up=4]="Up";a[a.Down=5]="Down";a[a.RotateRight=6]="RotateRight";a[a.RotateLeft=7]="RotateLeft";a[a.TiltUp=8]="TiltUp";a[a.TiltDown=9]="TiltDown"})(d.WalkDirection||(d.WalkDirection={}));(function(a){a[a.Backspace=8]="Backspace";a[a.Shift=16]="Shift";a[a.Escape=27]="Escape";a[a.PgUp=33]="PgUp";a[a.PgDown=34]="PgDown";a[a.LeftArrow=
37]="LeftArrow";a[a.UpArrow=38]="UpArrow";a[a.RightArrow=39]="RightArrow";a[a.DownArrow=40]="DownArrow";a[a.Delete=46]="Delete";a[a.a=65]="a";a[a.b=66]="b";a[a.c=67]="c";a[a.d=68]="d";a[a.e=69]="e";a[a.f=70]="f";a[a.g=71]="g";a[a.h=72]="h";a[a.i=73]="i";a[a.j=74]="j";a[a.k=75]="k";a[a.l=76]="l";a[a.m=77]="m";a[a.n=78]="n";a[a.o=79]="o";a[a.p=80]="p";a[a.q=81]="q";a[a.r=82]="r";a[a.s=83]="s";a[a.t=84]="t";a[a.u=85]="u";a[a.v=86]="v";a[a.w=87]="w";a[a.x=88]="x";a[a.y=89]="y";a[a.z=90]="z";a[a._0=48]=
"_0";a[a._1=49]="_1";a[a._2=50]="_2";a[a._3=51]="_3";a[a._4=52]="_4";a[a._5=53]="_5";a[a._6=54]="_6";a[a._7=55]="_7";a[a._8=56]="_8";a[a._9=57]="_9";a[a.NumPad_0=96]="NumPad_0";a[a.NumPad_1=97]="NumPad_1";a[a.NumPad_2=98]="NumPad_2";a[a.NumPad_3=99]="NumPad_3";a[a.NumPad_4=100]="NumPad_4";a[a.NumPad_5=101]="NumPad_5";a[a.NumPad_6=102]="NumPad_6";a[a.NumPad_7=103]="NumPad_7";a[a.NumPad_8=104]="NumPad_8";a[a.NumPad_9=105]="NumPad_9"})(d.KeyCode||(d.KeyCode={}));(function(a){a[a.None=0]="None";a[a.Face=
1]="Face";a[a.Line=2]="Line";a[a.Point=4]="Point";a[a.All=7]="All"})(d.SelectionMask||(d.SelectionMask={}));(function(a){a[a.None=0]="None";a[a.Face=1]="Face";a[a.Line=2]="Line";a[a.Point=3]="Point";a[a.Part=4]="Part"})(d.SelectionType||(d.SelectionType={}));(function(a){a[a.Set=0]="Set";a[a.Add=1]="Add";a[a.Toggle=2]="Toggle"})(d.SelectionMode||(d.SelectionMode={}));(function(a){a[a.HighlightOnly=0]="HighlightOnly";a[a.OutlineOnly=1]="OutlineOnly";a[a.HighlightAndOutline=2]="HighlightAndOutline"})(d.SelectionHighlightMode||
(d.SelectionHighlightMode={}));(function(a){a[a.Info=0]="Info";a[a.Warning=1]="Warning";a[a.Error=2]="Error"})(d.InfoType||(d.InfoType={}));(function(a){a[a.Interactive=1]="Interactive";a[a.All=2]="All";a[a.OnDemand=4]="OnDemand";a[a.Default=1]="Default"})(d.StreamingMode||(d.StreamingMode={}));(function(a){a[a.Client=0]="Client";a[a.Server=1]="Server"})(d.RendererType||(d.RendererType={}));(function(a){a[a.Wireframe=0]="Wireframe";a[a.Shaded=1]="Shaded";a[a.WireframeOnShaded=2]="WireframeOnShaded";
a[a.HiddenLine=3]="HiddenLine";a[a.XRay=4]="XRay"})(d.DrawMode||(d.DrawMode={}));(function(a){a[a.Unsorted=0]="Unsorted";a[a.SingleLayer=1]="SingleLayer"})(d.XRayTransparencyMode||(d.XRayTransparencyMode={}));(function(a){a[a.SMAA=0]="SMAA";a[a.None=1]="None"})(d.AntiAliasingMode||(d.AntiAliasingMode={}));(function(a){a[a.DoNotExplode=0]="DoNotExplode";a[a.DoNotCut=1]="DoNotCut";a[a.DoNotSelect=2]="DoNotSelect";a[a.SuppressCameraScale=3]="SuppressCameraScale";a[a.OverrideSceneVisibility=4]="OverrideSceneVisibility";
a[a.DoNotLight=5]="DoNotLight";a[a.DoNotOutlineHighlight=6]="DoNotOutlineHighlight";a[a.ExcludeBounding=7]="ExcludeBounding";a[a.DoNotUseVertexColors=8]="DoNotUseVertexColors";a[a.AlwaysDraw=9]="AlwaysDraw";a[a.DoNotXRay=10]="DoNotXRay";a[a.ScreenOriented=11]="ScreenOriented";a[a.ScreenSpace=12]="ScreenSpace";a[a.ScreenSpaceStretched=13]="ScreenSpaceStretched";a[a.IgnoreExplosion=0]="IgnoreExplosion";a[a.IgnoreCutting=1]="IgnoreCutting";a[a.IgnoreSelection=2]="IgnoreSelection";a[a.IgnoreCameraScale=
3]="IgnoreCameraScale";a[a.IgnoreLighting=5]="IgnoreLighting";a[a.IgnoreOutlineHighlight=6]="IgnoreOutlineHighlight"})(d.InstanceModifier||(d.InstanceModifier={}));(function(a){a[a.None=0]="None";a[a.SuppressCameraScale=1]="SuppressCameraScale";a[a.ScreenOriented=2]="ScreenOriented";a[a.DoNotCut=4]="DoNotCut";a[a.DoNotExplode=8]="DoNotExplode";a[a.DoNotSelect=16]="DoNotSelect";a[a.DoNotLight=32]="DoNotLight";a[a.DoNotOutlineHighlight=64]="DoNotOutlineHighlight";a[a.ExcludeBounding=128]="ExcludeBounding";
a[a.DoNotUseVertexColors=256]="DoNotUseVertexColors";a[a.Invisible=512]="Invisible";a[a.DoNotXRay=1024]="DoNotXRay";a[a.AlwaysDraw=2048]="AlwaysDraw";a[a.OverrideSceneVisibility=4096]="OverrideSceneVisibility";a[a.ScreenSpace=8192]="ScreenSpace";a[a.ScreenSpaceStretched=16384]="ScreenSpaceStretched"})(d.MeshInstanceCreationFlags||(d.MeshInstanceCreationFlags={}));(function(a){a[a.None=0]="None";a[a.Model=1]="Model";a[a.Instance=2]="Instance";a[a.Ejected=4]="Ejected";a[a.All=7]="All"})(d.BoundingPreviewMode||
(d.BoundingPreviewMode={}));(function(a){a[a.CameraTarget=0]="CameraTarget";a[a.ModelCenter=1]="ModelCenter";a[a.OrbitTarget=2]="OrbitTarget"})(d.OrbitFallbackMode||(d.OrbitFallbackMode={}));(function(a){a[a.Mouse=0]="Mouse";a[a.Keyboard=1]="Keyboard"})(d.WalkMode||(d.WalkMode={}));(function(a){a[a.AssemblyNode=0]="AssemblyNode";a[a.PartInstance=1]="PartInstance";a[a.Part=2]="Part";a[a.BodyInstance=3]="BodyInstance";a[a.PmiBody=4]="PmiBody";a[a.PMIBody=4]="PMIBody";a[a.ViewFrame=5]="ViewFrame";a[a.Body=
6]="Body";a[a.BrepBody=7]="BrepBody";a[a.TessBody=8]="TessBody";a[a.WireBody=9]="WireBody";a[a.PointsBody=10]="PointsBody";a[a.Pmi=11]="Pmi";a[a.PMI=11]="PMI";a[a.CadView=12]="CadView";a[a.CADView=12]="CADView";a[a.DrawingSheet=13]="DrawingSheet";a[a.Unknown=14]="Unknown"})(d.NodeType||(d.NodeType={}));var h;(function(a){a[a.Unknown=0]="Unknown";a[a.Text=1]="Text";a[a.Dimension=2]="Dimension";a[a.Arrow=3]="Arrow";a[a.Balloon=4]="Balloon";a[a.CircleCenter=5]="CircleCenter";a[a.Coordinate=6]="Coordinate";
a[a.Datum=7]="Datum";a[a.Fastener=8]="Fastener";a[a.Gdt=9]="Gdt";a[a.Locator=10]="Locator";a[a.MeasurementPoint=11]="MeasurementPoint";a[a.Roughness=12]="Roughness";a[a.Welding=13]="Welding";a[a.Table=14]="Table";a[a.Other=15]="Other";a[a.GeometricalTolerance=16]="GeometricalTolerance"})(h=d.PmiType||(d.PmiType={}));d.PMIType=h;(function(a){a[a.Unknown=0]="Unknown";a[a.DatumIdent=1]="DatumIdent";a[a.DatumTarget=2]="DatumTarget";a[a.DimensionDistance=1]="DimensionDistance";a[a.DimensionDistanceOffset=
2]="DimensionDistanceOffset";a[a.DimensionDistanceCumulate=3]="DimensionDistanceCumulate";a[a.DimensionChamfer=4]="DimensionChamfer";a[a.DimensionSlope=5]="DimensionSlope";a[a.DimensionOrdinate=6]="DimensionOrdinate";a[a.DimensionRadius=7]="DimensionRadius";a[a.DimensionRadiusTangent=8]="DimensionRadiusTangent";a[a.DimensionRadiusCylinder=9]="DimensionRadiusCylinder";a[a.DimensionRadiusEdge=10]="DimensionRadiusEdge";a[a.DimensionDiameter=11]="DimensionDiameter";a[a.DimensionDiameterTangent=12]="DimensionDiameterTangent";
a[a.DimensionDiameterCylinder=13]="DimensionDiameterCylinder";a[a.DimensionDiameterEdge=14]="DimensionDiameterEdge";a[a.DimensionDiameterCone=15]="DimensionDiameterCone";a[a.DimensionLength=16]="DimensionLength";a[a.DimensionLengthCurvilinear=17]="DimensionLengthCurvilinear";a[a.DimensionLengthCircular=18]="DimensionLengthCircular";a[a.DimensionAngle=19]="DimensionAngle";a[a.GdtFcf=1]="GdtFcf";a[a.WeldingLine=1]="WeldingLine";a[a.WeldingSpot=2]="WeldingSpot";a[a.OtherSymbolUser=1]="OtherSymbolUser";
a[a.OtherSymbolUtility=2]="OtherSymbolUtility";a[a.OtherSymbolCustom=3]="OtherSymbolCustom";a[a.OtherGeometricReference=4]="OtherGeometricReference";a[a.OtherRegion=5]="OtherRegion"})(h=d.PmiSubType||(d.PmiSubType={}));d.PMISubType=h;var f;(function(a){a[a.Unknown=-1]="Unknown";a[a.Context=1]="Context";a[a.Item=2]="Item";a[a.MultipleVertex=3]="MultipleVertex";a[a.UniqueVertex=4]="UniqueVertex";a[a.WireEdge=5]="WireEdge";a[a.Edge=6]="Edge";a[a.CoEdge=7]="CoEdge";a[a.Loop=8]="Loop";a[a.Face=9]="Face";
a[a.Shell=10]="Shell";a[a.Connex=11]="Connex";a[a.Body=12]="Body";a[a.SingleWireBody=13]="SingleWireBody";a[a.BrepData=14]="BrepData";a[a.WireBody=17]="WireBody"})(f=d.PmiTopoRef||(d.PmiTopoRef={}));d.PMITopoRef=f;(function(a){a[a.Unknown=0]="Unknown";a[a.Clockwise=1]="Clockwise";a[a.CounterClockwise=2]="CounterClockwise"})(d.FaceWinding||(d.FaceWinding={}));(function(a){a[a.UpperLeftCorner=0]="UpperLeftCorner";a[a.LowerLeftCorner=1]="LowerLeftCorner";a[a.LowerRightCorner=2]="LowerRightCorner";a[a.UpperRightCorner=
3]="UpperRightCorner";a[a.TopCenter=4]="TopCenter";a[a.LeftCenter=5]="LeftCenter";a[a.RightCenter=6]="RightCenter";a[a.BottomCenter=7]="BottomCenter";a[a.Center=8]="Center"})(d.OverlayAnchor||(d.OverlayAnchor={}));(function(a){a[a.Pixels=0]="Pixels";a[a.ProportionOfCanvas=1]="ProportionOfCanvas";a[a.ProportionOfOtherDimension=2]="ProportionOfOtherDimension"})(d.OverlayUnit||(d.OverlayUnit={}));(function(a){a[a.ScreenPixels=0]="ScreenPixels";a[a.CSSPixels=1]="CSSPixels";a[a.World=2]="World";a[a.ProportionOfScreenWidth=
3]="ProportionOfScreenWidth";a[a.ProportionOfScreenHeight=4]="ProportionOfScreenHeight";a[a.ProportionOfBoundingDiagonal=5]="ProportionOfBoundingDiagonal"})(d.PointSizeUnit||(d.PointSizeUnit={}));(function(a){a[a.Square=0]="Square";a[a.Disk=1]="Disk";a[a.Sphere=2]="Sphere"})(d.PointShape||(d.PointShape={}));h=function(){function a(){this.bodyId=d.InvalidNodeId;this.subElementType=f.Unknown;this.subElementIndex=-1}Object.defineProperty(a.prototype,"bodyID",{get:function(){return this.bodyId},set:function(a){this.bodyId=
a},enumerable:!0,configurable:!0});return a}();d.RefOnTopoItem=h;(function(a){a[a.Hidden=0]="Hidden";a[a.Shown=1]="Shown";a[a.Mixed=2]="Mixed"})(d.BranchVisibility||(d.BranchVisibility={}));(function(a){a[a.Object=0]="Object";a[a.World=1]="World"})(d.CullingVectorSpace||(d.CullingVectorSpace={}));(function(a){a[a.First=8]="First";a[a.Handles=8]="Handles";a[a.AxisTriad=9]="AxisTriad";a[a.NavCube=10]="NavCube";a[a.TestFramework=11]="TestFramework"})(d.BuiltinOverlayIndex||(d.BuiltinOverlayIndex={}));
h=function(){return function(){this.pos1=d.Point3.zero();this.pos2=d.Point3.zero();this.distance=0}}();d.FaceFaceDistanceItem=h;h=function(){return function(){this.frontVector=new d.Point3(-1,0,0);this.upVector=new d.Point3(0,0,1)}}();d.ViewAxes=h;(function(a){a[a.Object=0]="Object";a[a.World=1]="World";a[a.ProportionOfScreenWidth=2]="ProportionOfScreenWidth";a[a.ProportionOfScreenHeight=3]="ProportionOfScreenHeight"})(d.LinePatternLengthUnit||(d.LinePatternLengthUnit={}));(function(a){a[a.Selected=
0]="Selected";a[a.Unselected=1]="Unselected"})(d.XRayGroup||(d.XRayGroup={}));(function(a){a[a.Pixels=0]="Pixels";a[a.ProportionOfWidth=1]="ProportionOfWidth";a[a.ProportionOfHeight=2]="ProportionOfHeight"})(d.BlurIntervalUnit||(d.BlurIntervalUnit={}));(function(a){a[a.Undefined=0]="Undefined";a[a.Int=1]="Int";a[a.Float=2]="Float";a[a.Time=3]="Time";a[a.String=4]="String"})(d.AttributeType||(d.AttributeType={}));h=function(){return function(a,e){this.isInclusive=a;this.nodeIds=e}}();d.FilteredNodes=
h;h=function(){return function(a,e){this.defaultVisibility=a;this.visibilityExceptions=e}}();d.VisibilityState=h;h=function(){function a(){this.additionalMatrix=null;this.attachInvisibly=this.allowMissingExternalModels=!1;this.implicitlyLoadXmlExternalModels=!0}a.prototype.copy=function(){var e=new a;e.additionalMatrix=this.additionalMatrix;null!==e.additionalMatrix&&(e.additionalMatrix=e.additionalMatrix.copy());e.allowMissingExternalModels=this.allowMissingExternalModels;e.attachInvisibly=this.attachInvisibly;
e.implicitlyLoadXmlExternalModels=this.implicitlyLoadXmlExternalModels;return e};return a}();d.LoadSubtreeConfig=h;(function(a){a[a.Unknown=0]="Unknown";a[a.Catia=2]="Catia";a[a.CatiaV5=3]="CatiaV5";a[a.Cadds=4]="Cadds";a[a.Unigraphics=5]="Unigraphics";a[a.Parasolid=6]="Parasolid";a[a.Euclid=7]="Euclid";a[a.Iges=9]="Iges";a[a.Unisurf=10]="Unisurf";a[a.Vda=11]="Vda";a[a.Stl=12]="Stl";a[a.Wrl=13]="Wrl";a[a.Dxf=14]="Dxf";a[a.Acis=15]="Acis";a[a.ProE=16]="ProE";a[a.Step=18]="Step";a[a.Ideas=19]="Ideas";
a[a.Jt=20]="Jt";a[a.Slw=22]="Slw";a[a.Cgr=23]="Cgr";a[a.Prc=24]="Prc";a[a.Xvl=25]="Xvl";a[a.Hpgl=26]="Hpgl";a[a.TopSolid=27]="TopSolid";a[a.OneSpaceDesigner=28]="OneSpaceDesigner";a[a._3dxml=29]="_3dxml";a[a.Inventor=30]="Inventor";a[a.PostScript=31]="PostScript";a[a.Pdp=32]="Pdp";a[a.U3d=33]="U3d";a[a.Ifc=34]="Ifc";a[a.Dwg=35]="Dwg";a[a.Dwf=36]="Dwf";a[a.Se=37]="Se";a[a.Obj=38]="Obj";a[a.Kmz=39]="Kmz";a[a.Dae=40]="Dae";a[a._3ds=41]="_3ds";a[a.Rhino=43]="Rhino";a[a.Xml=44]="Xml";a[a._3mf=45]="_3mf";
a[a.Scs=46]="Scs";a[a._3dHtml=47]="_3dHtml";a[a.Hsf=48]="Hsf";a[a.Gltf=49]="Gltf";a[a.Revit=50]="Revit";a[a.Fbx=51]="Fbx"})(d.FileType||(d.FileType={}));(function(a){a[a.World=0]="World";a[a.ProportionOfBoundingHeight=1]="ProportionOfBoundingHeight"})(d.SimpleReflectionAttenuationUnit||(d.SimpleReflectionAttenuationUnit={}))})(Communicator||(Communicator={}));
(function(d){d=d.Internal||(d.Internal={});d=d.AttachType||(d.AttachType={});d[d.Direct=0]="Direct";d[d.Indirect=1]="Indirect"})(Communicator||(Communicator={}));(function(d){d=d.Internal||(d.Internal={});d=d.CameraFlags||(d.CameraFlags={});d[d.None=0]="None";d[d.Position=1]="Position";d[d.Target=2]="Target";d[d.Up=4]="Up";d[d.Width=8]="Width";d[d.Height=16]="Height";d[d.Projection=32]="Projection";d[d.NearLimit=64]="NearLimit"})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(){this._position=new d.Point3(0,0,1);this._target=d.Point3.zero();this._up=new d.Point3(0,1,0);this._height=this._width=0;this._projection=d.Projection.Orthographic;this._nearLimit=.01;this._cameraFlags=d.Internal.CameraFlags.None}f.prototype._clearFlags=function(){this._cameraFlags=d.Internal.CameraFlags.None};f.prototype._getFlags=function(){return this._cameraFlags};f.prototype.copy=function(){return f.create(this._position,this._target,this._up,this._projection,
this._width,this._height,this._nearLimit)};f.prototype.setPosition=function(a){this._position.assign(a);this._cameraFlags|=d.Internal.CameraFlags.Position};f.prototype.getPosition=function(){return this._position.copy()};f.prototype.setTarget=function(a){this._target.assign(a);this._cameraFlags|=d.Internal.CameraFlags.Target};f.prototype.getTarget=function(){return this._target.copy()};f.prototype.setUp=function(a){this._up.assign(a);this._cameraFlags|=d.Internal.CameraFlags.Up};f.prototype.getUp=
function(){return this._up.copy()};f.prototype.setWidth=function(a){this._width=a;this._cameraFlags|=d.Internal.CameraFlags.Width};f.prototype.getWidth=function(){return this._width};f.prototype.setHeight=function(a){this._height=a;this._cameraFlags|=d.Internal.CameraFlags.Height};f.prototype.getHeight=function(){return this._height};f.prototype.setProjection=function(a){this._projection=a;this._cameraFlags|=d.Internal.CameraFlags.Projection};f.prototype.getProjection=function(){return this._projection};
f.prototype.setNearLimit=function(a){this._nearLimit=a;this._cameraFlags|=d.Internal.CameraFlags.NearLimit};f.prototype.getNearLimit=function(){return this._nearLimit};f.prototype.equals=function(a){return this._position.equals(a._position)&&this._target.equals(a._target)&&this._up.equals(a._up)&&this._width===a._width&&this._height===a._height&&this._projection===a._projection&&this._nearLimit===a._nearLimit};f.prototype.dolly=function(a){this._position.subtract(a);this._target.subtract(a)};f.prototype.getCameraPlaneIntersectionPoint=
function(a,e){var c=d.Point3.subtract(this._position,this._target).normalize();c=d.Plane.createFromPointAndNormal(this._target,c);a=e.raycastFromPoint(a);if(null===a)return null;e=d.Point3.zero();return c.intersectsRay(a,e)?e:null};f.prototype.getViewMatrix=function(a){return a._getScEngine().getViewMatrix(this)};f.prototype.getProjectionMatrix=function(a){return a._getScEngine().getProjectionMatrix(this)};f.prototype.getFullMatrix=function(a){return a._getScEngine().getFullCameraMatrix(this)};f.prototype.getMatrixFromCamera=
function(){var a=d.Point3.subtract(this.getTarget(),this.getPosition()).normalize(),e=this.getUp().normalize();e=d.Point3.cross(e,a);var c=d.Point3.cross(a,e);return d.Matrix.createFromBasis(e,c,a)};f.create=function(a,e,c,b,g,d,l){var k=new f;k._position.assign(a);k._target.assign(e);k._up.assign(c);k._projection=b;k._width=g;k._height=d;void 0!==l&&(k._nearLimit=l);return k};f.prototype.toJson=function(){return this._toJson()};f.prototype._toJson=function(){return{position:this._position.toJson(),
target:this._target.toJson(),up:this._up.toJson(),width:this._width,height:this._height,projection:this._projection,nearLimit:this._nearLimit,className:"Communicator.Camera"}};f.prototype.forJson=function(){return this.toJson()};f.fromJson=function(a){var e=d.Point3.fromJson(a.position),c=d.Point3.fromJson(a.target),b=d.Point3.fromJson(a.up);return f.create(e,c,b,a.projection,a.width,a.height,a.nearLimit)};f.construct=function(a){return f.fromJson(a)};f.prototype.transform=function(a){if(a.isIdentity())return this.copy();
var e=Math.abs(this._width),c=Math.abs(this._height),b=this.getUp().normalize().scale(c);c=d.Point3.subtract(this._position,this._target);var g=d.Point3.cross(b,c).normalize().scale(e);e=this.getTarget();g=d.Point3.add(e,g);b=d.Point3.add(e,b);var k=d.Point3.add(e,c);a.transform(e,e);a.transform(g,g);a.transform(b,b);a.transform(k,k);a=d.Point3.subtract(g,e);c=d.Point3.subtract(b,e);b=d.Point3.subtract(k,e);b=d.Point3.add(e,b);g=c.copy().normalize();a=a.length();c=c.length();0>this._width&&(a=-a);
0>this._height&&(c=-c);return f.create(b,e,g,this._projection,a,c,this._nearLimit)};return f}();d.Camera=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(a,e,c,b){var g=this;this._cuttingSections=[];this._isInit=!1;this._standinGeometryPickable=!0;this._cappingFaceColor=d.Color.createFromFloat(.5,.5,.5);this._cappingLineColor=d.Color.createFromFloat(.5,.5,.5);this._cappingIdleCallbackEnabled=!1;this._cappingIdlePromise=null;this._conservativeIsCappingIdle=!1;this._viewer=a;this._model=e;this._callbackManager=c;this._engine=b;a.setCallbacks({cappingIdle:function(b){(g._conservativeIsCappingIdle=b)&&null!==g._cappingIdlePromise&&
(g._cappingIdlePromise.resolve(),g._cappingIdlePromise=null)},_resetAssemblyTreeBegin:function(){null!==g._cappingIdlePromise&&(g._cappingIdlePromise.reject(new d.CommunicatorError("Model became reset.")),g._cappingIdlePromise=null);return Promise.resolve()}})}f.prototype.createReferenceGeometryFromAxis=function(a,e){var c=[];switch(a){case d.Axis.X:c.push(new d.Point3(0,e.max.y,e.min.z));c.push(new d.Point3(0,e.max.y,e.max.z));c.push(new d.Point3(0,e.min.y,e.max.z));c.push(new d.Point3(0,e.min.y,
e.min.z));break;case d.Axis.Y:c.push(new d.Point3(e.min.x,0,e.min.z));c.push(new d.Point3(e.max.x,0,e.min.z));c.push(new d.Point3(e.max.x,0,e.max.z));c.push(new d.Point3(e.min.x,0,e.max.z));break;case d.Axis.Z:c.push(new d.Point3(e.min.x,e.max.y,0)),c.push(new d.Point3(e.max.x,e.max.y,0)),c.push(new d.Point3(e.max.x,e.min.y,0)),c.push(new d.Point3(e.min.x,e.min.y,0))}return c};f.prototype.createReferenceGeometryFromFaceNormal=function(a,e,c){var b=[],g=(new d.Plane).setFromPointAndNormal(e,a).d;g=
e.copy().add(d.Point3.scale(a,g));e=c.center();e=d.Point3.add(e,d.Point3.scale(a,d.Point3.dot(a,d.Point3.subtract(g,e))));c=c.extents().length()/2;g=d.Point3.subtract(e,g);var k=d.Point3.cross(a,g),l=g.copy().scale(-1),f=k.copy().scale(-1);a=d.Point3.add(g,k).normalize().scale(c).add(e);k=d.Point3.add(l,k).normalize().scale(c).add(e);l=d.Point3.add(l,f).normalize().scale(c).add(e);e=d.Point3.add(g,f).normalize().scale(c).add(e);b.push(a);b.push(k);b.push(l);b.push(e);return b};f.prototype.activateCuttingSections=
function(){for(var a=[],e=0,c=this._cuttingSections;e<c.length;e++)a.push(c[e].activate());return d.Util.waitForAll(a)};f.prototype.deactivateCuttingSections=function(a){void 0===a&&(a=!1);for(var e=[],c=0,b=this._cuttingSections;c<b.length;c++){var g=b[c];a?e.push(g.clear()):e.push(g.deactivate())}return d.Util.waitForAll(e)};f.prototype.setCuttingPlaneColor=function(a){for(var e=0,c=this._cuttingSections;e<c.length;e++)c[e].setColor(a);return Promise.resolve()};f.prototype.setCappingFaceColor=function(a){this._cappingFaceColor=
a?a.copy():null;return this._engine.setCappingFaceColor(this._cappingFaceColor)};f.prototype.getCappingFaceColor=function(){return this._cappingFaceColor?this._cappingFaceColor.copy():null};f.prototype.setCappingLineColor=function(a){this._cappingLineColor=a?a.copy():null;return this._engine.setCappingLineColor(this._cappingLineColor)};f.prototype.getCappingLineColor=function(){return this._cappingLineColor?this._cappingLineColor.copy():null};f.prototype.getCuttingSection=function(a){return this._isInit&&
a<this._cuttingSections.length?this._cuttingSections[a]:null};f.prototype.getCuttingSectionCapacity=function(){return void 0!==this._cuttingLimits?this._cuttingLimits.maxCuttingPlanesPerSection:0};f.prototype.getCuttingSectionCount=function(){return void 0!==this._cuttingLimits?this._cuttingLimits.maxCuttingSections:0};f.prototype.getCuttingSectionFromNodeId=function(a){if(null!==a)for(var e=0,c=this._cuttingSections;e<c.length;e++){var b=c[e];if(0<=b._getInstanceNodeIds().indexOf(a))return b}return null};
f.prototype.setStandinGeometryPickable=function(a){this._standinGeometryPickable=a;var e=this._gatherStandinGeometryIds();this._model.setInstanceModifier(d.InstanceModifier.DoNotSelect,e,!a);return Promise.resolve()};f.prototype.getStandinGeometryPickable=function(){return this._standinGeometryPickable};f.prototype.setCappingDelay=function(a){this._engine.setCappingDelay(a)};f.prototype.delayCapping=function(){this._engine.delayCapping()};f.prototype.enableCappingIdleCallback=function(a){a!==this._cappingIdleCallbackEnabled&&
(this._cappingIdleCallbackEnabled=a,this._conservativeIsCappingIdle=!1,a||null===this._cappingIdlePromise||(this._cappingIdlePromise.reject(new d.CommunicatorError("Capping idle callback became disabled.")),this._cappingIdlePromise=null));return this._engine.enableCappingIdleCallback(a)};f.prototype.waitForCappingIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(!this._cappingIdleCallbackEnabled)throw console.assert(null===this._cappingIdlePromise),
new d.CommunicatorError("Capping idle callback is not enabled.");if(this._conservativeIsCappingIdle)return[2];null===this._cappingIdlePromise&&(this._cappingIdlePromise=d.Util.OpenPromise.create());return[2,this._cappingIdlePromise]})})};f.prototype.setCappingGeometryVisibility=function(a){return this._engine.setCappingGeometryVisibility(a)};f.prototype.getCappingGeometryVisibility=function(){return this._engine.getCappingGeometryVisibility()};f.prototype.getActiveCuttingSectionCount=function(){var a=
0;if(this._cuttingLimits)for(var e=0;e<this._cuttingLimits.maxCuttingSections;e++){var c=this.getCuttingSection(e);null!==c&&c.isActive()&&(a+=c.getCount())}return a};f.prototype._init=function(){if(!this._isInit){this._cuttingLimits=this._engine.getCuttingSectionLimits();for(var a=0;a<this._cuttingLimits.maxCuttingSections;a++){var e=new d.CuttingSection(this._viewer,this._model,this._callbackManager,this,this._engine);this._cuttingSections.push(e)}this._isInit=!0}};f.prototype._isInitialized=function(){return this._isInit};
f.prototype.refreshPlaneGeometry=function(){for(var a=[],e=0,c=this._cuttingSections;e<c.length;e++)for(var b=c[e],g=0;g<b.getCount();g++){var k=b.getPlane(g);null!==k&&a.push(b.updatePlane(g,k,new d.Matrix,!1,!1))}return d.Util.waitForAll(a)};f.prototype.hasActiveCuttingSection=function(){if(this._cuttingLimits)for(var a=0;a<this._cuttingLimits.maxCuttingSections;a++){var e=this.getCuttingSection(a);if(null!==e&&e.isActive())return!0}return!1};f.prototype.toJson=function(){return this._toJson()};
f.prototype._toJson=function(){for(var a=[],e=0;e<this._cuttingSections.length;e++)a[e]=this._cuttingSections[e].toJson();return{cuttingSections:a,cappingGeometryVisibility:this.getCappingGeometryVisibility(),cappingFaceColor:this.getCappingFaceColor(),cappingLineColor:this.getCappingLineColor(),pickable:this.getStandinGeometryPickable()}};f.prototype.forJson=function(){return this.toJson()};f.prototype.fromJson=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,g,k,l;return __generator(this,
function(f){switch(f.label){case 0:e=d.Internal.deepClone(a);c=[];b=e.cuttingSections;for(g=0;g<b.length;g++)k=b[g],l=this._cuttingSections[g],c.push(l.fromJson(k));this.setStandinGeometryPickable(e.pickable);c.push(this.setCappingGeometryVisibility(e.cappingGeometryVisibility));c.push(this.setCappingFaceColor(d.Color.fromJson(e.cappingFaceColor)));c.push(this.setCappingLineColor(d.Color.fromJson(e.cappingLineColor)));return[4,Promise.all(c)];case 1:return f.sent(),[2,this._callbackManager.promiseTrigger("_cuttingSectionsLoaded",
null)]}})})};f.prototype._gatherStandinGeometryIds=function(){for(var a=[],e=0,c=this._cuttingSections;e<c.length;e++)for(var b=0,g=c[e]._getInstanceNodeIds();b<g.length;b++)a.push(g[b]);return a};return f}();d.CuttingManager=h})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function a(a,c,b,g,d){this._container=a;this._canvasContainerElement=c;this._markupSvgElement=b;this._redlineSvgElement=g;this._redlineElement=d}a.prototype.getCanvasContainerElement=function(){return this._canvasContainerElement};a.prototype.getMarkupSvgElement=function(){return this._markupSvgElement};a.prototype.getRedlineSvgElement=function(){return this._redlineSvgElement};a.prototype.getRedlineElement=function(){return this._redlineElement};a.prototype.shutdown=
function(){this._container.removeChild(this._markupSvgElement);this._container.removeChild(this._redlineSvgElement);this._container.removeChild(this._redlineElement);this._container.removeChild(this._canvasContainerElement)};a.createFromElement=function(e){var c=e.id;0===c.length&&(c=d.GUID.create());var b=c+"-canvas-container",g=c+"-svg",k=c+"-redline-svg";c+="-redline";var l=document.createElement("div");l.id=b;l.style.width="100%";l.style.height="100%";l.style.position="absolute";l.tabIndex=-1;
l.classList.add("webviewer-canvas");l.oncontextmenu=function(){return!1};e.appendChild(l);b=a._createSvgElement(g);e.appendChild(b);k=a._createSvgElement(k);e.appendChild(k);g=document.createElement("div");g.id=c;g.style.position="absolute";g.style.width="100%";g.style.height="100%";g.style.pointerEvents="none";e.appendChild(g);return new a(e,l,b,k,g)};a.createFromId=function(a){a=document.getElementById(a);return null===a?null:this.createFromElement(a)};a._createSvgElement=function(a){var c=document.createElementNS("http://www.w3.org/2000/svg",
"svg");c.id=a;c.style.width="100%";c.style.height="100%";c.style.position="absolute";c.style.pointerEvents="none";c.style.overflow="hidden";c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");return c};return a}();h.DomElements=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
var __extends=this&&this.__extends||function(){var d=function(h,f){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,e){a.__proto__=e}||function(a,e){for(var c in e)e.hasOwnProperty(c)&&(a[c]=e[c])};return d(h,f)};return function(h,f){function a(){this.constructor=h}d(h,f);h.prototype=null===f?Object.create(f):(a.prototype=f.prototype,new a)}}();
(function(d){var h=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(Error);d.CommunicatorError=h;var f=function(a){function c(b){b=a.call(this,"Invalid index ("+b+").")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.InvalidIndexError=f;f=function(a){function c(){var b=a.call(this,"Selection invalidated.")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.SelectionInvalidatedError=
f;f=function(a){function c(){var b=a.call(this,"Internal logic error.")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.InternalLogicError=f;f=function(a){function c(b){var g=a.call(this,"Invalid node ("+b+").")||this;Object.setPrototypeOf(g,c.prototype);g.nodeId=b;return g}__extends(c,a);return c}(h);d.InvalidNodeIdError=f;f=function(a){function c(b,g){for(var e=[],l=2;l<arguments.length;l++)e[l-2]=arguments[l];e.push(g);l=[];for(var f=0;f<e.length;f++){var m=e[f];
switch(m){case 0:l.push(d.NodeType.DrawingSheet,d.NodeType.PartInstance,d.NodeType.AssemblyNode);break;case 1:l.push(d.NodeType.BodyInstance);l.push(d.NodeType.PmiBody);l.push(d.NodeType.ViewFrame);break;case 2:l.push(d.NodeType.BodyInstance);break;case 3:l.push(d.NodeType.CadView);break;default:d.Util.TypeAssertNever(m)}}l.sort();e=[];for(f=0;f<l.length;f++)e.push(d.NodeType[l[f]]);e=a.call(this,"Expected node ("+b+") to be of "+(1===e.length?"type ("+e[0]+")":"types "+e)+".")||this;Object.setPrototypeOf(e,
c.prototype);e.nodeId=b;e.expectedTypes=l;return e}__extends(c,a);return c}(h);d.InvalidNodeTypeError=f;f=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.LoadError=f;var a=function(a){function c(){var b=a.call(this,"Load cancelled.")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(f);d.LoadCancelledError=a;f=function(a){function c(b){b=a.call(this,"Missing model: '"+b+"'.")||this;Object.setPrototypeOf(b,
c.prototype);return b}__extends(c,a);return c}(f);d.MissingModelError=f;h=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.ParseError=h;f=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);d.AssemblyDataParseError=f;d.MetaDataParseError=f;h=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);
d.XmlParseError=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,e,c){var b=this;this._explodeActive=!1;this._explodeMagnitude=0;this._model=a;this._engine=e;c.bind({_modelSwitched:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){this.stop();return[2]})})}})}d.prototype.start=function(a,e){this.getActive()&&this.stop();return this._doExplode(a,e)};d.prototype.setMagnitude=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return 0<
a&&!this._explodeActive?[4,this.start()]:[3,2];case 1:return e.sent(),[3,3];case 2:0===a&&this._explodeActive&&this.stop(),e.label=3;case 3:return this._explodeActive?(this._explodeMagnitude=a,[2,this._engine.setExplodeMagnitude(a)]):[2]}})})};d.prototype.stop=function(){this._engine.stopExplode();this._explodeMagnitude=0;this._explodeActive=!1;this._engine.setExplodeMagnitude(0);return Promise.resolve()};d.prototype.getMagnitude=function(){return this._explodeMagnitude};d.prototype.getActive=function(){return this._explodeActive};
d.prototype._doExplode=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b;return __generator(this,function(g){switch(g.label){case 0:return this._explodeActive=!0,c=void 0!==a&&0<a.length?this._model._gatherInstanceIncsFromNodeIds(a):[],e?[3,2]:[4,this._model.getModelBounding(!0,!1)];case 1:return b=g.sent(),this._engine.startExplode(c,b.center()),[3,3];case 2:this._engine.startExplode(c,e),g.label=3;case 3:return[2]}})})};return d}();d.ExplodeManager=h})(Communicator||(Communicator=
{}));(function(d){(function(d){d.create=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var a=16*Math.random()|0;return("x"===d?a:a&3|8).toString(16)})}})(d.GUID||(d.GUID={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function a(){this._obscuredLineColor=d.Color.black();this._obscuredLineOpacity=.2;this._visibleLineColor=d.Color.black();this._visibleLineOpacity=1;this._backgroundColor=d.Color.white()}a.prototype.getObscuredLineColor=function(){return this._obscuredLineColor.copy()};a.prototype.setObscuredLineColor=function(a){this._obscuredLineColor.assign(a)};a.prototype.getObscuredLineOpacity=function(){return this._obscuredLineOpacity};a.prototype.getObscuredLineTransparency=
function(){return this.getObscuredLineOpacity()};a.prototype.setObscuredLineOpacity=function(a){0<=a&&1>=a&&(this._obscuredLineOpacity=a)};a.prototype.setObscuredLineTransparency=function(a){this.setObscuredLineOpacity(a)};a.prototype.getVisibleLineColor=function(){return this._visibleLineColor.copy()};a.prototype.setVisibleLineColor=function(a){this._visibleLineColor.assign(a)};a.prototype.getVisibleLineOpacity=function(){return this._visibleLineOpacity};a.prototype.getVisibleLineTransparency=function(){return this.getVisibleLineOpacity()};
a.prototype.setVisibleLineOpacity=function(a){0<=a&&1>=a&&(this._visibleLineOpacity=a)};a.prototype.setVisibleLineTransparency=function(a){this.setVisibleLineOpacity(a)};a.prototype.getBackgroundColor=function(){return this._backgroundColor.copy()};a.prototype.setBackgroundColor=function(a){this._backgroundColor.assign(a)};return a}();h.HiddenLineSettings=f})(d.Settings||(d.Settings={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h._isMouseEventType=function(a){switch(a){case d.EventType.MouseDown:return!0;case d.EventType.MouseMove:return!0;case d.EventType.MouseUp:return!0;case d.EventType.Mousewheel:return!0;case d.EventType.TouchStart:return!1;case d.EventType.TouchMove:return!1;case d.EventType.TouchEnd:return!1;case d.EventType.KeyDown:return!1;case d.EventType.KeyUp:return!1;case d.EventType.ViewOrientationChange:return!1}};var f=function(){function a(){this._date=new Date;this._handled=!1;
this._compositePickResult=null}a.prototype._setCompositePickResult=function(a){this._compositePickResult=a};a.prototype._getCompositePickResult=function(){return this._compositePickResult};a.prototype._getPickResult=function(a){return null===this._compositePickResult?null:this._compositePickResult.fetchMostRelevant(a)};a.prototype.getHandled=function(){return this._handled};a.prototype.setHandled=function(a){this._handled=a};a.prototype.getDate=function(){return this._date};return a}();h.InputEvent=
f})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));(function(d){(function(d){var f=function(a){function d(c,b,g){b=a.call(this)||this;b._keyCode=c;b._eventType=g;return b}__extends(d,a);d.prototype.getKeyCode=function(){return this._keyCode};d.prototype.getEventType=function(){return this._eventType};return d}(d.InputEvent);d.KeyInputEvent=f})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function e(c,b){this._callbackManager=c;this._operatorManager=b;this._contextEventChecker=new a(this._callbackManager)}e.prototype.injectMouseDownEvent=function(c,b,g,a,e){c=new d.Event.MouseInputEvent(c,b,g,a,e,d.MouseInputType.Down);b=d.EventType.MouseDown;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b);this._contextEventChecker.onMouseDownEvent(c)};e.prototype.injectMouseMoveEvent=function(c,b,g,
a,e){c=new d.Event.MouseInputEvent(c,b,g,a,e,d.MouseInputType.Move);b=d.EventType.MouseMove;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b)};e.prototype.injectMouseUpEvent=function(c,b,g,a,e){c=new d.Event.MouseInputEvent(c,b,g,a,e,d.MouseInputType.Up);b=d.EventType.MouseUp;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b);this._contextEventChecker.onMouseUpEvent(c)};e.prototype.injectMousewheelEvent=
function(c,b,g,a,e){c=new d.Event.MouseWheelInputEvent(c,b,g,a,e,d.MouseInputType.Wheel);b=d.EventType.Mousewheel;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b)};e.prototype.injectKeyDownEvent=function(c,b){c=new d.Event.KeyInputEvent(c,b,d.KeyInputType.Down);b=d.EventType.KeyDown;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b)};e.prototype.injectKeyUpEvent=function(c,b){c=new d.Event.KeyInputEvent(c,
b,d.KeyInputType.Up);b=d.EventType.KeyUp;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b)};e.prototype.injectTouchStartEvent=function(c,b,g,a){c=new d.Event.TouchInputEvent(c,b,g,a,d.TouchInputType.Start);b=d.EventType.TouchStart;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b);this._contextEventChecker.onTouchStartEvent(c)};e.prototype.injectTouchMoveEvent=function(c,b,g,a){c=new d.Event.TouchInputEvent(c,
b,g,a,d.TouchInputType.Start);b=d.EventType.TouchMove;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b);this._contextEventChecker.onTouchMoveEvent(c)};e.prototype.injectTouchEndEvent=function(c,b,g,a){c=new d.Event.TouchInputEvent(c,b,g,a,d.TouchInputType.End);b=d.EventType.TouchEnd;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b);this._contextEventChecker.onTouchEndEvent(c)};e.prototype.injectViewOrientationChangeEvent=
function(){this._operatorManager._injectViewOrientationChangeEvent()};return e}();h.EventDispatcher=f;var a=function(){function a(c){this._contextMenuMouseButton=d.Button.Right;this._contextMenuPositionStart=d.Point2.zero();this._touchTimer=new h.Timer;this._activeTouchCount=0;this._initialPosition=d.Point2.zero();this._callbackManager=c}a.prototype.onMouseDownEvent=function(c){c.getHandled()||this._contextMenuPositionStart.assign(c.getPosition())};a.prototype.onMouseUpEvent=function(c){if(!c.getHandled()){var b=
c.getPosition();c.getButton()===this._contextMenuMouseButton&&this._contextMenuPositionStart.equals(b)&&this._callbackManager.trigger("contextMenu",b,c.getModifiers())}};a.prototype.onTouchStartEvent=function(c){var b=this,g=c.getPosition().copy();0===this._activeTouchCount&&(this._initialPosition=g);++this._activeTouchCount;c.getHandled()||this._touchTimer.set(600,function(){b._callbackManager.trigger("contextMenu",g,d.KeyModifiers.None)})};a.prototype.onTouchMoveEvent=function(c){if(!this._touchTimer.isIdle(0)){c=
d.Point2.subtract(this._initialPosition,c.getPosition());c=Math.abs(c.squaredLength());var b=.02*window.outerHeight;c>b*b&&this._touchTimer.clear()}};a.prototype.onTouchEndEvent=function(c){0<this._activeTouchCount&&--this._activeTouchCount;this._touchTimer.clear()};return a}()})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,d){this.x=a;this.y=d}d.prototype.assign=function(a){this.x=a.x;this.y=a.y;return this};d.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};d.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y;return this};d.prototype.scale=function(a){this.x*=a;this.y*=a;return this};d.prototype.equals=function(a){return this.x===a.x&&this.y===a.y};d.prototype.set=function(a,d){this.x=a;this.y=d;return this};d.prototype.copy=function(){return new d(this.x,
this.y)};d.prototype.length=function(){return Math.sqrt(this.squaredLength())};d.prototype.squaredLength=function(){return this.x*this.x+this.y*this.y};d.prototype.toJson=function(){return this._toJson()};d.prototype._toJson=function(){return{x:this.x,y:this.y}};d.prototype.forJson=function(){return this.toJson()};d.fromJson=function(a){return new d(a.x,a.y)};d.subtract=function(a,e){return new d(a.x-e.x,a.y-e.y)};d.add=function(a,e){return new d(a.x+e.x,a.y+e.y)};d.distance=function(a,e){return d.subtract(e,
a).length()};d.zero=function(){return new d(0,0)};d.fromPoint3=function(a){return new d(a.x,a.y)};return d}();d.Point2=h})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){return function(){this.top=this.left=0}}(),a=function(){function a(c,b){this._isFirefox=this._isIE=!1;this._canvas=null;this._canvasEventFunctions=new Map;this._documentEventFunctions=new Map;this._pointerEventsEnabled=!0;this._captureInput=this._dragStarted=this._eventsBound=this._processInput=!1;this._elementOffset=new f;this._pointerUp=!1;this._buttons=d.Buttons.None;this._eventDispatcher=c;this._timeoutMonitor=b;this._document=document;c=navigator.userAgent.toLowerCase();
this._isIE=0<=c.indexOf("trident")||0<=c.indexOf("edge");this._isFirefox=-1<c.indexOf("firefox")}a.prototype._tryLockEventDispatcher=function(){return a._activeEventDispatcherLocked&&a._activeEventDispatcher!==this._eventDispatcher?!1:(this._calculateElementOffset(),a._activeEventDispatcher=this._eventDispatcher,a._activeOffset=this._elementOffset,a._activeEventDispatcherLocked=!0)};a.prototype._unlockEventDispatcher=function(){a._activeEventDispatcherLocked=!1};a.prototype.shutdown=function(){this.unbindEvents()};
a.prototype.setDocument=function(c){this._unbindDocumentEvents();this._document=c;this._initDocumentEvents()};a.prototype.setOptions=function(c){c.hasOwnProperty("usePointerEvents")&&this.setPointerEventsEnabled(!!c.usePointerEvents)};a.prototype.elementResize=function(){this._calculateElementOffset()};a.prototype.setPointerEventsEnabled=function(c){this._pointerEventsEnabled=c};a.prototype.getPointerEventsEnabled=function(){return this._pointerEventsEnabled};a.prototype._browserSupportsPointerEvents=
function(){return window.hasOwnProperty("PointerEvent")};a.prototype._usePointerEvents=function(){return this._browserSupportsPointerEvents()&&this._pointerEventsEnabled&&this._isIE};a.prototype._calculateElementOffset=function(){this._elementOffset.left=0;this._elementOffset.top=0;if(null!==this._canvas)for(var c=this._canvas;c;)this._elementOffset.left+=c.offsetLeft,this._elementOffset.top+=c.offsetTop,c=c.offsetParent};a.prototype._initDocumentEvents=function(){var c=this;this._usePointerEvents()?
(this._bindDocumentEvent("pointermove",function(b){c._processDocumentPointerMove(b)}),this._bindDocumentEvent("pointerup",function(b){c._processDocumentPointerUp(b)})):(this._bindDocumentEvent("mousemove",function(b){c._processDocumentMouseMove(b)}),this._bindDocumentEvent("mouseup",function(b){c._processDocumentMouseUp(b)}))};a.prototype._initCanvasEvents=function(){var c=this;this._usePointerEvents()?(this._bindCanvasEvent("pointerdown",function(b){c._processPointerDown(b)}),this._bindCanvasEvent("pointermove",
function(b){c._processPointerMove(b)}),this._bindCanvasEvent("pointerup",function(b){c._processPointerUp(b)}),this._bindCanvasEvent("pointerenter",function(b){c._processPointerEnter(b)}),this._bindCanvasEvent("pointerleave",function(b){c._processPointerLeave(b)})):(this._bindCanvasEvent("mousedown",function(b){c._processMouseDown(b)}),this._bindCanvasEvent("mousemove",function(b){c._processMouseMove(b)}),this._bindCanvasEvent("mouseup",function(b){c._processMouseUp(b)}),this._bindCanvasEvent("mouseenter",
function(b){c._processMouseEnter(b)}),this._bindCanvasEvent("mouseleave",function(b){c._processMouseLeave(b)}),this._bindCanvasEvent("touchstart",function(b){c._processTouchStart(b)}),this._bindCanvasEvent("touchmove",function(b){c._processTouchMove(b)}),this._bindCanvasEvent("touchend",function(b){c._processTouchEnd(b)}),this._bindCanvasEvent("touchcancel",function(b){c._processTouchEnd(b)}));this._isFirefox?this._bindCanvasEvent("DOMMouseScroll",function(b){c._processMousewheel(b)}):this._bindCanvasEvent("mousewheel",
function(b){c._processMousewheel(b)});this._bindCanvasEvent("keydown",function(b){c._processKeyDownEvent(b)});this._bindCanvasEvent("keyup",function(b){c._processKeyUpEvent(b)})};a.prototype.bindEvents=function(c){this._eventsBound||(this._canvas=c,this._processInput=!0,this._initCanvasEvents(),this._initDocumentEvents(),this._eventsBound=!0,this._tryLockEventDispatcher())};a.prototype._bindDocumentEvent=function(c,b){if(null!==this._document){var g=this._documentEventFunctions.get(c);void 0!==g&&
this._document.removeEventListener(c,g);this._documentEventFunctions.set(c,b);this._document.addEventListener(c,b)}};a.prototype._bindCanvasEvent=function(c,b){if(null!==this._canvas){var g=this._canvasEventFunctions.get(c);void 0!==g&&this._canvas.removeEventListener(c,g);this._canvasEventFunctions.set(c,b);this._canvas.addEventListener(c,b)}};a.prototype._unbindDocumentEvents=function(){var c=this;this._documentEventFunctions.forEach(function(b,g){c._document.removeEventListener(g,b)});this._documentEventFunctions.clear()};
a.prototype._unbindCanvasEvents=function(){var c=this;null!==this._canvas&&(this._canvasEventFunctions.forEach(function(b,g){c._canvas.removeEventListener(g,b)}),this._canvasEventFunctions.clear());console.assert(0===this._canvasEventFunctions.size)};a.prototype.unbindEvents=function(){this._unbindCanvasEvents();this._unbindDocumentEvents();this._eventsBound=this._processInput=!1;a._activeEventDispatcher===this._eventDispatcher&&this._unlockEventDispatcher()};a.prototype._convertEventCoordsToTargetCoords=
function(c,b){var g=null!==a._activeOffset?a._activeOffset:this._elementOffset;return new d.Point2(c-g.left,b-g.top)};a.prototype.focusInput=function(c){null!==this._canvas&&(c?this._canvas.focus():this._canvas.blur())};a.prototype._setButtons=function(c){c.buttons&&(this._buttons=c.buttons)};a.prototype._processMouseDown=function(c){if(this._tryLockEventDispatcher()){switch(c.button){case 0:this._buttons|=d.Buttons.Left;break;case 1:this._buttons|=d.Buttons.Middle;break;case 2:this._buttons|=d.Buttons.Right}c.preventDefault();
this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.pageX,c.pageY),g=this._getEventModifiers(c);a._activeEventDispatcher.injectMouseDownEvent(b.x,b.y,c.button,this._buttons,g);this._dragStarted=!0}}};a.prototype._processMouseMove=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.pageX,c.pageY);c=this._getEventModifiers(c);null!==a._activeEventDispatcher&&a._activeEventDispatcher.injectMouseMoveEvent(b.x,
b.y,d.Button.None,this._buttons,c)}};a.prototype._processMouseUp=function(c){this._unlockEventDispatcher();switch(c.button){case 0:this._buttons&=~d.Buttons.Left;break;case 1:this._buttons&=~d.Buttons.Middle;break;case 2:this._buttons&=~d.Buttons.Right}c.preventDefault();c.stopPropagation();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.pageX,c.pageY),g=this._getEventModifiers(c);null!==a._activeEventDispatcher?a._activeEventDispatcher.injectMouseUpEvent(b.x,
b.y,c.button,this._buttons,g):this._eventDispatcher.injectMouseUpEvent(b.x,b.y,c.button,this._buttons,g);this._captureInput=this._dragStarted=!1}};a.prototype._processMousewheel=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.pageX,c.pageY),g=this._getEventModifiers(c);this._eventDispatcher.injectMousewheelEvent(b.x,b.y,this._isFirefox?0<c.detail?-1:1:0<c.wheelDelta?1:-1,this._buttons,g)}};a.prototype._processDocumentMouseMove=
function(c){this._dragStarted&&this._captureInput&&this._processMouseMove(c)};a.prototype._processDocumentMouseUp=function(c){this._dragStarted&&this._captureInput&&this._processMouseUp(c)};a.prototype._processMouseLeave=function(c){this._unlockEventDispatcher();this._dragStarted&&(this._captureInput=!0)};a.prototype._processMouseEnter=function(c){this._tryLockEventDispatcher()&&this._dragStarted&&(this._captureInput=!1)};a.prototype._isFunctionKey=function(c){return 112<=c.which&&123>=c.which};a.prototype._processKeyDownEvent=
function(c){this._isFunctionKey(c)||c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._getEventModifiers(c);this._eventDispatcher.injectKeyDownEvent(c.which,b)}};a.prototype._processKeyUpEvent=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._getEventModifiers(c);this._eventDispatcher.injectKeyUpEvent(c.which,b)}};a.prototype._processTouchStart=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();
if(this._processInput)for(var b=0;b<c.changedTouches.length;b++){var g=c.changedTouches.item(b),a=this._convertEventCoordsToTargetCoords(g.pageX,g.pageY);this._eventDispatcher.injectTouchStartEvent(g.identifier,a.x,a.y,this._buttons)}};a.prototype._processTouchMove=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput)for(var b=0;b<c.changedTouches.length;b++){var g=c.changedTouches.item(b),a=this._convertEventCoordsToTargetCoords(g.pageX,g.pageY);this._eventDispatcher.injectTouchMoveEvent(g.identifier,
a.x,a.y,this._buttons)}};a.prototype._processTouchEnd=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput)for(var b=0;b<c.changedTouches.length;b++){var g=c.changedTouches.item(b),a=this._convertEventCoordsToTargetCoords(g.pageX,g.pageY);this._eventDispatcher.injectTouchEndEvent(g.identifier,a.x,a.y,this._buttons)}};a.prototype._processPointerDown=function(c){if(this._tryLockEventDispatcher()&&(this._setButtons(c),c.preventDefault(),this._timeoutMonitor.resetTimeout(),
this._processInput)){var b=this._convertEventCoordsToTargetCoords(c.pageX,c.pageY),g=this._getEventModifiers(c);"mouse"===c.pointerType?a._activeEventDispatcher.injectMouseDownEvent(b.x,b.y,c.button,this._buttons,g):"touch"===c.pointerType&&a._activeEventDispatcher.injectTouchStartEvent(c.pointerId,b.x,b.y,this._buttons);this._pointerUp=!1}};a.prototype._processPointerMove=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();this._setButtons(c);if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.pageX,
c.pageY),g=this._getEventModifiers(c);null!==a._activeEventDispatcher&&("mouse"===c.pointerType?a._activeEventDispatcher.injectMouseMoveEvent(b.x,b.y,c.button,this._buttons,g):"touch"===c.pointerType&&a._activeEventDispatcher.injectTouchMoveEvent(c.pointerId,b.x,b.y,this._buttons))}};a.prototype._processPointerUp=function(c){this._unlockEventDispatcher();this._setButtons(c);c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.pageX,
c.pageY),g=this._getEventModifiers(c);"mouse"!==c.pointerType||this._pointerUp?"touch"===c.pointerType&&this._eventDispatcher.injectTouchEndEvent(c.pointerId,b.x,b.y,this._buttons):null!==a._activeEventDispatcher?a._activeEventDispatcher.injectMouseUpEvent(b.x,b.y,c.button,this._buttons,g):this._eventDispatcher.injectMouseUpEvent(b.x,b.y,c.button,this._buttons,g);this._captureInput=this._dragStarted=!1;this._pointerUp=!0}};a.prototype._processPointerEnter=function(c){this._pointerUp||(this._captureInput=
!1)};a.prototype._processPointerLeave=function(c){this._pointerUp||(this._captureInput=!0)};a.prototype._processDocumentPointerMove=function(c){!this._pointerUp&&this._captureInput&&this._processPointerMove(c)};a.prototype._processDocumentPointerUp=function(c){!this._pointerUp&&this._captureInput&&this._processPointerUp(c)};a.prototype._getEventModifiers=function(c){var b=d.KeyModifiers.None;c.altKey&&(b|=d.KeyModifiers.Alt);c.ctrlKey&&(b|=d.KeyModifiers.Control);c.shiftKey&&(b|=d.KeyModifiers.Shift);
c.metaKey&&(b|=d.KeyModifiers.Command);return b};a._activeEventDispatcher=null;a._activeEventDispatcherLocked=!1;a._activeOffset=null;return a}();h.InputMonitor=a})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){d[d.Directional=0]="Directional"})(d.LightType||(d.LightType={}));(function(d){d[d.World=0]="World";d[d.Camera=1]="Camera"})(d.LightSpace||(d.LightSpace={}));var h=function(){return function(d,a,e,c){this.type=d;this.space=a;this.position=e;this.color=c}}();d.Light=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(){}d.prototype.exportMarkup=function(){return[]};d.prototype.loadData=function(a){a;return Promise.resolve([])};return d}();d.MarkupTypeManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(f){function a(a,c){var b=f.call(this)||this;b._markupArray=[];b._viewer=a;b._callbackManager=c;b._callbackManager.bind({modelSwitched:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.removeAllLines()];case 1:return b.sent(),[2]}})})}});return b}__extends(a,f);a.prototype.addLine=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._markupArray.push(a),
[4,a.updateLine()];case 1:return c.sent(),this._callbackManager.trigger("lineCreated",a),[2]}})})};a.prototype.removeLine=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:c=0,b.label=1;case 1:return c<this._markupArray.length?this._markupArray[c].getId()!==a.getId()?[3,3]:[4,a.removeLine()]:[3,4];case 2:b.sent(),this._markupArray.splice(c,1),this._callbackManager.trigger("lineDeleted",a),b.label=3;case 3:return c++,[3,1];case 4:return[2]}})})};
a.prototype.removeAllLines=function(){for(var a=this,c=[],b=function(b){var d=g._markupArray[b];c.push(d.removeLine().then(function(){a._callbackManager.trigger("lineDeleted",d)}));g._markupArray.splice(b,1)},g=this,k=this._markupArray.length-1;0<=k;k--)b(k);return d.Util.waitForAll(c)};a.prototype.getAllLines=function(){return this._markupArray.slice(0)};a.prototype.removeLastLine=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return 0<
this._markupArray.length?[4,this.removeLine(this._markupArray[this._markupArray.length-1])]:[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}})})};a.prototype.getLineByNodeId=function(a){for(var c=0,b=this._markupArray;c<b.length;c++){var g=b[c],d=g.getNodeId();if(null!==d&&d===a)return g}return null};a.prototype.exportMarkup=function(){for(var a=[],c=0,b=this._markupArray;c<b.length;c++)a.push(b[c].toJson());return a};a.prototype._handleLoadLine=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(c){switch(c.label){case 0:return a instanceof d.Markup.Line.LineMarkup?[4,this.addLine(a)]:[3,2];case 1:return c.sent(),this._callbackManager.trigger("lineLoaded",a),[2,!0];case 2:return[2,!1]}})})};a.prototype.loadData=function(a){for(var c=this,b=[],g=0;g<a.length;g++){var k=a[g];if(k.hasOwnProperty("className")){var e=d.Internal.classFromString(k.className);e&&(k=e.fromJson(k,this._viewer),k instanceof Promise?b.push(k.then(function(b){return c._handleLoadLine(b)})):b.push(this._handleLoadLine(k)))}}return Promise.all(b)};
return a}(d.MarkupTypeManager);d.LineManager=h})(Communicator||(Communicator={}));var __decorate=this&&this.__decorate||function(d,h,f,a){var e=arguments.length,c=3>e?h:null===a?a=Object.getOwnPropertyDescriptor(h,f):a,b;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)c=Reflect.decorate(d,h,f,a);else for(var g=d.length-1;0<=g;g--)if(b=d[g])c=(3>e?b(c):3<e?b(h,f,c):b(h,f))||c;return 3<e&&c&&Object.defineProperty(h,f,c),c};
(function(d){var h=function(){function f(a,e,c,b,g,k,l){this._markupTypeMap=new Map;this._domElements=a;this._callbackManager=b;this._viewer=l;this._sheetManager=g;this._sheetManager.setMarkupManager(this);this._noteTextManager=k;this._renderer=new d.Internal.SVG.SVGMarkupRenderer;this._itemManager=new d.Internal.MarkupItemManager(this._callbackManager,this._domElements,this._renderer);this._viewManager=new d.Internal.MarkupViewManager(this._viewer,this._itemManager,this._callbackManager,l.explodeManager,
l.cuttingManager,this._sheetManager);this._measurementManager=e;this._lineManager=c}f.deprecated=function(a,d,c){var b=c.value;c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","MarkupManager",d);return b.apply(this,c)};return c};f.prototype.registerMarkupTypeManager=function(a,d){this._markupTypeMap.set(a,d)};f.prototype.createMarkupView=function(a,d,c,b,g){void 0===d&&(d=!0);void 0===c&&(c=null);void 0===b&&(b=null);void 0===
g&&(g=null);var k=this._viewer.getActiveSheetId();return this._viewManager.createView(a,d,k,c,b,g).getUniqueId()};f.prototype.getMarkupView=function(a){return this._viewManager.getView(a)};f.prototype.getMarkupViewKeys=function(){return this._viewManager.getViewKeys()};f.prototype.activateMarkupViewWithPromise=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,this._viewManager.activateView(a,e)]})})};
f.prototype.activateMarkupView=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return this._viewManager.deprecatedActivateView(a,e)};f.prototype.getActiveMarkupView=function(){return this._itemManager.getActiveView()};f.prototype.deleteMarkupView=function(a){return this._viewManager.deleteView(a)};f.prototype.registerMarkup=function(a){a=this._itemManager.registerMarkupItem(a);this.updateLater();return a};f.prototype.unregisterMarkup=function(a){this._itemManager.unregisterMarkupItem(a);
this.updateLater()};f.prototype.addMarkupElement=function(a){var e=d.GUID.create();a.id=e;this._domElements.getRedlineElement().appendChild(a);return e};f.prototype.removeMarkupElement=function(a){for(var d=this._domElements.getRedlineElement(),c=0;c<d.children.length;c++){var b=d.children.item(c);null!==b&&b.id===a&&d.removeChild(b)}};f.prototype.refreshMarkup=function(){this.updateLater()};f.prototype.updateLater=function(){this._itemManager.updateLater()};f.prototype.pickMarkupItem=function(a){return this._itemManager.pick(a)};
f.prototype.getPickTolerance=function(){return this._itemManager.getPickTolerance()};f.prototype.setPickTolerance=function(a){return this._itemManager.setPickTolerance(a)};f.prototype.selectMarkup=function(a){this._itemManager.select(a)};f.prototype.getSelectedMarkup=function(){return this._itemManager.getSelected()};f.prototype.exportMarkup=function(){var a={views:this._viewManager.exportMarkup(),notes:this._noteTextManager.exportMarkup(),measurement:this._measurementManager.exportMarkup(),lines:this._lineManager.exportMarkup()};
this._markupTypeMap.forEach(function(d,c){a[c]=d.exportMarkup()});return a};f.prototype.loadMarkupData=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){"string"===typeof a&&(a=JSON.parse(a));return[2,this._loadMarkupData(a)]})})};f.prototype._loadMarkupData=function(a){return __awaiter(this,void 0,void 0,function(){var e,c;return __generator(this,function(b){e=[];a.hasOwnProperty("views")&&(c=this._viewManager.loadData(a.views).then(d.Internal.all),e.push(c));
a.hasOwnProperty("notes")&&(c=this._noteTextManager.loadData(a.notes).then(d.Internal.all),e.push(c));a.hasOwnProperty("measurement")&&(c=this._measurementManager.loadData(a.measurement).then(d.Internal.all),e.push(c));a.hasOwnProperty("lines")&&(c=this._lineManager.loadData(a.lines).then(d.Internal.all),e.push(c));this._markupTypeMap.forEach(function(b,c){a.hasOwnProperty(c)&&(b=b.loadData(a[c]).then(d.Internal.all),e.push(b))});return[2,Promise.all(e).then(d.Internal.all)]})})};f.prototype.getRenderer=
function(){return this._renderer};f.prototype._shutdown=function(){this._itemManager.shutdown();this._renderer._clear()};f.prototype._update=function(){this._itemManager.update()};f.prototype._setActiveMarkupView=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._itemManager.setActiveView(a)]})})};f.prototype._getItemManager=function(){return this._itemManager};__decorate([f.deprecated],f.prototype,"activateMarkupView",null);return f}();d.MarkupManager=
h})(Communicator||(Communicator={}));
(function(d){var h=function(f){function a(a,c){var b=f.call(this)||this;b._markupArray=[];b._color=new d.Color(0,0,0);b._edgeColor=new d.Color(0,0,0);b._viewer=a;b._callbackManager=c;b._callbackManager.bind({modelSwitched:function(){b.removeAllMeasurements()}});return b}__extends(a,f);a.prototype.addMeasurement=function(a){this._markupArray.push(a);var c=this._viewer.markupManager.registerMarkup(a);a._setId(c);return c};a.prototype.finalizeMeasurement=function(a){this._callbackManager.trigger("measurementCreated",a)};
a.prototype.removeMeasurement=function(a){for(var c=0;c<this._markupArray.length;c++)if(this._markupArray[c]._getId()===a._getId()){this._markupArray.splice(c,1);this._viewer.markupManager.unregisterMarkup(a._getId());this._callbackManager.trigger("measurementDeleted",a);break}};a.prototype.removeAllMeasurements=function(){for(var a=this._markupArray.length-1;0<=a;a--){var c=this._markupArray[a];this._viewer.markupManager.unregisterMarkup(c._getId());this._markupArray.splice(a,1);this._callbackManager.trigger("measurementDeleted",
c)}};a.prototype.getAllMeasurements=function(){return this._markupArray.slice(0)};a.prototype.removeLastMeasurement=function(){0<this._markupArray.length&&this.removeMeasurement(this._markupArray[this._markupArray.length-1])};a.prototype.setMeasurementColor=function(a){this._color.assign(a)};a.prototype.getMeasurementColor=function(){return this._color.copy()};a.prototype.setMeasurementEdgeColor=function(a){this._edgeColor.assign(a)};a.prototype.getMeasurementEdgeColor=function(){return this._edgeColor.copy()};
a.prototype.exportMarkup=function(){for(var a=[],c=0,b=this._markupArray;c<b.length;c++)a.push(b[c].toJson());return a};a.prototype._handleLoadMeasurement=function(a){return a instanceof d.Markup.Measure.MeasureMarkup?(this.addMeasurement(a),this._callbackManager.trigger("measurementLoaded",a),!0):!1};a.prototype.loadData=function(a){for(var c=this,b=[],g=0;g<a.length;g++){var k=a[g];if(k.hasOwnProperty("className")){var e=d.Internal.classFromString(k.className);e&&(k=e.fromJson(k,this._viewer),k instanceof
Promise?b.push(k.then(function(b){return c._handleLoadMeasurement(b)})):b.push(Promise.resolve(this._handleLoadMeasurement(k))))}}return Promise.all(b)};return a}(d.MarkupTypeManager);d.MeasureManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(){this._faceMeshData=[];this._pointMeshData=[];this._polylineMeshData=[];this._faceWinding=d.FaceWinding.CounterClockwise;this._isManifold=this._backfacesEnabled=!1}f.prototype.addFaces=function(a,e,c,b,g){void 0===g&&(g=0);this._faceMeshData.push(new d.Internal.FaceMeshData(a,e,c,b,g))};f.prototype.addPoints=function(a,e,c){void 0===c&&(c=0);this._pointMeshData.push(new d.Internal.PointMeshData(a,e,c))};f.prototype.addPolyline=function(a,e,c){void 0===c&&
(c=0);this._polylineMeshData.push(new d.Internal.PolylineMeshData(a,e,c))};f.prototype.clear=function(){this._faceMeshData.length=0;this._pointMeshData.length=0;this._polylineMeshData.length=0};f.prototype.setFaceWinding=function(a){this._faceWinding=a};f.prototype.getFaceWinding=function(){return this._faceWinding};f.prototype.setBackfacesEnabled=function(a){this._backfacesEnabled=a};f.prototype.getBackfacesEnabled=function(){return this._backfacesEnabled};f.prototype.setManifold=function(a){this._isManifold=
a};f.prototype.isManifold=function(){return this._isManifold};f.prototype._getFaceData=function(){return this._faceMeshData};f.prototype._getPointData=function(){return this._pointMeshData};f.prototype._getPolylineData=function(){return this._polylineMeshData};return f}();d.MeshData=h;h=function(){function f(a,e,c,b,g,k,l){this._instanceName=this._pointColor=this._lineColor=this._faceColor=this._matrix=this._meshId=null;this._pointOpacity=this._lineOpacity=this._faceOpacity=1;this._creationFlags=
d.MeshInstanceCreationFlags.None;this._overlayIndex=0;a&&(this._meshId=a.slice());e&&(this._matrix=e.copy());c&&(this._instanceName=c);b&&(this._faceColor=b.copy());g&&(this._lineColor=g.copy());k&&(this._pointColor=k.copy());l&&(this._creationFlags=l)}f.prototype.copy=function(){var a=new f(this.getMeshId(),this.getMatrix(),this.getInstanceName(),this.getFaceColor(),this.getLineColor(),this.getPointColor(),this.getCreationFlags());a.setPointOpacity(this.getOpacity());a.setLineOpacity(this.getLineOpacity());
a.setOpacity(this.getOpacity());a.setOverlayIndex(this.getOverlayIndex());return a};f.prototype.clear=function(){this._instanceName=this._pointColor=this._lineColor=this._faceColor=this._matrix=this._meshId=null;this._pointOpacity=this._lineOpacity=this._faceOpacity=1;this._creationFlags=d.MeshInstanceCreationFlags.None;this._overlayIndex=0};f.prototype.getMeshId=function(){return null!==this._meshId?this._meshId.slice():null};f.prototype.getMeshKey=function(){return this.getMeshId()};f.prototype.setMeshId=
function(a){this._meshId=a.slice()};f.prototype.setMeshKey=function(a){this.setMeshId(a)};f.prototype.getMatrix=function(){return null!==this._matrix?this._matrix.copy():null};f.prototype.getCreationFlags=function(){return this._creationFlags};f.prototype.setCreationFlags=function(a){this._creationFlags=a};f.prototype.setMatrix=function(a){this._matrix=a.copy()};f.prototype.getInstanceName=function(){return this._instanceName};f.prototype.setInstanceName=function(a){this._instanceName=a};f.prototype.setFaceColor=
function(a){this._faceColor=a.copy()};f.prototype.getFaceColor=function(){return null!==this._faceColor?this._faceColor.copy():null};f.prototype.setLineColor=function(a){this._lineColor=a.copy()};f.prototype.getLineColor=function(){return null!==this._lineColor?this._lineColor.copy():null};f.prototype.setPointColor=function(a){this._pointColor=a.copy()};f.prototype.getPointColor=function(){return null!==this._pointColor?this._pointColor.copy():null};f.prototype.setPointOpacity=function(a){this._pointOpacity=
a};f.prototype.getPointOpacity=function(){return this._pointOpacity};f.prototype.setLineOpacity=function(a){this._lineOpacity=a};f.prototype.getLineOpacity=function(){return this._lineOpacity};f.prototype.setOpacity=function(a){this._faceOpacity=a};f.prototype.setTransparency=function(a){this._faceOpacity=a};f.prototype.getOpacity=function(){return this._faceOpacity};f.prototype.getTransparency=function(){return this._faceOpacity};f.prototype.setOverlayIndex=function(a){this._overlayIndex=a};f.prototype.getOverlayIndex=
function(){return this._overlayIndex};return f}();d.MeshInstanceData=h})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){return function(a,d,c,b,g){void 0===g&&(g=0);this.vertexData=a;this.normalData=d;this.rgba32data=c;this.uvData=b;this.bits=g}}();d.FaceMeshData=f;f=function(){return function(a,d,c){void 0===c&&(c=0);this.vertexData=a;this.rgba32data=d;this.bits=c}}();d.PolylineMeshData=f;f=function(){return function(a,d,c){void 0===c&&(c=0);this.vertexData=a;this.rgba32data=d;this.bits=c}}();d.PointMeshData=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator=
{}));(function(d){(function(d){(function(d){function a(a){console.assert(a!==d.invalidNodeId);return a>d.invalidNodeId}d.invalidNodeId=-1;d.isAuthoredId=a;d.getAuthoredId=function(d){console.assert(a(d));return d};d.getRuntimeId=function(e,c){return a(e)?d.towardInclusionContext(c).toRuntimeId(e):e}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){d.DefaultTransitionDuration=400;d.EmptyModelName="_empty";d.InvalidNodeId=d.Internal.Tree.invalidNodeId;var h=function(){function f(a,e){var c=this;this._pmiColor=d.Color.black();this._pmiColorOverride=!1;this._viewAxes=new d.ViewAxes;this._viewAxesSet=!1;this._firstModelRootId=d.InvalidNodeId;this._engine=a;this._callbackManager=e;this._callbackManager.bind({_firstModelLoaded:function(b){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(c){this._firstModelRootId=
b[0];return[2]})})},_resetAssemblyTreeBegin:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(b){this._viewAxes=new d.ViewAxes;this._viewAxesSet=!1;return[2]})})}})}f.deprecated=function(a,d,c){var b=c.value;c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","Model",d);return b.apply(this,c)};return c};f.prototype._setModelStructure=function(a){console.assert(void 0===this._modelStructure);this._modelStructure=
a};f.prototype.getClientDimensions=function(){return this._engine.getClientDimensions()};f.prototype.setViewAxes=function(a,e){if(a.isAxis()&&e.isAxis()&&!a.equals(e))this._viewAxes.frontVector=a,this._viewAxes.upVector=e,this._callbackManager.trigger("viewAxes",a,e),this._viewAxesSet=!0;else throw new d.CommunicatorError("The upVector and frontVector must be unique, cardinal axes.");};f.prototype.viewAxesHaveBeenSet=function(){return this._viewAxesSet};f.prototype.getViewAxes=function(){return this._viewAxes};
f.prototype.getModelBounding=function(a,d,c){void 0===c&&(c=!1);return this._engine.getModelBounding(a,d,c)};f.prototype._preventNodeDeletion=function(a){return this._modelStructure.preventNodeDeletion(a)};f.prototype._preventMeshDeletion=function(a){console.assert(0===a[0]);return this._modelStructure.preventMeshDeletion(a[1])};f.prototype._getNodeFromInstanceInc=function(a,d,c,b){return this._modelStructure.getNodeFromInstanceInc(a,d,c,b)};f.prototype.getNodesBounding=function(a,d){var c=7,b=!1,
g=!1;void 0!==d&&(!1===d.bodyInstance&&(c&=-2),!1===d.pmiBody&&(c&=-3),!1===d.viewFrame&&(c&=-5),d.ignoreInvisible&&(b=!0),d.tightBounding&&(g=!0));return this._modelStructure.getBounding(a,c,b,g)};f.prototype.getNodeRealBounding=function(a){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(c){e=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);if(0===e.length)throw new d.CommunicatorError("Cannot get bounding of node without geometry.");
return[2,this._engine.getDrawnPartsBounding(e)]})})};f.prototype.setNodesVisibilities=function(a,e){void 0===e&&(e=null);a=d.Internal.fromIntegerMap(a);return this._modelStructure.setVisibilitiesByMap(a,e)};f.prototype.setNodesVisibility=function(a,d,c){void 0===c&&(c=null);return this._modelStructure.setVisibilitiesByValue(a,d,c)};f.prototype.resetNodesVisibility=function(){return this._modelStructure.resetAllVisibilities()};f.prototype.getVisibilityState=function(a){return __awaiter(this,void 0,
void 0,function(){var e;return __generator(this,function(c){e=this._modelStructure.lookupAnyTreeNode(a);if(null===e)throw new d.InvalidNodeIdError(a);return[2,d.Internal.Tree.getVisibilityState(e)]})})};f.prototype.resetNodesTransform=function(){return this._modelStructure.resetAllTransforms()};f.prototype.reset=function(){return this._modelStructure.reset()};f.prototype.clear=function(){return this._modelStructure.clear()};f.prototype.setNodesFaceColor=function(a,d){this._setNodesFaceColor(a,d);
return Promise.resolve()};f.prototype._setNodesFaceColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartColor(a,d.ElementType.Faces,e)};f.prototype._unsetNodesColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.unsetPartColor(a,e)};f.prototype.unsetNodesFaceColor=function(a){this._unsetNodesColor(a,d.ElementType.Faces);
return Promise.resolve()};f.prototype.setNodesLineColor=function(a,d){this._setNodesLineColor(a,d);return Promise.resolve()};f.prototype._setNodesLineColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartColor(a,d.ElementType.Lines,e)};f.prototype.unsetNodesLineColor=function(a){this._unsetNodesColor(a,d.ElementType.Lines);return Promise.resolve()};f.prototype.setNodesHighlighted=function(a,e){if(0===a.length)return Promise.resolve();
a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<a.length&&this._engine.highlightParts(a,e);return Promise.resolve()};f.prototype.getNodesHighlighted=function(a){a=this._getInstanceIncsFromLeafNodes(a);return 0<a.length?this._engine.getPartHighlighted(a):Promise.resolve([])};f.prototype.setNodesColors=function(a,e){void 0===e&&(e=!1);a=d.Internal.fromIntegerMap(a);this._setNodesColors(a,e);return Promise.resolve()};f.prototype._setNodesColors=
function(a,e){var c=this,b=new Set;a.forEach(function(g,a){a=c._modelStructure.lookupAnyTreeNode(a);null!==a&&(a=d.Internal.Tree.gatherInstanceIncsSync(a,7,!1,b,d.Internal.Tree.WalkRestriction.None),0<a.length&&(c._engine.setPartColor(a,d.ElementType.Faces,g),e&&c._engine.setPartColor(a,d.ElementType.Lines,g)))})};f.prototype.getPmiTopologyReferences=function(a){var e=[],c=function(b,c,g){var a=new d.RefOnTopoItem;a.bodyId=b;a.subElementType=c;a.subElementIndex=g;return a};a=this._modelStructure.getPmiTopologyReferences(a);
if(null!==a)for(var b=0;b<a.length;b++){for(var g=a[b],k=g.body.getRuntimeId(),l=0,f=g.faceIds;l<f.length;l++)e.push(c(k,d.PmiTopoRef.Face,f[l]));l=0;for(g=g.edgeIds;l<g.length;l++)e.push(c(k,d.PmiTopoRef.Edge,g[l]))}return 0===e.length?null:e};f.prototype.getPmis=function(){return this._modelStructure.getPmis()};f.prototype.getPMIs=function(){return this.getPmis()};f.prototype.getPmiType=function(a){return this._modelStructure.getPmiType(a)};f.prototype.getPMIType=function(a){return this.getPmiType(a)};
f.prototype.getPmiSubtype=function(a){return this._modelStructure.getPmiSubType(a)};f.prototype.getPMISubtype=function(a){return this.getPmiSubtype(a)};f.prototype.setPmiColor=function(a){this._pmiColor.assign(a)};f.prototype.setPMIColor=function(a){this.setPmiColor(a)};f.prototype.getPmiColor=function(){return this._pmiColor.copy()};f.prototype.getPMIColor=function(){return this.getPmiColor()};f.prototype.setPmiColorOverride=function(a,d){(this._pmiColorOverride=a)?this._modelStructure.setPmiColor(this._pmiColor,
d):this._modelStructure.resetPmiColor(d);return Promise.resolve()};f.prototype.setPMIColorOverride=function(a){return this.setPmiColorOverride(a)};f.prototype.getPmiColorOverride=function(){return this._pmiColorOverride};f.prototype.getPMIColorOverride=function(){return this.getPmiColorOverride()};f.prototype.computeMinimumBodyBodyDistance=function(a,e){var c=this._modelStructure.lookupAnyBody(a);if(null===c)throw new d.InvalidNodeTypeError(a,1);a=this._modelStructure.lookupAnyBody(e);if(null===a)throw new d.InvalidNodeTypeError(e,
1);e=c.getInstanceInc();c=a.getInstanceInc();return this._engine.computeMininimumBodyBodyDistance(e,c)};f.prototype.computeMinimumFaceFaceDistance=function(a,e,c,b){var g=this._modelStructure.lookupAnyBody(a);if(null===g)throw new d.InvalidNodeTypeError(a,1);a=this._modelStructure.lookupAnyBody(c);if(null===a)throw new d.InvalidNodeTypeError(c,1);c=g.getInstanceInc();g=a.getInstanceInc();return this._engine.computeMininimumFaceFaceDistance([c[0],c[1]],e,[g[0],g[1]],b)};f.prototype.computeMinimumFaceRayDistance=
function(a,e,c){var b=this._modelStructure.lookupAnyBody(a);if(null===b)throw new d.InvalidNodeTypeError(a,1);a=b.getInstanceInc();return this._engine.computeMinimumFaceRayDistance(a,e,c)};f.prototype.computeMinimumFaceLineDistance=function(a,e,c){var b=this._modelStructure.lookupAnyBody(a);if(null===b)throw new d.InvalidNodeTypeError(a,1);a=b.getInstanceInc();return this._engine.computeMinimumFaceLineDistance(a,e,c)};f.prototype.setNodeFaceColor=function(a,d,c){this._setNodeFaceColor(a,d,c);return Promise.resolve()};
f.prototype._setNodeFaceColor=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);2===a.length&&this._engine.setElementColor(a,d.ElementType.Faces,e,1,c)};f.prototype._unsetElementColor=function(a,d,c){a=this._getInstanceIncFromSingleLeafNode(a);this._engine.unsetElementColor(a,d,c,1)};f.prototype.unsetNodeFaceColor=function(a,e){this._unsetElementColor(a,d.ElementType.Faces,e);return Promise.resolve()};f.prototype.setNodeFaceHighlighted=
function(a,d,c){this._setNodeFaceHighlighted(a,d,c);return Promise.resolve()};f.prototype._setNodeFaceHighlighted=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<a.length&&this._engine.highlightElements(a,d.ElementType.Faces,e,1,c)};f.prototype._getElementHighlighted=function(a,d,c){return __awaiter(this,void 0,void 0,function(){var b,g;return __generator(this,function(k){switch(k.label){case 0:return b=this._getInstanceIncFromSingleLeafNode(a),
[4,this._engine.getElementHighlighted(b,d,c)];case 1:return g=k.sent()[0],[2,g]}})})};f.prototype.getNodeFaceHighlighted=function(a,e){return this._getElementHighlighted(a,d.ElementType.Faces,e)};f.prototype.setNodeLineColor=function(a,d,c){this._setNodeLineColor(a,d,c);return Promise.resolve()};f.prototype._setNodeLineColor=function(a,e,c){var b=this._modelStructure.lookupAnyBody(a);if(null===b)throw new d.InvalidNodeTypeError(a,1);a=b.getInstanceInc();this._engine.setElementColor(a,d.ElementType.Lines,
e,1,c)};f.prototype.unsetNodeLineColor=function(a,e){this._unsetElementColor(a,d.ElementType.Lines,e);return Promise.resolve()};f.prototype.setNodeLineHighlighted=function(a,d,c){this._setNodeLineHighlighted(a,d,c);return Promise.resolve()};f.prototype._setNodeLineHighlighted=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<a.length&&this._engine.highlightElements(a,d.ElementType.Lines,e,1,c)};f.prototype.getNodeLineHighlighted=
function(a,e){return this._getElementHighlighted(a,d.ElementType.Lines,e)};f.prototype.setNodePointHighlighted=function(a,d,c){this._setNodePointHighlighted(a,d,c);return Promise.resolve()};f.prototype._setNodePointHighlighted=function(a,e,c){var b=this._modelStructure.lookupAnyBody(a);if(null===b)throw new d.InvalidNodeTypeError(a,1);a=b.getInstanceInc();this._engine.highlightElements(a,d.ElementType.Points,e,1,c)};f.prototype.getNodePointHighlighted=function(a,e){return this._getElementHighlighted(a,
d.ElementType.Points,e)};f.prototype.resetNodesColor=function(){this._engine.resetColors();return Promise.resolve()};f.prototype.setNodesOpacity=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.setPartOpacity(a,e)};f.prototype.setNodesTransparency=function(a,d){this.setNodesOpacity(a,d);return Promise.resolve()};f.prototype.getNodesHaveTransparency=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,
7,d.Internal.Tree.WalkRestriction.None);return 0<a.length?this._engine.getPartHasTransparency(a):Promise.resolve([])};f.prototype.setNodesOpacities=function(a){var e=this;a=d.Internal.fromIntegerMap(a);var c=new Set;a.forEach(function(b,g){g=e._modelStructure.lookupAnyTreeNode(g);null!==g&&(g=d.Internal.Tree.gatherInstanceIncsSync(g,1,!1,c,d.Internal.Tree.WalkRestriction.None),0<g.length&&e._engine.setPartOpacity(g,b))})};f.prototype.setNodesTransparencies=function(a){this.setNodesOpacities(a);return Promise.resolve()};
f.prototype.resetModelOpacity=function(){this._engine.resetOpacity();this._callbackManager.trigger("_resetOpacity")};f.prototype.resetModelTransparency=function(){this.resetModelOpacity();return Promise.resolve()};f.prototype.resetModelHighlight=function(){this._engine.clearHighlight();return Promise.resolve()};f.prototype.resetNodesOpacity=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);0<a.length&&this._engine.unsetPartOpacity(a)};f.prototype.resetNodesTransparency=
function(a){this.resetNodesOpacity(a);return Promise.resolve()};f.prototype._getNodesColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);return 0<a.length?this._engine.getPartColor(a,e):Promise.resolve([])};f.prototype._getNodesEffectiveColor=function(a,e){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);return 0<a.length?this._engine.getEffectivePartColor(a,e):Promise.resolve([])};f.prototype.getNodesFaceColor=
function(a){return this._getNodesColor(a,d.ElementType.Faces)};f.prototype.getNodesEffectiveFaceColor=function(a){return this._getNodesEffectiveColor(a,d.ElementType.Faces)};f.prototype.getNodesLineColor=function(a){return this._getNodesColor(a,d.ElementType.Lines)};f.prototype.getNodesEffectiveLineColor=function(a){return this._getNodesEffectiveColor(a,d.ElementType.Lines)};f.prototype.getNodeColorMap=function(a,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){c=
this._modelStructure.lookupAnyTreeNode(a);if(null!==c)return[2,d.Internal.Tree.getNodeColorMap(c,this._engine,e)];throw new d.InvalidNodeIdError(a);})})};f.prototype.getNodesOpacity=function(a){return Promise.resolve(this._getNodesOpacity(a))};f.prototype.getNodesTransparency=function(a){return this.getNodesOpacity(a)};f.prototype._getNodesOpacity=function(a){a=this._getInstanceIncsFromLeafNodes(a);return 0<a.length?this._engine.getPartOpacity(a):[]};f.prototype.getNodesEffectiveOpacity=function(a,
d){return(a=this._getInstanceIncsFromLeafNodes(a))&&0<a.length?this._engine.getEffectivePartOpacity(a,d):Promise.resolve([])};f.prototype.getNodesEffectiveTransparency=function(a,d){return this.getNodesEffectiveOpacity(a,d)};f.prototype._getNodeElementColor=function(a,d,c){return __awaiter(this,void 0,void 0,function(){var b,g;return __generator(this,function(k){switch(k.label){case 0:return b=this._getInstanceIncFromSingleLeafNode(a),[4,this._engine.getElementColor(b,d,c)];case 1:return g=k.sent()[0],
[2,g]}})})};f.prototype._getNodeEffectiveElementColor=function(a,d,c){return __awaiter(this,void 0,void 0,function(){var b,g;return __generator(this,function(k){switch(k.label){case 0:return b=this._getInstanceIncFromSingleLeafNode(a),[4,this._engine.getEffectiveElementColor(b,d,c)];case 1:return g=k.sent()[0],[2,g]}})})};f.prototype.getNodeFaceColor=function(a,e){return this._getNodeElementColor(a,d.ElementType.Faces,e)};f.prototype.getNodeEffectiveFaceColor=function(a,e){return this._getNodeEffectiveElementColor(a,
d.ElementType.Faces,e)};f.prototype.getNodeLineColor=function(a,e){return this._getNodeElementColor(a,d.ElementType.Lines,e)};f.prototype.getNodeEffectiveLineColor=function(a,e){return this._getNodeEffectiveElementColor(a,d.ElementType.Lines,e)};f.prototype.getOutOfHierarchy=function(a){return this._modelStructure.isOutOfHierarchy(a)};f.prototype.getAbsoluteRootNode=function(){return this._modelStructure.getAbsoluteRootNodeId()};f.prototype.getRootNode=function(){return this.getAbsoluteRootNode()};
f.prototype.getNodeChildren=function(a,d){return this._modelStructure.getChildIds(a,d||!1)};f.prototype.getNodesInstancingSamePart=function(a){return this._modelStructure.getPartReferrers(a)};f.prototype.getUnitMultiplier=function(){return this._getUnitMultiplier()};f.prototype._getUnitMultiplier=function(){var a=this._firstModelRootId!==d.InvalidNodeId?this._firstModelRootId:this.getAbsoluteRootNode();return this.getNodeUnitMultiplier(a)};f.prototype.getNodeUnitMultiplier=function(a){return this._modelStructure.getUnit(a)};
f.prototype.createCadView=function(a,d,c,b,g,k,l,f,m){b||(b=[]);g||(g=[]);k||(k=[]);l||(l=[]);void 0===f&&(f=null);void 0===m&&(m=null);a=this._modelStructure.createCadView(a,d,c,b,g,k,l,f,m);null!==a&&this._callbackManager.trigger("cadViewCreated",a,d);return a};f.prototype.createCADView=function(a,d,c,b,g,k,l,f,m){return this.createCadView(a,d,c,b,g,k,l,f,m)};f.prototype.getCadViews=function(){return this._modelStructure.getCadViews()};f.prototype.getCADViews=function(){return this.getCadViews()};
f.prototype.activateCadView=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return this._modelStructure.activateCadView(a,e)};f.prototype.activateCADView=function(a,d){return this.activateCadView(a,d)};f.prototype.getCadViewPmis=function(a){return this._modelStructure.getCadViewPmis(a)};f.prototype.getCADViewPMIs=function(a){return this.getCadViewPmis(a)};f.prototype._cadConfigurationsEnabled=function(){return this._modelStructure.cadConfigurationsEnabled()};f.prototype.getCadConfigurations=
function(){return this._modelStructure.getCadConfigurations()};f.prototype.getCADConfigurations=function(){return this.getCadConfigurations()};f.prototype.getDefaultCadConfiguration=function(){return this._modelStructure.getDefaultCadConfiguration()};f.prototype.getCADDefaultConfiguration=function(){return this.getDefaultCadConfiguration()};f.prototype.getActiveCadConfiguration=function(){return this._modelStructure.getActiveCadConfiguration()};f.prototype.getCADActiveConfiguration=function(){return this.getActiveCadConfiguration()};
f.prototype.activateCadConfiguration=function(a){return this._modelStructure.activateCadConfiguration(a)};f.prototype.activateCADConfiguration=function(a){return this.activateCadConfiguration(a)};f.prototype.activateDefaultCadConfiguration=function(){return this._modelStructure.activateDefaultCadConfiguration()};f.prototype.activateCADDefaultConfiguration=function(){return this.activateDefaultCadConfiguration()};f.prototype.getEdgeCount=function(a){return this._modelStructure.getEdgeCount(a)};f.prototype.getEdgeAttributes=
function(a,d){return this._modelStructure.getEdgeAttributes(a,d)};f.prototype.getEdgeProperty=function(a,d){return this._modelStructure.getEdgeProperty(a,d)};f.prototype.getFaceCount=function(a){return this._modelStructure.getFaceCount(a)};f.prototype.getFaceAttributes=function(a,d){return this._modelStructure.getFaceAttributes(a,d)};f.prototype.getFaceProperty=function(a,d){return this._modelStructure.getFaceProperty(a,d)};f.prototype.setEdgeProperty=function(a,d,c){this._modelStructure.setEdgeProperty(a,
d,c)};f.prototype.setFaceProperty=function(a,d,c){this._modelStructure.setFaceProperty(a,d,c)};f.prototype.getNodeMeshData=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(g){switch(g.label){case 0:e=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);if(0===e.length)throw new d.CommunicatorError("Node does not refer to a mesh instance");if(2<e.length)throw new d.CommunicatorError("Node refers to multiple mesh instances");
c=e;return[4,this._engine.getInstancesMeshData(c)];case 1:return b=g.sent(),[2,this._engine.getMeshData(b)]}})})};f.prototype.getNodeMatrix=function(a){return this._modelStructure.getMatrix(a)};f.prototype.setNodeMatrix=function(a,d,c){void 0===c&&(c=!1);return this._modelStructure.setMatrix(a,d,c)};f.prototype.resetNodeMatrixToInitial=function(a){return this._modelStructure.resetToInitialMatrix(a)};f.prototype.getNodeNetMatrix=function(a){return this._modelStructure.getNetMatrix(a)};f.prototype.getNodeParent=
function(a){return this._modelStructure.getParentId(a)};f.prototype.getNodeType=function(a){return this._modelStructure.getType(a)};f.prototype.getNodeProperties=function(a){return this._modelStructure.getProperties(a)};f.prototype.addPropertyToNode=function(a,d,c){return this._modelStructure.addProperty(a,d,c)};f.prototype.setPhysicalProperties=function(a,d,c,b){return this._modelStructure.setPhysicalProperties(a,d,c,b)};f.prototype.requestNodes=function(a){return this._modelStructure.requestNodes(a)};
f.prototype.getNodeName=function(a){return this._modelStructure.getName(a)||null};f.prototype.getNodeExchangeId=function(a){return this._modelStructure.getNodeExchangeId(a)};f.prototype.getFilters=function(){return this._modelStructure.getFilters()};f.prototype.getFilterName=function(a){return this._modelStructure.getFilterName(a)};f.prototype.getFiltersWithNode=function(a){return this._modelStructure.getFiltersWithNode(a)};f.prototype.getNodesFromFiltersId=function(a){return this._modelStructure.getNodesFromFilterIds(a)};
f.prototype.getLayers=function(){return this._modelStructure.getLayers()};f.prototype.getUniqueLayerNames=function(){return this._modelStructure.getUniqueLayerNames()};f.prototype.getLayerName=function(a){return this._modelStructure.getLayerName(a)};f.prototype.getLayerIdsFromName=function(a){return this._modelStructure.getLayerIdsFromName(a)};f.prototype.getNodeLayerId=function(a){return this._modelStructure.getNodeLayerId(a)};f.prototype.getNodesFromLayer=function(a,d){return this._modelStructure.getNodesFromLayer(a,
d)};f.prototype.getNodesFromLayers=function(a,d){return this._modelStructure.getNodesFromLayers(a,d)};f.prototype.getNodesFromLayerName=function(a,d){return this._modelStructure.getNodesFromLayerName(a,d)};f.prototype.getNodeVisibility=function(a){return this._modelStructure.isVisible(a)};f.prototype.getBranchVisibility=function(a){a=this._modelStructure.getBranchVisibility(a);if(2===a)return d.BranchVisibility.Shown;if(1===a)return d.BranchVisibility.Hidden;console.assert(3===a);return d.BranchVisibility.Mixed};
f.prototype.getDataFromIds=function(a){return this._engine.getDataFromIds(a)};f.prototype.getDataFromKeys=function(a){return this.getDataFromIds(a)};f.prototype.createMesh=function(a){return this._engine.createMesh(a)};f._flatArrayToPairArray=function(a){for(var d=[],c=0;c<a.length;c+=2)d.push([a[c],a[c+1]]);return d};f._pairArrayToFlatArray=function(a){for(var d=[],c=0;c<a.length;c++){var b=a[c];d.push(b[0],b[1])}return d};f.prototype.getMeshIds=function(a){return __awaiter(this,void 0,void 0,function(){var e,
c;return __generator(this,function(b){switch(b.label){case 0:return e=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None),[4,this._engine.getInstancesMeshData(e)];case 1:return c=b.sent(),[2,f._flatArrayToPairArray(c)]}})})};f.prototype.replaceMesh=function(a,d){return this._engine.replaceMesh(a,d)};f.prototype.createMeshInstance=function(a,d,c,b){void 0===d&&(d=null);c||(c=!1);b||(b=!1);return this._createMeshInstance(a,d,c,b)};f.prototype._createMeshInstance=
function(a,e,c,b){return __awaiter(this,void 0,void 0,function(){var g,k,l,f,m,p,h,q;return __generator(this,function(n){switch(n.label){case 0:g=a.getMatrix();k=null!==g||null!==e;l=a.getCreationFlags();console.assert(!e||!b,"Out of hierarchy instances should not have a parent node.");f=null===e||this.getNodeVisibility(e);m=a;if(k||!f)m=a.copy(),m.setCreationFlags(l|d.MeshInstanceCreationFlags.Invisible);return[4,this._engine.createMeshInstance(m)];case 1:p=n.sent();h=this._modelStructure.createMeshInstance(p[0],
p[1],a.getInstanceName(),e,c,b);if(!k)return[3,3];q=g?g:new d.Matrix;return[4,this.setNodeMatrix(h,q,!0)];case 2:n.sent(),0===(l&d.MeshInstanceCreationFlags.Invisible)&&f&&this._engine.setPartVisibility(p,!0,!0),n.label=3;case 3:return null===e?[3,5]:[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",[h],d.NodeSource.CreateInstance)];case 4:n.sent(),n.label=5;case 5:return[2,h]}})})};f.prototype.createPmiInstance=function(a,e,c,b,g){return __awaiter(this,void 0,void 0,function(){var k,
l,f,m,p,h,q,u;return __generator(this,function(n){switch(n.label){case 0:void 0===g&&(g=null);k=[];l=0;for(f=b;l<f.length;l++){m=f[l];p=this._modelStructure.lookupBodyInstance(m.bodyId);if(null===p)throw new d.InvalidNodeIdError(m.bodyId);h=d.Internal.Tree.ReferenceOnTopology.fromBodyInstance(p,m.subElementType,m.subElementIndex);k.push(h)}return[4,this._engine.createMeshInstance(a)];case 1:return q=n.sent(),u=this._modelStructure.createPmiInstance(q[0],q[1],e,c,k,a.getInstanceName(),g),null===g?
[3,3]:[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",[u],d.NodeSource.CreatePmi)];case 2:n.sent(),n.label=3;case 3:return[2,u]}})})};f.prototype.createPMIInstance=function(a,d,c,b,g){return this.createPmiInstance(a,d,c,b,g)};f.prototype.createImage=function(a,d){return this._engine.createImage(a,d)};f.prototype.deleteImages=function(a){return this._engine.destroyImages(f._pairArrayToFlatArray(a))};f.prototype.setNodesTexture=function(a,d){a=this._getInstanceIncsFromLeafNodes(a);
return this._engine.setTexture(a,d)};f.prototype.unsetNodesTexture=function(a){a=this._getInstanceIncsFromLeafNodes(a);this._engine.unsetTexture(a)};f.prototype.deleteMeshes=function(a){return this._engine.destroyMeshes(f._pairArrayToFlatArray(a))};f.prototype.deleteMeshInstances=function(a){var e=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None),c=[];if(0<e.length){for(var b=0;b<a.length;b++)c.push(this._modelStructure.deleteNode(a[b]));c.push(this._engine.destroyLocalInstances(e))}return d.Util.waitForAll(c)};
f.prototype._obtainLoadSubtreeConfig=function(a){if(a[0]instanceof d.LoadSubtreeConfig)var e=a[0];else e=new d.LoadSubtreeConfig,e.additionalMatrix=a[0]||null,e.allowMissingExternalModels=!!a[1];return e.copy()};f.prototype.loadSubtreeFromXmlFile=function(a,e,c){for(var b=[],g=3;g<arguments.length;g++)b[g-3]=arguments[g];b=this._obtainLoadSubtreeConfig(b);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromXmlFile(a,e,c,b)};f.prototype.loadSubtreeFromXmlBuffer=function(a,e,c){for(var b=
[],g=3;g<arguments.length;g++)b[g-3]=arguments[g];b=this._obtainLoadSubtreeConfig(b);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromXmlDoc(a,e,c,b)};f.prototype.loadSubtreeFromScsXmlFile=function(a,e,c){for(var b=[],g=3;g<arguments.length;g++)b[g-3]=arguments[g];b=this._obtainLoadSubtreeConfig(b);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromScsXmlFile(a,e,c,b)};f.prototype.loadSubtreeFromScsXmlBuffer=function(a,e,c){for(var b=[],g=3;g<arguments.length;g++)b[g-
3]=arguments[g];b=this._obtainLoadSubtreeConfig(b);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromScsXmlDoc(a,e,c,b)};f.prototype.loadSubtreeFromModel=function(a,d){for(var c=[],b=2;b<arguments.length;b++)c[b-2]=arguments[b];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromStream(a,d,c)};f.prototype.loadSubtreeFromScsFile=function(a,d){for(var c=[],b=2;b<arguments.length;b++)c[b-2]=arguments[b];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromScsFile(a,
d,c)};f.prototype.loadSubtreeFromScsBuffer=function(a,d){for(var c=[],b=2;b<arguments.length;b++)c[b-2]=arguments[b];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromScsBuffer(a,d,c)};f.prototype.loadSubtreeFromUrl=function(a,d){return this.loadSubtreeFromXmlFile(a,d)};f.prototype.loadSubtreeFromXML=function(a,d){return this.loadSubtreeFromXmlBuffer(a,d)};f.prototype.switchToModel=function(a){this._callbackManager.trigger("modelLoadBegin");return this._modelStructure.switchToModel(a)};
f.prototype.createNode=function(a,e,c,b,g,k){void 0===a&&(a=null);void 0===c&&(c=null);void 0===b&&(b=null);if(void 0===g||null===g)g=!0;a=this._modelStructure.createNode(a,e,c,b,g,k);null!==a&&(e=this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",[a],d.NodeSource.CreateNode),e);return a};f.prototype.deleteNode=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return[4,this._modelStructure.deleteNode(a)];case 1:return d.sent(),
this._callbackManager.trigger("subtreeDeleted",[a]),[2]}})})};f.prototype.createPart=function(a){void 0===a&&(a=null);return this._modelStructure.createPart(a)};f.prototype.setPart=function(a,d){return void 0===a||null===a||void 0===d||null===d?!1:this._modelStructure.setPart(a,d)};f.prototype.createAndAddRepresentationItem=function(a,d){if(void 0===a||null===a)return null;void 0===d&&(d=null);return this._modelStructure.createAndAddRepItem(a,d)};f.prototype.createAndAddBody=function(a,d){return this.createAndAddRepresentationItem(a,
d)};f.prototype.getLowestAvailableNodeId=function(){return this._modelStructure.getLowestAvailableNodeId()};f.prototype.getLowestAvailableNodeID=function(){return this.getLowestAvailableNodeId()};f.prototype.setInstanceModifier=function(a,d,c){this._setInstanceModifier(a,d,c,7);return Promise.resolve()};f.prototype._setInstanceModifier=function(a,e,c,b){e=this._modelStructure.gatherInstanceIncsFromNodeIds(e,b,d.Internal.Tree.WalkRestriction.None);0<e.length&&this._engine.setInstanceModifier(a,e,c)};
f.prototype.getSCInstanceKey=function(a){a=this._modelStructure.lookupBodyInstance(a);return null!==a?a.getInstanceInc():null};f.prototype.getNodeIDFromSCInstanceKey=function(a,d){return this._modelStructure.getNodeFromInstanceInc(!1,a,d,!1)};f.prototype.getPrimaryModelKey=function(){return this._engine.getPrimaryModelKey()};f.prototype.getPrimaryModelId=function(){return this.getPrimaryModelKey()};f.prototype.getAssociatedModelKey=function(a){a=this._modelStructure.getAssociatedModelKey(a);return Promise.resolve(a)};
f.prototype.hasDepthRange=function(a){a=this._getInstanceIncsFromLeafNodes(a);return this._engine.hasDepthRange(a)};f.prototype.setDepthRange=function(a,d,c){this._setDepthRange(a,d,c);return Promise.resolve()};f.prototype._setDepthRange=function(a,e,c){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);this._engine.setDepthRange(a,e,c)};f.prototype.unsetDepthRange=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);
this._engine.unsetDepthRange(a)};f.prototype._gatherInstanceIncsFromNodeIds=function(a,e){void 0===e&&(e=7);return this._modelStructure.gatherInstanceIncsFromNodeIds(a,e,d.Internal.Tree.WalkRestriction.None)};f.prototype._getInstanceIncsFromLeafNodes=function(a){for(var e=[],c=0;c<a.length;c++){var b=this._modelStructure.gatherInstanceIncsFromNodeIds([a[c]],7,d.Internal.Tree.WalkRestriction.None);if(2===b.length)e.push(b[0],b[1]);else throw new d.CommunicatorError("Non-leaf node encountered");}return e};
f.prototype._getInstanceIncFromSingleLeafNode=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds([a],7,d.Internal.Tree.WalkRestriction.None);if(2===a.length)return a;throw new d.CommunicatorError("Non-leaf node encountered");};f.prototype.setMeshLevel=function(a,d){this._modelStructure.setMeshLevel(a,d);return Promise.resolve()};f.prototype.setEnableAutomaticUnitScaling=function(a){return this._modelStructure.setEnableAutomaticUnitScaling(a)};f.prototype.setBehaviorInitiallyHidden=function(a){return this._modelStructure.setBehaviorInitiallyHidden(a)};
f.prototype.isDrawing=function(){return this._modelStructure.isACadDrawing()};f.prototype.isMeasurable=function(){return this._modelStructure.isMeasurable()};f.prototype.getModelFileNameFromNode=function(a){return this._modelStructure.getModelFileNameFromNode(a)};f.prototype.getModelFileTypeFromNode=function(a){return this._modelStructure.getModelFileTypeFromNode(a)};f.prototype.getNodeGenericType=function(a){return this._modelStructure.getNodeGenericType(a)};f.prototype.getNodeGenericId=function(a){return this._modelStructure.getNodeGenericId(a)};
f.prototype.registerBimNodes=function(a,e,c){void 0===c&&(c=null);return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(g){b=this._modelStructure.lookupAnyTreeNode(a);if(null===b)return[2];"boolean"===typeof c&&(c=c?"TYPE":null);return[2,d.Internal.Tree.registerBimNodes(e,this._engine,this._modelStructure,b,c)]})})};f.prototype.getGenericTypeIdMap=function(){return this._modelStructure.getGenericTypeIdMap()};f.prototype.getIfcNodeIds=function(){return this.getGenericTypeIdMap()};
f.prototype.getIfcTypeByNodeId=function(a){return this._modelStructure.getNodeGenericType(a)};f.prototype.getNodesByGenericType=function(a){return this._modelStructure.getNodesByGenericType(a)};f.prototype.getNodesByIfcType=function(a){return this.getNodesByGenericType(a)};f.prototype.getGenericTypes=function(){return this._modelStructure.getGenericTypes()};f.prototype.getIfcTypes=function(){return this.getGenericTypes()};f.prototype._hasEffectiveGenericType=function(a,d){return this._modelStructure.hasEffectiveGenericType(a,
d)};f.prototype.registerIfcNodes=function(a,e){void 0===e&&(e=null);return this.registerBimNodes(a,d.Internal.Tree.ifcAttributeToBimMask,e)};f.prototype.isAnnotationView=function(a){return this._modelStructure.isAnnotationView(a)};f.prototype.setNodesCullingVector=function(a,d,c,b){this._setNodesCullingVector(a,d,c,b);return Promise.resolve()};f.prototype._setNodesCullingVector=function(a,e,c,b){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);return this._engine.setCullingVector(a,
e,c,b)};f.prototype.unsetNodesCullingVectors=function(a){this._unsetNodesCullingVectors(a);return Promise.resolve()};f.prototype._unsetNodesCullingVectors=function(a){a=this._modelStructure.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);this._engine.unsetCullingVector(a)};f.prototype.getNodesCullingVectors=function(a){a=this._getInstanceIncsFromLeafNodes(a);return this._engine.getCullingVector(a)};f.prototype.getNodeIdOffset=function(a){return this._modelStructure.getIdOffset(a)};
f.prototype.isNodeLoaded=function(a){return this._modelStructure.isNodeLoaded(a)};f.prototype.triangulatePolygon=function(a,e){e=d.Internal.toVec3(e);return this._engine.triangulatePolygon(a,e)};f.prototype.setNodesLinePattern=function(a,d,c,b){a=this._gatherInstanceIncsFromNodeIds(a);this._engine.setLinePattern(a,d,c,b)};f.prototype.unsetNodesLinePattern=function(a){a=this._gatherInstanceIncsFromNodeIds(a);this._engine.unsetLinePattern(a)};f.prototype._hwfAwaitAssemblyTreeReady=function(){return __awaiter(this,
void 0,void 0,function(){var a,e,c;return __generator(this,function(b){switch(b.label){case 0:a=this.getAbsoluteRootNode();e=this._modelStructure.lookupAnyTreeNode(a);if(null===e)throw new d.InternalLogicError;c=d.Internal.Tree.towardLoadContext(e);return[4,d.Internal.Tree.WalkerAsync.forceLazyPromises(c)];case 1:return b.sent(),[4,d.Internal.Tree.markContextsLoaded([c])];case 2:return b.sent(),[2]}})})};f.prototype.getNodeUserDataIndices=function(a){return this._modelStructure.getUserDataIndices(a)};
f.prototype.getNodeUserData=function(a,d){return this._modelStructure.getUserData(a,d)};f.prototype.getNodeIdsByGenericIds=function(a){for(var d=[],c=0;c<a.length;c++){var b=this._modelStructure.getNodeByGenericId(a[c]);null!==b&&d.push(b)}return d};f.prototype.getNodeIdsByIfcGuids=function(a){return this.getNodeIdsByGenericIds(a)};f.prototype._isReady=function(){return this._modelStructure.isReady()};f.prototype._getModelStructure=function(){return this._modelStructure};f.prototype._isWithinExternalModel=
function(a){return this._modelStructure.isWithinExternalModel(a)};f.prototype._firstAssemblyDataHeader=function(){return this._modelStructure.firstAssemblyDataHeader()};__decorate([f.deprecated],f.prototype,"getPMIs",null);__decorate([f.deprecated],f.prototype,"getPMIType",null);__decorate([f.deprecated],f.prototype,"getPMISubtype",null);__decorate([f.deprecated],f.prototype,"setPMIColor",null);__decorate([f.deprecated],f.prototype,"getPMIColor",null);__decorate([f.deprecated],f.prototype,"setPMIColorOverride",
null);__decorate([f.deprecated],f.prototype,"getPMIColorOverride",null);__decorate([f.deprecated],f.prototype,"setNodesTransparency",null);__decorate([f.deprecated],f.prototype,"setNodesTransparencies",null);__decorate([f.deprecated],f.prototype,"resetModelTransparency",null);__decorate([f.deprecated],f.prototype,"resetNodesTransparency",null);__decorate([f.deprecated],f.prototype,"getNodesTransparency",null);__decorate([f.deprecated],f.prototype,"getNodesEffectiveTransparency",null);__decorate([f.deprecated],
f.prototype,"getRootNode",null);__decorate([f.deprecated],f.prototype,"getUnitMultiplier",null);__decorate([f.deprecated],f.prototype,"createCADView",null);__decorate([f.deprecated],f.prototype,"getCADViews",null);__decorate([f.deprecated],f.prototype,"activateCADView",null);__decorate([f.deprecated],f.prototype,"getCADViewPMIs",null);__decorate([f.deprecated],f.prototype,"getCADConfigurations",null);__decorate([f.deprecated],f.prototype,"getCADDefaultConfiguration",null);__decorate([f.deprecated],
f.prototype,"getCADActiveConfiguration",null);__decorate([f.deprecated],f.prototype,"activateCADConfiguration",null);__decorate([f.deprecated],f.prototype,"activateCADDefaultConfiguration",null);__decorate([f.deprecated],f.prototype,"getDataFromKeys",null);__decorate([f.deprecated],f.prototype,"createPMIInstance",null);__decorate([f.deprecated],f.prototype,"loadSubtreeFromUrl",null);__decorate([f.deprecated],f.prototype,"loadSubtreeFromXML",null);__decorate([f.deprecated],f.prototype,"createAndAddBody",
null);__decorate([f.deprecated],f.prototype,"getLowestAvailableNodeID",null);__decorate([f.deprecated],f.prototype,"getSCInstanceKey",null);__decorate([f.deprecated],f.prototype,"getNodeIDFromSCInstanceKey",null);__decorate([f.deprecated],f.prototype,"getPrimaryModelKey",null);__decorate([f.deprecated],f.prototype,"getPrimaryModelId",null);__decorate([f.deprecated],f.prototype,"getIfcNodeIds",null);__decorate([f.deprecated],f.prototype,"getIfcTypeByNodeId",null);__decorate([f.deprecated],f.prototype,
"getNodesByIfcType",null);__decorate([f.deprecated],f.prototype,"getIfcTypes",null);__decorate([f.deprecated],f.prototype,"getNodeIdsByIfcGuids",null);return f}();d.Model=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(a){var e=this;this._position=new d.Point2(0,0);this._viewportSize=new d.Point2(200,200);this._anchor=d.OverlayAnchor.UpperRightCorner;this._dimension=3;this._fieldSize=8;this._instanceKeys=[];this._enabled=!1;this._textImageId=null;this._selectionFaceColor=new d.Color(76,186,240);this._outlineColor=new d.Color(17,94,133);this._lastSelectedNodes=[];this._nodeIds=[];this._adjacentFaces=[];this._cameraRotation=0;this._lastFaceIndex=this._lastCamera=this._lastOrientation=
null;this._textWidths=[];this._sceneReadyCompleted=d.Util.OpenPromise.create();this._firstAttachment=this._geometryCreated=this._texturesReady=!1;this._viewer=a;this._fontSize=25;this._fontInfo=this._fontSize+"px Arial";this._textureSize=512;this._viewer.setCallbacks({sceneReady:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._createViewport()];case 1:return c.sent(),this._updateVisibility(),[4,this._createGeometry()];
case 2:return c.sent(),this._sceneReadyCompleted.resolve(),[2]}})})},_assemblyTreeReady:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._sceneReadyCompleted];case 1:return c.sent(),[2,this._setTextures()]}})})},_firstAttachment:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._firstAttachment=!0,[4,this._onCameraUpdate()];case 1:return c.sent(),
this._updateVisibility(),[2]}})})},modelSwitchStart:function(){e._firstAttachment=!1},camera:function(){e._onCameraUpdate()},transitionEnd:function(){e._onCameraUpdate()},viewAxes:function(){e._updateOrientationMatrices()},_resetOpacity:function(){e._viewer.model.setNodesOpacity(e._nodeIds.slice(1),0)},viewOrientation:function(c){e._lastOrientation=c;e._cameraRotation=0;e._lastCamera=e._viewer.view.getCamera()}})}f.prototype.setAnchor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(d){switch(d.label){case 0:return this._anchor=a,[4,this._sceneReadyCompleted];case 1:return d.sent(),[2,this._updateViewport()]}})})};f.prototype.getAnchor=function(){return this._anchor};f.prototype.enable=function(){this._enabled=!0;this._updateVisibility();return Promise.resolve()};f.prototype.disable=function(){this._enabled=!1;this._updateVisibility();return Promise.resolve()};f.prototype._updateVisibility=function(){this._enabled&&this._texturesReady&&this._firstAttachment?this._showOverlay():
this._hideOverlay()};f.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.NavCube,!1)};f.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.NavCube,!0)};f.prototype.getEnabled=function(){return this._enabled};f.prototype.getOverlayId=function(){return d.BuiltinOverlayIndex.NavCube};f.prototype._setTextures=function(){return __awaiter(this,void 0,void 0,function(){var a,d,c,b,g;return __generator(this,function(k){switch(k.label){case 0:if(!this._textImageId||
0<this._nodeIds.length||0>=this._instanceKeys.length)return[2];a=this._viewer.model;d=0;for(c=this._instanceKeys;d<c.length;d++)b=c[d],g=a._getNodeFromInstanceInc(!0,0,b,!0),this._nodeIds.push(g),a._preventNodeDeletion(g);a.setNodesOpacity(this._nodeIds.slice(1),0);return[4,a.setNodesTexture([this._nodeIds[0]],{imageId:this._textImageId})];case 1:return k.sent(),this._texturesReady=!0,this._updateVisibility(),[2]}})})};f.prototype._updateViewport=function(){this._viewer.overlayManager.setViewport(d.BuiltinOverlayIndex.NavCube,
this._anchor,this._position.x,d.OverlayUnit.Pixels,this._position.y,d.OverlayUnit.Pixels,this._viewportSize.x,d.OverlayUnit.Pixels,this._viewportSize.y,d.OverlayUnit.Pixels)};f.prototype._createViewport=function(){var a=this._viewer.overlayManager;this._updateViewport();var e=new d.Camera;e.setPosition(new d.Point3(0,0,10));e.setTarget(d.Point3.zero());e.setUp(new d.Point3(0,1,0));e.setWidth(this._fieldSize);e.setHeight(this._fieldSize);e.setProjection(d.Projection.Orthographic);a.setCamera(d.BuiltinOverlayIndex.NavCube,
e)};f.prototype._createGeometry=function(){return __awaiter(this,void 0,void 0,function(){var a,e,c,b,g,k,l,f,m,p,h,q,u,t,v,w,z,y,x,A,B,D,C,E,F,G,I,J,K,H,L,M,N;return __generator(this,function(n){switch(n.label){case 0:if(this._geometryCreated)return[2];a=this._initializeTextures();e=0;c=[];c.push(this._createCube(e++,this._dimension));b=[];b.push(this._makeRotationMatrixX(-.5*Math.PI));b.push(this._makeRotationMatrixX(.5*Math.PI));b.push(this._makeRotationMatrixY(.5*Math.PI));b.push(this._makeRotationMatrixY(-.5*
Math.PI));b.push(this._makeRotationMatrixZ(.5*Math.PI));b.push(this._makeRotationMatrixZ(-.5*Math.PI));g=this._dimension/4;k=this._dimension/2;l=[];f=new d.Point3(0,0,0);m=new d.Point3(0,0,0);p=new d.Point3(0,0,0);for(h=0;h<b.length;h++)q=this._dimension,u=b[h],t=!1,h===b.length-1&&(t=!0,f.z+=this._dimension+.02),m=new d.Point3(.5*q-g,-.5*q+g,-.5*q+-.01),p=new d.Point3(m.x+g,m.y-g,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,f,l)),m=new d.Point3(-.5*q,-.5*q+g,-.5*q+-.01),p=new d.Point3(m.x+g,
m.y-g,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,f,l)),m=new d.Point3(-.5*q,.5*q,-.5*q+-.01),p=new d.Point3(m.x+g,m.y-g,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,f,l)),m=new d.Point3(.5*q-g,.5*q,-.5*q+-.01),p=new d.Point3(m.x+g,m.y-g,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,f,l)),m=new d.Point3(-.5*q+g,.5*q,-.5*q+-.01),p=new d.Point3(m.x+k,m.y-g,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,f,l)),m=new d.Point3(-.5*q+g,-.5*q+g,-.5*q+-.01),p=new d.Point3(m.x+k,m.y-g,m.z),
c.push(this._createSelectionFace(e++,m,p,u,t,f,l)),m=new d.Point3(-.5*q,.5*q-g,-.5*q+-.01),p=new d.Point3(m.x+g,m.y-k,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,f,l)),m=new d.Point3(.5*q-g,.5*q-g,-.5*q+-.01),p=new d.Point3(m.x+g,m.y-k,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,f,l)),m=new d.Point3(-.5*q+g,.5*q-g,-.5*q+-.01),p=new d.Point3(m.x+k,m.y-k,m.z),c.push(this._createSelectionFace(e++,m,p,u,t,f,l));for(v=0;v<l.length;v++){w=Math.floor(v/9);z=[];y=l[v];for(x=0;x<y.length;x+=2)for(A=
y[x],B=y[x+1],D=0;D<l.length;D++)if(C=Math.floor(D/9),C!==w)for(E=l[D],F=0;F<E.length;F+=2)G=E[F],I=E[F+1],this._isSameEdge(A,B,G,I)&&z.push(D);this._adjacentFaces.push(z)}return[4,Promise.all(c)];case 1:J=n.sent();this._updateOrientationMatrices();this._onCameraUpdate();K=[];H=0;for(L=J;H<L.length;H++)M=L[H],K.push(0,M);N=this._getScEngine();N.setPartVisibility(K,!0,!0);this._geometryCreated=!0;return[2,a]}})})};f.prototype._createTexture=function(a,e){a=a.getImageData(0,0,e,e).data;e=new ArrayBuffer(e*
e*3);e=new Uint8Array(e);for(var c=0,b=0;b<a.length;b+=4)e[c]=a[b],e[c+1]=a[b],e[c+2]=a[b],c+=3;return this._viewer.model.createImage({format:d.ImageFormat.Rgb24,data:e,width:this._textureSize,height:this._textureSize})};f.prototype._geometryHasBeenCreated=function(){return this._geometryCreated};f.prototype._insideOverlay=function(a){var d=this._getOverlayOffset();return a.x>=d.x&&a.y>=d.y&&a.x<=d.x+this._viewportSize.x&&a.y<=d.y+this._viewportSize.y};f.prototype._getOverlayOffset=function(){return this._viewer.overlayManager._getOverlayOffset(this._anchor,
this._viewportSize)};f.prototype._getViewportSize=function(){return this._viewportSize};f.prototype._onNoSelection=function(){this._enabled&&0<this._lastSelectedNodes.length&&(this._viewer.model.setNodesOpacity(this._lastSelectedNodes,0),this._lastSelectedNodes.length=0)};f.prototype._onClickSelection=function(a){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(c){switch(c.label){case 0:console.assert(this._enabled);if(null===a||!a.isFaceSelection()||a.overlayIndex()!==
d.BuiltinOverlayIndex.NavCube)return this._onNoSelection(),[2];e=this._getFaceIndexFromNodeId(a.getNodeId());return e<this._nodeIds.length&&0<e?[4,this._setViewOrientation(e)]:[3,2];case 1:c.sent(),c.label=2;case 2:return[2]}})})};f.prototype._onMoveSelection=function(a){console.assert(this._enabled);if(null!==a&&a.isFaceSelection()&&a.overlayIndex()===d.BuiltinOverlayIndex.NavCube){var e=a.getNodeId(),c=this._getFaceIndexFromNodeId(e)-1;if(0<=c&&e!==this._nodeIds[0]){a=this._viewer.model;a.setNodesOpacity(this._lastSelectedNodes,
0);this._lastSelectedNodes.length=0;this._lastSelectedNodes.push(e);console.assert(c<this._adjacentFaces.length);e=0;for(c=this._adjacentFaces[c];e<c.length;e++){var b=this._getNodeIdFromFaceIndex(c[e]+1);this._lastSelectedNodes.push(b)}a.setNodesOpacity(this._lastSelectedNodes,1)}}else this._onNoSelection()};f.prototype._getViewOrientationFromFaceIndex=function(a){switch(a){case 1:a=d.ViewOrientation.LeftBottomBack;break;case 2:a=d.ViewOrientation.LeftBottomFront;break;case 3:a=d.ViewOrientation.LeftTopFront;
break;case 4:a=d.ViewOrientation.LeftTopBack;break;case 5:a=d.ViewOrientation.LeftTop;break;case 6:a=d.ViewOrientation.LeftBottom;break;case 7:a=d.ViewOrientation.LeftFront;break;case 8:a=d.ViewOrientation.LeftBack;break;case 9:a=d.ViewOrientation.Left;break;case 10:a=d.ViewOrientation.RightTopBack;break;case 11:a=d.ViewOrientation.RightTopFront;break;case 12:a=d.ViewOrientation.RightBottomFront;break;case 13:a=d.ViewOrientation.RightBottomBack;break;case 14:a=d.ViewOrientation.RightBottom;break;
case 15:a=d.ViewOrientation.RightTop;break;case 16:a=d.ViewOrientation.RightFront;break;case 17:a=d.ViewOrientation.RightBack;break;case 18:a=d.ViewOrientation.Right;break;case 19:a=d.ViewOrientation.BackTopRight;break;case 20:a=d.ViewOrientation.BackBottomRight;break;case 21:a=d.ViewOrientation.BackBottomLeft;break;case 22:a=d.ViewOrientation.BackTopLeft;break;case 23:a=d.ViewOrientation.BackLeft;break;case 24:a=d.ViewOrientation.BackRight;break;case 25:a=d.ViewOrientation.BackBottom;break;case 26:a=
d.ViewOrientation.BackTop;break;case 27:a=d.ViewOrientation.Back;break;case 28:a=d.ViewOrientation.FrontBottomRight;break;case 29:a=d.ViewOrientation.FrontTopRight;break;case 30:a=d.ViewOrientation.FrontTopLeft;break;case 31:a=d.ViewOrientation.FrontBottomLeft;break;case 32:a=d.ViewOrientation.FrontLeft;break;case 33:a=d.ViewOrientation.FrontRight;break;case 34:a=d.ViewOrientation.FrontTop;break;case 35:a=d.ViewOrientation.FrontBottom;break;case 36:a=d.ViewOrientation.Front;break;case 37:a=d.ViewOrientation.BottomRightFront;
break;case 38:a=d.ViewOrientation.BottomLeftFront;break;case 39:a=d.ViewOrientation.BottomLeftBack;break;case 40:a=d.ViewOrientation.BottomRightBack;break;case 41:a=d.ViewOrientation.BottomBack;break;case 42:a=d.ViewOrientation.BottomFront;break;case 43:a=d.ViewOrientation.BottomLeft;break;case 44:a=d.ViewOrientation.BottomRight;break;case 45:a=d.ViewOrientation.Bottom;break;case 46:a=d.ViewOrientation.TopLeftBack;break;case 47:a=d.ViewOrientation.TopRightBack;break;case 48:a=d.ViewOrientation.TopRightFront;
break;case 49:a=d.ViewOrientation.TopLeftFront;break;case 50:a=d.ViewOrientation.TopFront;break;case 51:a=d.ViewOrientation.TopBack;break;case 52:a=d.ViewOrientation.TopRight;break;case 53:a=d.ViewOrientation.TopLeft;break;case 54:a=d.ViewOrientation.Top;break;default:a=d.ViewOrientation.Front}return a};f.prototype._setViewOrientation=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,g,k,l,f,m,p,h,q,u,t,v;return __generator(this,function(n){switch(n.label){case 0:return e=this._viewer.view,
c=this._getViewOrientationFromFaceIndex(a),[4,e.getViewOrientationCamera(c)];case 1:b=n.sent();g=!1;console.assert(0<=a-1);console.assert(a-1<this._adjacentFaces.length);k=this._adjacentFaces[a-1];l=0;for(f=k;l<f.length;l++)if(m=f[l],p=m+1,p===this._lastFaceIndex){g=!0;break}this._lastFaceIndex=a;h=null!==this._lastCamera&&this._lastCamera.equals(e.getCamera());this._cameraRotation=(q=this._lastOrientation===c||g)&&h?(this._cameraRotation+90)%360:0;this._lastOrientation=c;0<this._cameraRotation&&
(u=d.Point3.subtract(b.getPosition(),b.getTarget()).normalize(),t=d.Matrix.createFromOffAxisRotation(u,this._cameraRotation),v=b.getUp(),t.transform(v,v),b.setUp(v));return[4,e.fitWorld(d.DefaultTransitionDuration,b)];case 2:return n.sent(),this._lastCamera=e.getCamera(),[2]}})})};f.prototype._getScEngine=function(){return this._viewer._getScEngine()};f.prototype._createInstance=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,g,k,l;return __generator(this,function(f){switch(f.label){case 0:return[4,
this._viewer.model.createMesh(a)];case 1:return c=f.sent(),b=new d.MeshInstanceData(c),b.setCreationFlags(d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.DoNotLight|d.MeshInstanceCreationFlags.Invisible),b.setOverlayIndex(d.BuiltinOverlayIndex.NavCube),g=this._getScEngine(),[4,g.createMeshInstance(b)];case 2:return k=f.sent(),l=k[1],this._instanceKeys[e]=l,[2,l]}})})};f.prototype._createCube=function(a,
e){for(var c=[],b=[],g=[],k=[],l=this._textWidths[0],f=0,m=this._textWidths;f<m.length;f++){var p=m[f];p>l&&(l=p)}l+=10;c.push(new d.Point3(.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));b.push(new d.Point3(0,1,0));b.push(new d.Point3(0,1,0));b.push(new d.Point3(0,1,0));b.push(new d.Point3(0,1,0));b.push(new d.Point3(0,1,0));b.push(new d.Point3(0,
1,0));f=22/this._textureSize;m=82/this._textureSize;f=1-f;m=1-m;var h=(l-this._textWidths[0])/2;p=-(h/this._textureSize);h=(this._textWidths[0]+h)/this._textureSize;g.push(new d.Point2(p,f));g.push(new d.Point2(h,m));g.push(new d.Point2(h,f));g.push(new d.Point2(p,m));g.push(new d.Point2(h,m));g.push(new d.Point2(p,f));k.push(new d.Point3(-.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,.5*e));k.push(new d.Point3(.5*e,.5*
e,.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));b.push(new d.Point3(0,-1,0));b.push(new d.Point3(0,-1,0));b.push(new d.Point3(0,-1,0));b.push(new d.Point3(0,-1,0));b.push(new d.Point3(0,-1,0));
b.push(new d.Point3(0,-1,0));f-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[1])/2;p=-(h/this._textureSize);h=(this._textWidths[1]+h)/this._textureSize;g.push(new d.Point2(p,f));g.push(new d.Point2(p,m));g.push(new d.Point2(h,f));g.push(new d.Point2(h,f));g.push(new d.Point2(p,m));g.push(new d.Point2(h,m));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,-.5*e,.5*e));k.push(new d.Point3(.5*
e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,.5*e));b.push(new d.Point3(-1,0,0));b.push(new d.Point3(-1,0,0));b.push(new d.Point3(-1,0,0));b.push(new d.Point3(-1,0,0));b.push(new d.Point3(-1,
0,0));b.push(new d.Point3(-1,0,0));f-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[2])/2;p=-(h/this._textureSize);h=(this._textWidths[2]+h)/this._textureSize;g.push(new d.Point2(p,f));g.push(new d.Point2(p,m));g.push(new d.Point2(h,m));g.push(new d.Point2(p,f));g.push(new d.Point2(h,m));g.push(new d.Point2(h,f));k.push(new d.Point3(-.5*e,.5*e,-.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*
e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));k.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));b.push(new d.Point3(1,0,0));b.push(new d.Point3(1,0,0));b.push(new d.Point3(1,0,0));b.push(new d.Point3(1,0,0));b.push(new d.Point3(1,0,0));
b.push(new d.Point3(1,0,0));f-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[3])/2;p=-(h/this._textureSize);h=(this._textWidths[3]+h)/this._textureSize;g.push(new d.Point2(h,f));g.push(new d.Point2(p,m));g.push(new d.Point2(h,m));g.push(new d.Point2(h,f));g.push(new d.Point2(p,f));g.push(new d.Point2(p,m));k.push(new d.Point3(.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,.5*e));k.push(new d.Point3(.5*e,.5*e,.5*e));k.push(new d.Point3(.5*e,-.5*e,.5*e));k.push(new d.Point3(.5*
e,-.5*e,.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));b.push(new d.Point3(0,0,-1));b.push(new d.Point3(0,0,-1));b.push(new d.Point3(0,0,-1));b.push(new d.Point3(0,0,-1));b.push(new d.Point3(0,
0,-1));b.push(new d.Point3(0,0,-1));f-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[4])/2;p=-(h/this._textureSize);h=(this._textWidths[4]+h)/this._textureSize;g.push(new d.Point2(p,m));g.push(new d.Point2(h,m));g.push(new d.Point2(h,f));g.push(new d.Point2(p,f));g.push(new d.Point2(p,m));g.push(new d.Point2(h,f));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(.5*
e,-.5*e,.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));b.push(new d.Point3(0,0,1));f-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[5])/2;p=-(h/this._textureSize);h=(this._textWidths[5]+h)/this._textureSize;g.push(new d.Point2(p,f));g.push(new d.Point2(p,m));g.push(new d.Point2(h,m));g.push(new d.Point2(p,f));g.push(new d.Point2(h,m));g.push(new d.Point2(h,
f));e=new d.MeshData;e.setFaceWinding(d.FaceWinding.CounterClockwise);l=[];m=[];p=[];for(f=h=0;f<c.length;f++){var q=c[f];l.push(q.x);l.push(q.y);l.push(q.z);q=b[f];m.push(q.x);m.push(q.y);m.push(q.z);q=g[f];p.push(q.x);p.push(q.y);if(18<=l.length){q=[[0,255,0,255],[0,255,0,255],[255,0,0,255],[255,0,0,255],[0,0,255,255],[0,0,255,255]][h];for(var u=[],t=0;6>t;t++)u.push(q[0]),u.push(q[1]),u.push(q[2]),u.push(q[3]);e.addFaces(l,m,new Uint8Array(u),p);l=[];m=[];p=[];++h}}l=[];c=new Uint8Array(4*k.length);
for(f=0;f<k.length;f++)b=k[f],l.push(b.x),l.push(b.y),l.push(b.z),b=4*f,c[b]=this._outlineColor.r,c[b+1]=this._outlineColor.g,c[b+2]=this._outlineColor.b,c[b+3]=255;e.addPolyline(l,c);return this._createInstance(e,a)};f.prototype._onCameraUpdate=function(){var a=new d.Camera,e=this._viewer.view.getCamera();a.setPosition(e.getPosition().subtract(e.getTarget()).normalize());a.setTarget(d.Point3.zero());a.setUp(e.getUp());a.setProjection(d.Projection.Orthographic);a.setWidth(this._fieldSize);a.setHeight(this._fieldSize);
this._viewer.overlayManager.setCamera(d.BuiltinOverlayIndex.NavCube,a)};f.prototype._updateOrientationMatrices=function(){var a=this._viewer.model.getViewAxes(),e=a.upVector.copy(),c=a.frontVector.copy(),b=d.Point3.cross(e,c.copy().scale(-1));a=new d.Matrix;a.m[0]=-c.x;a.m[1]=-c.y;a.m[2]=-c.z;a.m[4]=b.x;a.m[5]=b.y;a.m[6]=b.z;a.m[8]=e.x;a.m[9]=e.y;a.m[10]=e.z;e=this._getScEngine();c=[];b=0;for(var g=this._instanceKeys;b<g.length;b++)c.push(0,g[b]);e.setInstancesMatrix(c,a)};f.prototype._createSelectionFace=
function(a,e,c,b,g,k,l){var f=new d.MeshData;f.setFaceWinding(d.FaceWinding.CounterClockwise);var m=[];this._createQuad(e,c,m,b,k,g);e=[];c=[];b=[];for(k=0;k<m.length;k++){var p=m[k];e.push(p.x);e.push(p.y);e.push(p.z);c.push(0);c.push(0);c.push(-1);b.push(this._selectionFaceColor.r);b.push(this._selectionFaceColor.g);b.push(this._selectionFaceColor.b);b.push(128)}k=[];p=[this._outlineColor.r,this._outlineColor.g,this._outlineColor.b,255,this._outlineColor.r,this._outlineColor.g,this._outlineColor.b,
255];f.addFaces(e,c,new Uint8Array(b));e=[];g?(e.push(m[4].x,m[4].y,m[4].z),e.push(m[5].x,m[5].y,m[5].z)):(e.push(m[0].x,m[0].y,m[0].z),e.push(m[1].x,m[1].y,m[1].z));f.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));e=[];e.push(m[1].x,m[1].y,m[1].z);e.push(m[2].x,m[2].y,m[2].z);f.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));e=[];e.push(m[3].x,m[3].y,m[3].z);e.push(m[4].x,m[4].y,m[4].z);f.addPolyline(e,
new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));e=[];g?(e.push(m[3].x,m[3].y,m[3].z),e.push(m[2].x,m[2].y,m[2].z)):(e.push(m[5].x,m[5].y,m[5].z),e.push(m[3].x,m[3].y,m[3].z));f.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));l.push(k);return this._createInstance(f,a)};f.prototype._createQuad=function(a,e,c,b,g,k){void 0===k&&(k=!1);a=new d.Point3(a.x,a.y,a.z);e=new d.Point3(e.x,e.y,e.z);g&&(a.x+=g.x,a.y+=g.y,a.z+=
g.z,e.x+=g.x,e.y+=g.y,e.z+=g.z);g=c.length;var l=new d.Point3(e.x,e.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(a.x,e.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(a.x,a.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(e.x,a.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(e.x,e.y,a.z);l=b.transform(l);c.push(l);l=new d.Point3(a.x,a.y,a.z);l=b.transform(l);c.push(l);if(k)for(b=0;3>b;b++)k=g+b,a=c[g+b],a=new d.Point3(a.x,a.y,a.z),e=g+(6-b-1),c[k].x=c[e].x,c[k].y=c[e].y,c[k].z=c[e].z,c[e].x=
a.x,c[e].y=a.y,c[e].z=a.z};f.prototype._makeRotationMatrixX=function(a){var e=Math.cos(a);a=Math.sin(a);var c=new d.Matrix;c.m[5]=e;c.m[6]=-a;c.m[9]=a;c.m[10]=e;return c};f.prototype._makeRotationMatrixY=function(a){var e=Math.cos(a);a=Math.sin(a);var c=new d.Matrix;c.m[0]=e;c.m[2]=a;c.m[8]=-a;c.m[10]=e;return c};f.prototype._makeRotationMatrixZ=function(a){var e=Math.cos(a);a=Math.sin(a);var c=new d.Matrix;c.m[0]=e;c.m[1]=-a;c.m[4]=a;c.m[5]=e;return c};f.prototype._getFaceIndexFromNodeId=function(a){for(var d=
0;d<this._nodeIds.length;d++)if(this._nodeIds[d]===a)return d;return-1};f.prototype._getNodeIdFromFaceIndex=function(a){return this._nodeIds[a]};f.prototype._isSameEdge=function(a,e,c,b){var g=d.Point3.subtract(a,c).squaredLength()+d.Point3.subtract(e,b).squaredLength();a=d.Point3.subtract(e,c).squaredLength()+d.Point3.subtract(a,b).squaredLength();return.03>Math.min(g,a)};f.prototype._initializeTextures=function(){return __awaiter(this,void 0,void 0,function(){var a,d,c,b,g,k,l;return __generator(this,
function(e){switch(e.label){case 0:a=document.createElement("canvas");a.width=this._textureSize;a.height=this._textureSize;d=a.getContext("2d");c=2*(this._fontSize+5);d.beginPath();d.rect(0,0,this._textureSize,this._textureSize);d.fillStyle="gray";d.fill();d.fillStyle="black";d.font=this._fontInfo;for(b=0;b<f._faceTexts.length;b++)g=f._faceTexts[b],d.fillText(g,0,c*(b+1)),k=d.measureText(g),this._textWidths.push(k.width);return[4,this._createTexture(d,this._textureSize)];case 1:return this._textImageId=
l=e.sent(),[2]}})})};f._faceTexts="LEFT RIGHT FRONT BACK BOTTOM TOP".split(" ");return f}();d.NavCube=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(a){var e=this;this._operatorStack=[];this._operators=new Map;this._customOperatorIdCount=0;this._customOperatorIdIndex=1E4;this._viewer=a;this._viewer.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(e,void 0,void 0,function(){var c,b=this;return __generator(this,function(g){c=[];this._operators.forEach(function(g,a){g=b._deactivateOperator(a);void 0!==g&&c.push(g);g=b._activateOperator(a);void 0!==g&&c.push(g)});return[2,d.Util.waitForAll(c)]})})}})}
f.prototype._shutdown=function(){for(;void 0!==this.pop(););};f.prototype._registerOperator=function(a,d){this._operators.set(a,d)};f.prototype.registerCustomOperator=function(a){var d=this._customOperatorIdIndex+this._customOperatorIdCount++;this._operators.set(d,a);return d};f.prototype.unregisterCustomOperator=function(a){a>=this._customOperatorIdIndex&&this._operators.delete(a)};f.prototype.replaceOperator=function(a,d){d=this.getOperator(d);return null!==d?(this._operators.set(a,d),!0):!1};f.prototype.indexOf=
function(a){for(var d=this.size()-1;0<=d;d--)if(this._operatorStack[d]===a)return d;return-1};f.prototype.push=function(a){return this._isValid(a)&&!this._contains(a)?(this._operatorStack.push(a),this._activateOperator(a),!0):!1};f.prototype.set=function(a,d){var c=this._operatorStack[d];return a===c?!1:this._isValid(a)&&!this._contains(a)?(this._deactivateOperator(c),this._activateOperator(a),this._operatorStack[d]=a,!0):!1};f.prototype.pop=function(){var a=this._operatorStack.pop();void 0!==a&&
this._deactivateOperator(a);return a};f.prototype.remove=function(a){var d=this.indexOf(a);-1!==d&&(this._operatorStack.splice(d,1),this._deactivateOperator(a))};f.prototype.peek=function(){return 0<this.size()?this._operatorStack[this.size()-1]:d.OperatorId.Invalid};f.prototype.clear=function(){for(var a=this.size()-1;0<=a;a--)this.pop()};f.prototype.size=function(){return this._operatorStack.length};f.prototype.getOperator=function(a){a=this._operators.get(a);return void 0!==a?a:null};f.prototype.injectEvent=
function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b;return __generator(this,function(g){switch(g.label){case 0:c=this.size()-1,g.label=1;case 1:if(!(0<=c))return[3,5];b=this._operators.get(this._operatorStack[c]);if(void 0!==b)switch(e){case d.EventType.KeyDown:if(b.onKeyDown)b.onKeyDown(a);break;case d.EventType.KeyUp:if(b.onKeyUp)b.onKeyUp(a);break;case d.EventType.MouseDown:if(b.onMouseDown)b.onMouseDown(a);break;case d.EventType.MouseMove:if(b.onMouseMove)b.onMouseMove(a);break;
case d.EventType.MouseUp:if(b.onMouseUp)b.onMouseUp(a);break;case d.EventType.Mousewheel:if(b.onMousewheel)b.onMousewheel(a);break;case d.EventType.TouchStart:if(b.onTouchStart)b.onTouchStart(a);break;case d.EventType.TouchMove:if(b.onTouchMove)b.onTouchMove(a);break;case d.EventType.TouchEnd:if(b.onTouchEnd)b.onTouchEnd(a);break;case d.EventType.ViewOrientationChange:if(b.onViewOrientationChange)b.onViewOrientationChange();break;default:d.Util.TypeAssertNever(e)}return a.getHandled()?e!==d.EventType.MouseUp&&
e!==d.EventType.TouchEnd?[3,3]:[4,this._stopInteraction()]:[3,4];case 2:g.sent(),g.label=3;case 3:return[3,5];case 4:return c--,[3,1];case 5:return[2]}})})};f.prototype._stopInteraction=function(){for(var a=[],e=this.size()-1;0<=e;e--){var c=this._operators.get(this._operatorStack[e]);c&&c.stopInteraction&&(c=c.stopInteraction(),void 0!==c&&a.push(c))}return d.Util.waitForAll(a)};f.prototype._buildSelectionSpecs=function(a,e,c){for(var b=!1,g=d.SelectionMask.None,k=d.Operator.SelectionRequirements.None,
l=!0,f=this.size()-1;0<=f;f--){var m=this._operators.get(this._operatorStack[f]);void 0!==m&&m.needsSelection&&m.needsSelection(a,e,c)&&(b=!0,g|=m._selectionMask(a),k|=m.selectionRequirements(a),l=l&&m._onlySelectOverlays(a))}return b?{mask:g,requirements:k,restrictToOverlays:l}:null};f.prototype._injectSelectionEvent=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,g,k,l,f;return __generator(this,function(n){switch(n.label){case 0:c=d.Button.None;a instanceof d.Event.MouseInputEvent&&
(c=a.getButton());b=a.getPosition();a._setCompositePickResult(null);g=this._buildSelectionSpecs(e,c,b);if(null===g)return[2,this.injectEvent(a,e)];k=new d.PickConfig(g.mask);k.ignoreCappingGeometry=0!==(g.requirements&d.Operator.SelectionRequirements.IgnoreCapping);k.restrictToOverlays=g.restrictToOverlays;n.label=1;case 1:return n.trys.push([1,4,,5]),[4,this._viewer.view.compositePickFromPoint(b,k)];case 2:return l=n.sent(),a._setCompositePickResult(l),[4,this.injectEvent(a,e)];case 3:return[2,n.sent()];
case 4:return f=n.sent(),"reason"in f?console.log(f.reason):console.log(f),a._setCompositePickResult(null),[2,this.injectEvent(a,e)];case 5:return[2]}})})};f.prototype._injectViewOrientationChangeEvent=function(){for(var a=this.size()-1;0<=a;a--){var d=this._operators.get(this._operatorStack[a]);if(void 0!==d&&d.onViewOrientationChange)d.onViewOrientationChange()}};f.prototype._isValid=function(a){return this._operators.has(a)||a===d.OperatorId.None};f.prototype._contains=function(a){return-1!==this.indexOf(a)};
f.prototype._activateOperator=function(a){a=this._operators.get(a);if(void 0!==a&&a.onActivate)return a.onActivate()};f.prototype._deactivateOperator=function(a){a=this._operators.get(a);if(void 0!==a&&a.onDeactivate)return a.onDeactivate()};return f}();d.OperatorManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(a,d){this._viewer=a;this._engine=d}f.prototype.maxIndex=function(){return d.BuiltinOverlayIndex.First-1};f.prototype.setViewport=function(a,e,c,b,g,k,l,f,m,p){if(0===a)throw new d.CommunicatorError("Index 0 is reserved and may not be used to specify an overlay.");if(0>a)throw new d.CommunicatorError("Invalid index "+a+" specified when setting viewport.");this._validateUnit(c,b,"x");this._validateUnit(g,k,"y");this._validateUnit(l,f,"width");this._validateUnit(m,
p,"height");this._engine.setOverlayViewport(a,e,c,b,g,k,l,f,m,p);return Promise.resolve()};f.prototype.setVisibility=function(a,d){this._engine.setOverlayVisibility(a,d);return Promise.resolve()};f.prototype.destroy=function(a){this._engine.destroyOverlay(a);return Promise.resolve()};f.prototype.addNodes=function(a,d){d=this._viewer.model._gatherInstanceIncsFromNodeIds(d);0<d.length&&this._engine.addNodesToOverlay(d,a);return Promise.resolve()};f.prototype.setCamera=function(a,d){this._engine.setOverlayCamera(a,
d);return Promise.resolve()};f.prototype._getOverlayOffset=function(a,e){var c=this._viewer.view.getCanvasSize(),b=d.Point2.zero();if(a===d.OverlayAnchor.LowerRightCorner||a===d.OverlayAnchor.UpperRightCorner||a===d.OverlayAnchor.RightCenter)b.x=c.x-e.x;else if(a===d.OverlayAnchor.Center||a===d.OverlayAnchor.TopCenter||a===d.OverlayAnchor.BottomCenter)b.x=.5*(c.x-e.x);if(a===d.OverlayAnchor.LowerLeftCorner||a===d.OverlayAnchor.LowerRightCorner||a===d.OverlayAnchor.BottomCenter)b.y=c.y-e.y;else if(a===
d.OverlayAnchor.Center||a===d.OverlayAnchor.LeftCenter||a===d.OverlayAnchor.RightCenter)b.y=.5*(c.y-e.y);return b};f.prototype._validateUnit=function(a,e,c){if(e!==d.OverlayUnit.Pixels&&(0>a||1<a))throw new d.ParseError("value for "+c+" should be between 0.0 and 1.0 when specifying non pixel value");};return f}();d.OverlayManager=h})(Communicator||(Communicator={}));
(function(d){(function(d){d[d.None=0]="None";d[d.Floor=1]="Floor";d[d.Wall=2]="Wall";d[d.Door=4]="Door"})(d.BimMask||(d.BimMask={}));var h=function(){function f(a){void 0===a&&(a=d.SelectionMask.Face);this.respectVisibility=!0;this.forceEffectiveSceneVisibilityMask=this.forceEffectiveVisibilityMask=d.SelectionMask.None;this.restrictLinesAndPointsToSelectedFaceInstances=this.oneEntityPerTypePerInstance=this.respectDepthRange=!0;this.restrictToOverlays=this.ignoreOverlays=this.ignoreCappingGeometry=
this.enableProximityFaces=!1;this.selectionMask=a}Object.defineProperty(f.prototype,"allowFaces",{get:function(){return 0!==(this.selectionMask&d.SelectionMask.Face)},set:function(a){this.selectionMask=d.Internal.setBit(this.selectionMask,d.SelectionMask.Face,a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"allowLines",{get:function(){return 0!==(this.selectionMask&d.SelectionMask.Line)},set:function(a){this.selectionMask=d.Internal.setBit(this.selectionMask,d.SelectionMask.Line,
a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"allowPoints",{get:function(){return 0!==(this.selectionMask&d.SelectionMask.Point)},set:function(a){this.selectionMask=d.Internal.setBit(this.selectionMask,d.SelectionMask.Point,a)},enumerable:!0,configurable:!0});return f}();d.PickConfig=h;h=function(){return function(f){void 0===f&&(f=d.SelectionMask.All);this.mustBeFullyContained=!1;this.respectVisibility=!0;this.forceEffectiveSceneVisibilityMask=this.forceEffectiveVisibilityMask=
d.SelectionMask.None;this.ignoreCuttingSections=this.allowPoints=this.allowLines=this.allowFaces=!0;this.ignoreUnrequestedInstances=this.onlyStreamedInstances=!1;this.allowFaces=0!==(f&d.SelectionMask.Face);this.allowLines=0!==(f&d.SelectionMask.Line);this.allowPoints=0!==(f&d.SelectionMask.Point)}}();d.IncrementalPickConfig=h})(Communicator||(Communicator={}));var SC;
(function(d){d.UnspecifiedMeasurementUnit=0;d.isError=function(d){return"object"===typeof d&&null!==d&&!0};d.getStateFailure=function(d){d=d.data;return"object"===typeof d&&null!==d&&"scStateFailure"in d?d.scStateFailure:null}})(SC||(SC={}));
(function(d){(function(h){function f(b){return null!==b?d.Color.createFromFloatArray(b):b}function a(b){return h.mapInPlace(b,f)}var e;(function(b){b[b.Add=0]="Add";b[b.Update=1]="Update"})(e||(e={}));var c=function(){return function(b){this.promise=h.OpenPromise.create();this.ids=b}}(),b=function(){function b(b,c){this._engineReadyPromise=h.OpenPromise.create();this._sessionStartedPromise=h.OpenPromise.create();this._connectionlessEmpty=!1;this._uri="ws://localhost:9999";this._streamingMode=d.StreamingMode.Default;
this._rendererType=d.RendererType.Client;this._memoryLimit=this._meshLevel=0;this._boundingPreviewMode=d.BoundingPreviewMode.All;this._streamCutoffScale=1;this._loadFinished=!1;this._statistics=new h.StatisticMap;this._cachedElementCount=this._cachedTriangleCount=null;this._windowSize=new d.Point2(0,0);this._cuttingSectionToKeyMap=new Map;this._cappingQuantizationGranularity=-1E4;this._cappingMaterialDirty=this._cappingGeometryVisibility=this._cappingLinesEnabled=this._cappingFacesEnabled=!0;this._cappingDelayTimeoutId=
null;this._cappingDelay=500;this._requestBatchCountByType=[];this._pendingRequestsByType=[];this._xRayMaterials=[];this._callbackManager=b;this._applyOptions(c);for(b=0;1>b;++b)this._requestBatchCountByType.push(0),this._pendingRequestsByType.push([])}b.prototype.getNetworkModelName=function(){console.assert(1===this._sessionType);if(void 0!==this._model)return this._model;throw new d.InternalLogicError;};b.prototype.logMessage=function(b){console.log(b)};b.prototype.setTimeout=function(b,c){return setTimeout(b,
c)};b.prototype.sleep=function(b){return h.sleep(b)};b.prototype.getScsInfo=function(){console.assert(2===this._sessionType);return void 0!==this._buffer?this._buffer:/^wss?:\/\//i.test(this._uri)?null:this._uri};b.prototype._applyOptions=function(b){void 0!==b.empty&&(this._connectionlessEmpty=b.empty);void 0!==b.endpointUri&&(this._uri=b.endpointUri);b.model&&(this._model=b.model);void 0!==b.sessionToken&&(this._sessionToken=b.sessionToken);void 0!==b.buffer&&(this._buffer=b.buffer);void 0!==b.streamingMode&&
(this._streamingMode=b.streamingMode);void 0!==b.rendererType&&(this._rendererType=b.rendererType);void 0!==b.defaultMeshLevel&&(this._meshLevel=b.defaultMeshLevel);void 0!==b.memoryLimit&&(this._memoryLimit=b.memoryLimit);void 0!==b.boundingPreviewMode&&(this._boundingPreviewMode=b.boundingPreviewMode);void 0!==b.streamCutoffScale&&this._setStreamCutoffScale(b.streamCutoffScale)};b.prototype.start=function(b,c){var a=this;this._canvasContainer=b;this._initOptions=c;_SC.createInstance({container:b,
onReady:function(b){a._onEngineReady(b)},onError:function(b){a._callbackManager.trigger("modelLoadFailure",a._model||"","failed to load engine: "+b)},enginePath:c.enginePath});return!0};b.prototype.setPickTolerance=function(b){this._scSelectionManager.setPickTolerance(b)};b.prototype.getPickTolerance=function(){return this._scSelectionManager.getPickTolerance()};b.prototype._onEngineReady=function(b){var c=this;this._sc=b;this._sessionType=0;this._matrixCache=new h.ScMatrixCache(this);this._materialCache=
new h.ScMaterialCache(this);this._scSelectionManager=new h.ScSelectionManager(this._sc);this.resize();this._callbackManager.bind({_firstBoundingReady:function(){return c._regenerateCapping()}});this._sc.setEventHandler("session_started",function(){var b=function(){c._callbackManager.unbind(a);return c._sessionStartedPromise},a={_sessionStarted:function(){return c._onSessionStarted()},_assemblyTreeReady:b,_modelSwitched:b};c._callbackManager.bind(a);c._sessionStartedPromise.resolve(c._callbackManager.promiseTrigger("_sessionStarted",
null))});this._sc.setEventHandler("announce_model",function(b,a,g){c._callbackManager.trigger("_announceModel",a,g)});this._sc.setEventHandler("first_instance",function(){c._callbackManager.trigger("_firstInstance")});this._sc.setEventHandler("inclusion",function(b,a,g,d){c._callbackManager.trigger("_inclusion",a,g,d)});this._sc.setEventHandler("remap_model",function(b,a,g,d){c._callbackManager.trigger("_remapModel",a,g,d)});this._sc.setEventHandler("remap_inclusion",function(b,a,g,d,k){c._callbackManager.trigger("_remapInclusion",
a,g,d,k)});this._sc.setEventHandler("capping_idle",function(b,a,g){c._callbackManager.trigger("cappingIdle",a,g)});this._sc.setEventHandler("stream_active",this._initOptions.streamingActivated);this._sc.setEventHandler("stream_idle",this._initOptions.streamingDeactivated);this._sc.setEventHandler("open_model_failed",function(b,a){switch(a.reason){case "UNKNOWN_MODEL":b="Unknown model";break;case "BAD_NETWORK_VERSION":b="Client/Server network version mismatch";break;case "BAD_STREAM_VERSION":case "BAD_STORE_VERSION":b=
"Unsupported file version";break;default:b="Internal Error"}c._callbackManager.trigger("modelLoadFailure",c._model||"",b)});this._sc.setEventHandler("missing_model",function(b,a,g){c._callbackManager.trigger("_missingModel",a,g);c._callbackManager.trigger("missingModel",g)});this._sc.setEventHandler("bad_data",function(b,a){switch(a.type){case "TRUNCATED_BLOCK":b="Failed to parse truncated data block.";break;case "ZFRAME_DECOMPRESS_FAILED":b="Failed to decompress data.";break;case "UNMATCHED_CODE":b=
"Unknown opcode.";break;case "STORE_VERSION_MISMATCHED":b="Store version mismatched. Expected='"+(a.expected+"'.");b+=" Actual='"+a.actual+"'.";break;case "STREAM_VERSION_MISMATCHED":b="Stream version mismatched. Expected='"+(a.expected+"'.");b+=" Actual='"+a.actual+"'.";break;case "PARSE_BOUNDING_TREE_FAILED":b="Failed to parse bounding tree.";break;default:b="Unknown error."}c._callbackManager.trigger("modelLoadFailure",c._model||"",b)});this._sc.setEventHandler("socket_open_failed",function(){c._callbackManager.trigger("modelLoadFailure",
c._model||"","WebSocket connection failed.")});this._sc.setEventHandler("post_draw",function(b,a,g,d){c._syncedCamera=g;c._statistics=a;c._initOptions.renderComplete();c._fillStatTotalCounts();b=c._fromScCamera(g);c._callbackManager.trigger("frameDrawn",b,d)});this._sc.setEventHandler("priority_meta_data_sent",function(b,a,g){c._initOptions.priorityMetaDataSent(a,g)});this.setAllowHighDpi(!0);this._sc.setEventHandler("meta_data",function(b,a,g,d){0>a&&(a+=4294967296);c._callbackManager.trigger("_metaData",
a,g,d)});this._sc.setEventHandler("draw_complete",function(){c._callbackManager.trigger("_drawComplete")});this._sc.setEventHandler("webgl_context_lost",function(){c._callbackManager.trigger("webGlContextLost")});this._sc.setEventHandler("websocket_connection_closed",function(){c._callbackManager.trigger("websocketConnectionClosed")});this._initOptions.engineReady(this._sessionStartedPromise);this._engineReadyPromise.resolve()};b.prototype.loadFinished=function(){return this._loadFinished};b.prototype.resetCachedStatistics=
function(){this._cachedTriangleCount=this._cachedElementCount=null};b.prototype.setAmbientOcclusionEnabled=function(b){this._sc.setAmbientOcclusionEnabled(b)};b.prototype.setAmbientOcclusionRadius=function(b){this._sc.setAmbientOcclusionRadius(b)};b.prototype.setLightingEnabled=function(b){this._sc.setLightingEnabled(b)};b.prototype._fillStatTotalCounts=function(){null!==this._cachedElementCount&&null!==this._cachedTriangleCount&&(this._statistics.total_element_count=this._cachedElementCount,this._statistics.total_triangle_count=
this._cachedTriangleCount)};b.prototype._updateCachedStats=function(){return __awaiter(this,void 0,void 0,function(){var b,c,a;return __generator(this,function(g){switch(g.label){case 0:return b=this._sc.getElementCount(),c=this._sc.getTriangleCount(),[4,Promise.all([b,c])];case 1:return a=g.sent(),this._cachedElementCount=a[0],this._cachedTriangleCount=a[1],this._fillStatTotalCounts(),[2]}})})};b.prototype._toVector3=function(b){var c=[0,0,0];b.toArray(c);return c};b.prototype.startExplode=function(b,
c){this.delayCapping();this._sc.startExplode(b,this._toVector3(c))};b.prototype.setExplodeMagnitude=function(b){this._callbackManager.trigger("explode",b);this.delayCapping();this._sc.explode(b)};b.prototype.stopExplode=function(){this.delayCapping();this._sc.resetExplode()};b.prototype.getStatistics=function(b){void 0===b&&(b=!1);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return!b||this.loadFinished()?[3,2]:[4,this._updateCachedStats()];
case 1:return c.sent(),this._fillStatTotalCounts(),[2,this._statistics];case 2:return this.loadFinished()&&null===this._cachedTriangleCount?[4,this._updateCachedStats()]:[3,4];case 3:return c.sent(),this._fillStatTotalCounts(),[2,this._statistics];case 4:return this._fillStatTotalCounts(),[2,this._statistics]}})})};b.prototype.setStreamIdleMarker=function(){return this._sc.setStreamIdleMarker()};b.prototype.hasDepthRange=function(b){return this._sc.MeshInstance.hasDepthRange(b)};b.prototype.setDepthRange=
function(b,c,a){this._sc.MeshInstance.setDepthRange(b,c,a)};b.prototype.unsetDepthRange=function(b){this._sc.MeshInstance.unsetDepthRange(b)};b.prototype.setDefaultDepthRange=function(b,c){this._sc.setDefaultDepthRange(b,c)};b.prototype._getScPlaneArray=function(b){for(var c=[],a=0;a<b.getCount();a++){var g=b.getPlane(a);if(null!==g){var d=[];g.normal.toArray(d);d[3]=g.d;c.push(d)}}return c};b.prototype.getCuttingSectionLimits=function(){return this._sc.cuttingSectionLimits()};b.prototype._addCuttingSection=
function(b,c){return __awaiter(this,void 0,void 0,function(){var a,g,k;return __generator(this,function(l){switch(l.label){case 0:return console.assert(!this._cuttingSectionToKeyMap.has(b)),a=4294967295,g=this._getScPlaneArray(b),0<g.length?[4,this._sc.addCuttingSection(g)]:[3,2];case 1:a=l.sent();if(4294967295===a)throw k=c===e.Add?"add":"update",new d.CommunicatorError("Failed to "+k+" cutting section.");l.label=2;case 2:return console.assert(!this._cuttingSectionToKeyMap.has(b)),this._cuttingSectionToKeyMap.set(b,
a),c===e.Add&&this._callbackManager.trigger("addCuttingSection",b),[2]}})})};b.prototype.addCuttingSection=function(b){return this._addCuttingSection(b,e.Add)};b.prototype.removeCuttingSection=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){c=this._cuttingSectionToKeyMap.get(b);if(void 0===c)return console.assert(!1),[2];this._cuttingSectionToKeyMap.delete(b);this._callbackManager.trigger("removeCuttingSection");return 4294967295===c?[2]:[2,this._sc.removeCuttingSections([c])]})})};
b.prototype.removeAllCuttingSections=function(){this._cuttingSectionToKeyMap.clear();this._callbackManager.trigger("removeCuttingSection");return this._sc.removeAllCuttingSections()};b.prototype.updateCuttingSection=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(g){c=this._cuttingSectionToKeyMap.get(b);if(void 0===c)return console.assert(!1),[2];if(4294967295===c)return[2,this._addCuttingSection(b,e.Update)];a=this._getScPlaneArray(b);return[2,
this._sc.replaceCuttingSection(a,c)]})})};b.prototype.setCappingDelay=function(b){this._cappingDelay=b};b.prototype.enableCappingIdleCallback=function(b){return this._sc.setCappingIdleHookEnabled(b)};b.prototype.delayCapping=function(){var b=this;null===this._cappingDelayTimeoutId?this._sc.pauseCapping():clearTimeout(this._cappingDelayTimeoutId);this._cappingDelayTimeoutId=setTimeout(function(){b._cappingDelayTimeoutId=null;b._sc.resumeCapping()},this._cappingDelay)};b.prototype.setCappingGeometryVisibility=
function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(g){console.assert(void 0!==this._cappingLineMaterialId);console.assert(void 0!==this._cappingFaceMaterialId);if(this._cappingGeometryVisibility!==b||this._cappingMaterialDirty){null!==this._cappingDelayTimeoutId&&(clearTimeout(this._cappingDelayTimeoutId),this._cappingDelayTimeoutId=null);this._cappingMaterialDirty=!1;if(this._cappingGeometryVisibility=b)return c=this._cappingLinesEnabled?this._cappingLineMaterialId:
[0,4294967295],a=this._cappingFacesEnabled?this._cappingFaceMaterialId:[0,4294967295],[2,this._sc.enableCapping(c,a,this._cappingQuantizationGranularity)];this._sc.disableCapping()}return[2]})})};b.prototype._regenerateCapping=function(){this._cappingMaterialDirty=!0;return this.setCappingGeometryVisibility(this._cappingGeometryVisibility)};b.prototype.getCappingGeometryVisibility=function(){return this._cappingGeometryVisibility};b.prototype.setDiffuseColor=function(b,c){return this._sc.Material.setDiffuseColor(b,
c)};b.prototype._toRgb=function(b){var c=[0,0,0];b.toFloatArray(c);return c};b.prototype._toRgba=function(b,c){c=[0,0,0,c];b.toFloatArray(c);return c};b.prototype.setCappingFaceColor=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._cappingMaterialDirty=!0,this._cappingFacesEnabled=!!b,b?[4,this.setDiffuseColor(this._cappingFaceMaterialId,this._toRgba(b,1))]:[3,2];case 1:c.sent(),c.label=2;case 2:return[2,this._regenerateCapping()]}})})};
b.prototype.setCappingLineColor=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._cappingMaterialDirty=!0,this._cappingLinesEnabled=!!b,b?[4,this.setDiffuseColor(this._cappingLineMaterialId,this._toRgba(b,1))]:[3,2];case 1:c.sent(),c.label=2;case 2:return[2,this._regenerateCapping()]}})})};b.prototype._onSessionStarted=function(){return __awaiter(this,void 0,void 0,function(){var b,c,a,g,e,f,h,u,t=this;return __generator(this,
function(k){switch(k.label){case 0:this._sc.suspendDrawing();this._sc.setDrawMode(1);this._sc.setHighlightedInstanceFilter(3);this._sc.setUnhighlightedFilter(0);this._sc.setHighlightMode(1);this._sc.setAntiAliasingMode(1);b=[];b.push(this._matrixCache.init());c=[.5,.5,.5,1];a=function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(b){this._cappingMaterialDirty=!0;return void 0!==this._cappingFaceMaterialId&&void 0!==this._cappingLineMaterialId?[2,this.setCappingGeometryVisibility(this.getCappingGeometryVisibility())]:
[2]})})};b.push(this.createMaterial().then(function(b){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(g){switch(g.label){case 0:return[4,this.setDiffuseColor(b,c)];case 1:return g.sent(),this._cappingFaceMaterialId=b,[2,a()]}})})}));b.push(this.createMaterial().then(function(b){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(g){switch(g.label){case 0:return[4,this.setDiffuseColor(b,c)];case 1:return g.sent(),this._cappingLineMaterialId=b,
[2,a()]}})})}));g=function(c){e._xRayMaterials[c]=[];for(var a=function(a){b.push(e.createMaterial().then(function(b){t._xRayMaterials[c][a]={id:b,color:null}}))},g=0,k=[d.ElementType.Faces,d.ElementType.Lines,d.ElementType.Points];g<k.length;g++)a(k[g])};e=this;f=0;for(h=[d.XRayGroup.Selected,d.XRayGroup.Unselected];f<h.length;f++)u=h[f],g(u);return[4,Promise.all(b)];case 1:return k.sent(),this._initOptions.sceneReady(),this._sc.resumeDrawing(),[2]}})})};b.prototype.isInit=function(){return void 0!==
this._sc};b.prototype.setRemoteEndpoint=function(b,c){this._uri=b;this._model=c};b.prototype.getSessionType=function(){return this._sessionType};b.prototype._awaitEmptyLoad=function(){var b=this,c=h.OpenPromise.create(),a={_attached:function(g){b._callbackManager.unbind(a);0===g?c.resolve():c.reject(new d.InternalLogicError)}};this._callbackManager.bind(a);return c};b.prototype.loadEmpty=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,
this._engineReadyPromise];case 1:c.sent();try{if(0!==this._sessionType)throw new d.LoadError("Incompatible load types.");b=this._awaitEmptyLoad();this._sessionType=this._connectionlessEmpty||void 0!==this._buffer||void 0===this._model?this._loadEmptyScs():this._loadEmptyNetwork();return[2,b]}catch(n){throw this._callbackManager.trigger("modelLoadFailure",this._model||"",n.message),n;}}})})};b.prototype._loadEmpty=function(b){var c=this;console.assert(void 0===b.XHRonprogress);console.assert(void 0===
b.XHRonerror);console.assert(void 0===b.XHRonloadend);b.XHRonprogress=function(b){c._callbackManager.trigger("XHRonprogress",b)};b.XHRonerror=function(b){c._callbackManager.trigger("XHRonerror",b)};b.XHRonloadend=function(b,a,g){c._callbackManager.trigger("XHRonloadend",b,a,g)};return this._sc.load(b)};b.prototype._loadEmptyScs=function(){console.assert(void 0===this._model);var b={empty:!0};this._streamingMode===d.StreamingMode.OnDemand&&(b.streamInstancesOnDemand=!0);return this._loadEmpty(b)};
b.prototype._loadEmptyNetwork=function(){console.assert(void 0!==this._model);var b={model:d.EmptyModelName,uri:this._uri,serverSideRendering:this._rendererType===d.RendererType.Server,meshLevel:this._meshLevel,streamCutoffScale:this._streamCutoffScale};void 0!==this._sessionToken&&(b.sessionToken=this._sessionToken);0<this._memoryLimit&&(b.limitMiB=this._memoryLimit);(this._boundingPreviewMode&d.BoundingPreviewMode.Model)===d.BoundingPreviewMode.Model&&(b.streamModelBoundingPreviews=!0);(this._boundingPreviewMode&
d.BoundingPreviewMode.Instance)===d.BoundingPreviewMode.Instance&&(b.streamInstanceBoundingPreviews=!0);(this._boundingPreviewMode&d.BoundingPreviewMode.Ejected)===d.BoundingPreviewMode.Ejected&&(b.streamEjectedBoundingPreviews=!0);switch(this._streamingMode){case d.StreamingMode.OnDemand:b.streamInstancesOnDemand=!0;break;case d.StreamingMode.All:b.streamCulled=!0,b.streamMetaDataOnIdle=!0}return this._loadEmpty(b)};b.prototype.setProjection=function(b){var c=this.getCamera();c.getProjection()!==
b&&(c.setProjection(b),this.setCamera(c))};b.prototype.getViewMatrix=function(b){b=void 0!==b?this._toCamera(b):this._sc.getCamera();return d.Matrix.createFromArray(b.viewMatrix())};b.prototype.getProjectionMatrix=function(b){b=void 0!==b?this._toCamera(b):this._sc.getCamera();return d.Matrix.createFromArray(b.projectionMatrix())};b.prototype.getFullCameraMatrix=function(b){b=void 0!==b?this._toCamera(b):this._sc.getCamera();return d.Matrix.createFromArray(b.fullMatrix())};b.prototype.getSynchedViewMatrix=
function(){return this._syncedCamera?d.Matrix.createFromArray(this._syncedCamera.viewMatrix()):new d.Matrix};b.prototype.getSynchedProjectionMatrix=function(){return this._syncedCamera?d.Matrix.createFromArray(this._syncedCamera.projectionMatrix()):new d.Matrix};b.prototype.getPrimaryModelKey=function(){return this._sc.primaryModelKey()};b.prototype.getPartsBounding=function(b,c,a){return this.getBounding(b,c,!1,a)};b.prototype.getDrawnPartsBounding=function(b){return __awaiter(this,void 0,void 0,
function(){var c,a;return __generator(this,function(g){switch(g.label){case 0:return[4,this._sc.MeshInstance.getDrawnWorldSpaceBounding(b)];case 1:return c=g.sent(),a=new d.Box,a.min.fromArray(c.min),a.max.fromArray(c.max),[2,a]}})})};b.prototype.getBounding=function(b,c,a,g){return __awaiter(this,void 0,void 0,function(){var k,e;return __generator(this,function(l){switch(l.label){case 0:return[4,this._sc.MeshInstance.getWorldSpaceBounding(b,c,a,g)];case 1:return k=l.sent(),e=new d.Box,e.min.fromArray(k.min),
e.max.fromArray(k.max),[2,e]}})})};b.prototype.getClientDimensions=function(){var b=this._sc.container;return[b.clientWidth,b.clientHeight]};b.prototype.getModelBounding=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this.getBounding([],b,c,a)]})})};b.prototype.pickFromScreen=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this._scSelectionManager.pickFromScreen(b,c,a)]})})};b.prototype.pickAllFromScreen=
function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this._scSelectionManager.pickAllFromScreen(b,c,a)]})})};b.prototype.compositePickFromScreen=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this._scSelectionManager.compositePickFromScreen(b,c,a)]})})};b.prototype.beginScreenAreaSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,
this._scSelectionManager.beginScreenAreaSelection(b,c,a)]})})};b.prototype.beginRayDrillSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this._scSelectionManager.beginRayDrillSelection(b,c,a)]})})};b.prototype.beginConvexPolyhedronSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this._scSelectionManager.beginConvexPolyhedronSelection(b,c,a)]})})};b.prototype.beginSphereSelection=
function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this._scSelectionManager.beginSphereSelection(b,c,a)]})})};b.prototype.endIncrementalSelection=function(b){this._scSelectionManager.endIncrementalSelection(b)};b.prototype.advanceIncrementalSelection=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,this._scSelectionManager.advanceIncrementalSelection(b,!1)]})})};b.prototype.flushMetaDataCache=
function(){this._sc.flushMetaDataCache()};b.prototype.safeGetMetaDatas=function(b,c){for(var a=[],g=0;g<c.length;g++)a.push(b,c[g]);return this.getDataFromIds(a).then(h.identity,function(){return null})};b.prototype.safeGetMetaData=function(b,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(g){switch(g.label){case 0:return[4,this.safeGetMetaDatas(b,[c])];case 1:return a=g.sent(),null!==a?[2,a[0]]:[2,null]}})})};b.prototype.safeLoadMetaDatas=function(b){return this.getDataFromIds(b).then(h.nop,
h.nop)};b.prototype.getDataFromIds=function(b){if(0===this._requestBatchCountByType[0])return this._getDataFromIds(b);b=new c(b);this._pendingRequestsByType[0].push(b);return b.promise};b.prototype._getDataFromIds=function(b){return this._sc.getMetaData(b)};b.prototype.pickFromRay=function(b,c){return this._scSelectionManager.pickFromRay(b,c)};b.prototype.pickAllFromRay=function(b,c){return this._scSelectionManager.pickAllFromRay(b,c)};b.prototype.updateCamera=function(b){var c=b._getFlags(),a=this._sc.getCamera();
(c&h.CameraFlags.Position)===h.CameraFlags.Position&&a.setPosition(this._toVector3(b.getPosition()));(c&h.CameraFlags.Target)===h.CameraFlags.Target&&a.setTarget(this._toVector3(b.getTarget()));(c&h.CameraFlags.Up)===h.CameraFlags.Up&&a.setUpVector(this._toVector3(b.getUp()));this._setCamera(a);return this.getCamera()};b.prototype._toProjection=function(b){switch(b){default:case d.Projection.Orthographic:return 1;case d.Projection.Perspective:return 0}};b.prototype._toCamera=function(b){var c=this._sc.getCamera();
c.reset(this._toProjection(b.getProjection()),this._toVector3(b.getPosition()),this._toVector3(b.getTarget()),this._toVector3(b.getUp()),b.getWidth(),b.getHeight());c.setNearLimit(b.getNearLimit());return c};b.prototype.setCamera=function(b){b=this._toCamera(b);this._setCamera(b)};b.prototype._setCamera=function(b){this.delayCapping();this._sc.setCamera(b)};b.prototype.setInstancesMatrix=function(b,c){this._sc.MeshInstance.setAnonymousMatrix(b,c.m)};b.prototype.setMatrices=function(b,c){this._sc.requestMeshInstances(b,
!1,!0);for(var a=0;a<c.length;a++)this._sc.MeshInstance.setAnonymousMatrix([b[2*a],b[2*a+1]],c[a].m)};b.prototype.highlightParts=function(b,c){this._sc.MeshInstance.setHighlighted(b,c);this._sc.MeshInstance.setXRay(b,c)};b.prototype.highlightElements=function(b,c,a,g,d){c=this._toElementType(c);this._sc.MeshInstance.setElementHighlighted(b,c,a,g,d);this._sc.MeshInstance.setElementXRay(b,c,a,g,d)};b.prototype.getPartHighlighted=function(b){return this._sc.MeshInstance.getHighlighted(b)};b.prototype.getElementHighlighted=
function(b,c,a){return this._sc.MeshInstance.getElementHighlighted(b,this._toElementType(c),a)};b.prototype.setNodeHighlightColor=function(b,c){b?(this._sc.setHighlightedInstanceFilter(3),b=this._toRgba(b,1),this._sc.setHiddenLineHighlightedInstanceFillColor(b),this._sc.setHighlightedInstanceColor(b)):this._sc.setHighlightedInstanceFilter(0);b=c?this._toRgba(c,1):[0,0,0,0];this._sc.setHiddenLineHighlightedInstanceOutlineColor(b);this._sc.setHighlightedInstanceOutlineColor(b)};b.prototype.setElementHighlightColor=
function(b,c){b?(this._sc.setHighlightedElementFilter(3),b=this._toRgba(b,1),this._sc.setHighlightedElementColor(b),this._sc.setHiddenLineHighlightedElementFillColor(b)):this._sc.setHighlightedElementFilter(0);b=c?this._toRgba(c,1):[0,0,0,0];this._sc.setHighlightedElementOutlineColor(b);this._sc.setHiddenLineHighlightedElementOutlineColor(b)};b.prototype.setHighlightColorizeCompression=function(b){this._sc.setHighlightColorizeCompression(b)};b.prototype.computeMininimumBodyBodyDistance=function(b,
c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(g){switch(g.label){case 0:if(2!==b.length||2!==c.length)throw new d.CommunicatorError("Invalid instance inc.");return[4,this._sc.MeshInstance.computeMinimalBodyBodyDistance(b,c)];case 1:return a=g.sent(),[2,h.makeFaceFaceDistanceItem(a)]}})})};b.prototype.computeMininimumFaceFaceDistance=function(b,c,a,g){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(k){switch(k.label){case 0:if(2!==
b.length||2!==a.length)throw new d.CommunicatorError("Invalid instance inc.");return[4,this._sc.MeshInstance.computeMinimalFaceFaceDistance(b,c,a,g)];case 1:return e=k.sent(),[2,h.makeFaceFaceDistanceItem(e)]}})})};b.prototype.computeMinimumFaceRayDistance=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var g,e;return __generator(this,function(k){switch(k.label){case 0:if(2!==b.length)throw new d.CommunicatorError("Invalid instance inc.");g=h.toScRay(a);return[4,this._sc.MeshInstance.computeMinimalFaceRayDistance(b,
c,g)];case 1:return e=k.sent(),[2,h.makeFaceFaceDistanceItem(e)]}})})};b.prototype.computeMinimumFaceLineDistance=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var g,e;return __generator(this,function(k){switch(k.label){case 0:if(2!==b.length)throw new d.CommunicatorError("Invalid instance inc.");g=h.toScRay(a);return[4,this._sc.MeshInstance.computeMinimalFaceLineDistance(b,c,g)];case 1:return e=k.sent(),[2,h.makeFaceFaceDistanceItem(e)]}})})};b.prototype.pauseRendering=function(){this._sc.suspendDrawing()};
b.prototype.resumeRendering=function(){this._sc.resumeDrawing()};b.prototype.beginRequestBatch=function(b){++this._requestBatchCountByType[b]};b.prototype.endRequestBatch=function(b){0<this._requestBatchCountByType[b]&&--this._requestBatchCountByType[b];this._flushBatchedRequests(b)};b.prototype._flushBatchedRequests=function(b){var c=this._pendingRequestsByType[b];this._pendingRequestsByType[b]=[];for(var a=[],g=0;g<c.length;g++)for(var e=0,k=c[g].ids;e<k.length;e++)a.push(k[e]);switch(b){case 0:return this._flushBatchedMetaDataRequests(c,
a);default:return d.Util.TypeAssert(b),console.assert(!1),Promise.resolve()}};b.prototype._flushBatchedMetaDataRequests=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,g,d,e,k,l,f,h,w;return __generator(this,function(n){switch(n.label){case 0:return[4,this._getDataFromIds(c)];case 1:a=n.sent();d=g=0;for(e=b;d<e.length;d++){k=e[d];l=[];f=k.ids.length/2;for(h=0;h<f;++h)w=a[g++],l.push(w);k.promise.resolve(l)}console.assert(g===a.length);return[2]}})})};b.prototype.clearHighlight=
function(){this._sc.unsetAllHighlighted();this._sc.unsetAllXRay()};b.prototype.resetColors=function(){this._sc.unsetAllColors()};b.prototype.resetOpacity=function(){this._sc.unsetAllOpacity()};b.prototype.setPartOpacity=function(b,c){this._sc.MeshInstance.setOpacity(b,0,c);this._sc.MeshInstance.setOpacity(b,1,c)};b.prototype.unsetPartOpacity=function(b){this._sc.MeshInstance.unsetOpacity(b,0);this._sc.MeshInstance.unsetOpacity(b,1)};b.prototype.getPartOpacity=function(b){return this._sc.MeshInstance.getOpacity(b,
0)};b.prototype.getEffectivePartOpacity=function(b,c){return this._sc.MeshInstance.getEffectiveOpacity(b,this._toElementType(c))};b.prototype.getPartHasTransparency=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,g,d,e;return __generator(this,function(k){switch(k.label){case 0:return c=[],c.push(this._sc.MeshInstance.hasTransparency(b,0)),c.push(this._sc.MeshInstance.hasTransparency(b,1)),[4,Promise.all(c)];case 1:a=k.sent();g=a[0];d=a[1];for(e=0;e<g.length;++e)g[e]||(g[e]=d[e]);
return[2,g]}})})};b.prototype.setPartColor=function(b,c,a){this._sc.MeshInstance.setColor(b,this._toElementType(c),a.getFloatArray())};b.prototype.unsetPartColor=function(b,c){this._sc.MeshInstance.unsetColor(b,this._toElementType(c))};b.prototype.getPartColor=function(b,c){return this._sc.MeshInstance.getColor(b,this._toElementType(c)).then(a)};b.prototype.getEffectivePartColor=function(b,c){return __awaiter(this,void 0,void 0,function(){var g,d;return __generator(this,function(e){switch(e.label){case 0:return g=
this._toElementType(c),[4,this._sc.MeshInstance.getEffectiveColor(b,g)];case 1:return d=e.sent(),[2,a(d)]}})})};b.prototype.setElementColor=function(b,c,a,g,d){this._sc.MeshInstance.setElementColor(b,this._toElementType(c),a,g,d.getFloatArray())};b.prototype.unsetElementColor=function(b,c,a,g){this._sc.MeshInstance.unsetElementColor(b,this._toElementType(c),a,g)};b.prototype.getElementColor=function(b,c,g){return this._sc.MeshInstance.getElementColor(b,this._toElementType(c),g).then(a)};b.prototype.getEffectiveElementColor=
function(b,c,g){return __awaiter(this,void 0,void 0,function(){var d,e;return __generator(this,function(k){switch(k.label){case 0:return d=this._toElementType(c),[4,this._sc.MeshInstance.getEffectiveElementColor(b,d,g)];case 1:return e=k.sent(),[2,a(e)]}})})};b.prototype.synchronizeVisibilities=function(b,c){0<b.length&&this._sc.MeshInstance.synchronizeVisibilities(b,c)};b.prototype.setPartVisibility=function(b,c,a){0<b.length&&this._sc.MeshInstance.setVisible(b,c,a)};b.prototype.setVisibilityByAttachment=
function(b,c){this._sc.setVisibilityByAttachment(b,c)};b.prototype.requestMeshInstances=function(b){this._sc.demandMeshInstances(b)};b.prototype.getRendererType=function(){return this._rendererType};b.prototype._toMeshDataBuilder=function(b){for(var c=b._getFaceData(),a=b._getPointData(),g=b._getPolylineData(),e=new this._sc.MeshDataBuilder,k=0;k<c.length;k++){var f=c[k];e.addFace(f.vertexData,{normals:f.normalData,rgba32s:f.rgba32data,uvs:f.uvData,bits:f.bits})}for(c=0;c<a.length;c++)f=a[c],e.addPoints(f.vertexData,
{rgba32s:f.rgba32data,bits:f.bits});for(a=0;a<g.length;a++)f=g[a],e.addPolyline(f.vertexData,{rgba32s:f.rgba32data,bits:f.bits});switch(b.getFaceWinding()){case d.FaceWinding.Clockwise:g=1;break;case d.FaceWinding.CounterClockwise:g=2;break;default:g=0}f=b.getBackfacesEnabled()?4:0;b=b.isManifold()?65536:0;e.formatBits=e.formatBits|g|f|b;return e};b.prototype.createMesh=function(b){b=this._toMeshDataBuilder(b);return this._sc.MeshData.create(b)};b.prototype.replaceMesh=function(b,c){c=this._toMeshDataBuilder(c);
return this._sc.MeshData.replace(b,c)};b.prototype.destroyMeshes=function(b){return this._sc.MeshData.destroy(b)};b.prototype._toImageFormat=function(b){switch(b){case d.ImageFormat.Gray8:return 2;case d.ImageFormat.GrayAlpha16:return 3;case d.ImageFormat.Rgb24:return 1;case d.ImageFormat.Rgba32:return 0;case d.ImageFormat.Jpeg:return 4;case d.ImageFormat.Png:return 5}};b.prototype._validateImage=function(b){if(void 0===b.format)throw new d.ParseError("missing 'format' property");if(void 0===b.data)throw new d.ParseError("missing 'data' property");
if((b.format===d.ImageFormat.Gray8||b.format===d.ImageFormat.GrayAlpha16||b.format===d.ImageFormat.Rgb24||b.format===d.ImageFormat.Rgba32)&&(void 0===b.width||0>=b.width||void 0===b.height||0>=b.height))throw new d.ParseError("uncompressed format requested but missing width or height");};b.prototype.createImage=function(b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){this._validateImage(b);return void 0!==c?(this._validateImage(c),[2,this._sc.Image.create(this._toImageFormat(b.format),
b.data,b.width,b.height,this._toImageFormat(c.format),c.data,c.width,c.height)]):[2,this._sc.Image.create(this._toImageFormat(b.format),b.data,b.width,b.height)]})})};b.prototype.destroyImages=function(b){return this._sc.Image.destroy(b)};b.prototype._toTextureTiling=function(b){switch(b){default:case d.TextureTiling.Repeat:return 0;case d.TextureTiling.Clamp:return 1}};b.prototype._toTextureInterpolation=function(b){return!1===b?1:0};b.prototype._toTextureMipMapping=function(b){return!1===b?1:0};
b.prototype._toTextureParameterization=function(b){switch(b){default:case d.TextureParameterization.UV:return 0}};b.prototype._toTextureModifier=function(b){switch(b){default:case 0:return 0;case d.TextureModifier.Decal:return 1}};b.prototype.setTexture=function(b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(void 0===c.imageId)throw new d.ParseError("missing 'imageId' property");return[2,this._sc.MeshInstance.setTexture(b,0,c.imageId,void 0!==c.matrix?c.matrix.m:
(new d.Matrix).m,this._toTextureTiling(c.tiling),this._toTextureInterpolation(c.interpolation),this._toTextureMipMapping(c.mipMapping),this._toTextureParameterization(c.parameterization),this._toTextureModifier(c.modifiers))]})})};b.prototype.unsetTexture=function(b){this._sc.MeshInstance.unsetTexture(b,0)};b.prototype.createMaterial=function(){return this._sc.Material.create()};b.prototype._getMaterialPromiseWithDiffuseColor=function(b,c,a,g){var d=new h.MaterialInfo;d.setDiffuseColor(null!==b?b:
a);d.setDiffuseTransparency(null!==c?c:g);return this._materialCache.getOrCreateMaterial(d)};b.prototype.createMatrix=function(b){return this._sc.Matrix.create(b)};b.prototype.createIdentityMatrix=function(){return this._sc.Matrix.create()};b.prototype.createMeshInstance=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,g,e,k,f,h,t,v,w;return __generator(this,function(l){switch(l.label){case 0:c=b.getMeshId();if(null===c)throw new d.CommunicatorError("MeshId is not set");k=this._matrixCache.getIdentityInc();
f=[];if(h=b.getMatrix())t=this.createMatrix(h.m).then(function(b){k=b}),f.push(t);v=new d.Color(255,0,0);f.push(this._getMaterialPromiseWithDiffuseColor(b.getFaceColor(),b.getOpacity(),v,1).then(function(b){a=b}));f.push(this._getMaterialPromiseWithDiffuseColor(b.getLineColor(),b.getLineOpacity(),v,1).then(function(b){g=b}));f.push(this._getMaterialPromiseWithDiffuseColor(b.getPointColor(),b.getPointOpacity(),v,1).then(function(b){e=b}));return[4,Promise.all(f)];case 1:return l.sent(),[4,this._sc.MeshInstance.create(c,
k,a,g,e,b.getCreationFlags(),b.getOverlayIndex())];case 2:return w=l.sent(),this._callbackManager.trigger("_geometryCreated",w),[2,w]}})})};b.prototype.destroyLocalInstances=function(b){return this._sc.MeshInstance.destroy(b)};b.prototype._fromScCamera=function(b){var c=d.Projection.Orthographic;0===b.projection()&&(c=d.Projection.Perspective);return d.Camera.create(d.Point3.createFromArray(b.position()),d.Point3.createFromArray(b.target()),d.Point3.createFromArray(b.upVector()),c,b.fieldWidth(),
b.fieldHeight(),b.nearLimit())};b.prototype.getCameraPromise=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,this._sc.getCameraPromise()];case 1:return b=c.sent(),[2,this._fromScCamera(b)]}})})};b.prototype.getCamera=function(){var b=this._sc.getCamera();return this._fromScCamera(b)};b.prototype.resize=function(){this._sc.onResize();this._windowSize.set(this._canvasContainer.offsetWidth,this._canvasContainer.offsetHeight)};
b.prototype.setFaceVisibility=function(b){this._sc.setFacesVisible(b)};b.prototype.setLineVisibility=function(b){this._sc.setLinesVisible(b)};b.prototype.getCanvasSize=function(){return this._windowSize.copy()};b.prototype.setBackgroundGradient=function(b,c){this._sc.setBackgroundGradient(b?this._toRgba(b,1):[0,0,0,0],c?this._toRgba(c,1):[0,0,0,0])};b.prototype.setServerRenderQuality=function(b,c,a,g){this._sc.setSsrQuality({jpegQualityLow:b,jpegQualityHigh:c,scaleLow:a,scaleHigh:g})};b.prototype.setMinimumFramerate=
function(b){this._sc.setMinFrameRate(b)};b.prototype.getMinimumFramerate=function(){return this._sc.getMinFrameRate()};b.prototype.setBackFacesVisible=function(b){this._sc.setBackFacesVisible(b)};b.prototype.setDrawMode=function(b){this._sc.setDrawMode(b)};b.prototype.enableHiddenLineRendering=function(b){this.setDrawMode(2);this._sc.setHiddenLineVisibleLineColor(this._toRgba(b.getVisibleLineColor(),b.getVisibleLineOpacity()));this._sc.setHiddenLineHiddenLineColor(this._toRgba(b.getObscuredLineColor(),
b.getObscuredLineOpacity()))};b.prototype.setAntiAliasingMode=function(b){switch(b){case d.AntiAliasingMode.None:this._sc.setAntiAliasingMode(0);break;case d.AntiAliasingMode.SMAA:this._sc.setAntiAliasingMode(1)}};b.prototype.setInstanceModifier=function(b,c,a){switch(b){case d.InstanceModifier.DoNotCut:this._sc.MeshInstance.setDoNotCut(c,a);break;case d.InstanceModifier.DoNotExplode:this._sc.MeshInstance.setDoNotExplode(c,a);break;case d.InstanceModifier.DoNotSelect:this._sc.MeshInstance.setDoNotSelect(c,
a);break;case d.InstanceModifier.SuppressCameraScale:this._sc.MeshInstance.setSuppressCameraScale(c,a);break;case d.InstanceModifier.OverrideSceneVisibility:this._sc.MeshInstance.setOverrideSceneVisibility(c,a);break;case d.InstanceModifier.DoNotLight:this._sc.MeshInstance.setDoNotLight(c,a);break;case d.InstanceModifier.DoNotOutlineHighlight:this._sc.MeshInstance.setDoNotOutlineHighlight(c,a);break;case d.InstanceModifier.ExcludeBounding:this._sc.MeshInstance.setExcludeBounding(c,a);break;case d.InstanceModifier.DoNotUseVertexColors:this._sc.MeshInstance.setDoNotUseVertexColors(c,
a);break;case d.InstanceModifier.AlwaysDraw:this._sc.MeshInstance.setAlwaysDraw(c,a);break;case d.InstanceModifier.DoNotXRay:this._sc.MeshInstance.setDoNotXRay(c,a);break;case d.InstanceModifier.ScreenOriented:this._sc.MeshInstance.setScreenOriented(c,a);break;case d.InstanceModifier.ScreenSpace:this._sc.MeshInstance.setScreenSpace(c,a);break;case d.InstanceModifier.ScreenSpaceStretched:this._sc.MeshInstance.setScreenSpaceStretched(c,a)}};b.prototype.attachModel=function(b,c,a,g,d){return this._attachModels(b,
[[c,a]],g,d)};b.prototype.attachScsModelByKey=function(b,c,a,g,d){console.assert(2===this._sessionType);return this._sc.attachScsModelByKey(b,a,c,g,d)};b.prototype._attachModels=function(b,c,a,g){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return[4,this._sc.attachModels(b,c,a,g)];case 1:return d.sent(),this._callbackManager.trigger("_attached",b),[2]}})})};b.prototype.attachScsBuffer=function(b,c,a,g,d,e){return __awaiter(this,void 0,void 0,
function(){return __generator(this,function(k){switch(k.label){case 0:return[4,this._sc.attachScsBuffer(b,c,a,g,d,e)];case 1:return k.sent(),this._callbackManager.trigger("_attached",b),[2]}})})};b.prototype._parseKeyInfo=function(b,c,a){if(b||c)return a;b=new Map;for(c=0;c<a.length;++c){for(var g=a[c++],d=[];c<a.length&&4294967295!==a[c];++c)d.push(a[c]);b.set(g,d)}return b};b.prototype.instanceKeyInfo=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var g,d,e;return __generator(this,
function(k){switch(k.label){case 0:return g=1===c,d=1===a,[4,this._sc.meshInstanceKeyInfo(b,g,d)];case 1:return e=k.sent(),[2,this._parseKeyInfo(g,d,e)]}})})};b.prototype.metaDataKeyInfo=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(d){switch(d.label){case 0:return[4,this._sc.metaDataKeyInfo(b,c,a)];case 1:return g=d.sent(),[2,this._parseKeyInfo(c,a,g)]}})})};b.prototype.modelKeysFromInclusionKeys=function(b){return this._sc.modelKeysFromInclusionKeys(b)};
b.prototype.detachInclusions=function(b){return this._sc.detachInclusions(b)};b.prototype.resetToEmpty=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,g,d,e;return __generator(this,function(k){switch(k.label){case 0:for(a=0;a<this._requestBatchCountByType.length;++a){g=this._requestBatchCountByType[a]=0;for(d=this._pendingRequestsByType[a];g<d.length;g++)e=d[g],e.promise.reject(e.ids);this._pendingRequestsByType[a].length=0}return[4,this._sc.resetToEmpty(b,c)];case 1:return k.sent(),
this.flushMetaDataCache(),[2]}})})};b.prototype.redraw=function(){this._sc.queueRedraw()};b.prototype.disconnectNetwork=function(){this._sc.disconnectNetwork()};b.prototype.shutdown=function(){null!==this._cappingDelayTimeoutId&&(clearTimeout(this._cappingDelayTimeoutId),this._cappingDelayTimeoutId=null);this._sessionType=0;this._sc.shutDown()};b.prototype.getVersionString=function(){return this._sc.getStreamVersion().toString()};b.prototype.setAllowHighDpi=function(b){this._sc.allowHighDpi=b;this.resize()};
b.prototype.getAllowHighDpi=function(){return this._sc.allowHighDpi};b.prototype.setMeshLevel=function(b,c){this._sc.MeshInstance.setMeshLevel(b,c)};b.prototype.setOverlayVisibility=function(b,c){this._sc.Overlay.setVisible(b,c)};b.prototype.setOverlayCamera=function(b,c){c=this._toCamera(c);this._sc.Overlay.setCamera(b,c)};b.prototype.destroyOverlay=function(b){this._sc.Overlay.destroy(b)};b.prototype._overlayUnit=function(b){switch(b){case d.OverlayUnit.ProportionOfCanvas:return 1;case d.OverlayUnit.ProportionOfOtherDimension:return 2;
default:return 0}};b.prototype.getMaxOverlayIndex=function(){return this._sc.Overlay.maxIndex()};b.prototype._overlayAnchor=function(b){switch(b){case d.OverlayAnchor.BottomCenter:return 7;case d.OverlayAnchor.Center:return 8;case d.OverlayAnchor.LeftCenter:return 5;case d.OverlayAnchor.LowerLeftCorner:return 1;case d.OverlayAnchor.LowerRightCorner:return 2;case d.OverlayAnchor.RightCenter:return 6;case d.OverlayAnchor.TopCenter:return 4;case d.OverlayAnchor.UpperRightCorner:return 3;default:return 0}};
b.prototype.setOverlayViewport=function(b,c,a,g,d,e,f,h,t,v){this._sc.Overlay.setViewport(b,this._overlayAnchor(c),a,this._overlayUnit(g),d,this._overlayUnit(e),f,this._overlayUnit(h),t,this._overlayUnit(v))};b.prototype.addNodesToOverlay=function(b,c){this._sc.MeshInstance.setOverlayIndex(b,c)};b.prototype.getInstancesMeshData=function(b){return this._sc.MeshInstance.getMeshData(b)};b.prototype.getMeshData=function(b){return this._sc.MeshData.getData(b)};b.prototype._toElementType=function(b){switch(b){case d.ElementType.Faces:return 0;
case d.ElementType.Lines:return 1;case d.ElementType.Points:return 2}};b.prototype._toXRayGroup=function(b){switch(b){case d.XRayGroup.Selected:return 0;case d.XRayGroup.Unselected:return 1}};b.prototype.setXRayColor=function(b,c,a){var g=this._xRayMaterials[b][c];if(g.color&&g.color.equals(a))return Promise.resolve();g.color=a;this.setDiffuseColor(g.id,this._toRgba(a,1));return this._sc.setXRayMaterial(this._toXRayGroup(b),this._toElementType(c),g.id)};b.prototype.unsetXRayColor=function(b,c){if(!this._xRayMaterials[b][c].color)return Promise.resolve();
this._xRayMaterials[b][c].color=null;return this._sc.unsetXRayMaterial(this._toXRayGroup(b),this._toElementType(c))};b.prototype.setXRayOpacity=function(b,c){void 0!==c?this._sc.setXRayOpacity(this._toElementType(c),b):(this._sc.setXRayOpacity(0,b),this._sc.setXRayOpacity(1,b),this._sc.setXRayOpacity(2,b))};b.prototype._xRayTransparencyMode=function(b){switch(b){case d.XRayTransparencyMode.Unsorted:return 0;case d.XRayTransparencyMode.SingleLayer:return 1}};b.prototype.setXRayTransparencyMode=function(b){this._sc.setXRayTransparencyMode(this._xRayTransparencyMode(b))};
b.prototype._toPointSizeUnit=function(b){switch(b){case d.PointSizeUnit.ScreenPixels:return 0;case d.PointSizeUnit.CSSPixels:return 1;case d.PointSizeUnit.World:return 2;case d.PointSizeUnit.ProportionOfScreenWidth:return 3;case d.PointSizeUnit.ProportionOfScreenHeight:return 4;case d.PointSizeUnit.ProportionOfBoundingDiagonal:return 5}};b.prototype._toPointShape=function(b){switch(b){case d.PointShape.Square:return 0;case d.PointShape.Disk:return 1;case d.PointShape.Sphere:return 2}};b.prototype._fromPointSizeUnit=
function(b){switch(b){default:case 0:return d.PointSizeUnit.ScreenPixels;case 1:return d.PointSizeUnit.CSSPixels;case 2:return d.PointSizeUnit.World;case 3:return d.PointSizeUnit.ProportionOfScreenWidth;case 4:return d.PointSizeUnit.ProportionOfScreenHeight;case 5:return d.PointSizeUnit.ProportionOfBoundingDiagonal}};b.prototype._fromPointShape=function(b){switch(b){default:case 0:return d.PointShape.Square;case 1:return d.PointShape.Disk;case 2:return d.PointShape.Sphere}};b.prototype.setPointSize=
function(b,c){this._sc.setPointSize(b,this._toPointSizeUnit(c))};b.prototype.getPointSize=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,Promise.all([this._sc.getPointSize(),this._sc.getPointSizeUnit()])];case 1:return b=c.sent(),[2,[b[0],this._fromPointSizeUnit(b[1])]]}})})};b.prototype.setPointShape=function(b){this._sc.setPointShape(this._toPointShape(b))};b.prototype.getPointShape=function(){return __awaiter(this,
void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return b=this._fromPointShape,[4,this._sc.getPointShape()];case 1:return[2,b.apply(this,[c.sent()])]}})})};b.prototype.setEyeDomeLightingEnabled=function(b){this._sc.setEyeDomeLightingEnabled(b)};b.prototype.getEyeDomeLightingEnabled=function(){return this._sc.getEyeDomeLightingEnabled()};b.prototype.setEyeDomeLightingBlurSamples=function(b){this._sc.setEyeDomeLightingBlurSamples(b)};b.prototype.getEyeDomeLightingBlurSamples=
function(){return this._sc.getEyeDomeLightingBlurSamples()};b.prototype.setEyeDomeLightingBlurInterval=function(b){this._sc.setEyeDomeLightingBlurInterval(b)};b.prototype.getEyeDomeLightingBlurInterval=function(){return this._sc.getEyeDomeLightingBlurInterval()};b.prototype.setEyeDomeLightingBlurEdgeDistance=function(b){this._sc.setEyeDomeLightingBlurEdgeDistance(b)};b.prototype.getEyeDomeLightingBlurEdgeDistance=function(){return this._sc.getEyeDomeLightingBlurEdgeDistance()};b.prototype.setEyeDomeLightingShadingEdgeDistance=
function(b){this._sc.setEyeDomeLightingShadingEdgeDistance(b)};b.prototype.getEyeDomeLightingShadingEdgeDistance=function(){return this._sc.getEyeDomeLightingShadingEdgeDistance()};b.prototype.setEyeDomeLightingOpacity=function(b){this._sc.setEyeDomeLightingOpacity(b)};b.prototype.getEyeDomeLightingOpacity=function(){return this._sc.getEyeDomeLightingOpacity()};b.prototype.setDisplayIncompleteFrames=function(b){this._sc.setDisplayIncompleteFrames(b)};b.prototype.setInteractiveDrawDelay=function(b){this._sc.setPostInputDelay(b)};
b.prototype._toCullingVectorSpace=function(b){switch(b){case d.CullingVectorSpace.Object:return 0;case d.CullingVectorSpace.World:return 1}};b.prototype._fromCullingVectorSpace=function(b){switch(b){default:case 0:return d.CullingVectorSpace.Object;case 1:return d.CullingVectorSpace.World}};b.prototype.setCullingVector=function(b,c,a,g){this._sc.MeshInstance.setCullingVector(b,this._toCullingVectorSpace(c),[a.x,a.y,a.z],g)};b.prototype.unsetCullingVector=function(b){this._sc.MeshInstance.unsetCullingVector(b)};
b.prototype.getCullingVector=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,g,e,k;return __generator(this,function(l){switch(l.label){case 0:return[4,this._sc.MeshInstance.getCullingVector(b)];case 1:c=l.sent();a=[];g=0;for(e=c;g<e.length;g++)k=e[g],0===k.vector[0]&&0===k.vector[1]&&0===k.vector[2]?a.push(null):a.push({space:this._fromCullingVectorSpace(k.space),vector:d.Point3.createFromArray(k.vector),toleranceDegrees:k.toleranceDegrees});return[2,a]}})})};b.prototype._setStreamCutoffScale=
function(b){this._streamCutoffScale=Math.max(0,Math.min(b,2))};b.prototype.setStreamCutoffScale=function(b){this._setStreamCutoffScale(b);this._sc.setStreamCutoffScale(this._streamCutoffScale)};b.prototype.getStreamCutoffScale=function(){return this._streamCutoffScale};b.prototype.loseWebGlContext=function(){return this._sc._loseWebGlContext()};b.prototype.triangulatePolygon=function(b,c){b=this._sc.triangulatePolygon(b,c);return new Float32Array(b)};b.prototype.debug_log=function(b){return this._sc.debug_log(b)};
b.prototype.debug_stateFailure=function(b){return this._sc.debug_stateFailure(b)};b.prototype.debug_sync=function(){return this._sc.debug_sync()};b.prototype._toLinePatternLengthUnit=function(b){switch(b){case d.LinePatternLengthUnit.Object:return 0;case d.LinePatternLengthUnit.World:return 1;case d.LinePatternLengthUnit.ProportionOfScreenWidth:return 2;case d.LinePatternLengthUnit.ProportionOfScreenHeight:return 3}};b.prototype.setLinePattern=function(b,c,a,g){this._sc.MeshInstance.setLinePattern(b,
c,a,this._toLinePatternLengthUnit(g))};b.prototype.unsetLinePattern=function(b){this._sc.MeshInstance.unsetLinePattern(b)};b.prototype.exportToSvg=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(g){switch(g.label){case 0:return[4,this._sc.exportToSvg(b)];case 1:return c=g.sent(),a=c.map(function(b){return String.fromCharCode(b)}),[2,a.join("")]}})})};b.prototype.waitForImageDecoding=function(){return this._sc.waitForImageDecoding()};b.prototype.registerBimInstances=
function(b,c){return this._sc.registerBimInstances(b,c)};b.prototype.setAmbientLightColor=function(b){this._sc.setAmbientLightColor(this._toRgb(b))};b.prototype.clearLights=function(){this._sc.clearLights()};b.prototype._toLightType=function(b){switch(b){default:case d.LightType.Directional:return 0}};b.prototype._toLightSpace=function(b){switch(b){case d.LightSpace.World:return 0;default:case d.LightSpace.Camera:return 1}};b.prototype.addLight=function(b){this._sc.addLight(this._toLightType(b.type),
this._toLightSpace(b.space),this._toVector3(b.position),this._toRgb(b.color))};b.prototype.setBloomEnabled=function(b){this._sc.setBloomEnabled(b)};b.prototype.setBloomThreshold=function(b){this._sc.setBloomThreshold(b)};b.prototype.setBloomThresholdRampWidth=function(b){this._sc.setBloomThresholdRampWidth(b)};b.prototype.setBloomIntensityScale=function(b){this._sc.setBloomIntensityScale(b)};b.prototype._toBlurIntervalUnit=function(b){switch(b){default:case d.BlurIntervalUnit.Pixels:return 0;case d.BlurIntervalUnit.ProportionOfWidth:return 1;
case d.BlurIntervalUnit.ProportionOfHeight:return 2}};b.prototype.setBloomLayers=function(b){for(var c=0;c<b.length;c++){var a=b[c];if(void 0!==a.blurInterval&&2!==a.blurInterval.length)throw new d.CommunicatorError("'blurInterval' must be an array containing a number followed by a BlurIntervalUnit");}this._sc.suspendDrawing();this._sc.setBloomLayerCount(b.length);for(c=0;c<b.length;++c)a=b[c],void 0!==a.intensity&&this._sc.setBloomIntensity(c,a.intensity),void 0!==a.blurSamples&&this._sc.setBloomBlurSamples(c,
a.blurSamples),void 0!==a.blurInterval&&this._sc.setBloomBlurInterval(c,a.blurInterval[0],this._toBlurIntervalUnit(a.blurInterval[1]));this._sc.resumeDrawing()};b.prototype.startComparison=function(b,c,a){var g=a&&a.sameColor?this._toRgb(a.sameColor):[0,0,0],d=a&&a.only1Color?this._toRgb(a.only1Color):[1,0,0];a=a&&a.only2Color?this._toRgb(a.only2Color):[0,1,0];this._sc.setComparisonColors(g,d,a);this._sc.startComparison(b,c)};b.prototype.endComparison=function(){this._sc.endComparison()};b.prototype.setSimpleShadowColor=
function(b){this._sc.setSimpleShadowColor(this._toRgb(b))};b.prototype.setSimpleShadowEnabled=function(b){this._sc.setSimpleShadowEnabled(b)};b.prototype.setSimpleShadowOpacity=function(b){this._sc.setSimpleShadowOpacity(b)};b.prototype.setGroundPlane=function(b,c){void 0!==c?this._sc.setGroundPlaneWithPosition(this._toVector3(b),this._toVector3(c)):this._sc.setGroundPlane(this._toVector3(b))};b.prototype.setSimpleShadowResolution=function(b){this._sc.setSimpleShadowResolution(b)};b.prototype.setSimpleShadowBlurSamples=
function(b){this._sc.setSimpleShadowBlurSamples(b)};b.prototype.setSimpleShadowBlurInterval=function(b){this._sc.setSimpleShadowBlurInterval(b)};b.prototype.setSimpleShadowInteractiveUpdateEnabled=function(b){void 0===b&&(b=!0);this._sc.setSimpleShadowInteractiveUpdateEnabled(b)};b.prototype.setSilhouetteColor=function(b){this._sc.setSilhouetteColor(this._toRgb(b))};b.prototype.setSilhouetteEnabled=function(b){void 0===b&&(b=!0);this._sc.setSilhouetteEnabled(b)};b.prototype.setSilhouetteOpacity=function(b){this._sc.setSilhouetteOpacity(b)};
b.prototype.setSilhouetteThreshold=function(b){this._sc.setSilhouetteThreshold(b)};b.prototype.setSilhouetteThresholdRampWidth=function(b){this._sc.setSilhouetteThresholdRampWidth(b)};b.prototype.setSimpleReflectionEnabled=function(b){void 0===b&&(b=!0);this._sc.setSimpleReflectionEnabled(b)};b.prototype.setSimpleReflectionBlurInterval=function(b,c){this._sc.setSimpleReflectionBlurInterval(b,this._toBlurIntervalUnit(c))};b.prototype.setSimpleReflectionBlurSamples=function(b){this._sc.setSimpleReflectionBlurSamples(b)};
b.prototype.setSimpleReflectionFadeAngle=function(b){this._sc.setSimpleReflectionFadeAngle(b)};b.prototype.setSimpleReflectionOpacity=function(b){this._sc.setSimpleReflectionOpacity(b)};b.prototype.setSimpleReflectionAttenuation=function(b,c,a){void 0===a&&(a=d.SimpleReflectionAttenuationUnit.World);this._sc.setSimpleReflectionAttenuation(b,c,a)};b.prototype.throttleLoad=function(b,c){this._sc.throttleLoad(b,c)};b.prototype._toVector3Array=function(b){for(var c=[],a=0;a<b.length;a++){var g=b[a];c.push([g.x,
g.y,g.z])}return c};b.prototype.testPointVisibility=function(b){return this._sc.testPointVisibility(this._toVector3Array(b))};b.prototype.setPointVisibilityTest=function(b){this._sc.setPointVisibilityTest(this._toVector3Array(b))};return b}();h.ScEngine=b})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function b(b,c,a,d,e,f,h){this._position=b.copy();this._normal=c.copy();this._elementIndex=a;this._elementBits=e;this._bounding=f.copy();this._overlayIndex=d;this._isProximityFace=h}b.prototype.isProximityFace=function(){return this._isProximityFace};b.prototype.isCappingGeometry=function(){return-1===this._elementIndex};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=function(){return{position:this._position.toJson(),normal:this._normal.toJson(),
cadFaceIndex:this._elementIndex,cadFaceBits:this._elementBits,bounding:this._bounding.toJson(),overlayIndex:this._overlayIndex,isProximityFace:this._isProximityFace}};b.prototype.forJson=function(){return this.toJson()};b.fromJson=function(c){var a=d.Point3.fromJson(c.position),g=d.Point3.fromJson(c.normal),e=d.Box.fromJson(c.bounding);return new b(a,g,c.cadFaceIndex,c.overlayIndex,c.cadFaceBits,e,!0===c.isProximityFace)};b.construct=function(c){return b.fromJson(c)};b.prototype.getPosition=function(){return this._position.copy()};
b.prototype.getNormal=function(){return this._normal.copy()};b.prototype.getCadFaceIndex=function(){return this._elementIndex};b.prototype.getCadFaceBits=function(){return this._elementBits};b.prototype.getBounding=function(){return this._bounding.copy()};b.prototype.overlayIndex=function(){return this._overlayIndex};return b}();h.FaceEntity=f;var a=function(){function b(b,c,a,e,f,p,h){this._lineSegmentVertices=[];this._elementIndex=b;this._elementBits=h;this._position=c.copy();this._bounding=f.copy();
this._overlayIndex=p;if(a)for(0<=e&&(b=3*e,this._bestLineSegmentVertexIndex=new d.Point3(a[b],a[b+1],a[b+2])),this._lineSegmentVertices.push(new d.Point3(a[0],a[1],a[2])),b=3;b<a.length;b+=6)this._lineSegmentVertices.push(new d.Point3(a[b],a[b+1],a[b+2]))}b.prototype.isCappingGeometry=function(){return-1===this._elementIndex};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=function(){for(var b=[],c=0,a=this._lineSegmentVertices;c<a.length;c++)b.push(a[c].toJson());return{lineId:this._elementIndex,
lineBits:this._elementBits,position:this._position.toJson(),linePoints:b,bounding:this._bounding.copy(),overlayIndex:this._overlayIndex}};b.prototype.forJson=function(){return this.toJson()};b.fromJson=function(c){var a=d.Point3.fromJson(c.position),g=d.Box.fromJson(c.bounding);a=new b(c.lineId,a,null,-1,g,c.overlayIndex,0);g=0;for(c=c.linePoints;g<c.length;g++){var e=d.Point3.fromJson(c[g]);a._lineSegmentVertices.push(e)}return a};b.construct=function(c){return b.fromJson(c)};b.prototype.getLineId=
function(){return this._elementIndex};b.prototype.getPosition=function(){return this._position.copy()};b.prototype.getPoints=function(){return this._lineSegmentVertices};b.prototype.getBestVertex=function(){return this._bestLineSegmentVertexIndex?this._bestLineSegmentVertexIndex.copy():null};b.prototype.getLineBits=function(){return this._elementBits};b.prototype.getBounding=function(){return this._bounding.copy()};b.prototype.overlayIndex=function(){return this._overlayIndex};return b}();h.LineEntity=
a;var e=function(){function b(b,c,a,d){this._position=b.copy();this._elementIndex=c;this._overlayIndex=a;this._elementBits=d}b.fromJson=function(c){var a=d.Point3.fromJson(c.position);return new b(a,c.pointId,c.pointBits,c.overlayIndex)};b.construct=function(c){return b.fromJson(c)};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=function(){return{pointId:this._elementIndex,pointBits:this._elementBits,position:this._position.toJson(),overlayIndex:this._overlayIndex}};b.prototype.forJson=
function(){return this.toJson()};b.prototype.getPosition=function(){return this._position.copy()};b.prototype.getPointBits=function(){return this._elementBits};b.prototype.getPointId=function(){return this._elementIndex};b.prototype.overlayIndex=function(){return this._overlayIndex};return b}();h.PointEntity=e;var c=function(){return function(b){this._handle=b}}();h.IncrementalSelectionId=c;c=function(){function b(b,c,a,d,e){void 0===b&&(b=null);void 0===c&&(c=null);void 0===a&&(a=null);void 0===
d&&(d=null);void 0===e&&(e=null);this._nodeId=b;this._inclusionKey=c;this._faceEntity=a;this._lineEntity=d;this._pointEntity=e}b.create=function(c,a,d,e,f){return new b(c,a,d,e,f)};b.prototype.getSelectionType=function(){return null===this._nodeId?d.SelectionType.None:null!==this._faceEntity?d.SelectionType.Face:null!==this._lineEntity?d.SelectionType.Line:null!==this._pointEntity?d.SelectionType.Point:d.SelectionType.Part};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=
function(){return{nodeId:this._nodeId,includeId:this._inclusionKey,faceEntity:this._faceEntity?this._faceEntity.toJson():null,lineEntity:this._lineEntity?this._lineEntity.toJson():null,pointEntity:this._pointEntity?this._pointEntity.toJson():null}};b.prototype.forJson=function(){return this.toJson()};b._fromJson=function(c){return new b(c.nodeId,c.includeId,c.faceEntity?f.fromJson(c.faceEntity):null,c.lineEntity?a.fromJson(c.lineEntity):null,c.pointEntity?e.fromJson(c.pointEntity):null)};b.prototype.getFaceEntity=
function(){return this._faceEntity};b.prototype.getLineEntity=function(){return this._lineEntity};b.prototype.getPointEntity=function(){return this._pointEntity};b.prototype.getNodeId=function(){return this._nodeId};b.prototype.getInclusionKey=function(){return this._inclusionKey};b.prototype.getIncludeId=function(){return this.getInclusionKey()};b.prototype.getPosition=function(){return null!==this._faceEntity?this._faceEntity.getPosition():null!==this._lineEntity?this._lineEntity.getPosition():
null!==this._pointEntity?this._pointEntity.getPosition():null};b.prototype.overlayIndex=function(){return this._faceEntity?this._faceEntity.overlayIndex():this._lineEntity?this._lineEntity.overlayIndex():this._pointEntity?this._pointEntity.overlayIndex():null};b.prototype._setNodeId=function(b){this._nodeId=b};b.prototype.equals=function(b){return this._nodeId!==b._nodeId||this.getSelectionType()!==b.getSelectionType()?!1:this._faceEntity&&b._faceEntity?this._faceEntity.getCadFaceIndex()===b._faceEntity.getCadFaceIndex():
this._lineEntity&&b._lineEntity?this._lineEntity.getLineId()===b._lineEntity.getLineId():this._pointEntity&&b._pointEntity?this._pointEntity.getPointId()===b._pointEntity.getPointId():!0};b.prototype._hash=function(){var b=null!==this._nodeId?this._nodeId.toString(36):"";b+=";"+this.getSelectionType()+";";this._faceEntity&&(b+=this._faceEntity.getCadFaceIndex().toString(36));b+=";";this._lineEntity&&(b+=this._lineEntity.getLineId().toString(36));b+=";";this._pointEntity&&(b+=this._pointEntity.getPointId().toString(36));
return b};b.prototype.isEntitySelection=function(){return null!==this._faceEntity||null!==this._lineEntity||null!==this._pointEntity};b.prototype.isNodeSelection=function(){return null!==this._nodeId};b.prototype.isNodeEntitySelection=function(){return null!==this._nodeId&&this.isEntitySelection()};b.prototype.isFaceSelection=function(){return null!==this._nodeId&&null!==this._faceEntity};b.prototype.isLineSelection=function(){return null!==this._nodeId&&null!==this._lineEntity};b.prototype.isPointSelection=
function(){return null!==this._nodeId&&null!==this._pointEntity};return b}();h.SelectionItem=c;c=function(){function b(b,c,a){this.faceItem=b;this.lineItem=c;this.pointItem=a}b.prototype.fetchMostRelevant=function(b){return null!==this.pointItem&&0!==(b&d.SelectionMask.Point)?this.pointItem:null!==this.lineItem&&0!==(b&d.SelectionMask.Line)?this.lineItem:null!==this.faceItem&&0!==(b&d.SelectionMask.Face)?this.faceItem:null};return b}();h.CompositeSelectionItem=c})(d.Selection||(d.Selection={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){function f(a,e,c){var b=d.Point2.subtract(c,e),g=b.length();b.scale(((a.x-e.x)*(c.x-e.x)+(a.y-e.y)*(c.y-e.y))/(g*g));return d.Point2.add(e,b)}h.hasBits=function(a,d){return(a&d)===d};h.setBit=function(a,d,c){return c?a|d:a&~d};h.sleep=function(a){return new Promise(function(d){setTimeout(d,a)})};h.classFromString=function(a){a=a.split(".");for(var d=window||this,c=0;c<a.length;c++){if(void 0===d)return null;d=d[a[c]]}return"function"!==typeof d?null:d};h.pointInRect=function(a,
d,c,b){void 0===b&&(b=0);return a.x+b<d.x||a.x>d.x+c.x+b||a.y+b<d.y||a.y>d.y+c.y+b?!1:!0};h.closestPointOnLine2d=f;h.pointOnLineSegment2d=function(a,e,c,b){var g=f(a,e,c);return d.Point2.distance(a,g)<=b?g.x<Math.min(e.x,c.x)||g.x>Math.max(e.x,c.x)||g.y<Math.min(e.y,c.y)||g.y>Math.max(e.y,c.y)?!1:!0:!1};h.projectOnto=function(a,e){a=d.Point3.dot(e,a);var c=e.squaredLength();return d.Point3.scale(e,a/c)};h.majorAxis=function(a){var e=Math.abs(a.x),c=Math.abs(a.y);a=Math.abs(a.z);e=+e.toFixed(6);c=
+c.toFixed(6);a=+a.toFixed(6);return e>c&&e>a?new d.Point3(1,0,0):c>e&&c>a?new d.Point3(0,1,0):a>e&&a>c?new d.Point3(0,0,1):null};h.deepClone=function(a){return JSON.parse(JSON.stringify(a))};h.getWithDefault=function(a,d){return void 0===a?d:a};h.versionAtLeast=function(a,d){for(var c=a.length>d.length?a.length:d.length,b=0;b<c;++b){var g=a[b]||0,e=d[b]||0;if(g>e)break;else if(g<e)return!1}return!0}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){return function(a){this.futureItemHash=null;this.pastItemHash=a}}(),f=function(){function a(){this.part=this.point=this.line=this.face=this.none=0}a.prototype.update=function(c,b){switch(c.getSelectionType()){case d.SelectionType.None:0===b?--this.none:++this.none;break;case d.SelectionType.Face:0===b?--this.face:++this.face;break;case d.SelectionType.Line:0===b?--this.line:++this.line;break;case d.SelectionType.Point:0===b?--this.point:++this.point;break;case d.SelectionType.Part:0===
b?--this.part:++this.part}};a.prototype.sum=function(){return this.none+this.face+this.line+this.point+this.part};return a}(),a=function(){function a(c,b,a,e,l){var g=this;this._selectedItemsPruned=new Map;this._selectedItemsFull=new Map;this._selectedNodeCounts=new Map;this._temporalLinks=new Map;this._newestItemHash=this._oldestItemHash=null;this._selectedLayers=new Set;this._selectedTypes=new Set;this._nodeSelectionColor=new d.Color(255,255,0);this._nodeSelectionOutlineColor=new d.Color(255,255,
0);this._elementSelectionColor=d.Color.red();this._elementSelectionOutlineColor=d.Color.red();this._nodeElementHighlightMode=this._nodeHighlightMode=d.SelectionHighlightMode.HighlightAndOutline;this._pruneSelectionDescendants=this._selectParentIfSelected=this._highlightPointElementSelection=this._highlightLineElementSelection=this._highlightFaceElementSelection=this._highlightNodeSelection=!0;this._selectionFilter=null;this._incrementalBlacklistedInstanceNodes=new Set;this._engine=b;this._view=a;
this._model=e;this._modelStructure=l;this._callbackManager=c;this._callbackManager.bind({_subtreeLoaded:function(b){for(var c=0;c<b.length;c++)g._onSubtreeLoaded(b[c]);return Promise.resolve()}})}a.deprecated=function(c,b,a){var g=a.value;a.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","SelectionManager",b);return g.apply(this,c)};return a};a.prototype._init=function(){this._updateHighlightingMode();this._engine.setHighlightColorizeCompression(.7)};
a.prototype.setSelectionFilter=function(c){this._selectionFilter=c};a.prototype.setPruneSelectionDescendants=function(c){this._pruneSelectionDescendants=c;this.clear()};a.prototype.getPruneSelectionDescendants=function(){return this._pruneSelectionDescendants};a.prototype.setSelectParentIfSelected=function(c){this._selectParentIfSelected=c};a.prototype.getSelectParentIfSelected=function(){return this._selectParentIfSelected};a.prototype.selectFromPoint=function(c,b,a){void 0===a&&(a=d.SelectionMode.Set);
return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickFromPoint(c,b)];case 1:return g=d.sent(),this._onSelectionItem(g,a),[2]}})})};a.prototype.selectAllFromPoint=function(c,b,a){void 0===a&&(a=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickAllFromPoint(c,b)];case 1:return g=d.sent(),this._onSelectionItems(g,
a),[2]}})})};a.prototype.selectFromRay=function(c,b,a){void 0===a&&(a=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickFromRay(c,b)];case 1:return g=d.sent(),this._onSelectionItem(g,a),[2]}})})};a.prototype.selectAllFromRay=function(c,b,a){void 0===a&&(a=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(d){switch(d.label){case 0:return[4,
this._view.pickAllFromRay(c,b)];case 1:return g=d.sent(),this._onSelectionItems(g,a),[2]}})})};a.prototype._onSelectionItem=function(c,b){c.isNodeEntitySelection()?this._processSelection(c,b):this._triggerNullSelection()};a.prototype._onSelectionItems=function(c,b){b===d.SelectionMode.Set&&this.clear(!1);if(0===c.length)this._triggerNullSelection();else switch(b){case d.SelectionMode.Add:case d.SelectionMode.Set:this.add(c);break;case d.SelectionMode.Toggle:for(b=0;b<c.length;b++)this.toggle(c[b]);
break;default:d.Util.TypeAssertNever(b)}};a.prototype.beginScreenSelectByArea=function(c,b,a){return this._view.beginScreenSelectByArea(c,b,a)};a.prototype.beginRayDrillSelection=function(c,b,a){return this._view.beginRayDrillSelection(c,b,a)};a.prototype.beginConvexPolyhedronSelection=function(c,b,a){return this._view.beginConvexPolyhedronSelection(c,b,a)};a.prototype.beginSphereSelection=function(c,b,a){return this._view.beginSphereSelection(c,b,a)};a.prototype.endIncrementalSelection=function(c){this._callbackManager.trigger("incrementalSelectionEnd");
this._view.endIncrementalSelection(c);return Promise.resolve()};a.prototype.endVolumeSelection=function(c){return this.endIncrementalSelection(c)};a.prototype.advanceIncrementalSelection=function(c,b){void 0===b&&(b=null);return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(g){switch(g.label){case 0:return[4,this._view.advanceIncrementalSelection(c)];case 1:return a=g.sent(),null===a?[2,!1]:null===b?[3,3]:[4,Promise.all(a.map(b))];case 2:d=g.sent(),a=a.filter(function(b,
c){return d[c]}),g.label=3;case 3:return this.add(a),[2,!0]}})})};a.prototype.advanceVolumeSelection=function(c,b){void 0===b&&(b=null);return this.advanceIncrementalSelection(c,b)};a.prototype.isSelected=function(c){return this.contains(c)?!0:c.isNodeSelection()?null!==this._findAncestor(c):!1};a.prototype.contains=function(c){return this._selectedItemsPruned.has(c._hash())};a.prototype.containsParent=function(c){return this._findAncestor(c)};a.prototype._findAncestor=function(c){if(0<this._selectedItemsPruned.size)for(;;){c=
this._model.getNodeParent(c.getNodeId());if(null===c)break;c=d.Selection.SelectionItem.create(c);var b=c._hash();if(this._selectedItemsPruned.has(b))return c}return null};a.prototype.selectLayer=function(c,b){b===d.SelectionMode.Set&&this.clear();var a=[],e=this._model.getLayerIdsFromName(c);if(null!==e)for(var l=0;l<e.length;l++){var f=this._model.getNodesFromLayer(e[l],!0);if(null!==f)for(var m=0;m<f.length;m++)a.push(d.Selection.SelectionItem.create(f[m]))}e=this._selectedLayers.has(c);b===d.SelectionMode.Toggle&&
e?this.remove(a):(this.add(a),this._selectedLayers.add(c))};a.prototype.getSelectedLayers=function(){var c=[];this._selectedLayers.forEach(function(b){c.push(b)});return c};a.prototype.selectType=function(c,b){b===d.SelectionMode.Set&&this.clear();var a=[],e=this._model.getNodesByGenericType(c);null!==e&&e.forEach(function(b){a.push(d.Selection.SelectionItem.create(b))});e=this._selectedTypes.has(c);if(b===d.SelectionMode.Toggle&&e)for(c=0;c<a.length;c++)this.remove(a[c]);else this.add(a),this._selectedTypes.add(c)};
a.prototype.getSelectedTypes=function(){var c=[];this._selectedTypes.forEach(function(b){c.push(b)});return c};a.prototype.selectNode=function(c,b){void 0===b&&(b=d.SelectionMode.Set);if(null!==c&&this._modelStructure.isIdValid(c))return c=d.Selection.SelectionItem.create(c),this._processSelection(c,b),c.getSelectionType();this._processSelection(null,b);return d.SelectionType.None};a.prototype._triggerNullSelection=function(){this._callbackManager.trigger("selectionArray",[],!1)};a.prototype._isInAxisOverlay=
function(c){var b=c.getFaceEntity();return b||(b=c.getLineEntity())?1===b.overlayIndex():(c=c.getPointEntity())?1===c.overlayIndex():!1};a.prototype._getNodeCounts=function(c){c=c.getNodeId();var b=this._selectedNodeCounts.get(c);b||(b=new f,this._selectedNodeCounts.set(c,b));return b};a.prototype._addToFull=function(c,b){for(;this._selectedItemsFull.set(b,c);){c=this._model.getNodeParent(c.getNodeId());if(null===c)break;c=d.Selection.SelectionItem.create(c);b=c._hash()}};a.prototype._addItems=function(c){var b=
c.length;if(0!==b){this._callbackManager.trigger("incrementalSelectionBatchBegin");for(var a=[],e=0;e<b;++e){var l=this._filterItem(c[e]);null!==l&&this._addImpl(l,l._hash())&&(l=new d.Event.NodeSelectionEvent(l),a.push(l))}0===a.length?this._triggerNullSelection():this._callbackManager.trigger("selectionArray",a,!1);this._callbackManager.trigger("incrementalSelectionBatchEnd")}};a.prototype._addItem=function(c){c=this._filterItem(c);null!==c&&this._addImpl(c,c._hash())?(c=new d.Event.NodeSelectionEvent(c),
this._callbackManager.trigger("selectionArray",[c],!1)):this._triggerNullSelection()};a.prototype.add=function(c){null===c?this._triggerNullSelection():Array.isArray(c)?this._addItems(c):this._addItem(c)};a.prototype._filterItem=function(c){return null!==this._selectionFilter?(c=this._selectionFilter(c.getNodeId(),this._model),null===c?null:d.Selection.SelectionItem.create(c)):c};a.prototype._addImpl=function(c,b){if(c.getSelectionType()===d.SelectionType.None)return!1;if(this._isInAxisOverlay(c))return!0;
if(this._selectedItemsPruned.has(b))return!1;if(this._pruneSelectionDescendants){if(null!==this._findAncestor(c))return!1;this._removeDescendants(c)}this._selectedItemsPruned.set(b,c);this._addToFull(c,b);this._getNodeCounts(c).update(c,1);var a=this._newestItemHash;this._newestItemHash=b;this._oldestItemHash||(this._oldestItemHash=b);if(null!==a){var e=this._temporalLinks.get(a);e&&(e.futureItemHash=b)}a=new h(a);this._temporalLinks.set(b,a);this._updateItemHighlight(c,!0,!0);if(this._modelStructure.getType(c.getNodeId())===
d.NodeType.Pmi&&(c=this._modelStructure.getPmiTopologyReferences(c.getNodeId()),null!==c))for(b=0;b<c.length;b++){e=c[b];a=e.body.getRuntimeId();for(var l=0,f=e.faceIds;l<f.length;l++)this._model.setNodeFaceHighlighted(a,f[l],!0);l=0;for(e=e.edgeIds;l<e.length;l++)this._model.setNodeLineHighlighted(a,e[l],!0)}return!0};a.prototype._removeUpdateLayers=function(c){0<this._selectedLayers.size&&(c=c.getNodeId(),null!==c&&(c=this._model.getNodeLayerId(c),null!==c&&(c=this._model.getLayerName(c),null!==
c&&this._selectedLayers.delete(c))))};a.prototype._removeUpdateTypes=function(c){0<this._selectedTypes.size&&(c=c.getNodeId(),null!==c&&(c=this._model.getNodeGenericType(c),null!==c&&this._selectedTypes.delete(c)))};a.prototype._removeFromFull=function(c,b){this._removeUpdateLayers(c);this._removeUpdateTypes(c);if(this._selectedItemsFull.delete(b))for(b=0,c=this._model.getNodeChildren(c.getNodeId());b<c.length;b++){var a=d.Selection.SelectionItem.create(c[b]);this._removeFromFull(a,a._hash())}};a.prototype._removeItems=
function(c){var b=this,a=[];c.forEach(function(c){b._removeImpl(c,c._hash())&&a.push(new d.Event.NodeSelectionEvent(c))});this._callbackManager.trigger("selectionArray",a,!0)};a.prototype._removeItem=function(c){this._removeImpl(c,c._hash())&&(c=new d.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!0))};a.prototype.remove=function(c){Array.isArray(c)?this._removeItems(c):this._removeItem(c)};a.prototype._removeImpl=function(c,b){if(!this._selectedItemsPruned.delete(b))return!1;
this._removeFromFull(c,b);var a=this._getNodeCounts(c);a.update(c,0);var d=this._temporalLinks.get(b);if(void 0!==d){this._temporalLinks.delete(b);if(null!==d.pastItemHash){var e=this._temporalLinks.get(d.pastItemHash);e&&(e.futureItemHash=d.futureItemHash)}null!==d.futureItemHash&&(e=this._temporalLinks.get(d.futureItemHash))&&(e.pastItemHash=d.pastItemHash);this._oldestItemHash===b&&(this._oldestItemHash=d.futureItemHash);this._newestItemHash===b&&(this._newestItemHash=d.pastItemHash)}b=!0;0===
a.sum()&&(b=!1,a=c.getNodeId(),this._selectedNodeCounts.delete(a));this._updateItemHighlight(c,b,!1);return!0};a.prototype.toggle=function(c){var b=this._findAncestor(c);null!==b?null===c.getFaceEntity()&&null===c.getLineEntity()&&null===c.getPointEntity()&&this._removeImplicit(c,b):(b=c._hash(),this._selectedItemsPruned.has(b)?this._removeImpl(c,b)&&(c=new d.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!0)):(c=this._filterItem(c),null!==c&&this._addImpl(c,c._hash())&&
(c=new d.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!1))))};a.prototype.set=function(c){this.clear(!1);this.add(c)};a.prototype.getResults=function(){var c=[];this.each(function(b){c.push(b)});return c};a.prototype.getResult=function(c){var b=this.size();if(0>c||c>=b)return null;b=b-c-1;return c<=b?this._getItemFromOldest(c):this._getItemFromNewest(b)};a.prototype._getItemFromOldest=function(c){for(var b=this._oldestItemHash;b;){if(0===c--)return this._selectedItemsPruned.get(b)||
null;b=this._temporalLinks.get(b).futureItemHash}return null};a.prototype._getItemFromNewest=function(c){for(var b=this._newestItemHash;b;){if(0===c--)return this._selectedItemsPruned.get(b)||null;b=this._temporalLinks.get(b).pastItemHash}return null};a.prototype.getFirst=function(){return null!==this._oldestItemHash?this._selectedItemsPruned.get(this._oldestItemHash)||null:null};a.prototype.getLast=function(){return null!==this._newestItemHash?this._selectedItemsPruned.get(this._newestItemHash)||
null:null};a.prototype.size=function(){return this._selectedItemsPruned.size};a.prototype.each=function(c){for(var b=this._oldestItemHash;b;){var a=this._selectedItemsPruned.get(b);c(a);b=this._temporalLinks.get(b).futureItemHash}};a.prototype.clear=function(c){void 0===c&&(c=!0);this._selectedLayers.clear();this._selectedTypes.clear();this._clearHighlight();this._selectedItemsPruned.clear();this._selectedItemsFull.clear();this._selectedNodeCounts.clear();this._temporalLinks.clear();this._newestItemHash=
this._oldestItemHash=null;c&&this._triggerNullSelection()};a.prototype.setNodeSelectionColor=function(c){this._setNodeSelectionColor(c);return Promise.resolve()};a.prototype._setNodeSelectionColor=function(c){this._nodeSelectionColor.assign(c);this._updateHighlightingMode()};a.prototype.getNodeSelectionColor=function(){return this._nodeSelectionColor.copy()};a.prototype.setNodeSelectionOutlineColor=function(c){this._setNodeSelectionOutlineColor(c);return Promise.resolve()};a.prototype._setNodeSelectionOutlineColor=
function(c){this._nodeSelectionOutlineColor.assign(c);this._updateHighlightingMode()};a.prototype.getNodeSelectionOutlineColor=function(){return this._nodeSelectionOutlineColor.copy()};a.prototype.setNodeElementSelectionColor=function(c){this._setNodeElementSelectionColor(c);return Promise.resolve()};a.prototype._setNodeElementSelectionColor=function(c){this._elementSelectionColor.assign(c);this._updateHighlightingMode()};a.prototype.getNodeElementSelectionColor=function(){return this._elementSelectionColor.copy()};
a.prototype.setNodeElementSelectionOutlineColor=function(c){this._setNodeElementSelectionOutlineColor(c);return Promise.resolve()};a.prototype._setNodeElementSelectionOutlineColor=function(c){this._elementSelectionOutlineColor.assign(c);this._updateHighlightingMode()};a.prototype.getNodeElementSelectionOutlineColor=function(){return this._elementSelectionOutlineColor.copy()};a.prototype.getHighlightFaceElementSelection=function(){return this._highlightFaceElementSelection};a.prototype.setHighlightFaceElementSelection=
function(c){this._highlightFaceElementSelection=c;this._updateHighlight();return Promise.resolve()};a.prototype.setNodeSelectionHighlightMode=function(c){this._setNodeSelectionHighlightMode(c);return Promise.resolve()};a.prototype._setNodeSelectionHighlightMode=function(c){this._nodeHighlightMode=c;this._updateHighlightingMode()};a.prototype.getNodeSelectionHighlightMode=function(){return this._nodeHighlightMode};a.prototype.setNodeElementSelectionHighlightMode=function(c){this._setNodeElementSelectionHighlightMode(c);
return Promise.resolve()};a.prototype._setNodeElementSelectionHighlightMode=function(c){this._nodeElementHighlightMode=c;this._updateHighlightingMode()};a.prototype.getNodeElementSelectionHighlightMode=function(){return this._nodeElementHighlightMode};a.prototype.setHighlightNodeSelection=function(c){this._highlightNodeSelection=c;this._updateHighlight();return Promise.resolve()};a.prototype.getHighlightNodeSelection=function(){return this._highlightNodeSelection};a.prototype.getHighlightLineElementSelection=
function(){return this._highlightLineElementSelection};a.prototype.getHighlightPointElementSelection=function(){return this._highlightPointElementSelection};a.prototype.setHighlightLineElementSelection=function(c){this._highlightLineElementSelection=c;this._updateHighlight();return Promise.resolve()};a.prototype.setHighlightPointElementSelection=function(c){this._highlightPointElementSelection=c;this._updateHighlight();return Promise.resolve()};a.prototype.setPickTolerance=function(c){this._engine.setPickTolerance(c)};
a.prototype.getPickTolerance=function(){return this._engine.getPickTolerance()};a.prototype.exportSelectionData=function(){for(var c=[],b=0,a=this.getResults();b<a.length;b++)c.push(a[b].toJson());return c};a.prototype.loadSelectionData=function(c){this.clear(!1);if("string"===typeof c&&(c=JSON.parse(c),!Array.isArray(c)))throw new d.ParseError("Expected JSON depicting an Array.");for(var b=[],a=0;a<c.length;a++){var e=d.Selection.SelectionItem._fromJson(c[a]);e.isNodeSelection()&&b.push(e)}this.add(b)};
a.prototype._pathToParent=function(c,b){for(var a=[];!c.equals(b);){a.push(c);c=this._model.getNodeParent(c.getNodeId());if(null===c)break;c=d.Selection.SelectionItem.create(c)}return a};a.prototype._removeImplicit=function(c,b){for(var a=this._pathToParent(c,b),e=b;0<a.length;){this.remove(e);b=[];var l=0;for(e=this._model.getNodeChildren(e.getNodeId());l<e.length;l++){var f=d.Selection.SelectionItem.create(e[l]);b.push(f)}this.add(b);e=a.pop()}console.assert(c===e);this.remove(c)};a.prototype._removeDescendants=
function(c){var b=0;for(c=this._model.getNodeChildren(c.getNodeId());b<c.length;b++){var a=d.Selection.SelectionItem.create(c[b]);this._removeDescendantsRecursive(a)}};a.prototype._removeDescendantsRecursive=function(c){var b=c._hash();if(this._selectedItemsFull.delete(b))for(this._removeImpl(c,b),b=0,c=this._model.getNodeChildren(c.getNodeId());b<c.length;b++){var a=d.Selection.SelectionItem.create(c[b]);this._removeDescendantsRecursive(a)}};a.prototype._processSelection=function(c,b){switch(b){case d.SelectionMode.Add:this.add(c);
break;case d.SelectionMode.Set:this.set(c);break;case d.SelectionMode.Toggle:null!==c&&this.toggle(c)}};a.prototype._clearHighlight=function(){0<this._selectedItemsPruned.size&&this._engine.clearHighlight()};a.prototype._updateHighlight=function(){var c=this;this._clearHighlight();this._selectedItemsPruned.forEach(function(b){b&&c._updateItemHighlight(b,!0,!0)});this._highlightNodeSelection&&this._model.setNodesHighlighted([],!0)};a.prototype._updateItemHighlight=function(c,b,a){var g=c.getNodeId();
this._highlightNodeSelection&&this._model.setNodesHighlighted([g],b);this._model.getNodeType(g)!==d.NodeType.Pmi&&(b=c.getFaceEntity(),this._highlightFaceElementSelection&&null!==b&&!b.isCappingGeometry()&&this._model.setNodeFaceHighlighted(g,b.getCadFaceIndex(),a),b=c.getLineEntity(),this._highlightLineElementSelection&&null!==b&&!b.isCappingGeometry()&&this._model.setNodeLineHighlighted(g,b.getLineId(),a),c=c.getPointEntity(),this._highlightPointElementSelection&&null!==c&&this._model.setNodePointHighlighted(g,
c.getPointId(),a))};a.prototype._updateHighlightingMode=function(){switch(this._nodeHighlightMode){case d.SelectionHighlightMode.HighlightOnly:this._engine.setNodeHighlightColor(this._nodeSelectionColor,null);break;case d.SelectionHighlightMode.OutlineOnly:this._engine.setNodeHighlightColor(null,this._nodeSelectionOutlineColor);break;case d.SelectionHighlightMode.HighlightAndOutline:this._engine.setNodeHighlightColor(this._nodeSelectionColor,this._nodeSelectionOutlineColor)}switch(this._nodeElementHighlightMode){case d.SelectionHighlightMode.HighlightOnly:this._engine.setElementHighlightColor(this._elementSelectionColor,
null);break;case d.SelectionHighlightMode.OutlineOnly:this._nodeHighlightMode===d.SelectionHighlightMode.OutlineOnly?this._engine.setElementHighlightColor(null,this._elementSelectionOutlineColor):this._engine.setElementHighlightColor(this._nodeSelectionColor,this._elementSelectionOutlineColor);break;case d.SelectionHighlightMode.HighlightAndOutline:this._engine.setElementHighlightColor(this._elementSelectionColor,this._elementSelectionOutlineColor)}};a.prototype._onSubtreeLoaded=function(c){c=d.Selection.SelectionItem.create(c);
if(this.isSelected(c))return this._updateItemHighlight(c,!0,!0)};a.ifcSelectionFilter=function(c,b){if(b.getNodeType(c)!==d.NodeType.BodyInstance)return c;for(;null!==c;){if(null!==b.getNodeGenericId(c))return c;c=b.getNodeParent(c)}return null};__decorate([a.deprecated],a.prototype,"endVolumeSelection",null);__decorate([a.deprecated],a.prototype,"advanceVolumeSelection",null);return a}();d.SelectionManager=a})(Communicator||(Communicator={}));
(function(d){(function(h){var f;(function(a){a[a.Background=0]="Background";a[a.Shadow=1]="Shadow";a[a.Selection=2]="Selection"})(f||(f={}));var a=function(){function a(c,b,a,e){var g=this;this._backgroundSheetMeshId=this._activeSheetId=null;this._sheetIds=[null,null,null];this._backgroundSelectionEnabled=this._backgroundSheetEnabled=!1;this._backgroundColor=new d.Color(180,180,180);this._sheetColor=d.Color.white();this._sheetShadowColor=new d.Color(75,75,75);this._viewer=c;this._engine=b;this._callbackManager=
a;var k=function(){return __awaiter(g,void 0,void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:if(!this._viewer.model.isDrawing())return[2];b=this._viewer.getActiveSheetId();return null!=b?[3,4]:[4,this.deactivateSheets(!1)];case 1:return a.sent(),c=this.getSheets(),0===this.get3DNodes().length&&0<c.length?[4,this.setActiveSheetId(c[0],!0,!0)]:[3,3];case 2:a.sent(),a.label=3;case 3:return[3,6];case 4:return[4,this._activateSheetId(b,!0,!0)];case 5:a.sent(),a.label=
6;case 6:return[2]}})})};this._viewer.setCallbacks({_modelStructureHeaderParsed:function(){return __awaiter(g,void 0,void 0,function(){return __generator(this,function(b){return this._viewer.model.isDrawing()&&!e?[2,this.setBackgroundSheetEnabled(!0)]:[2]})})},_firstModelLoaded:function(){return __awaiter(g,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,k()];case 1:return b.sent(),[2]}})})},_resetAssemblyTreeBegin:function(){return __awaiter(g,void 0,
void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:return[4,this.setBackgroundSheetEnabled(!1)];case 1:return a.sent(),[4,this.setBackgroundSelectionEnabled(!1)];case 2:return a.sent(),this._backgroundSheetMeshId=this._activeSheetId=null,b=this._viewer.view,c=b.getBackgroundColor(),b.setBackgroundColor(c.top,c.bottom),[2]}})})},_resetDrawing:function(){return __awaiter(g,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,
k()];case 1:return b.sent(),[2]}})})}})}a.prototype.getSheets=function(){var c=this._viewer.model,b=c.getAbsoluteRootNode();b=c.getNodeChildren(b);var a=c.getNodeChildren(b[0]);b=[];var e=0;for(a=c.getNodeChildren(a[0]);e<a.length;e++){var l=a[e];c.getNodeType(l)===d.NodeType.DrawingSheet&&b.push(l)}return b};a.prototype.get3DNodes=function(){var c=this._viewer.model,b=c.getAbsoluteRootNode();b=c.getNodeChildren(b);var a=c.getNodeChildren(b[0]);b=[];var e=0;for(a=c.getNodeChildren(a[0]);e<a.length;e++){var l=
a[e];c.getNodeType(l)!==d.NodeType.DrawingSheet&&b.push(l)}return b};a.prototype.deactivateSheets=function(c){void 0===c&&(c=!0);return __awaiter(this,void 0,void 0,function(){var b,a,d,e;return __generator(this,function(g){switch(g.label){case 0:return this._activeSheetId=null,this._viewer.pauseRendering(),b=this.get3DNodes(),a=0<b.length,[4,this._viewer.view.isolateNodes(b,0,a)];case 1:return g.sent(),[4,this._refreshBackgroundSheets()];case 2:return g.sent(),d=this._viewer.view,e=d.getBackgroundColor(),
d.setBackgroundColor(e.top,e.bottom),this._viewer.resumeRendering(),c&&this._callbackManager.trigger("sheetDeactivated"),[2]}})})};a.prototype.setActiveSheetId=function(c,b,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){switch(g.label){case 0:if(this._activeSheetId===c)return[2];this._activeSheetId=c;return[4,this._activateSheetId(c,b,a)];case 1:return g.sent(),[2]}})})};a.prototype._activateSheetId=function(c,b,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(g){switch(g.label){case 0:return[4,this._markupManager._setActiveMarkupView(null)];case 1:g.sent();if(!b)return[3,4];this._viewer.pauseRendering();return[4,this._viewer.view.isolateNodes([c],0,a)];case 2:return g.sent(),[4,this._refreshBackgroundSheets()];case 3:g.sent(),this._viewer.resumeRendering(),g.label=4;case 4:return this._callbackManager.trigger("sheetActivated",this._activeSheetId),[2]}})})};a.prototype.getActiveSheetId=function(){return this._activeSheetId};a.prototype.isDrawingSheetActive=
function(){return null!==this._activeSheetId};a.prototype.setMarkupManager=function(c){this._markupManager=c};a.prototype._createBackgroundSheetMesh=function(){return __awaiter(this,void 0,void 0,function(){var c,b,a;return __generator(this,function(g){c=[0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,1,1,0];b=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1];a=new d.MeshData;a.addFaces(c,b);a.setBackfacesEnabled(!0);return[2,this._viewer.model.createMesh(a)]})})};a.prototype._createBackgroundSheetMatrix=function(c,b){var a=
c.min,e=c.max,l=this._viewer.view.getCamera();c=l.getPosition();var f=l.getTarget(),m=d.Point3.subtract(f,c);c=e.x-a.x;f=e.y-a.y;var p=Math.max(.1*c,.1*(e.z-a.z)),h=a.x+.5*c,q=a.y+.5*f,u=Math.max(.05*c,.05*f);c+=u;f+=u;h-=.5*c;q-=.5*f;a=0<m.z?e.z+p:a.z-p;b&&(b=l.getUp(),l=.3*u,h+=l,0<b.y&&(l=-l),q+=l,a+=0<m.z?p:-p);b=new d.Matrix;b.setTranslationComponent(h,q,a);b.setScaleComponent(c,f,1);return b};a.prototype._createBackgroundSheetInstance=function(c,b,a,e,l,f){return __awaiter(this,void 0,void 0,
function(){var g,k,n;return __generator(this,function(m){switch(m.label){case 0:return g=d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.DoNotLight|d.MeshInstanceCreationFlags.DoNotOutlineHighlight|d.MeshInstanceCreationFlags.AlwaysDraw|d.MeshInstanceCreationFlags.ExcludeBounding,f||(g|=d.MeshInstanceCreationFlags.DoNotSelect),k=new d.MeshInstanceData(c,a,b,e,null,null,g),[4,this._viewer.model.createMeshInstance(k,
null,!1,!0)];case 1:return n=m.sent(),this._viewer.model.setNodesOpacity([n],l),[2,n]}})})};a.prototype._deleteBackgroundSheetInstances=function(c){void 0===c&&(c=[f.Background,f.Selection,f.Shadow]);return __awaiter(this,void 0,void 0,function(){var b,a,d,e,f;return __generator(this,function(g){b=[];a=0;for(d=c;a<d.length;a++)e=d[a],f=this._sheetIds[e],null!==f&&(this._sheetIds[e]=null,b.push(f));return 0<b.length?[2,this._viewer.model.deleteMeshInstances(b)]:[2]})})};a.prototype._createOrUpdateSheet=
function(c,b,a,e,f,n){return __awaiter(this,void 0,void 0,function(){var g,k,l,h;return __generator(this,function(m){switch(m.label){case 0:g=this._viewer.model;if(null!==this._sheetIds[c])return[3,2];k=this._sheetIds;l=c;return[4,this._createBackgroundSheetInstance(this._backgroundSheetMeshId,b,a,e,f,n)];case 1:return k[l]=m.sent(),[2,Promise.resolve()];case 2:return h=this._sheetIds[c],g.setNodesFaceColor([h],e),g.setNodesOpacity([h],f),null!==n&&g.setInstanceModifier(d.InstanceModifier.DoNotSelect,
[h],!n),[2,g.setNodeMatrix(h,a,!0)]}})})};a.prototype._refreshBackgroundSheets=function(){return __awaiter(this,void 0,void 0,function(){var c,b,a,e,l,n;return __generator(this,function(g){switch(g.label){case 0:c=this._viewer.model;if(!this.isDrawingSheetActive())return this._backgroundSelectionEnabled=!1,[2,this._deleteBackgroundSheetInstances()];if(null!==this._backgroundSheetMeshId)return[3,2];b=this;return[4,this._createBackgroundSheetMesh()];case 1:b._backgroundSheetMeshId=g.sent(),g.label=
2;case 2:return[4,c.getModelBounding(!0,!1)];case 3:return a=g.sent(),e=this._createBackgroundSheetMatrix(a,!1),l=[],this._backgroundSelectionEnabled?[4,this._createOrUpdateSheet(f.Selection,"2d_drawing_background_selection_sheet",e,d.Color.black(),0,!0)]:[3,5];case 4:return g.sent(),[3,6];case 5:l.push(f.Selection),g.label=6;case 6:this._engine.setBackgroundGradient(this._backgroundColor,this._backgroundColor);if(!this._backgroundSheetEnabled)return[3,9];n=this._createBackgroundSheetMatrix(a,!0);
return[4,this._createOrUpdateSheet(f.Background,"2d_drawing_background_sheet",e,this._sheetColor,1,!1)];case 7:return g.sent(),[4,this._createOrUpdateSheet(f.Shadow,"2d_drawing_background_shadow_sheet",n,this._sheetShadowColor,1,!1)];case 8:return g.sent(),[3,10];case 9:l.push(f.Background,f.Shadow),g.label=10;case 10:return 0<l.length?[2,this._deleteBackgroundSheetInstances(l)]:[2]}})})};a.prototype.setSheetColors=function(c,b,a){this._backgroundColor=c.copy();this._sheetColor=b.copy();this._sheetShadowColor=
a.copy();return this._refreshBackgroundSheets()};a.prototype.getSheetBackgroundColor=function(){return this._backgroundColor};a.prototype.getSheetColor=function(){return this._sheetColor};a.prototype.getSheetShadowColor=function(){return this._sheetShadowColor};a.prototype.setBackgroundSheetEnabled=function(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:if(c===this._backgroundSheetEnabled)return[2];this._backgroundSheetEnabled=c;this._viewer.pauseRendering();
return[4,this._refreshBackgroundSheets()];case 1:return b.sent(),this._viewer.resumeRendering(),[2]}})})};a.prototype.getBackgroundSheetEnabled=function(){return this._backgroundSheetEnabled};a.prototype.setBackgroundSelectionEnabled=function(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:this.isDrawingSheetActive()||(c=!1);if(c===this._backgroundSelectionEnabled)return[2];this._backgroundSelectionEnabled=c;this._viewer.pauseRendering();
return[4,this._refreshBackgroundSheets()];case 1:return b.sent(),this._viewer.resumeRendering(),[2]}})})};a.prototype.getBackgroundSelectionEnabled=function(){return this._backgroundSelectionEnabled};a.prototype.startComparison=function(c,b,a){return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(d){switch(d.label){case 0:return g=this._viewer.view,g.startComparison([c],[b],a),[4,this.setActiveSheetId(c,!1,!1)];case 1:return d.sent(),[4,g.isolateNodes([c,b],0,!0)];
case 2:return d.sent(),[4,this._refreshBackgroundSheets()];case 3:return d.sent(),[2]}})})};a.prototype.endComparison=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return null===this._activeSheetId?[2]:[4,this.setActiveSheetId(this._activeSheetId,!0,!1)];case 1:return c.sent(),this._viewer.view.endComparison(),[2]}})})};return a}();h.SheetManager=a})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h;(function(a){a[a.Model=1]="Model";a[a.Svg=2]="Svg";a[a.Html=4]="Html";a[a.All=7]="All"})(h=d.SnapshotLayer||(d.SnapshotLayer={}));var f=function(){return function(a,d,c){void 0===a&&(a=0);void 0===d&&(d=0);void 0===c&&(c=h.All);this.width=a;this.height=d;this.layers=c}}();d.SnapshotConfig=f})(Communicator||(Communicator={}));
(function(d){(function(h){function f(b){var c=document.createElement("canvas");c.width=b.width;c.height=b.height;c.getContext("2d").drawImage(b,0,0);return c}function a(b){if(b instanceof HTMLCanvasElement&&0<b.clientWidth&&0<b.clientHeight)return b;for(var c=0;c<b.childNodes.length;c++){var d=b.childNodes.item(c);if(d=a(d))return d}return null}function e(b,c){var a=b.getContext("2d");if(null===a)throw new d.CommunicatorError("failed to create 2D canvas context");for(var g=0;g<c.length;g++)a.drawImage(c[g],
0,0);var e=h.OpenPromise.create(),f=new Image;f.src=b.toDataURL();f.onload=function(){e.resolve(f)};return e}var c=function(){function b(b,c){this._domElements=b;this._config=c}b.prototype._extractMarkupSvgAsCanvas=function(){var b=this._domElements.getMarkupSvgElement(),c=(new XMLSerializer).serializeToString(b);b=c;var a=(new DOMParser).parseFromString(b,"text/xml");c=a.getElementsByTagName("defs");for(var d=[],e=0;e<c.length;e++)for(var p=c.item(e).getElementsByTagName("marker"),h=0;h<p.length;h++){var q=
p.item(h);d.push(q)}c=[];p=a.getElementsByTagName("line");for(e=0;e<p.length;e++)if(a=p.item(e),null!==a.style.marker&&0<a.style.marker.length){h=a.style.marker.indexOf("#")+1;q=a.style.marker.indexOf('"',h+1);q=a.style.marker.substring(h,q);var u=null,t=null;for(h=0;h<d.length;h++)if(d[h].id===q){u=d[h];t=d[h+1];break}c.push({line:a,start:u,end:t})}for(d=b.indexOf("marker: url");0<=d;){e=b.indexOf(")",d)+1;a=b.substring(d,e);h=a.indexOf("#")+1;p=a.indexOf('"',h);q=a.indexOf("&quot",h+11+1);u=p;if(0>
p||q<p)u=q;h=a.substring(h,u);p=0;for(q=c;p<q.length;p++)if(a=q[p],u=a.start,a=a.end,null!==u&&null!==a&&u.id===h){h="marker-start: url('#"+u.id+"');";h+="marker-end: url('#"+a.id+"')";b=b.slice(0,d)+h+b.slice(e);break}d=b.indexOf("marker: url",e+1)}c=b;b=document.createElement("canvas");document.body.appendChild(b);canvg(b,c);c=f(b);document.body.removeChild(b);return c};b.prototype._extractRedlineSvgAsCanvas=function(b,c){var a=this._domElements.getRedlineSvgElement();a.setAttribute("width",""+
b);a.setAttribute("height",""+c);a=(new XMLSerializer).serializeToString(a);a=a.replace("width: 100%;","width: "+b+";");a=a.replace("height: 100%;","height: "+c+";");b=document.createElement("canvas");document.body.appendChild(b);canvg(b,a);c=f(b);document.body.removeChild(b);return c};b.prototype._extractRedlineAsCanvas=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){b=this._domElements.getRedlineElement();return[2,html2canvas(b,{background:void 0})]})})};
b.prototype.capture=function(b){return __awaiter(this,void 0,void 0,function(){var c,g,n,m,p;return __generator(this,function(k){switch(k.label){case 0:c=a(b);if(null===c)throw new d.CommunicatorError("failed to find canvas");g=document.createElement("canvas");g.width=this._config.width||b.clientWidth;g.height=this._config.height||b.clientHeight;g.style.width="100%";g.style.height="100%";n=[];this._config.layers&d.SnapshotLayer.Model&&n.push(f(c));this._config.layers&d.SnapshotLayer.Svg&&(n.push(this._extractMarkupSvgAsCanvas()),
n.push(this._extractRedlineSvgAsCanvas(g.width,g.height)));if(!(this._config.layers&d.SnapshotLayer.Html))return[3,2];p=(m=n).push;return[4,this._extractRedlineAsCanvas()];case 1:p.apply(m,[k.sent()]),k.label=2;case 2:return[2,e(g,n)]}})})};return b}();h.Snapshot=c})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function b(){this._strokeWidth=1;this._strokeColor=d.Color.black()}b.prototype._assign=function(b){this._strokeWidth=b._strokeWidth;this._strokeColor.assign(b._strokeColor)};b.prototype.setStrokeColor=function(b){this._strokeColor.assign(b)};b.prototype.getStrokeColor=function(){return this._strokeColor.copy()};b.prototype.setStrokeWidth=function(b){this._strokeWidth=b};b.prototype.getStrokeWidth=function(){return this._strokeWidth};return b}();
f.StrokedShape=a;var e=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c._fillColor=d.Color.black();c._fillOpacity=1;return c}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._fillColor.assign(c._fillColor);this._fillOpacity=c._fillOpacity};c.prototype.getFillOpacity=function(){return this._fillOpacity};c.prototype.setFillOpacity=function(b){this._fillOpacity=b};c.prototype.setFillColor=function(b){this._fillColor.assign(b)};c.prototype.getFillColor=
function(){return this._fillColor.copy()};return c}(a);f.FilledShape=e;var c;(function(b){b[b.None=0]="None";b[b.Arrowhead=1]="Arrowhead";b[b.Circle=2]="Circle"})(c=f.EndcapType||(f.EndcapType={}));a=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a._startEndcapType=c.None;a._startEndcapColor=d.Color.black();a._startEndcapSize=9;a._endEndcapType=c.None;a._endEndcapColor=d.Color.black();a._endEndcapSize=9;a._endcapsInverted=!1;return a}__extends(a,b);a.prototype._assign=function(c){b.prototype._assign.call(this,
c);this._startEndcapType=c._startEndcapType;this._startEndcapColor.assign(c._startEndcapColor);this._startEndcapSize=c._startEndcapSize;this._endEndcapType=c._endEndcapType;this._endEndcapColor.assign(c._endEndcapColor);this._endEndcapSize=c._endEndcapSize;this._endcapsInverted=c._endcapsInverted};a.prototype.getStartEndcapType=function(){return this._startEndcapType};a.prototype.setStartEndcapType=function(b){this._startEndcapType=b};a.prototype.getStartEndcapColor=function(){return this._startEndcapColor.copy()};
a.prototype.setStartEndcapColor=function(b){this._startEndcapColor.assign(b)};a.prototype.getStartEndcapSize=function(){return this._startEndcapSize};a.prototype.setStartEndcapSize=function(b){this._startEndcapSize=b};a.prototype.getEndEndcapType=function(){return this._endEndcapType};a.prototype.setEndEndcapType=function(b){this._endEndcapType=b};a.prototype.setEndcapType=function(b){this._endEndcapType=this._startEndcapType=b};a.prototype.getEndEndcapSize=function(){return this._endEndcapSize};
a.prototype.setEndEndcapSize=function(b){this._endEndcapSize=b};a.prototype.getEndEndcapColor=function(){return this._endEndcapColor.copy()};a.prototype.setEndEndcapColor=function(b){this._endEndcapColor.assign(b)};a.prototype.getEndcapsInverted=function(){return this._endcapsInverted};a.prototype.setEndcapsInverted=function(b){this._endcapsInverted=b};return a}(a);f.EndcapShape=a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c._borderRadius=0;return c}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._borderRadius=c._borderRadius};c.prototype.getBorderRadius=function(){return this._borderRadius};c.prototype.setBorderRadius=function(b){this._borderRadius=b};return c}(f.FilledShape);f.RectangleBase=a;var e=function(b){function c(c,a){var g=b.call(this)||this;g._position=
d.Point2.zero();g._size=d.Point2.zero();c&&g._position.assign(c);a&&g._size.assign(a);return g}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._position.assign(c._position);this._size.assign(c._size)};c.prototype.setPosition=function(b){this._position.assign(b)};c.prototype.getPosition=function(){return this._position.copy()};c.prototype.setSize=function(b){this._size.assign(b)};c.prototype.getSize=function(){return this._size.copy()};return c}(a);f.Rectangle=
e;var c=function(){return function(b,c){this.position=b.copy();this.size=c.copy()}}();f._MarkupRectangleData=c;a=function(b){function a(){var c=null!==b&&b.apply(this,arguments)||this;c._rectangles=[];return c}__extends(a,b);a.prototype.clear=function(){this._rectangles=[]};a.prototype.addRectangle=function(b,a){this._rectangles.push(new c(b,a))};a.prototype.getRectangles=function(){return this._rectangles};return a}(a);f.RectangleCollection=a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){(function(f){var a=function(b){function c(){var c=b.call(this)||this;c._fontFamily=null;c._fontSize=12;c.setStrokeWidth(0);return c}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._fontFamily=c._fontFamily;this._fontSize=c._fontSize};c.prototype.getFontFamily=function(){return this._fontFamily};c.prototype.setFontFamily=function(b){this._fontFamily=b};c.prototype.setFontSize=function(b){this._fontSize=b};c.prototype.getFontSize=function(){return this._fontSize};
return c}(f.FilledShape);f.TextMarkupBase=a;var e=function(b){function c(c,a){var g=b.call(this)||this;g._position=d.Point2.zero();g._text="";a&&(g._position=a.copy());c&&g.setText(c);return g}__extends(c,b);c.prototype._assign=function(c){b.prototype._assign.call(this,c);this._text=c._text;this._position.assign(c._position)};c.prototype.setPosition=function(b){this._position.assign(b)};c.prototype.getPosition=function(){return this._position};c.prototype.setText=function(b){this._text=b};c.prototype.getText=
function(){return this._text};return c}(a);f.Text=e;var c=function(){return function(b,c){this.text=b;this.position=c.copy()}}();f._MarkupTextData=c;a=function(b){function a(){var c=null!==b&&b.apply(this,arguments)||this;c._textStrings=[];return c}__extends(a,b);a.prototype.clear=function(){this._textStrings=[]};a.prototype.addString=function(b,a){this._textStrings.push(new c(b,a))};a.prototype.getStrings=function(){return this._textStrings};return a}(a);f.TextCollection=a})(h.Shape||(h.Shape={}))})(d.Markup||
(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(){this._behindView=!1}a.prototype.remove=function(){};a.prototype.draw=function(){};a.prototype.hit=function(a){a;return!1};a.prototype.hitWithTolerance=function(a,c){a;c;return!1};a.prototype.onSelect=function(){};a.prototype.onDeselect=function(){};a.prototype.toJson=function(){return{}};a.prototype.forJson=function(){return this.toJson()};a.prototype.getClassName=function(){return"Communicator.Markup.MarkupItem"};return a}();d.MarkupItem=f})(d.Markup||
(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(c){function b(b){var a=c.call(this)||this;a._position=new d.Point2(10,10);a._nextItemPosition=d.Point2.zero();a._statItemOffset=new d.Point2(5,5);a._maxStatWidth=0;a._viewer=b;a._backgroundPanel=new d.Markup.Shape.Rectangle(a._position,new d.Point2(300,100));a._backgroundPanel.setFillColor(d.Color.white());a._backgroundPanel.setStrokeWidth(0);a._statsText=new d.Markup.Shape.TextCollection;return a}__extends(b,c);b.prototype.draw=function(){this._updateBackgroundSize();
var b=this._viewer.markupManager.getRenderer();b.drawRectangle(this._backgroundPanel);b.drawTexts(this._statsText)};b.prototype.clearStatsText=function(){this._statsText.clear();this._nextItemPosition.assign(this._position)};b.prototype.setPosition=function(b){this._position.assign(b);this._backgroundPanel.setPosition(this._position)};b.prototype.addStatistic=function(b,c){var a=d.Point2.add(this._nextItemPosition,this._statItemOffset);this._statsText.addString(b+": "+c,a);this._nextItemPosition.y+=
this._statsText.getFontSize()};b.prototype._updateBackgroundSize=function(){for(var b=this._viewer.markupManager.getRenderer(),c=this._statsText.getStrings(),a=this._statsText.getFontSize(),e=0;e<c.length;e++){var f=b.measureText(c[e].text,this._statsText);this._maxStatWidth=Math.max(this._maxStatWidth,f.x)}this._backgroundPanel.setSize(new d.Point2(2*this._statItemOffset.x+this._maxStatWidth,c.length*(a+this._statItemOffset.y)))};return b}(d.Markup.MarkupItem),a=function(){return function(){this.total_triangle_count=
this.total_element_count=0}}();h.StatisticMap=a;var e=function(){function c(b,c){var g=this;this._statisticsDisplayHandle=null;this._statistics=new a;this._viewer=c;this._callbackManager=b;this._callbackManager.bind({frameDrawn:function(){return __awaiter(g,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.update()];case 1:return b.sent(),[2]}})})}});this._statisticsDisplay=new f(this._viewer)}c.prototype.update=function(){return __awaiter(this,void 0,
void 0,function(){var b,c,a,d,e,f,p;return __generator(this,function(g){switch(g.label){case 0:return[4,this._viewer.getStatistics()];case 1:this._statistics=b=g.sent();this._statisticsDisplay.clearStatsText();c=Object.keys(this._statistics);a=0;for(d=c;a<d.length;a++)f=e=d[a],p=this._statistics[f],this._statisticsDisplay.addStatistic(f,p.toString());return[2]}})})};c.prototype.isShown=function(){return null!==this._statisticsDisplayHandle};c.prototype.getStatistics=function(){return this._statistics};
c.prototype.showDisplay=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this.isShown()?[3,2]:[4,this.update()];case 1:b.sent(),this._statisticsDisplayHandle=this._viewer.markupManager.registerMarkup(this._statisticsDisplay),b.label=2;case 2:return[2]}})})};c.prototype.hideDisplay=function(){this.isShown()&&(this._viewer.markupManager.unregisterMarkup(this._statisticsDisplayHandle),this._statisticsDisplayHandle=null)};return c}();
h.Statistics=e})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){var h=function(){return function(){this.svgXmlPrologEnabled=!0;this.svgBackgroundCssColor="";this.linesDrawModelLinesEnabled=this.silhouettesEnabled=!0;this.linesStrokeWidth=20;this.linesCssColor="#000000";this.linesClipZNudgeFactor=this.linesClipProximityToPlane=5.5;this.polygonsForceDrawCssColor="";this.logDiagnostics=this.logProgress=!1}}();d.SvgConfig=h})(Communicator||(Communicator={}));
(function(d){(function(d){d[d.Rgba32=0]="Rgba32";d[d.Rgb24=1]="Rgb24";d[d.Gray8=2]="Gray8";d[d.GrayAlpha16=3]="GrayAlpha16";d[d.Jpeg=4]="Jpeg";d[d.Png=5]="Png"})(d.ImageFormat||(d.ImageFormat={}));(function(d){d[d.Clamp=0]="Clamp";d[d.Repeat=1]="Repeat"})(d.TextureTiling||(d.TextureTiling={}));(function(d){d[d.UV=0]="UV"})(d.TextureParameterization||(d.TextureParameterization={}));(function(d){d[d.Decal=1]="Decal"})(d.TextureModifier||(d.TextureModifier={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(a){this._timeoutDurationMinutes=15;this._timeoutWarningMinutes=14;this._timer=new d.Timer;this._enabled=!0;this._callbackManager=a;this.resetTimeout()}a.prototype.setTimeoutDurations=function(a,c){this._timeoutDurationMinutes=a;this._timeoutWarningMinutes=c;this.resetTimeout();return!0};a.prototype.shutdown=function(){this._enabled=!1;this._timer.clear()};a.prototype.resetTimeout=function(){var a=this;this._enabled&&this._timer.set(Math.round(6E4*
this._timeoutWarningMinutes),function(){a._warn()})};a.prototype._warn=function(){var a=this;console.assert(this._timer.isIdle(0));var c=this._timeoutDurationMinutes-this._timeoutWarningMinutes,b=Math.round(6E4*c);this._callbackManager.trigger("timeoutWarning",c);this._timer.set(b,function(){a._timeout()})};a.prototype._timeout=function(){this._callbackManager.trigger("timeout");this._callbackManager.trigger("_timeout")};return a}();d.TimeoutMonitor=f})(d.Internal||(d.Internal={}))})(Communicator||
(Communicator={}));var __assign=this&&this.__assign||function(){__assign=Object.assign||function(d){for(var h,f=1,a=arguments.length;f<a;f++){h=arguments[f];for(var e in h)Object.prototype.hasOwnProperty.call(h,e)&&(d[e]=h[e])}return d};return __assign.apply(this,arguments)};
(function(d){var h=function(){function f(a,e,c,b,g,k,f,n){this._backfacesVisible=!1;this._initialCamera=null;this._boundingCalculationIgnoresInvisible=this._faceVisibility=this._lineVisibility=!0;this._backgroundColorBottom=this._backgroundColorTop=null;this._drawMode=d.DrawMode.WireframeOnShaded;this._ambientOcclusionEnabled=!1;this._ambientOcclusionRadius=.03;this._antiAliasingMode=d.AntiAliasingMode.SMAA;this._lightingEnabled=!0;this._ambientLightColor=d.Color.black();this._bloomEnabled=!1;this._bloomIntensityScale=
this._bloomThresholdRampWidth=this._bloomThreshold=0;this._bloomLayers=[];this._silhouetteEnabled=this._simpleReflectionEnabled=this._simpleShadowEnabled=!1;this._hiddenLineSettings=new d.Settings.HiddenLineSettings;this._projectionMode=d.Projection.Orthographic;var l=a.getCreationParameters();this._viewer=a;this._engine=e;this._callbackManager=c;this._interpolationManager=g;this._eventDispatcher=b;this._model=a.model;this._statistics=k;this._navCube=f;this._axisTriad=n;this._determineInitialAxes=
d.Internal.getWithDefault(l.calculateDefaultViewAxes,!0);this._initEvents()}f.deprecated=function(a,d,c){var b=c.value;c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","View",d);return b.apply(this,c)};return c};f.prototype._initEvents=function(){var a=this;this._callbackManager.bind({_resetAssemblyTreeBegin:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){this._initialCamera=null;return[2]})})},
_firstAttachment:function(e){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(c){return e===d.Internal.AttachType.Direct?[2,this._massageInitialCamera(!1)]:[2]})})},_firstModelLoaded:function(){return a._massageInitialCamera(!1)},_modelSwitched:function(d){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return d?[3,2]:[4,this._massageInitialCamera(!1)];case 1:return c.sent(),[2,this._setInitialView(0)];case 2:return[2]}})})},
hwfParseComplete:function(){return a._massageInitialCamera(!0)},_modelStructureHeaderParsed:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){return this._viewer.isDrawingSheetActive()?(this._model.setViewAxes(new d.Point3(0,0,1),new d.Point3(0,1,0)),[2,this.setViewOrientation(d.ViewOrientation.Front,0)]):[2]})})},_sessionStarted:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){this.clearLights();this.setAmbientLightColor(d.Color.createFromFloatArray([.075,
.075,.075]));this.addLight(new d.Light(d.LightType.Directional,d.LightSpace.Camera,new d.Point3(.5,.5,1),d.Color.createFromFloatArray([.925,.925,.925])));this.addLight(new d.Light(d.LightType.Directional,d.LightSpace.Camera,new d.Point3(-.5,-.5,1),d.Color.createFromFloatArray([.1,.1,.2])));this.setBloomIntensityScale(1);this.setBloomThreshold(.65);this.setBloomThresholdRampWidth(.1);this.setBloomLayers([{intensity:.5,blurSamples:5,blurInterval:[.0025,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:.5,
blurSamples:5,blurInterval:[.005,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:.5,blurSamples:9,blurInterval:[.01,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:1,blurSamples:9,blurInterval:[.02,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:2,blurSamples:11,blurInterval:[.04,d.BlurIntervalUnit.ProportionOfHeight]}]);this.setGroundPlane({normal:new d.Point3(0,0,1),followViewAxes:!0});this.setSimpleShadowColor(d.Color.black());this.setSimpleShadowOpacity(.65);this.setSimpleShadowResolution(512);
this.setSimpleShadowBlurSamples(5);this.setSimpleShadowBlurInterval(1);this.setSimpleShadowInteractiveUpdateEnabled();this.setSimpleReflectionOpacity(.65);this.setSimpleReflectionFadeAngle(10);this.setSimpleReflectionBlurSamples(9);this.setSimpleReflectionBlurInterval(1,d.BlurIntervalUnit.Pixels);this.setSimpleReflectionAttenuation(0,1,d.SimpleReflectionAttenuationUnit.ProportionOfBoundingHeight);this.setSilhouetteColor(d.Color.black());this.setSilhouetteOpacity(1);this.setSilhouetteThreshold(.05);
this.setSilhouetteThresholdRampWidth(.025);return[2]})})},viewAxes:function(d,c){a._updateGroundPlane(d,c)}})};f.prototype._massageInitialCamera=function(a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:if(null!==this._initialCamera)return[2];d=this;return[4,this._engine.getCameraPromise()];case 1:return d._initialCamera=c.sent(),this._projectionMode=this._initialCamera.getProjection(),!this._determineInitialAxes||this._viewer.isDrawingSheetActive()||
this._model.viewAxesHaveBeenSet()||this._determineViewAxes(this._initialCamera),a?[4,this.fitWorld()]:[3,3];case 2:c.sent(),this._initialCamera=this.getCamera(),c.label=3;case 3:return[2]}})})};f.prototype.setLineVisibility=function(a){this._setLineVisibility(a);return Promise.resolve()};f.prototype._setLineVisibility=function(a){a!==this._lineVisibility&&(this._lineVisibility=a,this._engine.setLineVisibility(a))};f.prototype.getLineVisibility=function(){return this._lineVisibility};f.prototype.setFaceVisibility=
function(a){this._setFaceVisibility(a);return Promise.resolve()};f.prototype._setFaceVisibility=function(a){a!==this._faceVisibility&&(this._faceVisibility=a,this._engine.setFaceVisibility(a));return Promise.resolve()};f.prototype.getFaceVisibility=function(){return this._faceVisibility};f.prototype.setProjectionMode=function(a){this._projectionMode!==a&&(this._projectionMode=a,this._engine.isInit()&&this._engine.setProjection(a),this._eventDispatcher.injectViewOrientationChangeEvent())};f.prototype.getProjectionMode=
function(){return this._projectionMode};f.prototype.getViewMatrix=function(){return this._engine.getViewMatrix()};f.prototype.getProjectionMatrix=function(){return this._engine.getProjectionMatrix()};f.prototype.getFullCameraMatrix=function(){return this._engine.getFullCameraMatrix()};f.prototype.raycastFromPoint=function(a){var e=this.getCanvasSize(),c=this._engine.getViewMatrix(),b=this._engine.getProjectionMatrix(),g=new d.Point3(a.x,e.y-a.y,0);a=this._unproject(g,b,c,e);if(null===a)return null;
g.z=.5;e=this._unproject(g,b,c,e);if(null===e)return null;e=d.Point3.subtract(e,a).normalize();return new d.Ray(a,e)};f.prototype._unproject=function(a,e,c,b){e=d.Matrix.multiply(c,e);e=d.Matrix.inverse(e);if(null===e)return null;a=new d.Point4(a.x,a.y,a.z,1);a.x/=b.x;a.y/=b.y;a.x=2*a.x-1;a.y=2*a.y-1;a.z=2*a.z-1;b=e.transform4(a);if(0===b.w)return null;b.scale(1/b.w);return new d.Point3(b.x,b.y,b.z)};f.prototype._rectifySelectionItem=function(a){var d=a.getInclusionKey(),c=a.getNodeId();d=this._model._getNodeFromInstanceInc(!1,
d,c,!0);a._setNodeId(d)};f.prototype.isOutsideCanvasArea=function(a){var d=this.getCanvasSize();return 0>a.x||0>a.y||a.x>=d.x||a.y>=d.y};f.prototype.pickFromPoint=function(a,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:if(this.isOutsideCanvasArea(a))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");return[4,this._engine.pickFromScreen(a,e,this._viewer.isDrawingSheetActive())];case 1:return(c=b.sent())?(this._rectifySelectionItem(c),
[2,c]):[2,d.Selection.SelectionItem.create()]}})})};f.prototype.pickAllFromPoint=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,g,k;return __generator(this,function(f){switch(f.label){case 0:if(this.isOutsideCanvasArea(a))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");return[4,this._engine.pickAllFromScreen(a,e,this._viewer.isDrawingSheetActive())];case 1:c=f.sent();b=0;for(g=c;b<g.length;b++)k=g[b],this._rectifySelectionItem(k);return[2,c]}})})};
f.prototype.compositePickFromPoint=function(a,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:if(this.isOutsideCanvasArea(a))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");return[4,this._engine.compositePickFromScreen(a,e,this._viewer.isDrawingSheetActive())];case 1:return c=b.sent(),null!==c.faceItem&&this._rectifySelectionItem(c.faceItem),null!==c.lineItem&&this._rectifySelectionItem(c.lineItem),null!==
c.pointItem&&this._rectifySelectionItem(c.pointItem),[2,c]}})})};f.prototype.pickFromRay=function(a,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return[4,this._engine.pickFromRay(a,e)];case 1:return(c=b.sent())?(this._rectifySelectionItem(c),[2,c]):[2,d.Selection.SelectionItem.create()]}})})};f.prototype.pickAllFromRay=function(a,d){return __awaiter(this,void 0,void 0,function(){var c,b,g,e;return __generator(this,function(k){switch(k.label){case 0:return[4,
this._engine.pickAllFromRay(a,d)];case 1:c=k.sent();b=0;for(g=c;b<g.length;b++)e=g[b],this._rectifySelectionItem(e);return[2,c]}})})};f.prototype.beginScreenSelectByArea=function(a,e,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(this.isOutsideCanvasArea(a)||this.isOutsideCanvasArea(e))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");return[2,this._engine.beginScreenAreaSelection(a,e,c)]})})};f.prototype.beginRayDrillSelection=function(a,
e,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(this.isOutsideCanvasArea(a))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");return[2,this._engine.beginRayDrillSelection(a,e,c)]})})};f.prototype.beginConvexPolyhedronSelection=function(a,d,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._engine.beginConvexPolyhedronSelection(a,d,c)]})})};f.prototype.beginSphereSelection=function(a,
e,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(g){b=d.Internal.toVec3(a);return[2,this._engine.beginSphereSelection(b,e,c)]})})};f.prototype.endIncrementalSelection=function(a){this._endIncrementalSelection(a);return Promise.resolve()};f.prototype._endIncrementalSelection=function(a){this._engine.endIncrementalSelection(a)};f.prototype.endVolumeSelection=function(a){return this.endIncrementalSelection(a)};f.prototype.advanceIncrementalSelection=function(a){return __awaiter(this,
void 0,void 0,function(){var e,c,b,g,k,f,n,m,p,h;return __generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,this._engine.advanceIncrementalSelection(a)];case 1:e=l.sent();if(null===e)return[2,null];c=this._viewer.selectionManager;b=[];g=0;for(k=e;g<k.length;g++)f=k[g],this._rectifySelectionItem(f),n=f,m=n.getNodeId(),(p=c._incrementalBlacklistedInstanceNodes.has(m))||b.push(n);return[2,b];case 2:h=l.sent();if("advanceVolumeSelection"===h.scFunction)throw new d.SelectionInvalidatedError;
throw h;case 3:return[2]}})})};f.prototype.advanceVolumeSelection=function(a){return this.advanceIncrementalSelection(a)};f.prototype.projectPoint=function(a,d){if(void 0!==d){var c=d.getProjectionMatrix(this._viewer);var b=d.getViewMatrix(this._viewer)}else c=this._engine.getSynchedProjectionMatrix(),b=this._engine.getSynchedViewMatrix();d=this.getCanvasSize();a=this._project(a,c,b,d);a.y=d.y-a.y;return a};f.prototype._project=function(a,e,c,b){a=new d.Point4(a.x,a.y,a.z,1);c.transform4(a,a);e.transform4(a,
a);e=0>=a.w;c=a.w;0>=a.w&&(a.w=.001);a.scale(1/a.w);a.x=.5*a.x+.5;a.y=.5*a.y+.5;a.z=.5*a.z+.5;a.x*=b.x;a.y*=b.y;e&&(a.z=c);return new d.Point3(a.x,a.y,a.z)};f.prototype.unprojectPoint=function(a,e){var c=this.getCanvasSize(),b=this.getProjectionMatrix(),g=this.getViewMatrix();a=new d.Point3(a.x,c.y-a.y,e);return this._unproject(a,b,g,c)};f.prototype.pointToWindowPosition=function(a){var e=this._engine.getCanvasSize();return new d.Point2(a.x/e.x*2-1,1-a.y/e.y*2)};f.prototype.setCamera=function(a,d){void 0===
d&&(d=0);return null===a?!1:this._setCameraImpl(a,d).unsafeValue};f.prototype._setCameraPromise=function(a,d){return this._setCameraImpl(a,d).readyPromise};f.prototype._setCameraImpl=function(a,e){return 0<e?this._interpolateCamera(a,e):this._engine.isInit()?(e=a.getProjection(),this._projectionMode!==e&&this.setProjectionMode(e),this._engine.setCamera(a),e=this._markupManager?this._markupManager._setActiveMarkupView(null):Promise.resolve(),this._callbackManager.trigger("camera",a),d.Internal.UnsafePromise.create(!0,
e)):d.Internal.UnsafePromise.create(!1,Promise.resolve())};f.prototype._interpolateCamera=function(a,e){var c=this;if(this._engine.isInit()){var b=this.getCamera();if(b.equals(a))return this._markupManager&&this._markupManager._update(),d.Internal.UnsafePromise.create(!1,Promise.resolve());this._callbackManager.trigger("transitionBegin",e);var g=d.Util.OpenPromise.create();this._interpolationManager.start(new d.Internal.CameraInterpolation(b,a,e,function(){c._eventDispatcher.injectViewOrientationChangeEvent();
c._callbackManager.trigger("transitionEnd");g.resolve()},this));return d.Internal.UnsafePromise.create(!0,g)}return d.Internal.UnsafePromise.create(!1,Promise.resolve())};f.prototype.updateCamera=function(a){a=this._engine.updateCamera(a);this._callbackManager.trigger("camera",a);return a};f.prototype.resetCamera=function(a){void 0===a&&(a=d.DefaultTransitionDuration);return this._setInitialView(a)};f.prototype.getCamera=function(){if(this._engine.isInit())return this._engine.getCamera();throw new d.CommunicatorError("getCamera() called before sceneReady");
};f.prototype.getViewOrientationCamera=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,g,k,f,n,m,p,h,q,u,t,v,w,z,y,x,A,B;return __generator(this,function(l){switch(l.label){case 0:return c=this.getCamera(),b=this._model.getViewAxes(),g=b.upVector.copy(),k=b.frontVector.copy(),void 0!==e?[3,2]:[4,this._model.getModelBounding(this._boundingCalculationIgnoresInvisible,!1)];case 1:return e=l.sent(),[3,3];case 2:this._fitCameraToBounding(c,e),l.label=3;case 3:f=e.center();n=f.copy();
m=f.copy();p=d.Point3.subtract(c.getPosition(),c.getTarget()).length();h=d.Point3.subtract(c.getPosition(),f).length();q=new d.Point3(0,0,1);u=new d.Point3(-1,0,0);null!==g&&(q=g.copy());null!==k&&(u=k.copy());t=u.copy().scale(-1);v=u.copy();w=q.copy();z=q.copy().scale(-1);y=d.Point3.cross(w,t);x=y.copy().scale(-1);switch(a){case d.ViewOrientation.Front:n=d.Point3.add(m,v);break;case d.ViewOrientation.Back:n=d.Point3.add(m,t);break;case d.ViewOrientation.Left:n=d.Point3.add(m,y);break;case d.ViewOrientation.Right:n=
d.Point3.add(m,x);break;case d.ViewOrientation.Bottom:n=d.Point3.add(m,z);q=t.copy();break;case d.ViewOrientation.Top:n=d.Point3.add(m,w);q=t.copy();break;case d.ViewOrientation.FrontTop:case d.ViewOrientation.TopFront:n=d.Point3.add(m,d.Point3.add(v,w));q=d.Point3.add(t,w).normalize();break;case d.ViewOrientation.FrontTopLeft:case d.ViewOrientation.LeftTopFront:case d.ViewOrientation.TopLeftFront:n=d.Point3.add(m,d.Point3.add(v,d.Point3.add(y,w)));q=d.Point3.add(t,d.Point3.add(x,w)).normalize();
break;case d.ViewOrientation.Iso:case d.ViewOrientation.FrontTopRight:case d.ViewOrientation.RightTopFront:case d.ViewOrientation.TopRightFront:n=d.Point3.add(m,d.Point3.add(v,d.Point3.add(x,w)));q=d.Point3.add(t,d.Point3.add(y,w)).normalize();break;case d.ViewOrientation.FrontLeft:case d.ViewOrientation.LeftFront:n=d.Point3.add(m,d.Point3.add(v,y));break;case d.ViewOrientation.FrontRight:case d.ViewOrientation.RightFront:n=d.Point3.add(m,d.Point3.add(v,x));break;case d.ViewOrientation.FrontBottom:case d.ViewOrientation.BottomFront:n=
d.Point3.add(m,d.Point3.add(v,z));q=d.Point3.add(v,w).normalize();break;case d.ViewOrientation.FrontBottomLeft:case d.ViewOrientation.LeftBottomFront:case d.ViewOrientation.BottomLeftFront:n=d.Point3.add(m,d.Point3.add(v,d.Point3.add(y,z)));q=d.Point3.add(v,d.Point3.add(y,w)).normalize();break;case d.ViewOrientation.FrontBottomRight:case d.ViewOrientation.RightBottomFront:case d.ViewOrientation.BottomRightFront:n=d.Point3.add(m,d.Point3.add(v,d.Point3.add(x,z)));q=d.Point3.add(v,d.Point3.add(x,w)).normalize();
break;case d.ViewOrientation.BackTop:case d.ViewOrientation.TopBack:n=d.Point3.add(m,d.Point3.add(t,w));q=d.Point3.add(v,w).normalize();break;case d.ViewOrientation.BackTopLeft:case d.ViewOrientation.LeftTopBack:case d.ViewOrientation.TopLeftBack:n=d.Point3.add(m,d.Point3.add(t,d.Point3.add(y,w)));q=d.Point3.add(v,d.Point3.add(x,w)).normalize();break;case d.ViewOrientation.BackTopRight:case d.ViewOrientation.RightTopBack:case d.ViewOrientation.TopRightBack:n=d.Point3.add(m,d.Point3.add(t,d.Point3.add(x,
w)));q=d.Point3.add(v,d.Point3.add(y,w)).normalize();break;case d.ViewOrientation.BackLeft:case d.ViewOrientation.LeftBack:n=d.Point3.add(m,d.Point3.add(t,y));break;case d.ViewOrientation.BackRight:case d.ViewOrientation.RightBack:n=d.Point3.add(m,d.Point3.add(t,x));break;case d.ViewOrientation.BackBottom:case d.ViewOrientation.BottomBack:n=d.Point3.add(m,d.Point3.add(t,z));q=d.Point3.add(t,w).normalize();break;case d.ViewOrientation.BackBottomLeft:case d.ViewOrientation.LeftBottomBack:case d.ViewOrientation.BottomLeftBack:n=
d.Point3.add(m,d.Point3.add(t,d.Point3.add(y,z)));q=d.Point3.add(t,d.Point3.add(y,w)).normalize();break;case d.ViewOrientation.BackBottomRight:case d.ViewOrientation.RightBottomBack:case d.ViewOrientation.BottomRightBack:n=d.Point3.add(m,d.Point3.add(t,d.Point3.add(x,z)));q=d.Point3.add(t,d.Point3.add(x,w)).normalize();break;case d.ViewOrientation.LeftBottom:case d.ViewOrientation.BottomLeft:n=d.Point3.add(m,d.Point3.add(y,z));q=d.Point3.add(y,w).normalize();break;case d.ViewOrientation.LeftTop:case d.ViewOrientation.TopLeft:n=
d.Point3.add(m,d.Point3.add(y,w));q=d.Point3.add(x,w).normalize();break;case d.ViewOrientation.RightBottom:case d.ViewOrientation.BottomRight:n=d.Point3.add(m,d.Point3.add(x,z));q=d.Point3.add(x,w).normalize();break;case d.ViewOrientation.RightTop:case d.ViewOrientation.TopRight:n=d.Point3.add(m,d.Point3.add(x,w));q=d.Point3.add(y,w).normalize();break;default:n=d.Point3.add(m,v)}A=d.Point3.add(d.Point3.subtract(n,f).normalize().scale(h),f);B=d.Point3.add(d.Point3.subtract(n,f).normalize().scale(h-
p),f);c.setPosition(A);c.setTarget(B);c.setUp(q);return[2,c]}})})};f.prototype.setViewOrientation=function(a,e,c){void 0===e&&(e=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(g){switch(g.label){case 0:return[4,this.getViewOrientationCamera(a,c)];case 1:return b=g.sent(),void 0!==c?[3,3]:[4,this.fitWorld(e,b)];case 2:return g.sent(),[3,5];case 3:return[4,this.fitBounding(c,e,b)];case 4:g.sent(),g.label=5;case 5:return this._callbackManager.trigger("viewOrientation",
a),[2]}})})};f.prototype.centerCameraOnNode=function(a,e,c){void 0===e&&(e=0);void 0===c&&(c=this.getCamera());return __awaiter(this,void 0,void 0,function(){var b,g,k,f,n;return __generator(this,function(l){switch(l.label){case 0:return[4,this._model.getNodesBounding([a])];case 1:b=l.sent();g=b.center();k=c.getPosition();f=c.getTarget();n=d.Point3.subtract(f,g);k.subtract(n);c.setPosition(k);c.setTarget(g);if(0<e)return[2,this._setCameraPromise(c,e)];this.setCamera(c);return[2]}})})};f.prototype._setInitialView=
function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){if(!this._initialCamera)return[2,this.fitWorld(a)];if(0<a)return[2,this._setCameraPromise(this._initialCamera,a)];this.setCamera(this._initialCamera);this._eventDispatcher.injectViewOrientationChangeEvent();return[2]})})};f.prototype.getCanvasSize=function(){return this._engine.getCanvasSize()};f.prototype._setMarkupManager=function(a){this._markupManager=a};f.prototype.setStatisticsDisplayVisibility=function(a){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return a?[4,this._statistics.showDisplay()]:[3,2];case 1:return d.sent(),[3,3];case 2:this._statistics.hideDisplay(),d.label=3;case 3:return[2]}})})};f.prototype.getBackgroundColor=function(){var a=null!==this._backgroundColorTop?this._backgroundColorTop.copy():null,e=null!==this._backgroundColorBottom?this._backgroundColorBottom.copy():null;return new d.VerticalGradient(a,e)};f.prototype.setBackgroundColor=function(a,
e){void 0===a&&(a=null);void 0===e&&(e=null);this._backgroundColorTop=null!==a?a.copy():null;this._backgroundColorBottom=null!==e?e.copy():null;this._drawMode===d.DrawMode.HiddenLine||this._viewer.isDrawingSheetActive()||this._engine.setBackgroundGradient(this._backgroundColorTop,this._backgroundColorBottom);return Promise.resolve()};f.prototype.isolateNodes=function(a,e,c,b){void 0===e&&(e=d.DefaultTransitionDuration);void 0===c&&(c=!0);void 0===b&&(b=null);return __awaiter(this,void 0,void 0,function(){var g,
d,f,n,m;return __generator(this,function(k){switch(k.label){case 0:g=this._model.getAbsoluteRootNode();d=new Map;d.set(g,!1);f=0;for(n=a;f<n.length;f++)m=n[f],d.set(m,!0);return[4,this._model.setNodesVisibilities(d,b)];case 1:return k.sent(),c?[2,this.fitNodes(a,e)]:[2]}})})};f.prototype.fitNodes=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return[4,this._model.getNodesBounding(a)];
case 1:return c=b.sent(),[2,this.fitBounding(c,e)]}})})};f.prototype.fitWorld=function(a,d){void 0===a&&(a=0);return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return d||(d=this.getCamera()),[4,this._model.getModelBounding(this._boundingCalculationIgnoresInvisible,!1)];case 1:return c=b.sent(),[2,this.fitBounding(c,a,d)]}})})};f.prototype._fitCameraToBounding=function(a,e){var c=e.extents().length(),b=a.getWidth(),g=d.Point3.subtract(a.getPosition(),
a.getTarget()),k=g.length();b=c*k/b;e=e.center();g=d.Point3.add(e,g.normalize().scale(b));a.setTarget(e);a.setPosition(g);a.setWidth(c);a.setHeight(c)};f.prototype.fitBounding=function(a,e,c){void 0===e&&(e=d.DefaultTransitionDuration);void 0===c&&(c=this.getCamera());return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(a){this._fitCameraToBounding(c,a);if(0<e)return[2,this._setCameraPromise(c,e)];this.setCamera(c)}return[2]})})};f.prototype.setBackfacesVisible=function(a){this._backfacesVisible=
a;this._engine.setBackFacesVisible(a);return Promise.resolve()};f.prototype.getBackfacesVisible=function(){return this._backfacesVisible};f.prototype.setDrawMode=function(a){this._setDrawMode(a);return Promise.resolve()};f.prototype._setDrawMode=function(a){this._drawMode=a;this._drawMode!==d.DrawMode.HiddenLine&&this.setBackgroundColor(this._backgroundColorTop,this._backgroundColorBottom);switch(a){case d.DrawMode.Wireframe:this._engine.setDrawMode(1);this._setLineVisibility(!0);this._setFaceVisibility(!1);
break;case d.DrawMode.Shaded:this._engine.setDrawMode(1);this._setLineVisibility(!1);this._setFaceVisibility(!0);break;case d.DrawMode.WireframeOnShaded:this._engine.setDrawMode(1);this._setLineVisibility(!0);this._setFaceVisibility(!0);break;case d.DrawMode.HiddenLine:a=this._hiddenLineSettings.getBackgroundColor();this._setLineVisibility(!0);this._setFaceVisibility(!0);this._engine.enableHiddenLineRendering(this._hiddenLineSettings);this._engine.setBackgroundGradient(a,a);break;case d.DrawMode.XRay:this._engine.setDrawMode(3),
this._setLineVisibility(!0),this._setFaceVisibility(!0)}};f.prototype.getDrawMode=function(){return this._drawMode};f.prototype.setAntiAliasingMode=function(a){this._setAntiAliasingMode(a);return Promise.resolve()};f.prototype._setAntiAliasingMode=function(a){this._antiAliasingMode=a;this._engine.setAntiAliasingMode(a)};f.prototype.getAntiAliasingMode=function(){return this._antiAliasingMode};f.prototype.getHiddenLineSettings=function(){return this._hiddenLineSettings};f.prototype.setAmbientOcclusionEnabled=
function(a){void 0===a&&(a=!0);this._setAmbientOcclusionEnabled(a);return Promise.resolve()};f.prototype._setAmbientOcclusionEnabled=function(a){void 0===a&&(a=!0);this._ambientOcclusionEnabled=a;this._engine.setAmbientOcclusionEnabled(a)};f.prototype.getAmbientOcclusionEnabled=function(){return this._ambientOcclusionEnabled};f.prototype.setAmbientOcclusionRadius=function(a){this._setAmbientOcclusionRadius(a);return Promise.resolve()};f.prototype._setAmbientOcclusionRadius=function(a){this._ambientOcclusionRadius=
a;this._engine.setAmbientOcclusionRadius(a)};f.prototype.getAmbientOcclusionRadius=function(){return this._ambientOcclusionRadius};f.prototype.setLightingEnabled=function(a){void 0===a&&(a=!0);this._setLightingEnabled(a);return Promise.resolve()};f.prototype._setLightingEnabled=function(a){void 0===a&&(a=!0);this._lightingEnabled=a;this._engine.setLightingEnabled(a)};f.prototype.getLightingEnabled=function(){return this._lightingEnabled};f.prototype.setXRayOpacity=function(a,d){this._setXRayOpacity(a,
d);return Promise.resolve()};f.prototype._setXRayOpacity=function(a,d){this._engine.setXRayOpacity(a,d)};f.prototype.setXRayTransparencyMode=function(a){this._setXRayTransparencyMode(a);return Promise.resolve()};f.prototype._setXRayTransparencyMode=function(a){this._engine.setXRayTransparencyMode(a)};f.prototype.setXRayColor=function(a,e,c){void 0===c&&(c=d.XRayGroup.Selected);return this._engine.setXRayColor(c,a,e)};f.prototype.unsetXRayColor=function(a,e){void 0===e&&(e=d.XRayGroup.Selected);return this._engine.unsetXRayColor(e,
a)};f.prototype.setPointSize=function(a,d){this._setPointSize(a,d);return Promise.resolve()};f.prototype._setPointSize=function(a,d){this._engine.setPointSize(a,d)};f.prototype.getPointSize=function(){return this._engine.getPointSize()};f.prototype.setPointShape=function(a){this._setPointShape(a);return Promise.resolve()};f.prototype._setPointShape=function(a){this._engine.setPointShape(a)};f.prototype.getPointShape=function(){return this._engine.getPointShape()};f.prototype.setEyeDomeLightingEnabled=
function(a){void 0===a&&(a=!0);this._setEyeDomeLightingEnabled(a);return Promise.resolve()};f.prototype._setEyeDomeLightingEnabled=function(a){void 0===a&&(a=!0);this._engine.setEyeDomeLightingEnabled(a)};f.prototype.getEyeDomeLightingEnabled=function(){return this._engine.getEyeDomeLightingEnabled()};f.prototype.setEyeDomeLightingBlurSamples=function(a){this._setEyeDomeLightingBlurSamples(a);return Promise.resolve()};f.prototype._setEyeDomeLightingBlurSamples=function(a){this._engine.setEyeDomeLightingBlurSamples(a)};
f.prototype.getEyeDomeLightingBlurSamples=function(){return this._engine.getEyeDomeLightingBlurSamples()};f.prototype.setEyeDomeLightingBlurInterval=function(a){this._setEyeDomeLightingBlurInterval(a);return Promise.resolve()};f.prototype._setEyeDomeLightingBlurInterval=function(a){this._engine.setEyeDomeLightingBlurInterval(a)};f.prototype.getEyeDomeLightingBlurInterval=function(){return this._engine.getEyeDomeLightingBlurInterval()};f.prototype.setEyeDomeLightingBlurEdgeDistance=function(a){this._setEyeDomeLightingBlurEdgeDistance(a);
return Promise.resolve()};f.prototype._setEyeDomeLightingBlurEdgeDistance=function(a){this._engine.setEyeDomeLightingBlurEdgeDistance(a)};f.prototype.getEyeDomeLightingBlurEdgeDistance=function(){return this._engine.getEyeDomeLightingBlurEdgeDistance()};f.prototype.setEyeDomeLightingShadingEdgeDistance=function(a){this._setEyeDomeLightingShadingEdgeDistance(a);return Promise.resolve()};f.prototype._setEyeDomeLightingShadingEdgeDistance=function(a){this._engine.setEyeDomeLightingShadingEdgeDistance(a)};
f.prototype.getEyeDomeLightingShadingEdgeDistance=function(){return this._engine.getEyeDomeLightingShadingEdgeDistance()};f.prototype.setEyeDomeLightingOpacity=function(a){this._setEyeDomeLightingOpacity(a);return Promise.resolve()};f.prototype._setEyeDomeLightingOpacity=function(a){this._engine.setEyeDomeLightingOpacity(a)};f.prototype.getEyeDomeLightingOpacity=function(){return this._engine.getEyeDomeLightingOpacity()};f.prototype.setBoundingCalculationIgnoresInvisible=function(a){this._boundingCalculationIgnoresInvisible=
a};f.prototype.getBoundingCalculationIgnoresInvisible=function(){return this._boundingCalculationIgnoresInvisible};f.prototype.setDisplayIncompleteFrames=function(a){this._setDisplayIncompleteFrames(a);return Promise.resolve()};f.prototype._setDisplayIncompleteFrames=function(a){this._engine.setDisplayIncompleteFrames(a)};f.prototype.setInteractiveDrawDelay=function(a){this._setInteractiveDrawDelay(a);return Promise.resolve()};f.prototype._setInteractiveDrawDelay=function(a){this._engine.setInteractiveDrawDelay(a)};
f.prototype.getNavCube=function(){return this._navCube};f.prototype.getAxisTriad=function(){return this._axisTriad};f.prototype._determineViewAxes=function(a){var e=a.getUp().normalize();a=d.Point3.subtract(a.getTarget(),a.getPosition()).normalize();e=d.Internal.majorAxis(e);a=d.Internal.majorAxis(a);null===e&&null===a?(e=new d.Point3(0,1,0),a=new d.Point3(0,0,1)):null===e?e=0===a.y?new d.Point3(0,1,0):new d.Point3(0,0,1):null===a&&(a=0===e.z?new d.Point3(0,0,1):new d.Point3(0,1,0));this._model.setViewAxes(a,
e)};f.prototype.setAmbientLightColor=function(a){this._ambientLightColor=a;this._engine.setAmbientLightColor(a)};f.prototype.getAmbientLightColor=function(){return this._ambientLightColor};f.prototype.clearLights=function(){this._engine.clearLights()};f.prototype.addLight=function(a){this._engine.addLight(a)};f.prototype.setBloomEnabled=function(a){void 0===a&&(a=!0);this._engine.setBloomEnabled(a);this._bloomEnabled=a};f.prototype.getBloomEnabled=function(){return this._bloomEnabled};f.prototype.setBloomThreshold=
function(a){this._engine.setBloomThreshold(a);this._bloomThreshold=a};f.prototype.getBloomThreshold=function(){return this._bloomThreshold};f.prototype.setBloomThresholdRampWidth=function(a){this._engine.setBloomThresholdRampWidth(a);this._bloomThresholdRampWidth=a};f.prototype.getBloomThresholdRampWidth=function(){return this._bloomThresholdRampWidth};f.prototype.setBloomIntensityScale=function(a){this._engine.setBloomIntensityScale(a);this._bloomIntensityScale=a};f.prototype.getBloomIntensityScale=
function(){return this._bloomIntensityScale};f.prototype.setBloomLayers=function(a){a=d.Internal.deepClone(a);for(var e=0;e<a.length;e++){var c=a[e];void 0===c.intensity&&(c.intensity=1);void 0===c.blurSamples&&(c.blurSamples=9);void 0===c.blurInterval&&(c.blurInterval=[1,d.BlurIntervalUnit.Pixels])}this._engine.setBloomLayers(a);this._bloomLayers=a};f.prototype.getBloomLayers=function(){return d.Internal.deepClone(this._bloomLayers)};f.prototype.startComparison=function(a,e,c){var b=this._model._getModelStructure();
a=b.gatherInstanceIncsFromNodeIds(a,7,d.Internal.Tree.WalkRestriction.None);e=b.gatherInstanceIncsFromNodeIds(e,7,d.Internal.Tree.WalkRestriction.None);this._engine.startComparison(a,e,c)};f.prototype.endComparison=function(){this._engine.endComparison()};f.prototype.setSimpleShadowEnabled=function(a){void 0===a&&(a=!0);this._simpleShadowEnabled=a;this._engine.setSimpleShadowEnabled(a)};f.prototype.getSimpleShadowEnabled=function(){return this._simpleShadowEnabled};f.prototype.setSimpleShadowColor=
function(a){this._simpleShadowColor=a.copy();this._engine.setSimpleShadowColor(a)};f.prototype.getSimpleShadowColor=function(){return this._simpleShadowColor.copy()};f.prototype.setSimpleShadowOpacity=function(a){this._simpleShadowOpacity=a;this._engine.setSimpleShadowOpacity(a)};f.prototype.getSimpleShadowOpacity=function(){return this._simpleShadowOpacity};f.prototype.setGroundPlane=function(a){this._groundPlane=__assign({},a);this._updateGroundPlane()};f.prototype._updateGroundPlane=function(a,
e){if(this._groundPlane.followViewAxes&&(void 0!==a&&void 0!==e||this._model.viewAxesHaveBeenSet())){if(void 0===a||void 0===e)e=this._model.getViewAxes(),a=e.frontVector,e=e.upVector;a=a.copy().negate();var c=d.Point3.cross(e,a);a=d.Matrix.createFromBasis(a,c,e);e=new d.Point3(0,0,0);a.transform(this._groundPlane.normal,e);this._engine.setGroundPlane(e,this._groundPlane.position)}else this._engine.setGroundPlane(this._groundPlane.normal,this._groundPlane.position)};f.prototype.getGroundPlane=function(){return __assign({},
this._groundPlane)};f.prototype.setSimpleShadowResolution=function(a){this._simpleShadowResolution=a;this._engine.setSimpleShadowResolution(a)};f.prototype.getSimpleShadowResolution=function(){return this._simpleShadowResolution};f.prototype.setSimpleShadowBlurSamples=function(a){this._simpleShadowBlurSamples=a;this._engine.setSimpleShadowBlurSamples(a)};f.prototype.getSimpleShadowBlurSamples=function(){return this._simpleShadowBlurSamples};f.prototype.setSimpleShadowBlurInterval=function(a){this._simpleShadowBlurInterval=
a;this._engine.setSimpleShadowBlurInterval(a)};f.prototype.getSimpleShadowBlurInterval=function(){return this._simpleShadowBlurInterval};f.prototype.setSimpleShadowInteractiveUpdateEnabled=function(a){void 0===a&&(a=!0);this._simpleShadowInteractiveUpdateEnabled=a;this._engine.setSimpleShadowInteractiveUpdateEnabled(a)};f.prototype.getSimpleShadowInteractiveUpdateEnabled=function(){return this._simpleShadowInteractiveUpdateEnabled};f.prototype.setSilhouetteEnabled=function(a){void 0===a&&(a=!0);this._silhouetteEnabled=
a;this._engine.setSilhouetteEnabled(a)};f.prototype.getSilhouetteEnabled=function(){return this._silhouetteEnabled};f.prototype.setSilhouetteColor=function(a){this._silhouetteColor=a.copy();this._engine.setSilhouetteColor(a)};f.prototype.getSilhouetteColor=function(){return this._silhouetteColor.copy()};f.prototype.setSilhouetteOpacity=function(a){this._silhouetteOpacity=a;this._engine.setSilhouetteOpacity(a)};f.prototype.getSilhouetteOpacity=function(){return this._silhouetteOpacity};f.prototype.setSilhouetteThreshold=
function(a){this._silhouetteThreshold=a;this._engine.setSilhouetteThreshold(a)};f.prototype.getSilhouetteThreshold=function(){return this._silhouetteThreshold};f.prototype.setSilhouetteThresholdRampWidth=function(a){this._silhouetteThresholdRampWidth=a;this._engine.setSilhouetteThresholdRampWidth(a)};f.prototype.getSilhouetteThresholdRampWidth=function(){return this._silhouetteThresholdRampWidth};f.prototype.setSimpleReflectionEnabled=function(a){void 0===a&&(a=!0);this._simpleReflectionEnabled=a;
this._engine.setSimpleReflectionEnabled(a)};f.prototype.getSimpleReflectionEnabled=function(){return this._simpleReflectionEnabled};f.prototype.setSimpleReflectionBlurInterval=function(a,e){void 0===e&&(e=d.BlurIntervalUnit.Pixels);this._simpleReflectionBlurInterval=[a,e];this._engine.setSimpleReflectionBlurInterval(a,e)};f.prototype.getSimpleReflectionBlurInterval=function(){return[this._simpleReflectionBlurInterval[0],this._simpleReflectionBlurInterval[1]]};f.prototype.setSimpleReflectionBlurSamples=
function(a){this._simpleReflectionBlurSamples=a;this._engine.setSimpleReflectionBlurSamples(a)};f.prototype.getSimpleReflectionBlurSamples=function(){return this._simpleReflectionBlurSamples};f.prototype.setSimpleReflectionFadeAngle=function(a){this._simpleReflectionFadeAngle=a;this._engine.setSimpleReflectionFadeAngle(a)};f.prototype.getSimpleReflectionFadeAngle=function(){return this._simpleReflectionFadeAngle};f.prototype.setSimpleReflectionOpacity=function(a){this._simpleReflectionOpacity=a;this._engine.setSimpleReflectionOpacity(a)};
f.prototype.getSimpleReflectionOpacity=function(){return this._simpleReflectionOpacity};f.prototype.setSimpleReflectionAttenuation=function(a,e,c){void 0===c&&(c=d.SimpleReflectionAttenuationUnit.World);this._simpleReflectionAttenuation={nearDistance:a,farDistance:e,unit:c};this._engine.setSimpleReflectionAttenuation(a,e,c)};f.prototype.getSimpleReflectionAttenuation=function(){return __assign({},this._simpleReflectionAttenuation)};f.prototype.testPointVisibility=function(a){return this._engine.testPointVisibility(a)};
f.prototype.setPointVisibilityTest=function(a){this._engine.setPointVisibilityTest(a)};__decorate([f.deprecated],f.prototype,"endVolumeSelection",null);__decorate([f.deprecated],f.prototype,"advanceVolumeSelection",null);return f}();d.View=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(a){var e=this;this._callbackManager=new d.Internal.CallbackManager;this._interpolationManager=new d.Internal.InterpolationManager;this._streamingMode=d.StreamingMode.Interactive;this._rendererType=d.RendererType.Client;this._alreadyShutDown=!1;this._sceneReadyPromise=d.Util.OpenPromise.create();this._seenPriorityMetaDataSent=!1;this._params=__assign({},a);this._contextMenuActiveFlag=!1;if(void 0!==this._params.containerId){a=d.Internal.DomElements.createFromId(this._params.containerId);
if(null===a)throw new d.ParseError("'containerId' is invalid");this._domElements=a}else if(void 0!==this._params.container)this._domElements=d.Internal.DomElements.createFromElement(this._params.container);else throw new d.ParseError("must supply 'container' or 'containerId'");this.operatorManager=new d.OperatorManager(this);this._eventDispatcher=new d.Internal.EventDispatcher(this._callbackManager,this.operatorManager);this._timeoutMonitor=new d.Internal.TimeoutMonitor(this._callbackManager);this._inputMonitor=
new d.Internal.InputMonitor(this._eventDispatcher,this._timeoutMonitor);this._setInitialOptions(this._params);this._engine=new d.Internal.ScEngine(this._callbackManager,this._params);this._statistics=new d.Internal.Statistics(this._callbackManager,this);a=new d.NavCube(this);var c=new d.AxisTriad(this);this.model=new d.Model(this._engine,this._callbackManager);this.view=new d.View(this,this._engine,this._callbackManager,this._eventDispatcher,this._interpolationManager,this._statistics,a,c);this.cuttingManager=
new d.CuttingManager(this,this.model,this._callbackManager,this._engine);a={disableAutomaticFitWorld:d.Internal.getWithDefault(this._params.disableAutomaticFitWorld,!1),markImplicitNodesOutOfHierarchy:d.Internal.getWithDefault(this._params._markImplicitNodesOutOfHierarchy,!0),streamingMode:d.Internal.getWithDefault(this._params.streamingMode,d.StreamingMode.Default)};this._modelStructure=d.Internal.Tree.ModelStructure.unsafeCreate(a,this._engine,this._callbackManager,this.cuttingManager,this.view,
this.model,this._params._maxConcurrentAttachments||null);this.model._setModelStructure(this._modelStructure);this.measureManager=new d.MeasureManager(this,this._callbackManager);this.lineManager=new d.LineManager(this,this._callbackManager);this.explodeManager=new d.ExplodeManager(this.model,this._engine,this._callbackManager);this.overlayManager=new d.OverlayManager(this,this._engine);this.BCFManager=new d.BCFManager(this);this.selectionManager=new d.SelectionManager(this._callbackManager,this._engine,
this.view,this.model,this._modelStructure);a=d.Internal.getWithDefault(this._params.disableAutomaticBackgroundSheets,!1);this._sheetManager=new d.Internal.SheetManager(this,this._engine,this._callbackManager,a);this._noteTextManager=new d.Internal.NoteTextManager(this);this.markupManager=new d.MarkupManager(this._domElements,this.measureManager,this.lineManager,this._callbackManager,this._sheetManager,this._noteTextManager,this);this.view._setMarkupManager(this.markupManager);this._initEventDispatcher();
var b=function(b){if(!e.isDrawingSheetActive()){e.model._setInstanceModifier(d.InstanceModifier.OverrideSceneVisibility,b,!0,6);for(var c=0;c<b.length;c++)e.model.setPmiColorOverride(!0,b[c])}},g=function(b){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return b?[4,Promise.all([this.view.setPointSize(.003,d.PointSizeUnit.ProportionOfBoundingDiagonal),this.view.setEyeDomeLightingEnabled(!0),this.view.setPointShape(d.PointShape.Disk)])]:[3,2];
case 1:return c.sent(),[3,4];case 2:return[4,Promise.all([this.view.setPointSize(1,d.PointSizeUnit.ScreenPixels),this.view.setEyeDomeLightingEnabled(!1),this.view.setPointShape(d.PointShape.Square)])];case 3:c.sent(),c.label=4;case 4:return[2]}})})},k=function(b){return __awaiter(e,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return c=this.model.getModelFileTypeFromNode(b[0]),null===c||c===d.FileType.Unknown?[3,2]:[4,g(!1)];case 1:a.sent(),a.label=2;case 2:return[2]}})})},
f=function(b){return __awaiter(e,void 0,void 0,function(){var c,a,g,e,k;return __generator(this,function(f){switch(f.label){case 0:c=[];if(this.model.getModelFileTypeFromNode(b[0])===d.FileType.Ifc)for(a=0,g=b;a<g.length;a++)e=g[a],k=this.model.registerIfcNodes(e),c.push(k);return[4,Promise.all(c)];case 1:return f.sent(),[2]}})})},n=function(b){e.model.getModelFileTypeFromNode(b[0])===d.FileType.Ifc?e.selectionManager.setSelectionFilter(d.SelectionManager.ifcSelectionFilter):e.selectionManager.setSelectionFilter(null)};
this.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(b){e.model.setPmiColor(d.Color.black());return[2]})})},_sessionStarted:function(){return g(!0)},_firstModelLoaded:function(c){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return e.model.setPmiColor(d.Color.black()),n(c),b([this.model.getAbsoluteRootNode()]),[4,Promise.all([f(c),k(c)])];case 1:return a.sent(),[2]}})})},
_modelSwitched:function(c,a){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return n(a),b(a),[4,Promise.all([f(a),k(a)])];case 1:return c.sent(),[2]}})})},_subtreeLoaded:function(c){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return b(c),[4,f(c)];case 1:return a.sent(),[2]}})})},subtreeLoaded:function(b,c){e._callbackManager.trigger("modelLoaded",b,c)}})}f.deprecated=function(a,d,c){var b=
c.value;c.value=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];this._callbackManager.trigger("deprecated","WebViewer",d);return b.apply(this,c)};return c};f.prototype.setContextMenuStatus=function(a){this._contextMenuActiveFlag=a};f.prototype.getContextMenuStatus=function(){return this._contextMenuActiveFlag};f.prototype.deactivateSheets=function(){return this._sheetManager.deactivateSheets()};f.prototype.setActiveSheetId=function(a){return this._sheetManager.setActiveSheetId(a,
!0,!0)};f.prototype.getActiveSheetId=function(){return this._sheetManager.getActiveSheetId()};f.prototype.getSheetIds=function(){return this._sheetManager.getSheets()};f.prototype.isDrawingSheetActive=function(){return this.model.isDrawing()?this._sheetManager.isDrawingSheetActive():!1};f.prototype.enableBackgroundSheet=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._sheetManager.setBackgroundSheetEnabled(a)]})})};f.prototype.setBackgroundSheetEnabled=
function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._sheetManager.setBackgroundSheetEnabled(a)]})})};f.prototype.getBackgroundSheetEnabled=function(){return this._sheetManager.getBackgroundSheetEnabled()};f.prototype.setBackgroundSelectionEnabled=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._sheetManager.setBackgroundSelectionEnabled(a)]})})};f.prototype.getBackgroundSelectionEnabled=
function(){return this._sheetManager.getBackgroundSelectionEnabled()};f.prototype.setSheetColors=function(a,d,c){return this._sheetManager.setSheetColors(a,d,c)};f.prototype.getSheetBackgroundColor=function(){return this._sheetManager.getSheetBackgroundColor()};f.prototype.getSheetColor=function(){return this._sheetManager.getSheetColor()};f.prototype.getSheetShadowColor=function(){return this._sheetManager.getSheetShadowColor()};f.prototype.getCreationParameters=function(){return __assign({},this._params)};
f.prototype._setInitialOptions=function(a){this._inputMonitor.setOptions(a);void 0!==a.streamingMode?this._streamingMode=a.streamingMode:a.streamingMode=this._streamingMode;void 0!==a.rendererType?this._rendererType=a.rendererType:a.rendererType=this._rendererType};f.prototype._initEventDispatcher=function(){var a=new d.Operator.CameraOrbitOperator(this),e=new d.Operator.CameraPanOperator(this),c=new d.Operator.CameraZoomOperator(this),b=new d.Operator.CameraNavigationOperator(this,a,e,c),g=new d.Operator.CameraWalkOperator(this),
k=new d.Operator.CameraKeyboardWalkOperator(this),f=new d.Operator.CameraWalkModeOperator(this,g,k),n=new d.Operator.CameraTurntableOperator(this),m=new d.Operator.SelectionOperator(this,this._noteTextManager),p=new d.Operator.AreaSelectionOperator(this),h=new d.Operator.RayDrillSelectionOperator(this),q=new d.Operator.RedlineCircleOperator(this),u=new d.Operator.RedlineTextOperator(this),t=new d.Operator.RedlineRectangleOperator(this),v=new d.Operator.RedlinePolylineOperator(this),w=new d.Operator.MeasureEdgeLengthOperator(this,
this.measureManager),z=new d.Operator.MeasureFaceFaceDistanceOperator(this,this.measureManager),y=new d.Operator.MeasurePointPointDistanceOperator(this,this.measureManager),x=new d.Operator.MeasureFaceFaceAngleOperator(this,this.measureManager),A=new d.Operator.NoteOperator(this,this._noteTextManager),B=new d.Operator.CuttingPlaneOperator(this,this.cuttingManager),D=new d.Operator.HandleOperator(this),C=new d.Operator.NavCubeOperator(this),E=new d.Operator.AxisTriadOperator(this);this.operatorManager._registerOperator(d.OperatorId.Navigate,
b);this.operatorManager._registerOperator(d.OperatorId.Orbit,a);this.operatorManager._registerOperator(d.OperatorId.Pan,e);this.operatorManager._registerOperator(d.OperatorId.Zoom,c);this.operatorManager._registerOperator(d.OperatorId.Walk,g);this.operatorManager._registerOperator(d.OperatorId.KeyboardWalk,k);this.operatorManager._registerOperator(d.OperatorId.WalkMode,f);this.operatorManager._registerOperator(d.OperatorId.Turntable,n);this.operatorManager._registerOperator(d.OperatorId.Select,m);
this.operatorManager._registerOperator(d.OperatorId.AreaSelect,p);this.operatorManager._registerOperator(d.OperatorId.RayDrillSelect,h);this.operatorManager._registerOperator(d.OperatorId.RedlineCircle,q);this.operatorManager._registerOperator(d.OperatorId.RedlineText,u);this.operatorManager._registerOperator(d.OperatorId.RedlineRectangle,t);this.operatorManager._registerOperator(d.OperatorId.RedlinePolyline,v);this.operatorManager._registerOperator(d.OperatorId.MeasureEdgeLength,w);this.operatorManager._registerOperator(d.OperatorId.MeasureFaceFaceDistance,
z);this.operatorManager._registerOperator(d.OperatorId.MeasurePointPointDistance,y);this.operatorManager._registerOperator(d.OperatorId.MeasureFaceFaceAngle,x);this.operatorManager._registerOperator(d.OperatorId.Note,A);this.operatorManager._registerOperator(d.OperatorId.Cutting,B);this.operatorManager._registerOperator(d.OperatorId.Handle,D);this.operatorManager._registerOperator(d.OperatorId.NavCube,C);this.operatorManager._registerOperator(d.OperatorId.AxisTriad,E);a.addMapping(d.Button.Left);
a.addMapping(d.Button.Middle);c.addMapping(d.Button.Left,d.KeyModifiers.Shift);e.addMapping(d.Button.Right);e.addMapping(d.Button.Left,d.KeyModifiers.Control);w.addMapping(d.Button.Left);z.addMapping(d.Button.Left);y.addMapping(d.Button.Left);y.addMapping(d.Button.Left,d.KeyModifiers.Alt);x.addMapping(d.Button.Left);B.addMapping(d.Button.Left);p.addMapping(d.Button.Left);p.addMapping(d.Button.Left,d.KeyModifiers.Control);this.operatorManager.set(d.OperatorId.Navigate,0);this.operatorManager.set(d.OperatorId.Select,
1);this.operatorManager.push(d.OperatorId.Cutting);this.operatorManager.push(d.OperatorId.Handle);this.operatorManager.push(d.OperatorId.NavCube);this.operatorManager.push(d.OperatorId.AxisTriad)};f.prototype.getViewerVersionString=function(){return f.VIEWER_VERSION_STRING};f.prototype.getFormatVersionString=function(){return this._engine.getVersionString()};f.prototype.getView=function(){return this.view};f.prototype.getModel=function(){return this.model};f.prototype.getOverlayManager=function(){return this.overlayManager};
f.prototype.getMeasureManager=function(){return this.measureManager};f.prototype.getLineManager=function(){return this.lineManager};f.prototype.getCuttingManager=function(){return this.cuttingManager};f.prototype.getMarkupManager=function(){return this.markupManager};f.prototype.getSelectionManager=function(){return this.selectionManager};f.prototype.getExplodeManager=function(){return this.explodeManager};f.prototype.getOperatorManager=function(){return this.operatorManager};f.prototype._getNoteTextManager=
function(){return this._noteTextManager};f.prototype._getSheetManager=function(){return this._sheetManager};f.prototype.start=function(){var a=this,d=this._domElements.getCanvasContainerElement();return this._engine.start(d,{enginePath:this._params.enginePath,engineReady:function(c){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,c];case 1:return b.sent(),[4,this._modelStructure.waitForReady()];case 2:return b.sent(),[4,this._scEngineReady()];
case 3:return b.sent(),[2]}})})},sceneReady:function(){a._sceneReady()},renderComplete:function(){a._renderComplete()},streamingActivated:function(){a._streamingActivated()},streamingDeactivated:function(){a._streamingDeactivated()},priorityMetaDataSent:function(c,b){a._priorityMetaDataSent(c,b)}})};f.prototype.registerCustomOperator=function(a){return this.operatorManager.registerCustomOperator(a)};f.prototype.unregisterCustomOperator=function(a){this.operatorManager.unregisterCustomOperator(a)};
f.prototype.focusInput=function(a){this._inputMonitor.focusInput(a)};f.prototype.setCallbacks=function(a){this._callbackManager.bind(a)};f.prototype.unsetCallbacks=function(a){this._callbackManager.unbind(a)};f.prototype.resizeCanvas=function(){this._alreadyShutDown||(this._engine.resize(),this._inputMonitor.elementResize())};f.prototype.moveToWindow=function(a){this._inputMonitor.setDocument(a.document)};f.prototype.redraw=function(a){var d=this;if(a){var c=function(){d._callbackManager.unbind({_drawComplete:c});
a()};this._callbackManager.bind({_drawComplete:c})}this._engine.redraw()};f.prototype.selectPart=function(a,e){void 0===e&&(e=d.SelectionMode.Set);return this.selectionManager.selectNode(a,e)};f.prototype.trigger=function(a){for(var d=[],c=1;c<arguments.length;c++)d[c-1]=arguments[c];this._callbackManager.unsafeTrigger(a,d)};f.prototype.triggerEvent=function(a,d){this._callbackManager.unsafeTrigger(a,d)};f.prototype._getCallbackManager=function(){return this._callbackManager};f.prototype._setStreamIdleMarker=
function(){return this._engine.setStreamIdleMarker()};f.prototype.getStatistics=function(a){void 0===a&&(a=!1);return this._engine.getStatistics(a)};f.prototype.setMinimumFramerate=function(a){this._setMinimumFramerate(a);return Promise.resolve()};f.prototype._setMinimumFramerate=function(a){this._engine.setMinimumFramerate(a)};f.prototype.getMinimumFramerate=function(){return this._engine.getMinimumFramerate()};f.prototype.setServerRenderQuality=function(a,d,c,b){return this._engine.setServerRenderQuality(a,
d,c,b)};f.prototype.getStreamingMode=function(){return this._streamingMode};f.prototype.getRendererType=function(){return this._engine.getRendererType()};f.prototype.getViewElement=function(){return this._domElements.getCanvasContainerElement()};f.prototype.shutdown=function(){this._alreadyShutDown||(console.assert(this._modelStructure.isReady()),this._callbackManager.trigger("_shutdownBegin"),this.operatorManager._shutdown(),this._inputMonitor.shutdown(),this.markupManager._shutdown(),this._timeoutMonitor.shutdown(),
this._modelStructure.shutdown(),this._domElements.shutdown(),this._engine.shutdown(),this._alreadyShutDown=!0)};f.prototype.setClientTimeout=function(a,d){return this._timeoutMonitor.setTimeoutDurations(a,d)};f.prototype.resetClientTimeout=function(){this._timeoutMonitor.resetTimeout()};f.prototype.pauseRendering=function(){this._pauseRendering();return Promise.resolve()};f.prototype._pauseRendering=function(){this._engine.pauseRendering()};f.prototype.resumeRendering=function(){this._resumeRendering();
return Promise.resolve()};f.prototype._resumeRendering=function(){this._engine.resumeRendering()};f.prototype.delayCapping=function(){this.cuttingManager.delayCapping()};f.prototype.reset=function(a){void 0===a&&(a=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:return(d=null!==this.model.getDefaultCadConfiguration())?[4,this._modelStructure.cadConfigurationsEnabled()]:[3,2];case 1:d=c.sent(),c.label=2;case 2:return d?
[4,this.model.activateDefaultCadConfiguration()]:[3,4];case 3:return c.sent(),[3,7];case 4:return[4,this.model.reset()];case 5:return c.sent(),this.isDrawingSheetActive()?[3,7]:[4,this.view.resetCamera(a)];case 6:c.sent(),c.label=7;case 7:return[2]}})})};f.prototype.closeConnection=function(){this.view.setCamera(this.view.getCamera());this._engine.disconnectNetwork();this._timeoutMonitor.shutdown()};f.prototype.setAllowHighDpi=function(a){this._engine.setAllowHighDpi(a)};f.prototype.setAllowHighDPI=
function(a){this.setAllowHighDpi(a)};f.prototype.getAllowHighDpi=function(){return this._engine.getAllowHighDpi()};f.prototype.getAllowHighDPI=function(){return this.getAllowHighDpi()};f.prototype.takeSnapshot=function(a){var e=this;void 0===a&&(a=new d.SnapshotConfig);var c=d.Util.OpenPromise.create(),b=new d.Internal.Snapshot(this._domElements,a),g=this._domElements.getCanvasContainerElement(),k=this._domElements.getRedlineElement(),f=0<a.width&&0<a.height;if(f){var n=a.width/g.clientWidth*100+
"%";a=a.height/g.clientHeight*100+"%";g.style.width=n;g.style.height=a;k.style.width=n;k.style.height=a}var m=this.getAllowHighDpi();this._engine.setAllowHighDpi(!1);this._engine.resize();this.redraw(function(){return __awaiter(e,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return[4,b.capture(g)];case 1:return a=d.sent(),f&&(g.style.width="100%",g.style.height="100%",k.style.width="100%",k.style.height="100%"),this._engine.setAllowHighDpi(m),this._engine.resize(),
c.resolve(a),[2]}})})});return c};f.prototype.fitWorld=function(a){void 0===a&&(a=d.DefaultTransitionDuration);return this.view.fitWorld(a)};f.prototype.setViewOrientation=function(a,e){void 0===e&&(e=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this.view.setViewOrientation(a,e)];case 1:return c.sent(),this._eventDispatcher.injectViewOrientationChangeEvent(),[2]}})})};f.prototype._scEngineReady=function(){return __awaiter(this,
void 0,void 0,function(){var a,e,c,b,g,k,f=this;return __generator(this,function(l){switch(l.label){case 0:console.assert(this._modelStructure.isReady()),a=this.model.getAbsoluteRootNode(),e=this._engine.getSessionType(),l.label=1;case 1:return l.trys.push([1,,18,19]),this.cuttingManager._init(),[4,this._sceneReadyPromise];case 2:return l.sent(),[4,this._callbackManager.promiseTrigger("_assemblyTreeReady","assemblyTreeReady")];case 3:l.sent(),c=function(){f._modelStructure.notifyFirstLoadIsEmptyModel()},
b="",l.label=4;case 4:l.trys.push([4,16,,17]);if(1!==e)return[3,8];b=this._engine.getNetworkModelName();if(b!==d.EmptyModelName)return[3,5];c();return[3,7];case 5:return[4,this.model.loadSubtreeFromModel(a,b)];case 6:l.sent(),l.label=7;case 7:return[3,15];case 8:if(2!==e)return[3,14];this._timeoutMonitor.shutdown();g=this._engine.getScsInfo();return"string"!==typeof g?[3,10]:[4,this.model.loadSubtreeFromScsFile(a,g)];case 9:return l.sent(),[3,13];case 10:return null===g?[3,12]:[4,this.model.loadSubtreeFromScsBuffer(a,
g)];case 11:return l.sent(),[3,13];case 12:c(),l.label=13;case 13:return[3,15];case 14:throw new d.InternalLogicError;case 15:return[3,17];case 16:throw k=l.sent(),this._callbackManager.trigger("modelLoadFailure",b,""+k,k),k;case 17:return[3,19];case 18:return console.assert(this._modelStructure.isReady()),[2,this._callbackManager.promiseTrigger("_modelStructureReady","modelStructureReady")];case 19:return[2]}})})};f.prototype._sceneReady=function(){var a=this;this._inputMonitor.bindEvents(this._domElements.getCanvasContainerElement());
this.selectionManager._init();this._callbackManager.bind({_timeout:function(){a.shutdown()}});this._callbackManager.trigger("sceneReady");this._sceneReadyPromise&&this._sceneReadyPromise.resolve()};f.prototype._priorityMetaDataSent=function(a,e){this._callbackManager.trigger("_priorityMetaDataSent",a,e);if(!this._seenPriorityMetaDataSent){if(0!==a||0!==e)throw new d.InternalLogicError;this._seenPriorityMetaDataSent=!0;this._callbackManager.trigger("_attached",0)}};f.prototype._renderComplete=function(){this.markupManager._update()};
f.prototype._streamingActivated=function(){this._callbackManager.trigger("streamingActivated")};f.prototype._streamingDeactivated=function(){this._callbackManager.trigger("streamingDeactivated")};f.prototype.setStreamCutoffScale=function(a){this._setStreamCutoffScale(a);return Promise.resolve()};f.prototype._setStreamCutoffScale=function(a){this._engine.setStreamCutoffScale(a)};f.prototype.getStreamCutoffScale=function(){return this._engine.getStreamCutoffScale()};f.prototype._loseWebGlContext=function(){return this._engine.loseWebGlContext()};
f.prototype._getScEngine=function(){return this._engine};f.prototype._debug_log=function(a){return this._engine.debug_log(a)};f.prototype._debug_stateFailure=function(a){return this._engine.debug_stateFailure(a)};f.prototype._debug_sync=function(){return this._engine.debug_sync()};f.prototype.exportToSvg=function(a){void 0===a&&(a=new d.SvgConfig);return this._engine.exportToSvg(a)};f.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){var a,e,c;return __generator(this,
function(b){switch(b.label){case 0:return this._alreadyShutDown?[2]:[4,this._setStreamIdleMarker()];case 1:return b.sent(),a=[],this.cuttingManager.hasActiveCuttingSection()?[4,this.cuttingManager.enableCappingIdleCallback(!0)]:[3,3];case 2:(e=b.sent())||a.push(this.cuttingManager.waitForCappingIdle()),b.label=3;case 3:return a.push(this._engine.waitForImageDecoding()),[4,Promise.all(a)];case 4:return b.sent(),c=d.Util.OpenPromise.create(),this.redraw(function(){c.resolve()}),[4,c];case 5:return b.sent(),
[2]}})})};f.prototype.startSheetComparison=function(a,d,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._sheetManager.startComparison(a,d,c)];case 1:return b.sent(),[2]}})})};f.prototype.endSheetComparison=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._sheetManager.endComparison()];case 1:return a.sent(),[2]}})})};f.BUILD_ID="f8b8e66";f.VIEWER_VERSION_STRING=
"8.0 Build "+f.BUILD_ID;__decorate([f.deprecated],f.prototype,"enableBackgroundSheet",null);__decorate([f.deprecated],f.prototype,"getView",null);__decorate([f.deprecated],f.prototype,"getModel",null);__decorate([f.deprecated],f.prototype,"getOverlayManager",null);__decorate([f.deprecated],f.prototype,"getMeasureManager",null);__decorate([f.deprecated],f.prototype,"getLineManager",null);__decorate([f.deprecated],f.prototype,"getCuttingManager",null);__decorate([f.deprecated],f.prototype,"getMarkupManager",
null);__decorate([f.deprecated],f.prototype,"getSelectionManager",null);__decorate([f.deprecated],f.prototype,"getExplodeManager",null);__decorate([f.deprecated],f.prototype,"getOperatorManager",null);__decorate([f.deprecated],f.prototype,"setAllowHighDPI",null);__decorate([f.deprecated],f.prototype,"getAllowHighDPI",null);return f}();d.WebViewer=h})(Communicator||(Communicator={}));
(function(d){(function(h){function f(c){for(var b=2*Math.PI/c,a=[],d=0;d<c;d++){var e=d*b,f=Math.sin(e);a.push(Math.cos(e));a.push(f)}return a}function a(c,b,a,e){void 0===e&&(e=1);var g=d.Point3.cross(a,new d.Point3(0,1,0));.001>g.length()&&(g=d.Point3.cross(a,new d.Point3(0,0,1)));a=d.Point3.cross(g,a);for(var k=2*Math.PI/c,f=[],p=0;p<c;p++){var h=p*k,q=Math.sin(h);h=Math.cos(h);q=g.copy().scale(q).add(a.copy().scale(h)).scale(e).add(b);f.push(q)}return f}function e(c,b,a,e,f){for(var g=[],k=[],
l=0;l<a.length;l++){var h=(l+1)%a.length;g.push(a[l]);g.push(a[h]);g.push(e[l]);g.push(a[h]);g.push(e[h]);g.push(e[l]);k.push(d.Point3.subtract(a[l],c));k.push(d.Point3.subtract(a[h],c));k.push(d.Point3.subtract(e[l],b));k.push(d.Point3.subtract(a[h],c));k.push(d.Point3.subtract(e[h],b));k.push(d.Point3.subtract(e[l],b))}if(f)for(c=d.Point3.subtract(c,b),b=0;b<k.length;b++)k[b].add(c).normalize();return[g,k]}h.generateSphereMeshData=function(){var c=(1+Math.sqrt(5))/2,b=Math.sqrt(10+2*Math.sqrt(5))/
(4*c),a=b/2;c=b/(2*c);var e=[];e[0]=new d.Point3(-c,a,0);e[1]=new d.Point3(c,a,0);e[2]=new d.Point3(-c,-a,0);e[3]=new d.Point3(c,-a,0);e[4]=new d.Point3(0,-c,a);e[5]=new d.Point3(0,c,a);e[6]=new d.Point3(0,-c,-a);e[7]=new d.Point3(0,c,-a);e[8]=new d.Point3(a,0,-c);e[9]=new d.Point3(a,0,c);e[10]=new d.Point3(-a,0,-c);e[11]=new d.Point3(-a,0,c);for(a=0;a<e.length;a++)e[a].normalize();var f=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,
6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],n=12;a=function(b){var c=[];f.map(function(b){var a=e[b[0]],g=e[b[1]],k=e[b[2]];e[n++]=(new d.Point3(a.x+g.x,a.y+g.y,a.z+g.z)).scale(.5).normalize();e[n++]=(new d.Point3(g.x+k.x,g.y+k.y,g.z+k.z)).scale(.5).normalize();e[n++]=(new d.Point3(k.x+a.x,k.y+a.y,k.z+a.z)).scale(.5).normalize();c.push([b[0],n-3,n-1]);c.push([n-3,n-2,n-1]);c.push([n-3,b[1],n-2]);c.push([n-2,b[2],n-1])});f=c};for(c=0;2>c;c++)a(c);a=[];c=[];b=0;for(var m=f;b<m.length;b++)for(var p=
m[b],h=0;3>h;h++){var q=p[h];a.push(e[q].x);a.push(e[q].y);a.push(e[q].z);q=e[q].normalize();c.push(q.x);c.push(q.y);c.push(q.z)}b=new d.MeshData;b.addFaces(a,c);b.setFaceWinding(d.FaceWinding.CounterClockwise);return b};h.generateConeCylinderMeshData=function(c,b,g,k,l,n){var m=new d.Matrix,p,h=g+n,q=f(b);for(p=0;p<q.length;p++)q[p]*=k;l=new d.Point3(0,h+l,0);p=new d.Point3(0,h,0);var u=m.transform(l),t=m.transform(p);l=[];var v=[];for(p=0;p<q.length;p+=2){var w=q[p],z=q[p+1],y=(p+2)%q.length,x=
q[y],A=q[y+1],B=q[p],D=q[p+1],C=q[y];y=q[y+1];var E=new d.Point3(w,h,z),F=new d.Point3(x,h,A);E=m.transform(E);F=m.transform(F);l.push(u);l.push(E);l.push(F);F=new d.Point3(0,1,0);B=new d.Point3(B,0,D);C=new d.Point3(C,0,y);D=m.transform(F);B=m.transform(B);C=m.transform(C);v.push(D);v.push(B);v.push(C);w=new d.Point3(w,h,z);x=new d.Point3(x,h,A);A=m.transform(w);x=m.transform(x);l.push(t);l.push(x);l.push(A);x=new d.Point3(0,-1,0);x=m.transform(x);v.push(x);v.push(x);v.push(x)}h=[];q=[];for(p=0;p<
l.length;p++)u=l[p],h.push(u.x),h.push(u.y),h.push(u.z),u=v[p],q.push(u.x),q.push(u.y),q.push(u.z);p=[h,q];l=[];v=[];q=f(b);for(h=0;h<q.length;h++)q[h]*=c;u=[];t=[];for(h=0;h<q.length;h+=2){x=q[h];A=q[h+1];y=(h+2)%q.length;w=q[y];z=q[y+1];C=q[h];B=q[h+1];D=q[y];y=q[y+1];u[0]=new d.Point3(x,g,A);u[1]=new d.Point3(x,0,A);u[2]=new d.Point3(w,0,z);u[3]=new d.Point3(w,0,z);u[4]=new d.Point3(w,g,z);u[5]=new d.Point3(x,g,A);t[0]=new d.Point3(C,0,B);t[1]=new d.Point3(C,0,B);t[2]=new d.Point3(D,0,y);t[3]=
new d.Point3(D,0,y);t[4]=new d.Point3(D,0,y);t[5]=new d.Point3(C,0,B);for(C=0;C<u.length;C++)B=m.transform(u[C]),l.push(B),B=m.transform(t[C]),v.push(B);u[0]=new d.Point3(w,0,z);u[1]=new d.Point3(x,0,A);u[2]=d.Point3.zero();t[0]=new d.Point3(0,-1,0);t[1]=new d.Point3(0,-1,0);t[2]=new d.Point3(0,-1,0);for(C=0;3>C;C++)B=m.transform(u[C]),l.push(B),B=m.transform(t[C]),v.push(B)}m=[];q=[];for(h=0;h<l.length;h++)u=l[h],m.push(u.x),m.push(u.y),m.push(u.z),u=v[h],q.push(u.x),q.push(u.y),q.push(u.z);m=[m,
q];l=new d.Point3(0,0,g);g=new d.Point3(0,0,g+n);n=new d.Point3(0,0,1);c=a(b,l,n,c);b=a(b,g,n,k);b=e(l,g,c,b,!0);k=[];c=[];for(g=0;g<b[0].length;g++)k.push(b[0][g].x),k.push(b[0][g].z),k.push(b[0][g].y),c.push(b[1][g].x),c.push(b[1][g].z),c.push(b[1][g].y);k=[k,c];b=p[0].concat(m[0]).concat(k[0]);k=p[1].concat(m[1]).concat(k[1]);c=new d.MeshData;c.setFaceWinding(d.FaceWinding.Clockwise);c.addFaces(b,k);return c};h.createCylinderMeshDataFromArc=function(c,b,g,k){for(var f=[],n=[],m,p=0;p<c.length-
3;p+=3){var h=new d.Point3(c[p],c[p+1],c[p+2]),q=new d.Point3(c[p+3],c[p+4],c[p+5]),u=a(g,h,b,k),t=a(g,q,b,k);m=e(h,q,u,t,!1);Array.prototype.push.apply(f,m[0]);Array.prototype.push.apply(n,m[1])}h=c.length;p=new d.Point3(c[h-3],c[h-2],c[h-1]);t=p.copy().subtract(new d.Point3(c[h-6],c[h-5],c[h-4])).normalize();h=a(2*g,p,b,k);q=p.copy().add(t.copy().scale(2/3));u=a(2*g,q,b,2*k);t=q.copy().add(t.copy().scale(2));m=e(p,q,h,u,!1);Array.prototype.push.apply(f,m[0]);Array.prototype.push.apply(n,m[1]);for(p=
0;p<h.length;p++)m=(p+1)%h.length,f.push(t),f.push(u[p]),f.push(u[m]),m=u[p].copy().subtract(q).normalize().add(t.copy().normalize()).normalize(),n.push(m),n.push(m),n.push(m);p=new d.Point3(c[0],c[1],c[2]);t=p.copy().subtract(new d.Point3(c[3],c[4],c[5])).normalize();h=a(2*g,p,b,k);q=p.copy().add(t.copy().scale(2/3));u=a(2*g,q,b,2*k);t=q.copy().add(t.copy().scale(2));m=e(q,p,u,h,!1);Array.prototype.push.apply(f,m[0]);Array.prototype.push.apply(n,m[1]);for(p=0;p<h.length;p++)m=(p+1)%h.length,f.push(t),
f.push(u[m]),f.push(u[p]),m=u[p].copy().subtract(q).normalize().add(t.copy().normalize()).normalize(),n.push(m),n.push(m),n.push(m);c=[];b=[];for(p=0;p<f.length;p++)g=f[p],c.push(g.x),c.push(g.y),c.push(g.z),m=n[p],b.push(m.x),b.push(m.y),b.push(m.z);f=new d.MeshData;f.setFaceWinding(d.FaceWinding.CounterClockwise);f.addFaces(c,b);return f}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function a(a,c){this._mode=a;this._impl=new d.Internal.IncrementalSelectionImpl(c)}a.create=function(d,c){return new a(d,c)};a.prototype.performSelection=function(a,c,b){var g=this._impl.viewer;"View"===this._mode?(g=g.view,void 0===b&&(b=[])):(h.TypeAssert(this._mode),g=g.selectionManager);void 0===c&&(c=null);return this._impl.performSelection(g,a,c,b)};a.prototype.isIdle=function(){return this._impl.isIdle()};a.prototype.waitForIdle=function(){return this._impl.waitForIdle()};
a.prototype.stopSelection=function(){return this._impl.stopSelection()};a.prototype.clearSelection=function(){return this._impl.clearSelection()};return a}();h.IncrementalSelection=f;(function(a){a.isScreenByAreaConfig=function(a){return"areaCssMin"in a};a.isRayDrillConfig=function(a){return"rayCssBoxRadius"in a};a.isConvexPolyhedronConfig=function(a){return"volumePlanes"in a};a.isSphereConfig=function(a){return"sphereRadius"in a}})(f=h.IncrementalSelection||(h.IncrementalSelection={}))})(d.Util||
(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function a(a){this._killHandles=[];this._activeSelectionCount=0;this._inactivityPromise=null;this.viewer=a}a.prototype.isIdle=function(){return 0===this._activeSelectionCount};a.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(0===this._activeSelectionCount)return console.assert(null===this._inactivityPromise),[2,Promise.resolve()];null===this._inactivityPromise&&(this._inactivityPromise=
h.OpenPromise.create());return[2,this._inactivityPromise]})})};a.prototype.stopSelection=function(){return __awaiter(this,void 0,void 0,function(){var a,c,b,g;return __generator(this,function(e){console.assert(this._killHandles.length===this._activeSelectionCount);a=[];c=0;for(b=this._killHandles;c<b.length;c++)g=b[c],a.push(g());return[2,d.Util.waitForAll(a)]})})};a.prototype.clearSelection=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return a=
this.viewer.selectionManager,a.clear(),[4,this.stopSelection()];case 1:return c.sent(),a.clear(),[2]}})})};a.prototype._advanceBySelectionManager=function(a,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(g){b=this.viewer.selectionManager;return[2,b.advanceIncrementalSelection(a,c)]})})};a.prototype._advanceByView=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var g,d,e,f,m,p;return __generator(this,function(k){switch(k.label){case 0:return g=
this.viewer.view,[4,g.advanceIncrementalSelection(a)];case 1:return d=k.sent(),null===d?[2,!1]:c?[4,Promise.all(d.map(c))]:[3,3];case 2:e=k.sent(),d=d.filter(function(b,c){return e[c]}),k.label=3;case 3:f=0;for(m=d;f<m.length;f++)p=m[f],b.push(p);return[2,!0]}})})};a.prototype._wrapBeginSelection=function(a,c){return d.Util.IncrementalSelection.isScreenByAreaConfig(c)?a.beginScreenSelectByArea(c.areaCssMin,c.areaCssMax,c.pickConfig):d.Util.IncrementalSelection.isRayDrillConfig(c)?a.beginRayDrillSelection(c.rayCssOrigin,
c.rayCssBoxRadius,c.pickConfig):d.Util.IncrementalSelection.isConvexPolyhedronConfig(c)?a.beginConvexPolyhedronSelection(c.volumePlanes,c.heuristicOrigin,c.pickConfig):d.Util.IncrementalSelection.isSphereConfig(c)?a.beginSphereSelection(c.sphereCenter,c.sphereRadius,c.pickConfig):d.Util.TypeAssertNever(c)};a.prototype.performSelection=function(a,c,b,g){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return void 0!==g?[3,1]:[2,this._performSelection(a,
c,b,null)];case 1:return[4,this._performSelection(a,c,b,g)];case 2:return d.sent(),[2,g]}})})};a.prototype._performSelection=function(a,c,b,g){return __awaiter(this,void 0,void 0,function(){var d,e,f,m,p,r,q,u,t=this;return __generator(this,function(k){switch(k.label){case 0:d=this._wrapBeginSelection(a,c);if(null===d)return[2];++this._activeSelectionCount;e=this.viewer.selectionManager;f=null===g;m=!1;p=h.Lazy.create(function(){return __awaiter(t,void 0,void 0,function(){var b,c;return __generator(this,
function(a){switch(a.label){case 0:m=!0,a.label=1;case 1:return a.trys.push([1,,7,8]),[4,d];case 2:return b=a.sent(),f?[4,e.endIncrementalSelection(b)]:[3,4];case 3:return a.sent(),[3,6];case 4:return[4,this.viewer.view.endIncrementalSelection(b)];case 5:a.sent(),a.label=6;case 6:return[3,8];case 7:return c=this._killHandles.indexOf(r),console.assert(0<=c),this._killHandles.splice(c,1),--this._activeSelectionCount,0===this._activeSelectionCount&&null!==this._inactivityPromise&&(this._inactivityPromise.resolve(),
this._inactivityPromise=null),[7];case 8:return[2]}})})});r=function(){return p.get()};this._killHandles.push(r);k.label=1;case 1:return k.trys.push([1,,11,13]),[4,d];case 2:q=k.sent(),u=!0,k.label=3;case 3:return!u||m?[3,10]:f?[4,this._advanceBySelectionManager(q,b)]:[3,5];case 4:return u=k.sent(),[3,7];case 5:return[4,this._advanceByView(q,b,g)];case 6:u=k.sent(),k.label=7;case 7:return!u||m?[3,9]:[4,h.sleep(1)];case 8:k.sent(),k.label=9;case 9:return[3,3];case 10:return[3,13];case 11:return[4,
r()];case 12:return k.sent(),[7];case 13:return[2]}})})};return a}();h.IncrementalSelectionImpl=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(){this.diffuseColor=[1,1,1,1]}a.prototype.setDiffuseTransparency=function(a){this.diffuseColor[3]=a};a.prototype.setDiffuseColor=function(a){a.toFloatArray(this.diffuseColor)};a.prototype.setDiffuseColorFromArray=function(a){this.diffuseColor[0]=a[0];this.diffuseColor[1]=a[1];this.diffuseColor[2]=a[2]};a.prototype.hash=function(){return this.diffuseColor.join(",")};return a}();d.MaterialInfo=f;f=function(){function a(a){this._materials=new Map;
this._engine=a}a.prototype.getOrCreateMaterial=function(a){var c=this,b=a.hash(),g=this._materials.get(b);if(void 0!==g)return g;g=this._engine.createMaterial().then(function(b){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._engine.setDiffuseColor(b,a.diffuseColor)];case 1:return c.sent(),[2,b]}})})});this._materials.set(b,g);return g};return a}();d.ScMaterialCache=f;f=function(){function a(a){this._engine=a}a.prototype.getIdentityInc=
function(){return this._identityInc};a.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return[4,this._engine.createIdentityMatrix()];case 1:return this._identityInc=a=c.sent(),[2]}})})};return a}();d.ScMatrixCache=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function f(b,c,a){if(b.selectionMask===d.SelectionMask.None)throw new d.CommunicatorError("selectionMask is None");return __assign({},b,{cullSuboptimalEntities:c,enableOcclusionChecks:c,restrictLinesAndPointsToSelectedFaceInstances:a?!1:b.restrictLinesAndPointsToSelectedFaceInstances})}function a(b,c){var a=d.Point3.createFromArray(b.rayPoint),g=d.Point3.createFromArray(b.normal),e=new d.Point3(b.bounding.min[0],b.bounding.min[1],b.bounding.min[2]),k=new d.Point3(b.bounding.max[0],
b.bounding.max[1],b.bounding.max[2]);e=new d.Box(e,k);c=new d.Selection.FaceEntity(a,g,b.elementIndex,b.overlayIndex,b.elementBits,e,c);b=b.instanceInc;return d.Selection.SelectionItem.create(b[1],b[0],c,null,null)}function e(b){var c=new d.Point3(b.bounding.min[0],b.bounding.min[1],b.bounding.min[2]),a=new d.Point3(b.bounding.max[0],b.bounding.max[1],b.bounding.max[2]);c=new d.Box(c,a);c=new d.Selection.LineEntity(b.elementIndex,d.Point3.createFromArray(b.point),b.lineSegmentVertices,b.bestLineSegmentVertexIndex,
c,b.overlayIndex,b.elementBits);b=b.instanceInc;return d.Selection.SelectionItem.create(b[1],b[0],null,c,null)}function c(b){var c=new d.Selection.PointEntity(d.Point3.createFromArray(b.point),b.elementIndex,b.overlayIndex,b.elementBits);b=b.instanceInc;return d.Selection.SelectionItem.create(b[1],b[0],null,null,c)}function b(b){return null!==b.point?(b=b.point.entities[0],c(b)):null!==b.line?(b=b.line.entities[0],e(b)):null!==b.face?(b=b.face.entities[0],a(b,!1)):null!==b.proximityFace?(b=b.proximityFace.entities[0],
a(b,!0)):null}function g(b){var g=null;if(null!==b.face){var k=b.face.entities[0];g=a(k,!1)}else null!==b.proximityFace&&(k=b.proximityFace.entities[0],g=a(k,!0));var f=null;null!==b.line&&(k=b.line.entities[0],f=e(k));k=null;null!==b.point&&(k=b.point.entities[0],k=c(k));return new d.Selection.CompositeSelectionItem(g,f,k)}function k(b){var g=[];if(null!==b.face)for(var d=0,k=b.face.entities;d<k.length;d++){var f=a(k[d],!1);g.push(f)}a:for(f=b.line,d=b.point,k=b.proximityFace,b=null!==f?f.entities:
[],d=null!==d?d.entities:[],k=null!==k?k.entities:[],f=[b,d,k];;){for(var l,n=l=Number.POSITIVE_INFINITY,m=null,h=0;h<f.length;h++){var y=f[h];if(0<y.length){var x=y[0];x.radialMetric<l?(l=x.radialMetric,n=x.zMetric,m=y):x.radialMetric===l&&x.zMetric<n&&(n=x.zMetric,m=y)}}l=m;if(null===l){console.assert(0===b.length);console.assert(0===d.length);console.assert(0===k.length);break a}console.assert(0<l.length);l===b?(l=b.pop(),l=e(l)):l===d?(l=d.pop(),l=c(l)):(console.assert(l===k),l=k.pop(),l=a(l,
!0));g.push(l)}return g}var l;(function(b){b[b.Batch=1E3]="Batch";b[b.Chunk=100]="Chunk"})(l=h.AdvanceSelectionCapacity||(h.AdvanceSelectionCapacity={}));var n=function(){function c(b){this._pickTolerance=20;this._incrementalChunkedItems=new Map;this._sc=b}c.prototype.setPickTolerance=function(b){this._pickTolerance=b};c.prototype.getPickTolerance=function(){return this._pickTolerance};c.prototype.beginScreenAreaSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var g,e,k;return __generator(this,
function(f){switch(f.label){case 0:g=a,f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this._sc.beginScreenAreaSelection(b.x,b.y,c.x,c.y,g)];case 2:return e=f.sent(),[3,4];case 3:k=f.sent();if(SC.isError(k)&&"beginScreenAreaSelection"===k.scFunction)throw new d.SelectionInvalidatedError;throw k;case 4:return[2,new d.Selection.IncrementalSelectionId(e)]}})})};c.prototype.beginRayDrillSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var g,e,k;return __generator(this,function(f){switch(f.label){case 0:g=
a,f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this._sc.beginRayDrillSelection(b.x,b.y,c,g)];case 2:return e=f.sent(),[3,4];case 3:k=f.sent();if(SC.isError(k)&&"beginRayDrillSelection"===k.scFunction)throw new d.SelectionInvalidatedError;throw k;case 4:return[2,new d.Selection.IncrementalSelectionId(e)]}})})};c.prototype.beginConvexPolyhedronSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var g,e,k,f,l,n,m,h;return __generator(this,function(p){switch(p.label){case 0:g=
a;e=[];k=0;for(f=b;k<f.length;k++)l=f[k],e.push(l.getCoefficients());n=[c.x,c.y,c.z];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this._sc.beginConvexPolyhedronSelection(e,n,g)];case 2:return m=p.sent(),[3,4];case 3:h=p.sent();if(SC.isError(h)&&"beginConvexPolyhedronSelection"===h.scFunction)throw new d.SelectionInvalidatedError;throw h;case 4:return[2,new d.Selection.IncrementalSelectionId(m)]}})})};c.prototype.beginSphereSelection=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var g,
e,k;return __generator(this,function(f){switch(f.label){case 0:g=a,f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this._sc.beginSphereSelection(b,c,g)];case 2:return e=f.sent(),[3,4];case 3:k=f.sent();if(SC.isError(k)&&"beginSphereSelection"===k.scFunction)throw new d.SelectionInvalidatedError;throw k;case 4:return[2,new d.Selection.IncrementalSelectionId(e)]}})})};c.prototype.endIncrementalSelection=function(b){this._incrementalChunkedItems.delete(b._handle);this._sc.endVolumeSelection(b._handle)};
c.prototype.advanceIncrementalSelection=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,g,e,k,f,n,m,p;return __generator(this,function(r){switch(r.label){case 0:if((a=this._incrementalChunkedItems.get(b._handle))&&a.length)return[2,a.pop()];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._sc.advanceVolumeSelection(b._handle,l.Batch)];case 2:return g=r.sent(),[3,4];case 3:e=r.sent();if(SC.isError(e)&&"advanceVolumeSelection"===e.scFunction)throw new d.SelectionInvalidatedError;
throw e;case 4:return 2!==g.length||4294967295!==g[1]?[3,7]:c?[4,this._sc.setStreamIdleMarker()]:[3,6];case 5:return r.sent(),[2,this.advanceIncrementalSelection(b,!1)];case 6:return[2,null];case 7:k=[];for(f=0;f<g.length;f+=2)n=g[f],m=g[f+1],k.push(d.Selection.SelectionItem.create(m,n));if(k.length<=l.Chunk)return[2,k];p=h.chunkify(k,l.Chunk).reverse();this._incrementalChunkedItems.set(b._handle,p);return[2,p.pop()]}})})};c.prototype._screenSelectByRay=function(b,c,a,g){return __awaiter(this,void 0,
void 0,function(){var e,k,l,n;return __generator(this,function(m){e=f(c,a,g);k=c.selectionMask;n=(l=c.selectionMask!==d.SelectionMask.Face||c.enableProximityFaces)?this._pickTolerance:-1;return[2,this._sc.screenSelectByRay(k,b.x,b.y,n,e)]})})};c.prototype._worldSelectByRay=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var g,d;return __generator(this,function(e){g=f(c,a,!1);d=h.toScRay(b);return[2,this._sc.worldSelectByRay(d,g)]})})};c.prototype.pickFromScreen=function(c,a,g){return __awaiter(this,
void 0,void 0,function(){var d;return __generator(this,function(e){switch(e.label){case 0:return[4,this._screenSelectByRay(c,a,!0,g)];case 1:return d=e.sent(),[2,b(d)]}})})};c.prototype.pickAllFromScreen=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(d){switch(d.label){case 0:return[4,this._screenSelectByRay(b,c,!1,a)];case 1:return g=d.sent(),[2,k(g)]}})})};c.prototype.compositePickFromScreen=function(b,c,a){return __awaiter(this,void 0,void 0,
function(){var d;return __generator(this,function(e){switch(e.label){case 0:return[4,this._screenSelectByRay(b,c,!0,a)];case 1:return d=e.sent(),[2,g(d)]}})})};c.prototype.pickFromRay=function(c,a){return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(d){switch(d.label){case 0:return[4,this._worldSelectByRay(c,a,!0)];case 1:return g=d.sent(),[2,b(g)]}})})};c.prototype.pickAllFromRay=function(b,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,
function(g){switch(g.label){case 0:return[4,this._worldSelectByRay(b,c,!1)];case 1:return a=g.sent(),[2,k(a)]}})})};c.prototype.pickCompositeFromRay=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d,e;return __generator(this,function(k){switch(k.label){case 0:return a=f(c,!0,!1),d=h.toScRay(b),[4,this._sc.worldSelectByRay(d,a)];case 1:return e=k.sent(),[2,g(e)]}})})};return c}();h.ScSelectionManager=n})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){d=d.Internal||(d.Internal={});(d.Test||(d.Test={})).AdvanceSelectionCapacity=d.AdvanceSelectionCapacity})(Communicator||(Communicator={}));
(function(d){(function(h){h.toScRay=function(d){var a={origin:[],direction:[]};d.origin.toArray(a.origin);d.direction.toArray(a.direction);return a};h.makeFaceFaceDistanceItem=function(f){var a=new d.FaceFaceDistanceItem;a.pos1.fromArray(f.point1);a.pos2.fromArray(f.point2);a.distance=f.distance;return a}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a){this.attributes=a}d.prototype.copy=function(){return new d(this.attributes.map(function(a){return a.copy()}))};return d}();d.SubentityAttributes=h})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){(function(a){a.isFace=function(a){return a instanceof d.SubentityProperties.CylinderElement||a instanceof d.SubentityProperties.PlaneElement||a instanceof d.SubentityProperties.ConeElement||a instanceof d.SubentityProperties.SphereElement||a instanceof d.SubentityProperties.TorusElement||a instanceof d.SubentityProperties.Blend01Element||a instanceof d.SubentityProperties.Blend02Element||a instanceof d.SubentityProperties.Blend03Element||a instanceof d.SubentityProperties.NurbsElement||
a instanceof d.SubentityProperties.CylindricalElement||a instanceof d.SubentityProperties.OffsetElement||a instanceof d.SubentityProperties.PipeElement||a instanceof d.SubentityProperties.RuledElement||a instanceof d.SubentityProperties.RevolutionElement||a instanceof d.SubentityProperties.ExtrusionElement||a instanceof d.SubentityProperties.FromCurvesElement||a instanceof d.SubentityProperties.TransformElement||a instanceof d.SubentityProperties.OtherFaceElement};a.isEdge=function(a){return a instanceof
d.SubentityProperties.LineElement||a instanceof d.SubentityProperties.CircleElement||a instanceof d.SubentityProperties.OtherEdgeElement}})(f.MeasurementProperty||(f.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){(function(a){(function(a){a.parseBinary=function(a){var k=d.SubentityProperties.FaceType,l=a.parseFaceType();switch(l){case k.Cylinder:return c.parseBinary(a);case k.Plane:return b.parseBinary(a);case k.Cone:return g.parseBinary(a);case k.Other:return n.parseBinary(a);case k.Sphere:return e.parseBinary(a);case k.Torus:return f.parseBinary(a);case k.Blend01:return m.parseBinary(a);case k.Blend02:return h.parseBinary(a);case k.Blend03:return r.parseBinary(a);case k.Nurbs:return q.parseBinary(a);
case k.Cylindrical:return u.parseBinary(a);case k.Offset:return t.parseBinary(a);case k.Pipe:return v.parseBinary(a);case k.Ruled:return w.parseBinary(a);case k.Revolution:return z.parseBinary(a);case k.Extrusion:return y.parseBinary(a);case k.FromCurves:return x.parseBinary(a);case k.Transform:return A.parseBinary(a);default:throw d.Util.TypeAssert(l),new d.AssemblyDataParseError("Unexpected measurement face type.");}};var c=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),
a=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.CylinderElement(c,a,b)};return b}();a.Cylinder=c;var b=function(){function b(){}b.parseBinary=function(b){var c=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.PlaneElement(c,b)};return b}();a.Plane=b;var g=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),a=b.parsePoint3_32(),g=b.parsePoint3_32();b=b.parseFloat_32();return new d.SubentityProperties.ConeElement(c,a,g,b)};return b}();
a.Cone=g;var e=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),a=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.SphereElement(c,a,b)};return b}();a.Sphere=e;var f=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),a=b.parseFloat_32(),g=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.TorusElement(c,a,g,b)};return b}();a.Torus=f;var n=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.OtherFaceElement};
return b}();a.Other=n;var m=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.Blend01Element};return b}();a.Blend01=m;var h=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.Blend02Element};return b}();a.Blend02=h;var r=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.Blend03Element};return b}();a.Blend03=r;var q=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.NurbsElement};
return b}();a.Nurbs=q;var u=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.CylindricalElement};return b}();a.Cylindrical=u;var t=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.OffsetElement};return b}();a.Offset=t;var v=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.PipeElement};return b}();a.Pipe=v;var w=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.RuledElement};
return b}();a.Ruled=w;var z=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.RevolutionElement};return b}();a.Revolution=z;var y=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.ExtrusionElement};return b}();a.Extrusion=y;var x=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.FromCurvesElement};return b}();a.FromCurves=x;var A=function(){function b(){}b.parseBinary=function(b){return new d.SubentityProperties.TransformElement};
return b}();a.Transform=A})(a.Face||(a.Face={}))})(f.MeasurementProperty||(f.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){(function(a){(function(a){a.parseBinary=function(a){var e=d.SubentityProperties.EdgeType,k=a.parseEdgeType();switch(k){case e.Line:return c.parseBinary(a);case e.Circle:return b.parseBinary(a);case e.Other:return g.parseBinary(a);default:throw d.Util.TypeAssert(k),new d.AssemblyDataParseError("Unexpected measurement edge type.");}};var c=function(){function b(){}b.parseBinary=function(b){b=b.parseFloat_32();return new d.SubentityProperties.LineElement(b)};return b}();
a.Line=c;var b=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),a=b.parsePoint3_32();b=b.parsePoint3_32();return new d.SubentityProperties.CircleElement(c,a,b)};return b}();a.Circle=b;var g=function(){function b(){}b.parseBinary=function(b){b=b.parseFloat_32();return new d.SubentityProperties.OtherEdgeElement(b)};return b}();a.Other=g})(a.Edge||(a.Edge={}))})(f.MeasurementProperty||(f.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||
(Communicator={}));
(function(d){(function(d){var f;(function(c){c[c.Undefined=0]="Undefined";c[c.Line=1]="Line";c[c.Circle=2]="Circle";c[c.Other=6]="Other"})(f=d.EdgeType||(d.EdgeType={}));var a;(function(c){c[c.Undefined=0]="Undefined";c[c.Cylinder=3]="Cylinder";c[c.Plane=4]="Plane";c[c.Cone=5]="Cone";c[c.Other=6]="Other";c[c.Sphere=7]="Sphere";c[c.Torus=8]="Torus";c[c.Blend01=9]="Blend01";c[c.Blend02=10]="Blend02";c[c.Blend03=11]="Blend03";c[c.Nurbs=12]="Nurbs";c[c.Cylindrical=13]="Cylindrical";c[c.Offset=14]="Offset";
c[c.Pipe=15]="Pipe";c[c.Ruled=16]="Ruled";c[c.Revolution=17]="Revolution";c[c.Extrusion=18]="Extrusion";c[c.FromCurves=19]="FromCurves";c[c.Transform=20]="Transform"})(a=d.FaceType||(d.FaceType={}));var e=function(){function c(b){this.length=b}c.prototype.copy=function(){return new c(this.length)};c.prototype.type=function(){return f.Line};return c}();d.LineElement=e;e=function(){function c(b,c,a){this.radius=b;this.origin=c.copy();this.normal=a.copy()}c.prototype.copy=function(){return new c(this.radius,
this.origin,this.normal)};c.prototype.type=function(){return f.Circle};return c}();d.CircleElement=e;e=function(){function c(b){this.length=b}c.prototype.copy=function(){return new c(this.length)};c.prototype.type=function(){return f.Other};return c}();d.OtherEdgeElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Other};return c}();d.OtherFaceElement=e;e=function(){function c(b,c,a){this.radius=b;this.origin=c.copy();this.normal=a.copy()}
c.prototype.copy=function(){return new c(this.radius,this.origin,this.normal)};c.prototype.type=function(){return a.Cylinder};return c}();d.CylinderElement=e;e=function(){function c(b,c){this.origin=b.copy();this.normal=c.copy()}c.prototype.copy=function(){return new c(this.origin,this.normal)};c.prototype.type=function(){return a.Plane};return c}();d.PlaneElement=e;e=function(){function c(b,c,a,d){this.radius=b;this.origin=c.copy();this.normal=a.copy();this.halfAngle=d}c.prototype.copy=function(){return new c(this.radius,
this.origin,this.normal,this.halfAngle)};c.prototype.type=function(){return a.Cone};return c}();d.ConeElement=e;e=function(){function c(b,c,a){this.radius=b;this.origin=c.copy();this.normal=a.copy()}c.prototype.copy=function(){return new c(this.radius,this.origin,this.normal)};c.prototype.type=function(){return a.Sphere};return c}();d.SphereElement=e;e=function(){function c(b,c,a,d){this.majorRadius=b;this.minorRadius=c;this.origin=a.copy();this.normal=d.copy()}c.prototype.copy=function(){return new c(this.majorRadius,
this.minorRadius,this.origin,this.normal)};c.prototype.type=function(){return a.Torus};return c}();d.TorusElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Blend01};return c}();d.Blend01Element=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Blend02};return c}();d.Blend02Element=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Blend03};
return c}();d.Blend03Element=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Nurbs};return c}();d.NurbsElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Cylindrical};return c}();d.CylindricalElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Offset};return c}();d.OffsetElement=e;e=function(){function c(){}c.prototype.copy=
function(){return new c};c.prototype.type=function(){return a.Pipe};return c}();d.PipeElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Ruled};return c}();d.RuledElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Revolution};return c}();d.RevolutionElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Extrusion};
return c}();d.ExtrusionElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.FromCurves};return c}();d.FromCurvesElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return a.Transform};return c}();d.TransformElement=e})(d.SubentityProperties||(d.SubentityProperties={}))})(Communicator||(Communicator={}));
(function(d){d=d.StaticGenericType||(d.StaticGenericType={});d.IfcColumn="IFCCOLUMN";d.IfcCovering="IFCCOVERING";d.IfcCurtainWall="IFCCURTAINWALL";d.IfcDoor="IFCDOOR";d.IfcRamp="IFCRAMP";d.IfcRoof="IFCROOF";d.IfcSlab="IFCSLAB";d.IfcSpace="IFCSPACE";d.IfcStair="IFCSTAIR";d.IfcStairFlight="IFCSTAIRFLIGHT";d.IfcTransportElement="IFCTRANSPORTELEMENT";d.IfcWall="IFCWALL";d.IfcWallStandardCase="IFCWALLSTANDARDCASE";d.IfcWindow="IFCWINDOW"})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){function a(b,c,a,g){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,m,h,w,z;return __generator(this,function(p){switch(p.label){case 0:return[4,c.getNodeOrRepItem(a)];case 1:e=p.sent();if(null===e||e instanceof f.RepresentationItem||e instanceof f.PartDefinition)return[2,d.BimMask.None];k=f.getNodeGenericType(e);return null!==k?[3,3]:null===g?[2,d.BimMask.None]:[4,e.getAttributes()];case 2:l=p.sent();n=0;for(m=l;n<m.length;n++)if(h=m[n],w=h.getTitle(),
w===g){k=h.getValue();break}if(null===k)return[2,d.BimMask.None];p.label=3;case 3:return z=b(k),z!==d.BimMask.None?[2,z]:[2,d.BimMask.None]}})})}function e(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(g){switch(g.label){case 0:return c=[],a={enterAnyBody:function(b){b instanceof f.BodyInstance&&c.push(b)}},[4,f.WalkerAsync.walk(a,b,f.WalkRestriction.None)];case 1:return g.sent(),[2,c]}})})}function c(b){return __awaiter(this,void 0,void 0,function(){var c,
a,g,k,f,h;return __generator(this,function(l){switch(l.label){case 0:return[4,e(b)];case 1:c=l.sent();a=new Set;g=0;for(k=c;g<k.length;g++)f=k[g],h=f.getParent(),a.add(h);return[2,d.Util.setToArray(a)]}})})}function b(b,c,g,e){return __awaiter(this,void 0,void 0,function(){var k,f,l,n,m,h,w,z,y,x,A;return __generator(this,function(p){switch(p.label){case 0:k=[];f=0;for(l=g;f<l.length;f++)n=l[f],m=a(b,c,n,e),k.push(m);return[4,Promise.all(k)];case 1:h=p.sent();w=[];z=[];y=[];for(x=0;x<g.length;++x)n=
g[x],A=h[x],A!==d.BimMask.None&&(0!==(A&d.BimMask.Floor)&&w.push(n),0!==(A&d.BimMask.Wall)&&z.push(n),0!==(A&d.BimMask.Door)&&y.push(n));return[2,{floors:w,walls:z,doors:y}]}})})}function g(b){for(var c=[],a=0;a<b.length;a++)for(var g=0,d=b[a].getBodyInstances();g<d.length;g++){var e=d[g].getInstanceInc();c.push(e[0],e[1])}return c}f.hasEffectiveGenericType=function(b,c){for(;null!==b;){if(b.getName()===c||f.getNodeGenericType(b)===c)return!0;b=f.towardProductOccurrence(b.getParent())}return!1};f.ifcAttributeToBimMask=
function(b){switch(b){case d.StaticGenericType.IfcColumn:case d.StaticGenericType.IfcCurtainWall:case d.StaticGenericType.IfcStair:case d.StaticGenericType.IfcStairFlight:case d.StaticGenericType.IfcWall:case d.StaticGenericType.IfcWallStandardCase:case d.StaticGenericType.IfcWindow:return d.BimMask.Wall|d.BimMask.Floor;case d.StaticGenericType.IfcCovering:case d.StaticGenericType.IfcRamp:case d.StaticGenericType.IfcRoof:case d.StaticGenericType.IfcSlab:return d.BimMask.Floor;case d.StaticGenericType.IfcDoor:case d.StaticGenericType.IfcTransportElement:return d.BimMask.Door|
d.BimMask.Floor}return d.BimMask.None};f.registerBimNodes=function(a,d,e,f,h){return __awaiter(this,void 0,void 0,function(){var k,l,n,m,p;return __generator(this,function(r){switch(r.label){case 0:return[4,c(f)];case 1:return k=r.sent(),[4,b(a,e,k,h)];case 2:return l=r.sent(),n=g(l.floors),d.registerBimInstances(n,0),m=g(l.walls),d.registerBimInstances(m,1),p=g(l.doors),d.registerBimInstances(p,2),[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function c(b,c,a,d,e,f){this._rootAssemblyDataKey=c;this.headerVersion=b;this.isDrawing=a;this.isMeasurable=d;this.originalFileName=e;this.originalFileType=f}c.prototype.rootAssemblyDataKey=function(){console.assert(4294967295!==this._rootAssemblyDataKey);return this._rootAssemblyDataKey};c.parseBinary=function(b){if(0===b.length)return null;b=new f.AssemblyDataParser(new e(null,b));var a=new f.NodeParseBits;a.parseBits1(b);if(!a.hasBits1(8388608))return null;
var k=b.parseAssemblyDataHeaderVersion();if(k>c._maxHeaderVersion)throw new d.AssemblyDataParseError("Unknown header version: "+k);a.parseBits2(b);var l=b.parseDataKey(),n=b.parseBoolean(),m="",h=d.FileType.Unknown;var r=1<=k?b.parseBoolean():!0;3<=k&&(a.hasBits2(4)&&(m=b.parseCString()),h=b.parseIndex_32());return new c(k,l,n,r,m,h)};c._maxHeaderVersion=3;c.dynamic=new c(c._maxHeaderVersion,4294967295,!1,!1,"",d.FileType.Unknown);return c}();f.AssemblyDataHeader=a;var e=function(){return function(c,
b){this.header=c;this.bytes=b}}();f.AssemblyData=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){return function(){this.prototypes=new Map;this.partDefinitions=new Map}}(),e=function(){return function(){this.bodies=new Map;this.contexts=[]}}(),c=function(){function b(b,c,a,e,m,p){this._centralQueueClock=new h.Clock;this._productOccurrences=new Map;this._pmis=new Map;this._cadViews=new Map;this._bodyInstances=new Map;this._pmiBodies=new Map;this._viewFrames=new Map;this._partDefinitions=new Map;this._representationItems=new Map;this._partToInstance=
new Map;this._filters=[];this._layers=new Map;this._layersIds=new Map;this._genericTypeToNodes=new Map;this._genericIdToNode=new Map;this._cadConfigurations=new Set;this._modelContents=new Map;this._inclusionContents=new Map;this._nodeDeletionBlackList=new Set;this._meshDeletionBlackList=new Set;this._dynamicNodeIdSeed=f.invalidNodeId;this._currentNodeIdOffset=0;this._initialEmptyNodeIdOffsetObtained=!1;this._firstProductOccurrenceWithView=this._defaultCadConfiguration=this._activeCadConfiguration=
this._activeCadView=null;this._isMeasurable=this._containsDrawings=!1;this._initiallyHiddenStayHidden=this._automaticMeasurementUnitScaling=!0;this._completedLoadTimestamp=this._activeLoadTimestamp=0;this._requestedNodes=new Map;this._unnamedDrawingViewCount=this._unnamedDrawingSheetCount=this._unnamedGroupCount=this._unnamedProductCount=0;this._seenExternalModel=this._isInitialized=!1;this._config=__assign({},b);this._engine=c;this._callbackManager=a;this._cuttingManager=e;this._view=m;this._model=
p;this._isScs=2===this._engine.getSessionType();console.assert(!this._isScs||this._engine.getRendererType()===d.RendererType.Client)}b.prototype.initialize=function(b){var c=this;console.assert(void 0===this._rootLoadContext);console.assert(void 0===this._rootNode);console.assert(!this._isInitialized);this._isInitialized=!0;console.assert(void 0===this._centralQueue);this._centralQueue=new h.PromiseQueue(b.maxConcurrentAttachments(),!1);this._callbackManager.bind({_inputInteraction:function(b,a){c._onUserInteraction(b,
a)}});this._rootLoadContext=new f.LoadContext(null,d.EmptyModelName,null);b=new f.AttachContext(new f.ScKeyRemapper,0,!1,0,this._rootLoadContext);this._rootLoadContext.addAttachContext(b);var a=new f.InclusionContext(this,b,0,0);b.addInclusionContext(a);this._rootNode=f.ProductOccurrence.createDynamic(this,a,"Models",null,null,!0);a.addProductOccurrence(this._rootNode);console.assert(this._rootNode.isAbsoluteRoot());this.preventNodeDeletion(this._rootLoadContext);this.preventNodeDeletion(b);this.preventNodeDeletion(a);
this.preventNodeDeletion(this._rootNode);this._rootNode.markLoaded()};b.prototype.isInitialized=function(){return this._isInitialized};b.prototype.getRootNode=function(){return this._rootNode};b.prototype.getAbstractScEngine=function(){return this._engine};b.prototype.generateDynamicNodeId=function(){return--this._dynamicNodeIdSeed};b.prototype.newNodeIdOffset=function(){if(!this._initialEmptyNodeIdOffsetObtained)return this._initialEmptyNodeIdOffsetObtained=!0,console.assert(0===this._currentNodeIdOffset),
0;var b=this._currentNodeIdOffset;this._currentNodeIdOffset+=4294967296;return b};b.prototype.getLowestAvailableNodeId=function(){return this._currentNodeIdOffset};b.prototype.tryParseHeader=function(b){var c=this,a=f.AssemblyDataHeader.parseBinary(b);if(null===a)return null;this._containsDrawings=this._containsDrawings||a.isDrawing;this._isMeasurable=this._isMeasurable||a.isMeasurable;return this._callbackManager.promiseTrigger("_modelStructureHeaderParsed",null,a).then(function(){c._callbackManager.trigger("modelStructureHeaderParsed",
a.originalFileName,a.originalFileType);return a})};b.prototype._isRegistered=function(b){return this._productOccurrences.has(b)||this._pmis.has(b)||this._cadViews.has(b)||this._bodyInstances.has(b)||this._pmiBodies.has(b)||this._viewFrames.has(b)||this._partDefinitions.has(b)||this._representationItems.has(b)};b.prototype.registerProductOccurrence=function(b){if(!b.isMissing()){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._productOccurrences.set(c,b);c=f.getNodeGenericType(b);
null!==c&&this.registerGenericType(b,c);c=b.getGenericId();null!==c&&this.registerGenericGlobalId(b,c);b.isAConfigurationNode()&&this._registerCadConfiguration(b);if(b.isADrawingSheetNode()||b.isADrawingViewNode())this._containsDrawings=!0}};b.prototype.lookupProductOccurrence=function(b){b=this._productOccurrences.get(b);return void 0!==b?b:null};b.prototype.registerPmi=function(b){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._pmis.set(c,b)};b.prototype.lookupPmi=function(b){b=
this._pmis.get(b);return void 0!==b?b:null};b.prototype.registerCadView=function(b){null===this._firstProductOccurrenceWithView&&(this._firstProductOccurrenceWithView=b.getParent());var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._cadViews.set(c,b)};b.prototype.getFirstProductOccurrenceWithView=function(){return this._firstProductOccurrenceWithView};b.prototype.lookupCadView=function(b){b=this._cadViews.get(b);return void 0!==b?b:null};b.prototype.registerBodyInstance=function(b){var c=
b.getRuntimeId();console.assert(!this._isRegistered(c));this._bodyInstances.set(c,b);this._registerAnyBodyByInstanceInc(b)};b.prototype.lookupBodyInstance=function(b){b=this._bodyInstances.get(b);return void 0!==b?b:null};b.prototype.registerPmiBody=function(b){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._pmiBodies.set(c,b);this._registerAnyBodyByInstanceInc(b)};b.prototype.lookupPmiBody=function(b){b=this._pmiBodies.get(b);return void 0!==b?b:null};b.prototype.registerViewFrame=
function(b){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._viewFrames.set(c,b);this._registerAnyBodyByInstanceInc(b)};b.prototype.lookupViewFrame=function(b){b=this._viewFrames.get(b);return void 0!==b?b:null};b.prototype.registerPartDefinition=function(b){if(!b.isMissing()){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._partDefinitions.set(c,b)}};b.prototype.lookupPartDefinition=function(b){b=this._partDefinitions.get(b);return void 0!==b?b:null};b.prototype.registerRepresentationItem=
function(b){var c=b.getRuntimeId();console.assert(!this._isRegistered(c));this._representationItems.set(c,b)};b.prototype.lookupRepresentationItem=function(b){b=this._representationItems.get(b);return void 0!==b?b:null};b.prototype.lookupAnyBody=function(b){return this.lookupBodyInstance(b)||this.lookupPmiBody(b)||this.lookupViewFrame(b)};b.prototype.lookupAnyTreeNode=function(b){return this.lookupProductOccurrence(b)||this.lookupPmi(b)||this.lookupCadView(b)||this.lookupAnyBody(b)};b.prototype.lookupAnyNonTreeNode=
function(b){return this.lookupRepresentationItem(b)||this.lookupPartDefinition(b)};b.prototype.lookupAnyNode=function(b){return this.lookupAnyTreeNode(b)||this.lookupAnyNonTreeNode(b)};b.prototype._registerCadConfiguration=function(b){console.assert(b.isAConfigurationNode());console.assert(!this._cadConfigurations.has(b));this._cadConfigurations.add(b);b.isADefaultNode()&&null===this._defaultCadConfiguration&&(this._defaultCadConfiguration=b)};b.prototype.getInstanceCountByInclusion=function(b){return this._getInclusionContent(b).bodies.size};
b.prototype.lookupAnyBodyByInstanceInc=function(b,c){b=this._getInclusionContent(b).bodies.get(c);return void 0!==b?b:null};b.prototype._registerAnyBodyByInstanceInc=function(b){var c=b.getInstanceInc(),a=this._getInclusionContent(c[0]),g=a.bodies.get(c[1]);if(void 0!==g){console.assert(b.hasAuthoredId());if(g.hasAuthoredId()){console.assert(g.constructor===b.constructor);h.CompileTime.disable&&console.assert(!1);return}console.assert(g.constructor===f.BodyInstance);g=g.getRuntimeId();b instanceof
f.BodyInstance?this._bodyInstances.set(g,b):b instanceof f.PmiBody?this._pmiBodies.set(g,b):(d.Util.TypeAssert(b),this._viewFrames.set(g,b))}a.bodies.set(c[1],b)};b.prototype._getInclusionContent=function(b){console.assert(4294967295!==b);var c=this._inclusionContents.get(b);void 0===c&&(c=new e,this._inclusionContents.set(b,c));return c};b.prototype._getModelContent=function(b,c){console.assert(4294967295!==c);var d=this._modelContents.get(b);void 0===d&&(d=new Map,this._modelContents.set(b,d));
b=d.get(c);void 0===b&&(b=new a,d.set(c,b));return b};b.prototype.registerPrototypeByDataId=function(b,c,a,d){b=this._getModelContent(b,c);console.assert(!b.prototypes.has(a));b.prototypes.set(a,d)};b.prototype.registerPartDefinitionByDataId=function(b,c,a,d){b=this._getModelContent(b,c);console.assert(!b.partDefinitions.has(a));b.partDefinitions.set(a,d)};b.prototype.lookupPrototypeByDataId=function(b,c,a){b=this._getModelContent(b,c).prototypes.get(a);return void 0!==b?b:null};b.prototype.lookupPartDefinitionByDataId=
function(b,c,a){b=this._getModelContent(b,c).partDefinitions.get(a);return void 0!==b?b:null};b.prototype.registerInclusionContext=function(b){var c=b.getInclusionKey();this._getInclusionContent(c).contexts.push(b)};b.prototype.getInclusionContexts=function(b){return this._getInclusionContent(b).contexts};b.prototype._createLayer=function(b,c,a,d){a=new f.Layer(b,c,a,d);console.assert(!this._layers.has(b));this._layers.set(b,a);null!==c&&this._updateNameToLayersMap(c,b);return a};b.prototype._updateNameToLayersMap=
function(b,c){var a=this._layersIds.get(b);void 0!==a?a.push(c):this._layersIds.set(b,[c])};b.prototype.createOrUpdateLayerName=function(b,c){var a=this._layers.get(b);void 0===a?a=this._createLayer(b,c,[],[]):null!==c&&(a.name=c,this._updateNameToLayersMap(c,b));return a};b.prototype.registerNodeInLayer=function(b,c){var a=this._layers.get(c);void 0!==a?a.nodes.push(b):this._createLayer(c,null,[b],[])};b.prototype.registerTreeNodeInLayer=function(b,c){var a=this._layers.get(c);void 0!==a?a.treeNodes.push(b):
this._createLayer(c,null,[],[b])};b.prototype.addFilter=function(b){this._filters.push(b)};b.prototype.getFilters=function(){for(var b=new Map,c=0;c<this._filters.length;c++){var a=this.getFilterName(c)||"";b.set(c,a)}return b};b.prototype.getFilterName=function(b){return b<this._filters.length?this._filters[b].name||"":null};b.prototype.getFiltersWithNode=function(b){for(var c=b.getAuthoredId(),a=this._filters,d=[],g=0;g<a.length;g++){var e=a[g];if(null!==e.layers)for(var f=0,h=e.layers.ids;f<h.length;f++){var u=
this.getNodesFromLayer(h[f]);if(null!==u)for(var t=0;t<u.length;t++)b===u[t]&&d.push(g)}if(null!==e.entities)for(f=0,e=e.entities.ids;f<e.length;f++)c===e[f]&&d.push(g)}return d};b.prototype.getNodesFromFilterIds=function(b){for(var c=new Set,a=new Set,g=null,e=this._filters,f=this._layers,h=0;h<b.length;h++){var q=b[h],u=e[q].layers;if(null!==u){var t=u.isInclusive;null===g&&(g=t);for(var v=0,w=u.ids;v<w.length;v++)if((u=f.get(w[v]))&&null!==u.nodes)for(var z=0,y=u.nodes;z<y.length;z++)u=y[z].getAuthoredId(),
t?(c.add(u),a.delete(u)):(c.delete(u),a.add(u))}v=e[q].entities;if(null!==v)for(t=v.isInclusive,null===g&&(g=t),q=0,v=v.ids;q<v.length;q++)u=v[q],t?(c.add(u),a.delete(u)):(c.delete(u),a.add(u))}return null===g?null:g?new d.FilteredNodes(!0,c):new d.FilteredNodes(!1,a)};b.prototype.getLayers=function(){var b=new Map;this._layers.forEach(function(c,a){b.set(a,c.name||"")});return b};b.prototype.getUniqueLayerNames=function(){var b=new Set,c=[];this._layers.forEach(function(a){a=a.name;null===a||b.has(a)||
(b.add(a),c.push(a))});return c};b.prototype.getLayerName=function(b){b=this._layers.get(b);return void 0!==b?b.name||"":null};b.prototype.getLayersIdFromName=function(b){b=this._layersIds.get(b);return void 0!==b?b:null};b.prototype.getNodesFromLayer=function(b,c){b=this._layers.get(b);return void 0!==b?c?b.treeNodes:b.nodes:null};b.prototype.getNodesFromLayers=function(b,c){for(var a=[],d=0;d<b.length;d++){var g=this.getNodesFromLayer(b[d],c);if(null!==g)for(var e=0;e<g.length;e++)a.push(g[e])}return a};
b.prototype.getNodesFromLayerName=function(b,c){b=this._layersIds.get(b);return void 0!==b?this.getNodesFromLayers(b,c):null};b.prototype.generateProductName=function(){return"Product "+this._unnamedProductCount++};b.prototype.generateGroupName=function(){return"Product "+this._unnamedGroupCount++};b.prototype.generateDrawingSheetName=function(){return"Product "+this._unnamedDrawingSheetCount++};b.prototype.generateDrawingViewName=function(){return"Product "+this._unnamedDrawingViewCount++};b.prototype.forEachCadView=
function(b){this._cadViews.forEach(b)};b.prototype.forEachPmi=function(b){this._pmis.forEach(b)};b.prototype.forEachCadConfiguration=function(b){this._cadConfigurations.forEach(b)};b.prototype.hasActiveCadView=function(){return null!==this._activeCadView};b.prototype.activateCadView=function(b,c){console.assert(null===this._activeCadView);this._activeCadView=b;return b.activate(this,this._engine,this._callbackManager,this._cuttingManager,this._view,c,this._activeCadConfiguration)};b.prototype.deactivateActiveCadView=
function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return null===this._activeCadView?[2]:[4,this._activeCadView.deactivate(this._cuttingManager)];case 1:return b.sent(),console.assert(null!==this._activeCadView),this._activeCadView=null,[2]}})})};b.prototype.getCadViewPmis=function(b){var c=[];this._pmis.forEach(function(a){b.hasPmi(a)&&c.push(a)});return c};b.prototype.isMeasureable=function(){return this._isMeasurable};b.prototype.containsDrawings=
function(){return this._containsDrawings};b.prototype.getDefaultCadConfiguration=function(){return this._defaultCadConfiguration};b.prototype.getActiveCadConfiguration=function(){return this._activeCadConfiguration};b.prototype.activateCadConfiguration=function(b){console.assert(b.isAConfigurationNode());this._activeCadConfiguration=b;b=b.getRuntimeId();return this._view.isolateNodes([b],d.DefaultTransitionDuration,!0)};b.prototype.massageAuthoredUserId=function(b,c){if(null===c)return this.generateDynamicNodeId();
b=b.toRuntimeId(c);return null!==this.lookupAnyNode(b)?this.generateDynamicNodeId():c};b.prototype.createNode=function(b,c,a,d,e,h){void 0===h&&(h=null);c=f.ProductOccurrence.createDynamic(this,b,c,a,d,e,!1,h);b.addProductOccurrence(c);c.markLoaded();return c};b.prototype.createPart=function(b){b=f.PartDefinition.createDynamic(this,b,null);b.markLoaded();return b};b.prototype.setPart=function(b,c){c.addReferrer(b);var a=this._partToInstance.get(c);if(void 0===a){a=f.towardInclusionContext(this._rootNode);
var d=h.LazyObject.create(function(){console.assert(void 0!==g);return new f.SharedPrototypeContext(h.LazyPromise.create(g))});a=new f.PrototypeContext(d,a);var g=f.ProductOccurrence.createDynamic(this,a,null,null,null,!0);g.setPartDefinition(c);g.markLoaded()}b.setPrototype(a)};b.prototype._createCadView=function(b,c,a,d,e,h,r,q){c=f.CadView.createDynamic(this,b,c,a,d,e,h,r,q);b.addCadView(c);c.markLoaded();return c};b.prototype._createCadViewInstance=function(b,c,a){return __awaiter(this,void 0,
void 0,function(){var d,g,e,k,l,h,t,v,w;return __generator(this,function(n){switch(n.label){case 0:return null===a?[3,2]:[4,b.createMeshInstance(a)];case 1:d=n.sent(),g=d[0],e=d[1],k=this.generateDynamicNodeId(),l={nodeId:k,bits:786432,name:null,localTransform:null,attributes:[],header:f.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},h={nodeInfo:l,inclusionKey:g,instanceKey:e,bits:0},t=f.towardAttachContext(c),v=t.getMasterModelKey(),console.assert(c.isLoaded()),
w=f.ViewFrame.reify(this,v,c,h),c.setViewFrame(w),w.markLoaded(),n.label=2;case 2:return[2]}})})};b.prototype.createCadView=function(b,c,a,d,e,f,h,q,u,t){c=this._createCadView(c,a,d,e,f,h,q,u);null!==t&&(b=this._createCadViewInstance(b,c,t),b);return c};b.prototype.createMeshInstance=function(b,c,a,d,e,h,r,q){var g=0;r&&(g|=16384);q&&(g|=268435456);c=f.BodyInstance.createDynamic(this,c,a,d,e,h,g);h.addBodyInstance(c);b&&c.markLoaded();return c};b.prototype.createPmiInstance=function(b,c,a,d,e,h,r,
q){var g=f.towardInclusionContext(e);b={nodeInfo:{nodeId:this.massageAuthoredUserId(g,a),bits:1073741824,name:d,localTransform:null,attributes:[],header:f.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},inclusionKey:b,instanceKey:c,bits:0};h=f.Pmi.createDynamic(this,g,e,h,r,[b],q);e.addPmi(h);h.markLoaded();return h};b.prototype.getAutomaticMeasurementUnitScaling=function(){return this._automaticMeasurementUnitScaling};b.prototype.setAutomaticMeasurementUnitScaling=
function(b){this._automaticMeasurementUnitScaling=b};b.prototype.getInitiallyHiddenStayHidden=function(){return this._initiallyHiddenStayHidden};b.prototype.setInitiallyHiddenStayHidden=function(b){this._initiallyHiddenStayHidden=b};b.prototype._removeIdMappingsRecursive=function(b){var c=this;return f.WalkerAsync.walk({enterProductOccurrence:function(b){c._productOccurrences.delete(b.getRuntimeId())},enterAnyBody:function(b){var a=b.getRuntimeId();b instanceof f.BodyInstance?c._bodyInstances.delete(a):
b instanceof f.PmiBody?c._pmiBodies.delete(a):(d.Util.TypeAssert(b),c._viewFrames.delete(a))},enterCadView:function(b){c._cadViews.delete(b.getRuntimeId())},enterPmi:function(b){c._pmis.delete(b.getRuntimeId())}},b,f.WalkRestriction.None)};b.prototype.deleteNode=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,g,e,h,r,q;return __generator(this,function(k){switch(k.label){case 0:if(!this._canDeleteNode(b))throw c=b.getRuntimeId(),new d.CommunicatorError("Cannot delete node ("+c+")");
a=f.gatherInstanceIncsSync(b,7,!0,new Set,f.WalkRestriction.None);this._engine.setPartVisibility(a,!1,!1);this._engine.setInstanceModifier(d.InstanceModifier.DoNotSelect,a,!0);if(!(b instanceof f.ProductOccurrence))return[3,2];this._cadConfigurations.delete(b)&&(b===this._activeCadConfiguration&&(this._activeCadConfiguration=null),b===this._defaultCadConfiguration&&(this._defaultCadConfiguration=null));g=b.getParent();console.assert(null!==g);null!==g&&(e=void 0,e=g instanceof f.PrototypeContext?
g.removeReferrer(b):g.removeProductOccurrence(b),console.assert(e));this._productOccurrences.delete(b.getRuntimeId());return[4,this._removeIdMappingsRecursive(b)];case 1:return k.sent(),[2,b.purgeContents()];case 2:d.Util.TypeAssert(b),h=b.getParent(),h.removeBodyInstance(b),r=b.getInstanceInc(),q=this._getInclusionContent(r[0]),q.bodies.delete(r[1]),this._bodyInstances.delete(b.getRuntimeId()),k.label=3;case 3:return[2]}})})};b.prototype._canDeleteNode=function(b){return!this._nodeDeletionBlackList.has(b)};
b.prototype.preventNodeDeletion=function(b){var c=b.getParent();if(c instanceof f.PrototypeContext)throw new d.InternalLogicError;null!==c&&(console.assert(null===c||this._nodeDeletionBlackList.has(c)),b instanceof f.ProductOccurrence?(console.assert(!b.hasAuthoredId()),console.assert(!b.isOutOfHierarchy())):b instanceof f.BodyInstance&&(c=b.getInstanceInc(),console.assert(!b.hasAuthoredId()),console.assert(0===c[0]),console.assert(b.isOutOfHierarchy())));this._nodeDeletionBlackList.add(b)};b.prototype.preventMeshDeletion=
function(b){this._meshDeletionBlackList.add(b)};b.prototype._resetContents=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return this.hasActiveCadView()?[4,this.deactivateActiveCadView()]:[3,2];case 1:return c.sent(),[2,this._resetContents()];case 2:return[4,this._rootLoadContext.purgeContents()];case 3:return c.sent(),this._productOccurrences.clear(),this._pmis.clear(),this._cadViews.clear(),this._bodyInstances.clear(),
this._pmiBodies.clear(),this._viewFrames.clear(),this._partDefinitions.clear(),this._representationItems.clear(),this._partToInstance.clear(),this._filters.length=0,this._layers.clear(),this._layersIds.clear(),this._genericTypeToNodes.clear(),this._genericIdToNode.clear(),this._cadConfigurations.clear(),this._modelContents.clear(),this._inclusionContents.clear(),this._currentNodeIdOffset=0,this._firstProductOccurrenceWithView=this._defaultCadConfiguration=this._activeCadConfiguration=this._activeCadView=
null,this._isMeasurable=this._containsDrawings=!1,this._completedLoadTimestamp=this._activeLoadTimestamp=0,this._requestedNodes.clear(),this._unnamedDrawingViewCount=this._unnamedDrawingSheetCount=this._unnamedGroupCount=this._unnamedProductCount=0,this._seenExternalModel=!1,this._rootNode.unsetMeasurementUnit(),this._nodeDeletionBlackList.forEach(function(c){if(c instanceof f.ProductOccurrence){var a=c.getRuntimeId();b._productOccurrences.set(a,c);a=c.getParent();a instanceof f.PrototypeContext?
console.assert(!1):a.addProductOccurrence(c);c.setVisibility(!0);c.unsetMeasurementUnit();c.hasLocalTransformOverride()&&c.removeLocalTransformOverride()}else if(c instanceof f.BodyInstance){a=c.getRuntimeId();b._bodyInstances.set(a,c);a=c.getInstanceInc();var g=a[0];console.assert(0===g);g=b._getInclusionContent(g);g.bodies.set(a[1],c);c.getParent().addBodyInstance(c)}else c instanceof f.LoadContext?(a=c.getParent(),null!==a&&a.addLoadContext(c)):c instanceof f.AttachContext?c.getParent().addAttachContext(c):
(d.Util.TypeAssert(c),g=c.getInclusionKey(),console.assert(0===g),g=b._getInclusionContent(g),g.contexts.push(c),c.getParent().addInclusionContext(c))}),[2]}})})};b.prototype.reset=function(){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._callbackManager.promiseTrigger("_resetAssemblyTreeBegin",null)];case 1:return a.sent(),[4,this._resetContents()];case 2:return a.sent(),b=[],this._nodeDeletionBlackList.forEach(function(c){c instanceof
f.BodyInstance&&(c=c.getInstanceInc(),console.assert(0===c[0]),b.push(c[1]))}),c=[],this._meshDeletionBlackList.forEach(function(b){c.push(b)}),[4,this._engine.resetToEmpty(b,c)];case 3:return a.sent(),[4,this._resetContents()];case 4:return a.sent(),[2]}})})};b.prototype.setViewAxes=function(b,c){this._model.setViewAxes(b,c)};b.prototype._requestIncsOfNodes=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,g,e,h,r,q,u,t;return __generator(this,function(k){switch(k.label){case 0:if(this._config.streamingMode!==
d.StreamingMode.OnDemand)return[2];c=new Set;a=[];g=[];e=0;for(h=b;e<h.length;e++)r=h[e],q=f.gatherInstanceIncs(r,7,!1,c).then(function(b){for(var c=0;c<b.length;c++)a.push(b[c])}),g.push(q);return[4,d.Util.waitForAll(g)];case 1:return k.sent(),u=[],t=[],c.forEach(function(b){if(!b.isRequested()){b.setRequested();var c=b.isInitiallyShown();c!==b.isVisible()&&(c?(b.setVisibility(!0),u.push(b.getRuntimeId())):(b.setVisibility(!1),t.push(b.getRuntimeId())))}}),0<u.length+t.length&&this._callbackManager.trigger("visibilityChanged",
u,t),this._engine.requestMeshInstances(a),[2]}})})};b.prototype._requestExternalModelsLocal=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(g){switch(g.label){case 0:return[4,c.loadPendingExternalModels(b)];case 1:return d=g.sent(),0===d.length?[3,4]:[4,f.markContextsLoaded(d)];case 2:return g.sent(),[4,this._requestNodes(b,[c],a)];case 3:g.sent(),g.label=4;case 4:return[2,d]}})})};b.prototype._requestExternalModelsNonLocal=function(b,c,a){return __awaiter(this,
void 0,void 0,function(){var d,g,e,k,l,u,t,v;return __generator(this,function(n){switch(n.label){case 0:return[4,f.gatherParentsOfPendingExternalModels(c)];case 1:d=n.sent();if(0===d.length)return[2,[]];g=[];e=0;for(k=d;e<k.length;e++)l=k[e],u=this._requestExternalModelsLocal(b,l,a),g.push(u);v=h.concatAll;return[4,Promise.all(g)];case 2:return t=v.apply(void 0,[n.sent()]),[2,t]}})})};b.prototype._requestExternalModelsOfNodes=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,g,
e,k,f,l,t;return __generator(this,function(n){switch(n.label){case 0:d=[];g=0;for(e=c;g<e.length;g++)k=e[g],f=this._requestExternalModelsNonLocal(b,k,a),d.push(f);t=h.concatAll;return[4,Promise.all(d)];case 1:return l=t.apply(void 0,[n.sent()]),[2,l]}})})};b.prototype._requestNodes=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,g,e,k,l,h,t;return __generator(this,function(n){switch(n.label){case 0:if(!a)for(d=0,g=c;d<g.length;d++)e=g[d],this._activeLoadTimestamp!==this._completedLoadTimestamp&&
this._requestedNodes.set(e,this._activeLoadTimestamp),e instanceof f.ProductOccurrence&&b.notifyDirectRequest(e);k=this._requestIncsOfNodes(c);l=this._requestExternalModelsOfNodes(b,c,a);h=[k,l];return[4,Promise.all(h)];case 1:return t=n.sent()[1],[2,t]}})})};b.prototype.requestNodes=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var g,e,k,f,l,u,t;return __generator(this,function(n){switch(n.label){case 0:return[4,this._requestNodes(b,c,a)];case 1:g=n.sent();e=[];k=0;for(f=g;k<f.length;k++)l=
f[k],u=l.getChildren(),h.concatInPlace(e,u);if(!(0<e.length))return[3,3];t=e.map(function(b){return b.getRuntimeId()});return[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",t,d.NodeSource.LoadModel)];case 2:n.sent(),n.label=3;case 3:return[2]}})})};b.prototype.isBeingRequested=function(b){for(;;)if(b instanceof f.NodeMixin){if(this._requestedNodes.has(b))return!0;b=b.getParent()}else if(b instanceof f.AttachContext)b=b.getParent();else if(b instanceof f.InclusionContext)b=
b.getParent();else if(b instanceof f.LoadContext){if(b=b.getParent(),null===b)return!1}else return d.Util.TypeAssert(b),console.assert(!1),!1};b.prototype.onDemandRequestsActive=function(){return 0!==this._requestedNodes.size};b.prototype.onLoadBegin=function(){++this._activeLoadTimestamp};b.prototype.onLoadEnd=function(){var b=this;console.assert(this._completedLoadTimestamp<this._activeLoadTimestamp);++this._completedLoadTimestamp;console.assert(this._completedLoadTimestamp===this._activeLoadTimestamp);
var c=[];this._requestedNodes.forEach(function(a,d){a<=b._completedLoadTimestamp&&(console.assert(a===b._completedLoadTimestamp),c.push(d))});for(var a=0;a<c.length;a++)this._requestedNodes.delete(c[a])};b.prototype.markSeenExternalModel=function(){this._seenExternalModel=!0};b.prototype.seenExternalModel=function(){return this._seenExternalModel};b.prototype.getNodeByGenericId=function(b){return this._genericIdToNode.get(b)||null};b.prototype.getNodesByGenericType=function(b){return this._genericTypeToNodes.get(b)||
null};b.prototype.genericTypeToNodes=function(){return this._genericTypeToNodes};b.prototype.registerGenericGlobalId=function(b,c){this._genericIdToNode.set(c,b)};b.prototype.registerGenericType=function(b,c){var a=this._genericTypeToNodes.get(c);void 0===a&&(a=new Set);a.add(b);this._genericTypeToNodes.set(c,a)};b.prototype.disableAutomaticFitWorld=function(){return this._config.disableAutomaticFitWorld};b.prototype.markImplicitNodesOutOfHierarchy=function(){return this._config.markImplicitNodesOutOfHierarchy};
b.prototype._throttleLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._engine.throttleLoad(200,200),[4,this._engine.sleep(20)];case 1:return b.sent(),[2]}})})};b.prototype.enqueue=function(b){var c=this,a="function"===typeof b?h.Lazy.create(b):b;return this._centralQueue.push(function(){return __awaiter(c,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:return(b=this._isScs&&
this._centralQueueClock.isTicking())?[4,this._throttleLoad()]:[3,2];case 1:d.sent(),d.label=2;case 2:return[4,a.get()];case 3:return c=d.sent(),b?[4,this._throttleLoad()]:[3,5];case 4:d.sent(),d.label=5;case 5:return[2,c]}})})})};b.prototype._onUserInteraction=function(b,c){if(this._isScs){var a=!1;switch(c){case d.EventType.MouseDown:case d.EventType.MouseUp:case d.EventType.Mousewheel:case d.EventType.TouchStart:case d.EventType.TouchMove:case d.EventType.TouchEnd:case d.EventType.KeyDown:case d.EventType.KeyUp:case d.EventType.ViewOrientationChange:a=
!0;break;case d.EventType.MouseMove:a=b.getButtons()!==d.Buttons.None;break;default:d.Util.TypeAssertNever(c)}a&&this._centralQueueClock.tickFor(1E3)}};return b}();f.AssemblyTree=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){function a(c){var b=this;return function(a,d){return __awaiter(b,void 0,void 0,function(){var b,g;return __generator(this,function(e){switch(e.label){case 0:return b=h.versionAtLeast(d,[7,3])?a+".scs":a,[4,c(b)];case 1:return g=e.sent(),"string"===typeof g?[2,h.httpRequestBuffer(g)]:[2,g]}})})}}var e=function(){function c(b,c,a,d,e,m){this._clearQueue=new h.PromiseQueue(1,!1);this._clearInProgress=!1;this._cadConfigurationsEnabled=!0;this._engine=c;this._callbackManager=
a;this._cuttingManager=d;this._view=e;this._model=m;this._assemblyTree=new f.AssemblyTree(b,this._engine,this._callbackManager,this._cuttingManager,this._view,this._model);this._readyPromise=h.TrackedOpenPromise.create()}c.unsafeCreate=function(b,c,a,d,e,f,h){return this._create(b,c,a,d,e,f,h).unsafeValue};c.create=function(b,c,a,d,e,f,h){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this._create(b,c,a,d,e,f,h)]})})};c._create=function(b,a,d,e,f,m,p){b=
new c(b,a,d,e,f,m);p=b._init(p);return h.UnsafePromise.create(b,p)};c.prototype._init=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(d){switch(d.label){case 0:return[4,f.ScAttacher.createWithEmptyModel(this._engine,this._view,this._callbackManager,b)];case 1:return c=d.sent(),this._assemblyTree.initialize(c),a=new f.TreeLoader(this._assemblyTree,c,this._engine,this._view,this._callbackManager),this._callbackManager.trigger("modelStructureLoadBegin"),
this._callbackManager.trigger("modelStructureLoadEnd"),this._callbackManager.trigger("modelStructureParseBegin"),console.assert(void 0===this._treeLoader),this._treeLoader=a,this._readyPromise.resolve(),[2]}})})};c.prototype._loadSubtreePrologue=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(e){switch(e.label){case 0:if(this._engine.getSessionType()!==b)throw new d.LoadError("Incompatible load types.");return a?[4,this._clearQueue.waitOnLatest()]:
[3,2];case 1:e.sent(),e.label=2;case 2:if(this._clearInProgress)throw new d.LoadCancelledError;g=this._assemblyTree.lookupProductOccurrence(c);if(null===g)throw new d.InvalidNodeTypeError(c,0);return[2,g]}})})};c.prototype._loadSubtreeEpilogue=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,g;return __generator(this,function(e){switch(e.label){case 0:return b.isFirstLoad()&&2===this._engine.getSessionType()?[4,this._callbackManager.promiseTrigger("_firstBoundingReady",null)]:[3,
2];case 1:e.sent(),e.label=2;case 2:return a=b.getChildren(),g=a.map(function(b){return b.getRuntimeId()}),!c||b.isFirstLoad()?[3,4]:[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",g,d.NodeSource.LoadModel)];case 3:e.sent(),e.label=4;case 4:return[2,g]}})})};c.prototype.loadSubtreeFromXmlFile=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var g,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._disableCadConfigurations()];case 1:return k.sent(),
[4,this._loadSubtreePrologue(1,b,!0)];case 2:return g=k.sent(),[4,this._treeLoader.loadByXmlFile(d,g,c,a)];case 3:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,!1)]}})})};c.prototype.loadSubtreeFromXmlDoc=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var g,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._disableCadConfigurations()];case 1:return k.sent(),[4,this._loadSubtreePrologue(1,b,!0)];case 2:return g=k.sent(),[4,this._treeLoader.loadByXmlDoc(d,
g,c,a)];case 3:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,!1)]}})})};c.prototype.loadSubtreeFromScsXmlFile=function(b,c,d,e){return __awaiter(this,void 0,void 0,function(){var g,k,f;return __generator(this,function(l){switch(l.label){case 0:return[4,this._disableCadConfigurations()];case 1:return l.sent(),[4,this._loadSubtreePrologue(2,b,!0)];case 2:return g=l.sent(),k=a(d),[4,this._treeLoader.loadByXmlFile(e,g,c,k)];case 3:return f=l.sent(),[2,this._loadSubtreeEpilogue(f,!1)]}})})};c.prototype.loadSubtreeFromScsXmlDoc=
function(b,c,d,e){return __awaiter(this,void 0,void 0,function(){var g,k,f;return __generator(this,function(l){switch(l.label){case 0:return[4,this._disableCadConfigurations()];case 1:return l.sent(),[4,this._loadSubtreePrologue(2,b,!0)];case 2:return g=l.sent(),k=a(d),[4,this._treeLoader.loadByXmlDoc(e,g,c,k)];case 3:return f=l.sent(),[2,this._loadSubtreeEpilogue(f,!1)]}})})};c.prototype._loadSubtreeFromStream=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var g,e;return __generator(this,
function(k){switch(k.label){case 0:return[4,this._loadSubtreePrologue(1,b,a)];case 1:return g=k.sent(),[4,this._treeLoader.loadByStream(d,g,c)];case 2:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,!0)]}})})};c.prototype.loadSubtreeFromStream=function(b,c,a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._loadSubtreeFromStream(b,c,!0,a)]})})};c.prototype.loadSubtreeFromScsFile=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,
g;return __generator(this,function(e){switch(e.label){case 0:return[4,this._loadSubtreePrologue(2,b,!0)];case 1:return d=e.sent(),[4,this._treeLoader.loadByScsFile(a,d,c)];case 2:return g=e.sent(),[2,this._loadSubtreeEpilogue(g,!0)]}})})};c.prototype.loadSubtreeFromScsBuffer=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,g;return __generator(this,function(e){switch(e.label){case 0:return[4,this._loadSubtreePrologue(2,b,!0)];case 1:return d=e.sent(),[4,this._treeLoader.loadByScsBuffer(a,
d,c)];case 2:return g=e.sent(),[2,this._loadSubtreeEpilogue(g,!0)]}})})};c.prototype.loadSubtreeFromAssemblyData=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var g,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._loadSubtreePrologue(1,b,!0)];case 1:return g=k.sent(),[4,this._treeLoader.loadByAssemblyData(d,g,c,a)];case 2:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,!0)]}})})};c.prototype.notifyFirstLoadIsEmptyModel=function(){this._treeLoader.notifyFirstLoadIsEmptyModel()};
c.prototype._clearImpl=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:console.assert(!this._clearInProgress),this._clearInProgress=!0,c.label=1;case 1:return c.trys.push([1,5,,6]),[4,this._treeLoader.cancelPendingLoads()];case 2:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),[4,this._treeLoader.reset()];case 3:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),
[4,this._assemblyTree.reset()];case 4:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),this._clearInProgress=!1,[3,6];case 5:throw b=c.sent(),console.assert(this._clearInProgress),this._clearInProgress=!1,b;case 6:return[2]}})})};c.prototype.clear=function(){var b=this;return this._clearQueue.push(function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._callbackManager.trigger("modelSwitchStart",
!0),[4,this._clearImpl()];case 1:return b.sent(),[2,this._callbackManager.promiseTrigger("_modelSwitched","modelSwitched",!0,[],h.AttachType.Direct)]}})})})};c.prototype.switchToModel=function(b){var c=this,a=b===d.EmptyModelName;return this._clearQueue.push(function(){return __awaiter(c,void 0,void 0,function(){var c;return __generator(this,function(g){switch(g.label){case 0:return this._callbackManager.trigger("modelSwitchStart",!1),[4,this._clearImpl()];case 1:g.sent();if(!a)return[3,2];c=[];return[3,
4];case 2:return[4,this._loadSubtreeFromStream(this.getAbsoluteRootNodeId(),b,!1,new d.LoadSubtreeConfig)];case 3:c=g.sent(),g.label=4;case 4:return[4,this._callbackManager.promiseTrigger("_modelSwitched","modelSwitched",a,c,h.AttachType.Direct)];case 5:return g.sent(),[2,c]}})})})};c.prototype.getAbsoluteRootNodeId=function(){return this._assemblyTree.getRootNode().getRuntimeId()};c.prototype.isIdValid=function(b){return null!==this._assemblyTree.lookupAnyNode(b)};c.prototype._getNodeChildren=function(b,
c){var a=b.getChildrenSync();c||(a=a.filter(function(b){return!b.isOutOfHierarchy()}));for(var d=0,g=b.getBodyInstances();d<g.length;d++){var e=g[d];e.isOutOfHierarchy()&&!c||a.push(e)}c=0;for(b=b.getPmis();c<b.length;c++)a.push(b[c]);return a};c.prototype.getChildIds=function(b,c){var a=this._assemblyTree.lookupProductOccurrence(b);if(null===a)return[];b=[];var d=0;for(c=this._getNodeChildren(a,c);d<c.length;d++)b.push(c[d].getRuntimeId());return b};c.prototype.isOutOfHierarchy=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);
return null!==b&&f.isOutOfHierarchy(b)};c.prototype.getParentId=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);if(null===b)return null;b=f.towardContainerNode(b.getParent());return null===b?null:b.getRuntimeId()};c.prototype.getPartReferrers=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,e,m,h,r,q,u,t,v,w,z;return __generator(this,function(g){switch(g.label){case 0:c=this._assemblyTree.lookupProductOccurrence(b);if(null===c)return[2,null];a=this._assemblyTree.getRootNode();
return[4,f.forcePrototypes(a)];case 1:return g.sent(),[4,f.forcePartDefinitions(a)];case 2:g.sent();d=c.getPartDefinitionSync();if(null===d)return[2,null];e=d.getReferrers();m=new Set;h=0;for(r=e;h<r.length;h++)for(q=r[h],u=q.getParent(),t=u.getReferrers(),v=0,w=t;v<w.length;v++)z=w[v],m.add(z.getRuntimeId());return[2,Array.from(m)]}})})};c.prototype.getAttributes=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];
case 1:return c=a.sent(),null===c?[2,[]]:[2,c.getAttributes()]}})})};c.prototype.getProperties=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,e,n,m,p,r=this;return __generator(this,function(g){switch(g.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:c=g.sent();if(null===c)return[2,null];a=null;e=[];n=c.getAttributes().then(function(b){null===a&&(a={});for(var c=0;c<b.length;c++){var d=b[c],g=d.getTitle();d=d.getValue();a[g]=d}});e.push(n);m=function(c){null===a&&
(a={});var g=r.getNetMatrix(b),e=new d.Point3(g.m[0],g.m[1],g.m[2]),k=r.getUnit(b),f=e.length()/k;e=c.volume*f*f*f;f=d.Util.formatWithUnit(c.surfaceArea*f*f,k);a["Surface Area"]=""+f+h.Unicode.Subscript2;k=d.Util.formatWithUnit(e,k);a.Volume=""+k+h.Unicode.Subscript3;k=g.transform(c.centerOfGravity);c=k.x.toLocaleString();g=k.y.toLocaleString();k=k.z.toLocaleString();a.COG="x:"+c+" y:"+g+" z:"+k};c instanceof f.RepresentationItem?(p=c.getPhysicalProperties(),null!==p&&m(p)):c instanceof f.ProductOccurrence&&
(n=Promise.resolve(f.forcePartDefinition(c)).then(function(){return __awaiter(r,void 0,void 0,function(){var b;return __generator(this,function(a){switch(a.label){case 0:return[4,c.getPhysicalProperties()];case 1:return b=a.sent(),null!==b&&m(b),[2]}})})}),e.push(n));return[4,d.Util.waitForAll(e)];case 2:return g.sent(),[2,a]}})})};c.prototype.addProperty=function(b,c,a){b=this._assemblyTree.lookupAnyNode(b);if(null===b)return!1;c=new f.Attribute(d.AttributeType.String,c,a);b.addAttribute(c);return!0};
c.prototype.setPhysicalProperties=function(b,c,a,d){b=this._assemblyTree.lookupRepresentationItem(b);if(null===b)return!1;c=new f.PhysicalProperties(a,d,c);b.setPhysicalProperties(c);return!0};c.prototype.getUserDataIndices=function(b){var c=this._assemblyTree.lookupAnyTreeNode(b);if(null===c)throw new d.InvalidNodeIdError(b);return c.getUserDataIndices()};c.prototype.getUserData=function(b,c){var a=this._assemblyTree.lookupAnyTreeNode(b);if(null===a)throw new d.InvalidNodeIdError(b);return a.getUserData(c)};
c.prototype.getInstanceIncs=function(b,c){b=this._assemblyTree.lookupAnyTreeNode(b);if(null===b)return console.assert(!1),[];var a=f.isOutOfHierarchy(b),d=new Set;return f.gatherInstanceIncsSync(b,c,a,d,f.WalkRestriction.None)};c.prototype.getNodeFromInstanceInc=function(b,c,a,d){var g=this._assemblyTree.lookupAnyBodyByInstanceInc(c,a);null===g?(g=b?this._rectifyParent(c,null):this._assemblyTree.getRootNode(),g=this._assemblyTree.createMeshInstance(b,c,a,null,null,g,!1,d)):g instanceof f.PmiBody?
g=g.getParent():g instanceof f.ViewFrame&&(b=g.getParent(),b);return g.getRuntimeId()};c.prototype._getAssociatedModelKey=function(b){if(b instanceof f.PartDefinition)return b.getModelKey();d.Util.TypeAssert(b);return this._getAssociatedModelKey(b.getParent())};c.prototype.getAssociatedModelKey=function(b){var c=this._assemblyTree.lookupAnyTreeNode(b);return null===c?(c=this._assemblyTree.lookupAnyNonTreeNode(b),null===c?null:this._getAssociatedModelKey(c)):f.towardAttachContext(c).getMasterModelKey()};
c.prototype.getMatrix=function(b){b=this._assemblyTree.lookupAnyNode(b);if(null===b)return new d.Matrix;b=b.getLocalTransform();return null===b?new d.Matrix:b.copy()};c.prototype.setMatrix=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,g;return __generator(this,function(e){d=this._assemblyTree.lookupAnyTreeNode(b);if(null===d)return[2];a?d.setLocalTransformAsInitial(c):d.overrideLocalTransform(c);g=f.isOutOfHierarchy(d);return[2,f.updateScMatrices(this._engine,this._callbackManager,
[d],g)]})})};c.prototype.resetToInitialMatrix=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(d){c=this._assemblyTree.lookupAnyTreeNode(b);return null===c?[2]:c.hasLocalTransformOverride()?(c.removeLocalTransformOverride(),a=f.isOutOfHierarchy(c),[2,f.updateScMatrices(this._engine,this._callbackManager,[c],a)]):[2]})})};c.prototype.getNetMatrix=function(b){b=this._assemblyTree.lookupAnyNode(b);return null===b?new d.Matrix:f.getNetMatrix(b)};c.prototype._getBodyInstanceIndexFrom=
function(b,c,a){void 0===a&&(a={});for(var d=0,g=b.getBodyInstances();d<g.length;d++){var e=g[d];void 0!==a.value?a.value++:a.value=0;if(e===c)return a.value}d=0;for(g=b.getChildrenSync();d<g.length;d++)if(b=this._getBodyInstanceIndexFrom(g[d],c,a),void 0!==b)return b};c.prototype.getNodeOrRepItem=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,e,m,h;return __generator(this,function(g){switch(g.label){case 0:if(!(b instanceof f.BodyInstance))return[3,8];c=void 0;a=b.getParent();
d=void 0;e=a;g.label=1;case 1:return e instanceof f.ProductOccurrence?[4,f.forcePartDefinition(e)]:[2,null];case 2:return g.sent(),[4,e.getPartDefinition()];case 3:return m=g.sent(),null===m?[3,5]:[4,m.value];case 4:return d=g.sent(),[3,7];case 5:e=e.getParent(),g.label=6;case 6:return[3,1];case 7:return c=this._getBodyInstanceIndexFrom(e,b),h=d.getRepresentationItems(),void 0!==c&&c<h.length?[2,h[c]]:[2,null];case 8:if(b instanceof f.ProductOccurrence||b instanceof f.Pmi||b instanceof f.CadView||
b instanceof f.PartDefinition||b instanceof f.RepresentationItem)return[2,b];g.label=9;case 9:return[2,null]}})})};c.prototype._getNodeOrRepItemFromId=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){c=this._assemblyTree.lookupAnyNode(b);return null===c?[2,null]:[2,this.getNodeOrRepItem(c)]})})};c.prototype.getEdgeCount=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return[4,
this._getNodeOrRepItemFromId(b)];case 1:return c=a.sent(),c instanceof f.RepresentationItem?[2,c.getEdgeCount()]:[2,0]}})})};c.prototype.getEdgeAttributes=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(g){switch(g.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return a=g.sent(),a instanceof f.RepresentationItem&&(d=a.getEdgeAttributes(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.getEdgeProperty=function(b,c){return __awaiter(this,
void 0,void 0,function(){var a,d;return __generator(this,function(g){switch(g.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return a=g.sent(),a instanceof f.RepresentationItem&&(d=a.getEdgeMeasurementProperty(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.getFaceCount=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return c=a.sent(),c instanceof f.RepresentationItem?
[2,c.getFaceCount()]:[2,0]}})})};c.prototype.getFaceAttributes=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(g){switch(g.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:return a=g.sent(),a instanceof f.RepresentationItem&&(d=a.getFaceAttributes(c),null!=d)?[2,d.copy()]:[2,null]}})})};c.prototype.getFaceProperty=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(g){switch(g.label){case 0:return[4,
this._getNodeOrRepItemFromId(b)];case 1:return a=g.sent(),a instanceof f.RepresentationItem&&(d=a.getFaceMeasurementProperty(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.setEdgeProperty=function(b,c,a){b=this._assemblyTree.lookupRepresentationItem(b);null!==b&&f.MeasurementProperty.isEdge(a)&&b.setEdgeMeasurementProperty(c,a)};c.prototype.setFaceProperty=function(b,c,a){b=this._assemblyTree.lookupRepresentationItem(b);null!==b&&f.MeasurementProperty.isFace(a)&&b.setFaceMeasurementProperty(c,
a)};c.prototype.getName=function(b){b=this._assemblyTree.lookupAnyNode(b);return null!==b?b.getName():null};c.prototype.getNodeExchangeId=function(b){b=this._assemblyTree.lookupAnyNode(b);return null!==b?b.getExchangeId():null};c.prototype.getFilters=function(){return this._assemblyTree.getFilters()};c.prototype.getFilterName=function(b){return this._assemblyTree.getFilterName(b)};c.prototype.getFiltersWithNode=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null===b?[]:this._assemblyTree.getFiltersWithNode(b)};
c.prototype.getNodesFromFilterIds=function(b){return this._assemblyTree.getNodesFromFilterIds(b)};c.prototype.getLayers=function(){return this._assemblyTree.getLayers()};c.prototype.getUniqueLayerNames=function(){return this._assemblyTree.getUniqueLayerNames()};c.prototype.getLayerName=function(b){return this._assemblyTree.getLayerName(b)};c.prototype.getLayerIdsFromName=function(b){return this._assemblyTree.getLayersIdFromName(b)};c.prototype.getNodeLayerId=function(b){b=this._assemblyTree.lookupAnyNode(b);
return null!==b?b.getLayerId():null};c.prototype.getNodesFromLayer=function(b,c){b=this._assemblyTree.getNodesFromLayer(b,c);return null===b?null:b.map(function(b){return b.getAuthoredId()})};c.prototype.getNodesFromLayers=function(b,c){b=this._assemblyTree.getNodesFromLayers(b,c);return null===b?null:b.map(function(b){return b.getAuthoredId()})};c.prototype.getNodesFromLayerName=function(b,c){b=this._assemblyTree.getNodesFromLayerName(b,c);return null===b?null:b.map(function(b){return b.getAuthoredId()})};
c.prototype.createCadView=function(b,c,a,d,e,f,h,r,q){if(null===this._assemblyTree.lookupProductOccurrence(b))return null;b=this._assemblyTree.lookupProductOccurrence(b);if(null===b)return null;for(var g=[],k=0;k<d.length;k++){var l=this._assemblyTree.lookupPmi(d[k]);null!==l&&g.push(l)}d=new Map;for(k=0;k<h.length;k++)l=h[k],d.set(l[0],l[1]);return this._assemblyTree.createCadView(this._engine,b,c,a,g,e,f,d,r,q).getRuntimeId()};c.prototype.getCadViews=function(){var b=this._assemblyTree.getFirstProductOccurrenceWithView(),
c={};this._assemblyTree.forEachCadView(function(a){var d=a.getRuntimeId(),g=a.getParent();a=g===b?a.getName()||"(null)":g.getName()+" - "+a.getName();c[d]=a});return c};c.prototype.activateCadView=function(b,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return this._assemblyTree.hasActiveCadView()?[4,this._assemblyTree.deactivateActiveCadView()]:[3,2];case 1:return d.sent(),[2,this.activateCadView(b,c)];case 2:return a=this._assemblyTree.lookupCadView(b),
null===a?[2]:[2,this._assemblyTree.activateCadView(a,c)]}})})};c.prototype.getCadViewPmis=function(b){var c=this._assemblyTree.lookupCadView(b);if(null===c)return[];b=[];var a=0;for(c=this._assemblyTree.getCadViewPmis(c);a<c.length;a++)b.push(c[a].getRuntimeId());return b};c.prototype._disableCadConfigurations=function(){this._cadConfigurationsEnabled=!1;return this._assemblyTree.deactivateActiveCadView()};c.prototype.cadConfigurationsEnabled=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(b){switch(b.label){case 0:return this._cadConfigurationsEnabled&&this._assemblyTree.seenExternalModel()?[4,this._disableCadConfigurations()]:[3,2];case 1:b.sent(),b.label=2;case 2:return[2,this._cadConfigurationsEnabled]}})})};c.prototype.getCadConfigurations=function(){var b={};this._assemblyTree.forEachCadConfiguration(function(c){var a=c.getRuntimeId();c=c.getName()||"(null)";b[a]=c});return b};c.prototype.getDefaultCadConfiguration=function(){var b=this._assemblyTree.getDefaultCadConfiguration();
return null!==b?b.getRuntimeId():null};c.prototype.getActiveCadConfiguration=function(){var b=this._assemblyTree.getActiveCadConfiguration();return null!==b?b.getRuntimeId():null};c.prototype._activateCadConfiguration=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._assemblyTree.activateCadConfiguration(b)];case 1:return a.sent(),c=b.getRuntimeId(),this._callbackManager.trigger("configurationActivated",c),[2]}})})};
c.prototype.activateCadConfiguration=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){c=this._assemblyTree.lookupProductOccurrence(b);return null===c?[2]:[2,this._activateCadConfiguration(c)]})})};c.prototype.activateDefaultCadConfiguration=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){b=this._assemblyTree.getDefaultCadConfiguration();return null===b?[2]:[2,this._activateCadConfiguration(b)]})})};
c.prototype.getPmis=function(){var b={};this._assemblyTree.forEachPmi(function(c){var a=c.getRuntimeId();c=c.getName()||"(null)";b[a]=c});return b};c.prototype.getPmiType=function(b){b=this._assemblyTree.lookupPmi(b);return null===b?f.PmiType.Unknown:b.getPmiType()};c.prototype.getPmiSubType=function(b){b=this._assemblyTree.lookupPmi(b);return null===b?d.PmiSubType.Unknown:b.getPmiSubType()};c.prototype.getUnit=function(b){b=this._assemblyTree.lookupAnyNode(b);return b instanceof f.ProductOccurrence?
b.getMeasurementUnit():b instanceof f.BodyInstance?b.getParent().getMeasurementUnit():1};c.prototype._rectifyParent=function(b,c){if(null!==c){c=this._assemblyTree.lookupProductOccurrence(c);if(null!==c)return c;console.assert(!1)}b=this._assemblyTree.getInclusionContexts(b);return 0<b.length?(b=b[0].getChildren(),console.assert(0<b.length),b[0]):this._assemblyTree.getRootNode()};c.prototype.createMeshInstance=function(b,c,a,d,e,f){d=this._rectifyParent(b,d);return this._assemblyTree.createMeshInstance(!0,
b,c,null,a,d,e,f).getRuntimeId()};c.prototype.createPmiInstance=function(b,c,a,d,e,f,h){h=this._rectifyParent(b,h);return this._assemblyTree.createPmiInstance(b,c,null,f,h,a,d,e).getRuntimeId()};c.prototype.setVisibilitiesByMap=function(b,c){var a=this,d=new Map;b.forEach(function(b,c){c=a._assemblyTree.lookupAnyTreeNode(c);null!==c&&d.set(c,b)});b=this._assemblyTree.getRootNode();return f.updateVisibilities(this._assemblyTree,this._engine,this._callbackManager,b,d,!1,c,null)};c.prototype.setVisibilitiesByValue=
function(b,c,a){for(var d=new Map,g=0;g<b.length;g++){var e=this._assemblyTree.lookupAnyTreeNode(b[g]);null!==e&&d.set(e,c)}c=this._assemblyTree.getRootNode();1===b.length&&(b=this._assemblyTree.lookupAnyTreeNode(b[0]),b instanceof f.ProductOccurrence&&(c=b));return f.updateVisibilities(this._assemblyTree,this._engine,this._callbackManager,c,d,!1,a,null)};c.prototype.resetAllVisibilities=function(){var b=new Map,c=this._assemblyTree.getRootNode(),a=this._assemblyTree.getActiveCadConfiguration();return f.updateVisibilities(this._assemblyTree,
this._engine,this._callbackManager,c,b,!0,null,a)};c.prototype.resetAllTransforms=function(){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(a){switch(a.label){case 0:return b=this._assemblyTree.getRootNode(),[4,f.resetTransforms(b)];case 1:return(c=a.sent())?[2,f.updateScMatrices(this._engine,this._callbackManager,[b],!1)]:[2]}})})};c.prototype.reset=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return this._cadConfigurationsEnabled=
!0,this.isACadDrawing()?[2,this._callbackManager.promiseTrigger("_resetDrawing",null)]:this._assemblyTree.hasActiveCadView()?[4,this._assemblyTree.deactivateActiveCadView()]:[3,2];case 1:c.sent(),c.label=2;case 2:return b=[this.resetAllVisibilities(),this.resetAllTransforms()],[4,d.Util.waitForAll(b)];case 3:return c.sent(),[2]}})})};c.prototype.setPmiColor=function(b,c){void 0===c&&(c=this.getAbsoluteRootNodeId());c=this.getInstanceIncs(c,6);0<c.length&&(this._engine.setPartColor(c,d.ElementType.Faces,
b),this._engine.setPartColor(c,d.ElementType.Lines,b))};c.prototype.resetPmiColor=function(b){void 0===b&&(b=this.getAbsoluteRootNodeId());b=this.getInstanceIncs(b,6);0<b.length&&(this._engine.unsetPartColor(b,d.ElementType.Faces),this._engine.unsetPartColor(b,d.ElementType.Lines))};c.prototype.getPmiTopologyReferences=function(b){b=this._assemblyTree.lookupPmi(b);return null===b?null:b.getPmiTopologyReferences(this._assemblyTree)};c.prototype.createNode=function(b,c,a,e,n,m){void 0===e&&(e=null);
void 0===n&&(n=!0);void 0===m&&(m=null);var g=null;null!==b&&(g=this._assemblyTree.lookupProductOccurrence(b));null===g&&(g=this._assemblyTree.getRootNode());null===a||f.isAuthoredId(a)||(a=null);m&&(b=m/g.getMeasurementUnit(),b=(new d.Matrix).setScaleComponent(b,b,b),e=e?d.Matrix.multiply(e,b):b);return this._assemblyTree.createNode(g,c,a,e,n,m).getRuntimeId()};c.prototype.deleteNode=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){c=this._assemblyTree.lookupAnyTreeNode(b);
if(null!==c){if(c instanceof f.ProductOccurrence||c instanceof f.BodyInstance)return[2,this._assemblyTree.deleteNode(c)];throw new d.InvalidNodeTypeError(b,0,2);}return[2]})})};c.prototype.createPart=function(b){return this._assemblyTree.createPart(b).getRuntimeId()};c.prototype.setPart=function(b,c){b=this._assemblyTree.lookupProductOccurrence(b);if(null===b)return!1;c=this._assemblyTree.lookupPartDefinition(c);if(null===c)return!1;this._assemblyTree.setPart(b,c);return!0};c.prototype.createAndAddRepItem=
function(b,c){b=this._assemblyTree.lookupPartDefinition(b);return null===b?null:b.createRepItem(this._assemblyTree,c).getRuntimeId()};c.prototype.getLowestAvailableNodeId=function(){return this._assemblyTree.getLowestAvailableNodeId()};c.prototype.getType=function(b){b=this._assemblyTree.lookupAnyNode(b);return null===b?d.NodeType.Unknown:f.getNodeType(b)};c.prototype.isVisible=function(b){b=this._assemblyTree.lookupAnyNode(b);return null!==b?b.isVisible():!1};c.prototype.getBranchVisibility=function(b){b=
this._assemblyTree.lookupAnyTreeNode(b);return null!==b?f.getBranchVisibility(b):1};c.prototype.setMeshLevel=function(b,c){for(var a=[],d=0;d<b.length;d++){var g=this._assemblyTree.lookupAnyTreeNode(b[d]);null!==g&&a.push(g)}return f.setMeshLevels(this._engine,a,c)};c.prototype.setEnableAutomaticUnitScaling=function(b){this._assemblyTree.setAutomaticMeasurementUnitScaling(b)};c.prototype.setBehaviorInitiallyHidden=function(b){this._assemblyTree.setInitiallyHiddenStayHidden(b)};c.prototype.isACadDrawing=
function(){return this._assemblyTree.containsDrawings()};c.prototype.isMeasurable=function(){return this._assemblyTree.isMeasureable()};c.prototype.getModelFileNameFromNode=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?f.towardAttachContext(b).getOriginalFileName():null};c.prototype.getModelFileTypeFromNode=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?f.towardAttachContext(b).getOriginalFileType():null};c.prototype.isAnnotationView=function(b){var c=
this._assemblyTree.lookupCadView(b);if(null!==c)return c.isAnnotationView();throw new d.InvalidNodeTypeError(b,3);};c.prototype.preventNodeDeletion=function(b){b=this._assemblyTree.lookupBodyInstance(b);if(null===b)throw new d.InternalLogicError;this._assemblyTree.preventNodeDeletion(b)};c.prototype.preventMeshDeletion=function(b){this._assemblyTree.preventMeshDeletion(b)};c.prototype.getBounding=function(b,c,a,d){return f.getBoundingByNodeId(this._assemblyTree,this._engine,b,c,a,d)};c.prototype.getIdOffset=
function(b){b=this._assemblyTree.lookupAnyNode(b);return null!==b?(b instanceof f.PartDefinition?b.getInclusionContextForNodeId():b instanceof f.RepresentationItem?b.getParent().getInclusionContextForNodeId():f.towardInclusionContext(b)).getIdOffset():0};c.prototype.isNodeLoaded=function(b){var c=this._assemblyTree.lookupAnyNode(b);if(null===c)throw new d.InvalidNodeIdError(b);return c.isLoaded()};c.prototype.shutdown=function(){var b=this._treeLoader.cancelPendingLoads();b};c.prototype.isReady=function(){console.assert(2!==
this._readyPromise.state);return 0!==this._readyPromise.state};c.prototype.waitForReady=function(){return this._readyPromise};c.prototype.lookupAnyTreeNode=function(b){return this._assemblyTree.lookupAnyTreeNode(b)};c.prototype.lookupAnyBody=function(b){return this._assemblyTree.lookupAnyBody(b)};c.prototype.lookupBodyInstance=function(b){return this._assemblyTree.lookupBodyInstance(b)};c.prototype.gatherInstanceIncsFromNodeIds=function(b,c,a){return f.gatherInstanceIncsByNodeIdsSync(this._assemblyTree,
b,c,a)};c.prototype.requestNodes=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,e,f;return __generator(this,function(g){c=[];a=0;for(d=b;a<d.length;a++)e=d[a],f=this._assemblyTree.lookupAnyTreeNode(e),null!==f&&c.push(f);return[2,this._assemblyTree.requestNodes(this._treeLoader,c,!1)]})})};c.prototype.isWithinExternalModel=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);if(null===b)return!1;for(b=f.towardProductOccurrence(b);null!==b;){if(b.isExternalModelRoot())return!0;
b=f.towardProductOccurrence(b.getParent())}return!1};c.prototype.getNodeGenericType=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?f.getNodeGenericType(b):null};c.prototype.getNodeGenericId=function(b){b=this._assemblyTree.lookupAnyTreeNode(b);return null!==b?b.getGenericId():null};c.prototype.getNodeByGenericId=function(b){b=this._assemblyTree.getNodeByGenericId(b);return null!==b?b.getRuntimeId():null};c.prototype.getNodesByGenericType=function(b){b=this._assemblyTree.getNodesByGenericType(b);
if(null!==b){var c=new Set;b.forEach(function(b){c.add(b.getRuntimeId())});return c}return null};c.prototype.getGenericTypes=function(){var b=[];this._assemblyTree.genericTypeToNodes().forEach(function(c,a){b.push(a)});return b};c.prototype.getGenericTypeIdMap=function(){var b=new Map;this._assemblyTree.genericTypeToNodes().forEach(function(c,a){var d=new Set;c.forEach(function(b){d.add(b.getRuntimeId())});b.set(a,d)});return b};c.prototype.hasEffectiveGenericType=function(b,c){var a=this.lookupAnyTreeNode(b);
if(null===a)throw new d.InvalidNodeIdError(b);return f.hasEffectiveGenericType(a,c)};c.prototype.registerGenericId=function(b,c){return this._assemblyTree.registerGenericGlobalId(b,c)};c.prototype.registerGenericType=function(b,c){return this._assemblyTree.registerGenericType(b,c)};c.prototype.firstAssemblyDataHeader=function(){return this._treeLoader.firstAssemblyDataHeader()};return c}();f.ModelStructure=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){function a(a){for(;;)if(a instanceof f.InclusionContext)a=a.getParent();else{if(a instanceof f.AttachContext)return a;if(a instanceof f.NodeMixin)a=a.getParent();else if(a instanceof f.LoadContext){if(a=a.getParent(),null===a)throw new d.InternalLogicError;}else d.Util.TypeAssert(a),a=a.getInclusionContext()}}f.getNetMatrix=function(a){for(var c=new d.Matrix;null!==a;)if(a instanceof f.NodeMixin){var b=a.getLocalTransform();b&&(c=d.Matrix.multiply(c,b));a=a instanceof
f.PartDefinition?null:a.getParent()}else if(a instanceof f.InclusionContext)a=a.getParent();else if(a instanceof f.AttachContext)a=a.getParent();else if(a instanceof f.LoadContext)a=a.getParent();else{d.Util.TypeAssert(a);break}return c};f.towardContainerNode=function(a){for(;;)if(a instanceof f.NodeMixin)if(a instanceof f.BodyMixin)a=a.getParent();else return a;else if(a instanceof f.LoadContext)a=a.getParent();else if(a instanceof f.InclusionContext)a=a.getParent();else if(a instanceof f.AttachContext)a=
a.getParent();else{if(null===a)return null;d.Util.TypeAssert(a);console.assert(!1);a=a.getInclusionContext()}};f.isOutOfHierarchy=function(a){return a instanceof f.BodyMixin||a instanceof f.ProductOccurrence?a.isOutOfHierarchy():!1};f.getBranchVisibility=function(a){return a instanceof f.ProductOccurrence||a instanceof f.Pmi||a instanceof f.CadView?a.getBranchVisibility():a.isVisible()?2:1};f.getNodeType=function(a){if(a instanceof f.ProductOccurrence)return a.hasBodyInstances()?a.isADrawingSheetNode()?
d.NodeType.DrawingSheet:d.NodeType.PartInstance:d.NodeType.AssemblyNode;if(a instanceof f.PartDefinition)return d.NodeType.Part;if(a instanceof f.PmiBody)return d.NodeType.PmiBody;if(a instanceof f.ViewFrame)return d.NodeType.ViewFrame;if(a instanceof f.BodyInstance)return d.NodeType.BodyInstance;if(a instanceof f.RepresentationItem)switch(a.getBodyType()){case f.BodyType.BRep:return d.NodeType.BrepBody;case f.BodyType.Tessellation:return d.NodeType.TessBody;case f.BodyType.Wireframe:return d.NodeType.WireBody;
case f.BodyType.PointCloud:return d.NodeType.PointsBody;default:return d.NodeType.Body}else{if(a instanceof f.Pmi)return d.NodeType.Pmi;d.Util.TypeAssert(a);return d.NodeType.CadView}};f.getNodeGenericType=function(d){var c=d.getGenericTypeId();return null!==c&&(d=a(d).getGenericTypeMaps(),null!==d)?d.getRight(c)||null:null};f.towardInclusionContext=function(a){for(;;)if(a instanceof f.NodeMixin)a=a.getParent();else{if(a instanceof f.InclusionContext)return a;if(a instanceof f.PmiBody)a=a.getParent();
else if(a instanceof f.ViewFrame)a=a.getParent();else return d.Util.TypeAssert(a),a.getInclusionContext()}};f.towardLoadContext=function(a){for(;;)if(a instanceof f.AttachContext)a=a.getParent();else{if(a instanceof f.LoadContext)return a;a instanceof f.NodeMixin?a=a.getParent():a instanceof f.InclusionContext?a=a.getParent():(d.Util.TypeAssert(a),a=a.getInclusionContext())}};f.towardAttachContext=a;f.towardAttachRoot=function(a){for(var c=null;;)if(a instanceof f.ProductOccurrence)c=a,a=a.getParent();
else if(a instanceof f.NodeMixin)a=a.getParent();else{if(a instanceof f.InclusionContext){if(null===c)throw new d.InternalLogicError;return c}d.Util.TypeAssert(a);a=a.getInclusionContext()}};f.towardProductOccurrence=function(a){for(;;){if(a instanceof f.ProductOccurrence)return a;if(a instanceof f.AttachContext)a=a.getParent();else if(a instanceof f.InclusionContext)a=a.getParent();else if(a instanceof f.LoadContext){if(a=a.getParent(),null===a)return null}else if(a instanceof f.BodyMixin)a=a.getParent();
else if(a instanceof f.Pmi)a=a.getParent();else if(a instanceof f.CadView)a=a.getParent();else return d.Util.TypeAssert(a),console.assert(!1),null}}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){(function(a){})(f.GenericTypeId||(f.GenericTypeId={}));var a=function(){function a(c,b,a,e,f){this._inclusionContexts=this._reservedNodeIdOffset=null;this._originalFileName="";this._originalFileType=d.FileType.Unknown;this._genericTypeMaps=null;console.assert(4294967295!==e);this._remapper=c;this._attachScope=b;this._attachedInvisibly=a;this._masterModelKey=e;this._parent=f}a.prototype.getRootNodeMetaData=function(c){return __awaiter(this,void 0,void 0,function(){var b,
a,d,e,n,m;return __generator(this,function(g){switch(g.label){case 0:if(4294967295===this._masterModelKey)return[2,null];b=c.getAbstractScEngine();a=this._masterModelKey;return[4,b.safeGetMetaData(a,1)];case 1:d=g.sent();if(null===d)return[3,4];e=c.tryParseHeader(d);return null===e?[2,new f.AssemblyData(null,d)]:[4,e];case 2:return n=g.sent(),this._originalFileName=n.originalFileName,this._originalFileType=n.originalFileType,[4,b.safeGetMetaData(a,n.rootAssemblyDataKey())];case 3:return m=g.sent(),
null!==m?[2,new f.AssemblyData(n,m)]:[2,null];case 4:return[2,null]}})})};a.prototype.getAttachScope=function(){return this._attachScope};a.prototype.attachedInvisibly=function(){return this._attachedInvisibly};a.prototype.getMasterModelKey=function(){return this._masterModelKey};a.prototype.addInclusionContext=function(c){console.assert(c.getParent()===this);this._inclusionContexts=h.TerseArray.push(this._inclusionContexts,c)};a.prototype.getRemapper=function(){return this._remapper};a.prototype.getParent=
function(){return this._parent};a.prototype.getChildren=function(){var c=this._inclusionContexts;if(null===c)return[];if(Array.isArray(c)){console.assert(0<c.length);for(var b=c[0].getChildren(),a=1;a<c.length;++a)h.append(b,c[a].getChildren());return b}return c.getChildren()};a.prototype.split=function(c,b,d){return new a(this._remapper,c,b,this._masterModelKey,d)};a.prototype.hasChildren=function(){return null!==this._inclusionContexts};a.prototype.removeProductOccurrence=function(c){for(var b=
null,a=h.TerseArray.toArray(this._inclusionContexts),d=0,e=a;d<e.length;d++){var f=e[d];if(f.removeProductOccurrence(c)){b=f;break}}if(null===b)return!1;a=a.filter(function(b){return b.hasChildren()});this._inclusionContexts=0===a.length?null:h.TerseArray.fromArray(a);return!0};a.prototype.purgeContents=function(){for(var c=[],b=0,a=h.TerseArray.toArray(this._inclusionContexts);b<a.length;b++){var e=a[b].purgeContents();c.push(e)}this._inclusionContexts=null;return d.Util.waitForAll(c)};a.prototype.isLoaded=
function(){if(this._inclusionContexts instanceof f.InclusionContext)return this._inclusionContexts.isLoaded();if(null!==this._inclusionContexts)for(var c=0,b=this._inclusionContexts;c<b.length;c++)if(!b[c].isLoaded())return!1;return!0};a.prototype.setReservedNodeIdOffset=function(c){console.assert(null===this._reservedNodeIdOffset);this._reservedNodeIdOffset=c};a.prototype.getReservedNodeIdOffset=function(){return this._reservedNodeIdOffset};a.prototype.forgetReservedNodeIdOffset=function(){console.assert(null!==
this._reservedNodeIdOffset);this._reservedNodeIdOffset=null};a.prototype.getOriginalFileName=function(){return this._originalFileName};a.prototype.getOriginalFileType=function(){return this._originalFileType};a.prototype.setGenericTypeMaps=function(c){this._genericTypeMaps=c};a.prototype.getGenericTypeMaps=function(){return this._genericTypeMaps};return a}();f.AttachContext=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(c,b,a,d){this._productOccurrences=null;console.assert(void 0!==a);console.assert(0===a===(0===d));this._parent=b;this._inclusionKey=a;this._modelKey=d;b=f.towardAttachContext(b);a=b.getReservedNodeIdOffset();null!==a?b.forgetReservedNodeIdOffset():a=c.newNodeIdOffset();this._nodeIdOffset=a;c.registerInclusionContext(this)}a.prototype.split=function(c,b){return new a(c,b,this._inclusionKey,this._modelKey)};a.prototype.getIdOffset=function(){return this._nodeIdOffset};
a.prototype.toRuntimeId=function(c){console.assert(f.isAuthoredId(c));return c+this._nodeIdOffset};a.prototype.getInclusionKey=function(){return this._inclusionKey};a.prototype.getModelKey=function(){return this._modelKey};a.prototype.getParent=function(){return this._parent};a.prototype.addProductOccurrence=function(c){console.assert(c.getParent()===this);this._productOccurrences=h.TerseArray.push(this._productOccurrences,c)};a.prototype.getChildren=function(){console.assert(null!==this._productOccurrences);
return h.TerseArray.toArray(this._productOccurrences)};a.prototype.removeProductOccurrence=function(c){var b=h.TerseArray.toArray(this._productOccurrences),a=b.length;b=b.filter(function(b){return b!==c});0===b.length?delete this._productOccurrences:this._productOccurrences=h.TerseArray.fromArray(b);return b.length<a};a.prototype.purgeContents=function(){for(var c=[],b=0,a=h.TerseArray.toArray(this._productOccurrences);b<a.length;b++){var e=a[b].purgeContents();c.push(e)}this._productOccurrences=
null;return d.Util.waitForAll(c)};a.prototype.hasChildren=function(){return null!==this._productOccurrences};a.prototype.isLoaded=function(){if(this._productOccurrences instanceof f.ProductOccurrence)return this._productOccurrences.isLoaded();if(null!==this._productOccurrences)for(var c=0,b=this._productOccurrences;c<b.length;c++)if(!b[c].isLoaded())return!1;return!0};return a}();f.InclusionContext=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(c,b,a){this._attachContexts=this._handledExternalModels=null;this._registeredScsModelKeys=new Map;this._parent=c;this._debugLoadString=b;this._debugLoadString;this._scsBufferCache=a}a.prototype.handleExternalModel=function(c,b,a){b=b.getInclusionKey();c=h.compressUint(a)+" "+h.compressUint(b)+" "+h.compressUint(c);null===this._handledExternalModels&&(this._handledExternalModels=new Set);if(this._handledExternalModels.has(c))return!1;
this._handledExternalModels.add(c);return!0};a.prototype.getParent=function(){return this._parent};a.prototype.addAttachContext=function(c){this._attachContexts=h.TerseArray.push(this._attachContexts,c)};a.prototype.getChildren=function(){var c=this._attachContexts;if(null===c)return[];if(Array.isArray(c)){console.assert(0<c.length);for(var b=c[0].getChildren(),a=1;a<c.length;++a)h.append(b,c[a].getChildren());return b}return c.getChildren()};a.prototype.hasChildren=function(){return null!==this._attachContexts};
a.prototype.removeProductOccurrence=function(c){for(var b=null,a=h.TerseArray.toArray(this._attachContexts),d=0,e=a;d<e.length;d++){var f=e[d];if(f.removeProductOccurrence(c)){b=f;break}}if(null===b)return!1;a=a.filter(function(b){return b.hasChildren()});this._attachContexts=0===a.length?null:h.TerseArray.fromArray(a);return!0};a.prototype.purgeContents=function(){for(var c=[],b=0,a=h.TerseArray.toArray(this._attachContexts);b<a.length;b++){var e=a[b].purgeContents();c.push(e)}this._attachContexts=
null;return d.Util.waitForAll(c)};a.prototype.isLoaded=function(){if(this._attachContexts instanceof f.AttachContext)return this._attachContexts.isLoaded();if(null!==this._attachContexts)for(var c=0,b=this._attachContexts;c<b.length;c++)if(!b[c].isLoaded())return!1;return!0};a.prototype.initializeScsModelKeysOf=function(c){console.assert(void 0===this._registeredScsModelKeys.get(c));this._registeredScsModelKeys.set(c,h.TrackedOpenPromise.create())};a.prototype.getScsModelKeysOf=function(c){c=this._registeredScsModelKeys.get(c);
return void 0===c?null:c};a.prototype.markAsFirstLoad=function(){console.assert(void 0===this._isFirstLoad);this._isFirstLoad=!0};a.prototype.isFirstLoad=function(){return!0===this._isFirstLoad};a.prototype.toScsBuffer=function(c,b){return __awaiter(this,void 0,void 0,function(){var a,e=this;return __generator(this,function(g){a=h.LazyPromise.create(function(){return __awaiter(e,void 0,void 0,function(){var a;return __generator(this,function(g){switch(g.label){case 0:return[4,b(c)];case 1:g=a=g.sent();
if("string"===typeof g)throw new d.InternalLogicError;return[2,g]}})})});return null===this._scsBufferCache?[2,a]:[2,this._scsBufferCache.load(c,a)]})})};a.prototype.onLoadComplete=function(){this._scsBufferCache=null};return a}();f.LoadContext=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(f){var a=function(){function c(b){this._referrers=null;this._prototype=b}c.prototype._addReferrer=function(b){this._referrers=d.TerseArray.push(this._referrers,b)};c.prototype._getReferrers=function(){return d.TerseArray.toArray(this._referrers)};c.prototype._getPrototype=function(){return this._prototype};c.prototype._removeReferrer=function(b){var c=!1,a=d.TerseArray.toArray(this._referrers);a=a.filter(function(a){return a===b?(c=!0,!1):!0});if(!c)return!1;0===
a.length?delete this._referrers:this._referrers=d.TerseArray.fromArray(a);return!0};c.prototype._purgeContents=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return this._prototype.isUnforced()?[3,3]:[4,this._prototype];case 1:return b=c.sent(),[4,b.purgeContents()];case 2:c.sent(),c.label=3;case 3:return[2]}})})};c.prototype._isLoaded=function(){return this._prototype.isResolved()&&this._prototype.getResolved().isLoaded()};
return c}();f.SharedPrototypeContext=a;var e=function(){function c(b,c){b instanceof a&&(b=d.LazyObject.create(b));this._shared=b;this._inclusionContext=c}c.prototype.getInclusionContext=function(){return this._inclusionContext};c.prototype.addReferrer=function(b){this._shared.get()._addReferrer(b)};c.prototype.getReferrers=function(){return this._shared.get()._getReferrers()};c.prototype.getProductOccurrence=function(){return this._shared.get()._getPrototype()};c.prototype.removeReferrer=function(b){return this._shared.get()._removeReferrer(b)?
(b=b.removePrototype(),console.assert(this===b),!0):!1};c.prototype.removeAllReferrers=function(){for(var b=0,c=this.getReferrers();b<c.length;b++)this.removeReferrer(c[b])||console.assert(!1)};c.prototype.purgeContents=function(){return this._shared.get()._purgeContents()};c.prototype.isLoaded=function(){return this._shared.get()._isLoaded()};return c}();f.PrototypeContext=e})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function b(){this._bits2=this._bits1=0}b.prototype.hasBits1=function(b){return h.hasBits(this._bits1,b)};b.prototype.hasBits2=function(b){return h.hasBits(this._bits2,b)};b.prototype.parseBits1=function(b){this._bits1=b.parseIndex_32()};b.prototype.parseBits2=function(b){this.hasBits1(1073741824)&&(this._bits2=b.parseIndex_32())};return b}();f.NodeParseBits=a;var e=function(){return function(b,c){this.shown=b;this.removed=c}}();f.AssemblyVisibility=
e;var c=function(){function b(b){this._bytes=b.bytes;this._header=b.header;this._dataView=new DataView(this._bytes.buffer,this._bytes.byteOffset,this._bytes.byteLength);this._currentPos=0}b.prototype.hasNext=function(){return this._currentPos<this._bytes.length};b.prototype.parseCount_32=function(){return this._parseUint_32()};b.prototype.parseIndex_32=function(){return this._parseUint_32()};b.prototype.parseAssemblyDataVersion=function(){return{major:this._parseUint_32(),minor:this._parseUint_32()}};
b.prototype.parseAssemblyDataHeaderVersion=function(){return this._parseUint_32()};b.prototype.parseVisibility=function(){var b=this._parseInt_8(),c=h.hasBits(b,2);b=h.hasBits(b,1);return new e(c,b)};b.prototype.parseProductBits=function(){var b=this._parseUint_8();return null!==this._header&&2<=this._header.headerVersion||!h.hasBits(b,6)?b:b&-7|32};b.prototype.parseCString=function(){for(var b=this._currentPos,c=this._bytes[this._currentPos++];0!==c;)c=this._bytes[this._currentPos++];return h.utf8ArrayToStr(this._bytes.subarray(b,
this._currentPos-1))};b.prototype.parseBytes=function(b){var c=this._currentPos;this._currentPos+=b;b=this._bytes.subarray(c,this._currentPos);return new Uint8Array(b)};b.prototype.parseNodeId=function(){var b=this._parseUint_32();console.assert(b!==f.invalidNodeId);return b};b.prototype.parseLayerId=function(){var b=this._parseUint_32();console.assert(b!==f.invalidNodeId);return b};b.prototype.parseGenericTypes=function(){for(var b=this._parseUint_32(),c=new h.Bimap,a=0;a<b;a++){var d=this.parseCString(),
e=this._parseUint_32();c.set(e,d)}return c};b.prototype.parseGenericTypeId=function(){return this._parseUint_32()};b.prototype.parseGenericId=function(){return this.parseCString()};b.prototype._parseScKey=function(){var b=this._parseUint_32();console.assert(4294967295!==b);return b};b.prototype.parseDataKey=function(){return this._parseScKey()};b.prototype.parseInstanceKey=function(){return this._parseScKey()};b.prototype.parseMeshKey=function(){return this._parseScKey()};b.prototype.parseModelKey=
function(b){var c=this._parseScKey();return null!==b?b.getEffectiveModelKey(c):c};b.prototype.parseInclusionKey=function(b,c){var a=this._parseScKey();return null!==b?b.getEffectiveInclusionKey(a,c):a};b.prototype._parseInt_8=function(){return this._dataView.getInt8(this._currentPos++)};b.prototype._parseUint_8=function(){return this._dataView.getUint8(this._currentPos++)};b.prototype._parseUint_32=function(){var b=this._dataView.getUint32(this._currentPos,!0);this._currentPos+=4;return b};b.prototype._parseFloat_32=
function(){var b=this._dataView.getFloat32(this._currentPos,!0);this._currentPos+=4;return b};b.prototype._parseFloat_64=function(){var b=this._dataView.getFloat64(this._currentPos,!0);this._currentPos+=8;return b};b.prototype.parseFloat_32=function(){return this._parseFloat_32()};b.prototype.parseFloat_64=function(){return this._parseFloat_64()};b.prototype.parseAttributeType=function(){return this._parseInt_8()};b.prototype.parseNodeParseBits=function(){var b=new a;b.parseBits1(this);b.parseBits2(this);
return b};b.prototype.parseViewParseBits=function(){return this._parseUint_32()};b.prototype.parsePmiParseBits=function(){return this._parseUint_32()};b.prototype.parseLayerParseBits=function(){return this._parseUint_32()};b.prototype.parseBoolean=function(){return 0!==this._parseUint_8()};b.prototype.parsePoint3_32=function(){return new d.Point3(this._parseFloat_32(),this._parseFloat_32(),this._parseFloat_32())};b.prototype.parsePoint3_64=function(){return new d.Point3(this._parseFloat_64(),this._parseFloat_64(),
this._parseFloat_64())};b.prototype.parsePlane3_32=function(){return d.Plane.createFromCoefficients(this._parseFloat_32(),this._parseFloat_32(),this._parseFloat_32(),this._parseFloat_32())};b.prototype.parsePmiType=function(){return this._parseUint_32()};b.prototype.parsePmiSubType=function(){return this._parseUint_32()};b.prototype.parsePmiTopoRef=function(){return this._parseInt_8()};b.prototype.parseBodyType=function(){return this._parseUint_8()};b.prototype.parseFaceType=function(){return this._parseInt_8()};
b.prototype.parseEdgeType=function(){return this._parseInt_8()};b.prototype.parseUserDataIndex=function(){var b=this._parseUint_32(),c=this._parseUint_32();return 2097151>=c?4294967296*c+b:(""+c.toString(16)+h.zeroPadHex32(b)).toUpperCase()};b.prototype.getHeader=function(){return this._header};return b}();f.AssemblyDataParser=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b){this._inclusionsOf=new Map;this._masterModelKey=4294967295;this._prototypeInstanceCount=-1;this._attachScope=c;this._attachedInvisibly=b}a.prototype.getAttachScope=function(){return this._attachScope};a.prototype.getMasterModelKey=function(){console.assert(4294967295!==this._masterModelKey);return this._masterModelKey};a.prototype.getModelKeys=function(){var c=[];this._inclusionsOf.forEach(function(b,a){c.push(a)});return c};
a.prototype.hasInclusions=function(){return 0<this._inclusionsOf.size};a.prototype.getAllInclusions=function(){var c=[];this._inclusionsOf.forEach(function(b,a){for(var d=0;d<b.length;d++)c.push(b[d],a)});return c};a.prototype.getInclusionsOf=function(c){var b=this._inclusionsOf.get(c);if(void 0===b)return[];for(var a=[],d=0;d<b.length;d++)a.push(b[d],c);return a};a.prototype.hasModelIncluded=function(c){return this._inclusionsOf.has(c)};a.prototype.attachedInvisibly=function(){return this._attachedInvisibly};
a.prototype.prototypeInstanceCount=function(){console.assert(0<=this._prototypeInstanceCount);return this._prototypeInstanceCount};a.prototype.registerInclusion=function(c,b){var a=this._inclusionsOf.get(b);void 0===a?this._inclusionsOf.set(b,[c]):a.push(c)};a.prototype.registerMasterModelKey=function(c){console.assert(4294967295===this._masterModelKey);this._masterModelKey=c};a.prototype.registerPrototypeInstanceCount=function(c){console.assert(-1===this._prototypeInstanceCount);this._prototypeInstanceCount=
c};return a}();d.AttachInfoBuilder=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(f){var a=function(){function a(){this._prevPriorityValue=1;this._priorityProxies=new Map}a.prototype._getPriorityCompareValue=function(c){if("number"===typeof c)return c;c=this._priorityProxies.get(c);null!==c.worldBounding&&console.assert(1>=c.priorityHeuristic);return c.priorityHeuristic};a.prototype.comparePriority=function(c,b){c=this._getPriorityCompareValue(c);b=this._getPriorityCompareValue(b);return c<b};a.prototype._updateHeuristicInfo=function(c,b){if(null!==
b.worldBounding){var a=d.toVec3(b.worldBounding.center()),e=d.toVec3(b.worldBounding.extents());c=c.calculateAttachHeuristic(e,a);b.priorityHeuristic=c}null!==b.xmlAttachInfo&&b.xmlAttachInfo.directlyRequested&&(null===b.worldBounding&&(b.priorityHeuristic=0),b.priorityHeuristic+=-1E6)};a.prototype.createPriority=function(c,b,a){if(null===a)return++this._prevPriorityValue;var d=Object.create(null);if(null!==a.bounding){b=b.transformBox(a.bounding);var g=0}else b=null,g=++this._prevPriorityValue;a=
{xmlAttachInfo:a,worldBounding:b,priorityHeuristic:g};this._updateHeuristicInfo(c,a);this._priorityProxies.set(d,a);return d};a.prototype.destroyPriority=function(c){"object"===typeof c&&this._priorityProxies.delete(c)};a.prototype.onViewChange=function(c){var b=this;this._priorityProxies.forEach(function(a){b._updateHeuristicInfo(c,a)})};a.prototype.reset=function(){this._priorityProxies.clear()};return a}();f.AttachPriorityManager=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||
(Communicator={}));(function(d){(function(d){(function(d){(function(a){function d(c){return"modelName"in c}a.isNameInfo=d;a.isIncInfo=function(c){return!d(c)};a.canImplicitlyLoad=function(c){return c.config.implicitlyLoadXmlExternalModels||!d(c)}})(d.ExternalModel||(d.ExternalModel={}))})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){function a(b){return b instanceof e?b.referencedInfo:b}var e=function(){return function(b){this.referencedInfo=b}}();f.ReferencedNodeInfo=e;f.modelFileNodeInfoAsProdOccInfo=a;var c=function(){function b(){}b.parseXml=function(b,c,a,n,m){console.assert("ModelFile"===n.localName);var g=new Map,k=new Map,l=new Map;for(n=n.firstElementChild;null!==n;){if("ProductOccurence"!==n.localName)throw new d.XmlParseError('Unexpected element "'+n.localName+'".');if(null===
f.XmlParser.parseNodeId(n,"Id"))throw new d.XmlParseError('Expected "Id" attribute.');var h=n,t=f.ProductOccurrence.parseXml(b,c,a,h,m),v=t.nodeInfo.nodeId;if(l.has(t.nodeInfo.nodeId)){var w=new e(t);g.set(v,w)}else{if(!k.has(t.nodeInfo.nodeId)&&(k.set(t.nodeInfo.nodeId,null),null!==b.additionalMatrix)){w=b.additionalMatrix;var z=t.nodeInfo.localTransform;z=null===z?w:d.Matrix.multiply(z,w);t=__assign({},t,{nodeInfo:__assign({},t.nodeInfo,{localTransform:z})})}g.set(v,t)}v=0;for(w=f.XmlParser.parseNodeIds(h,
"Children")||[];v<w.length;v++)k.set(w[v],t);h=f.XmlParser.parseNodeId(h,"InstanceRef");null!==h&&(v=l.get(h),void 0===v?l.set(h,[t]):v.push(t));n=n.nextElementSibling}b=this._parentMapToChildMap(g,k,l);return{treeInfos:this._childMapRoseTrees(b)}};b._parentMapToChildMap=function(b,c,a){var g=new Map,f=function(b,c){var a=g.get(b);void 0===a?g.set(b,[c]):a.push(c)};c.forEach(function(c,a){a=b.get(a);if(a instanceof e)throw new d.XmlParseError('Expected a referenced node for "InstanceRef".');f(c,a)});
a.forEach(function(c,a){console.assert(0<c.length);a=b.get(a);if(!(a instanceof e))throw new d.XmlParseError('Node is both an "InstanceRef" and contained in another node\'s "Children" list.');for(var g=0;g<c.length;g++)f(c[g],a)});return g};b._childMapRoseTrees=function(b){var c=function(d){var g=[],e=a(d);e=b.get(e);if(void 0!==e){console.assert(0<e.length);for(var f=0;f<e.length;f++){var k=c(e[f]);g.push(k)}}return new h.RoseTree(d,g)},d=b.get(null);if(void 0===d)return console.assert(0===b.size),
[];for(var g=[],f=0;f<d.length;f++){var p=d[f];p instanceof e?console.assert(!1):(p=c(p),g.push(p))}return g};b.reify=function(b,c,a,f,m,h){return __awaiter(this,void 0,void 0,function(){var g,k,l,n,p,w,z,y;return __generator(this,function(r){switch(r.label){case 0:g=[];k=[];l=[];n=0;for(p=h.treeInfos;n<p.length;n++)w=p[n],w.value instanceof e?console.assert(!1):(z=this._reifyProductOccurrence(b,c,a,f,m,m,w,g),k.push(z),l.push(z.getRuntimeId()));y=c.promiseTrigger("_subtreeLoaded","subtreeLoaded",
l,d.NodeSource.LoadModel).then(function(){for(var b=0,a=l;b<a.length;b++)c.trigger("shatteredXmlStructureReady",a[b])});g.push(y);return[4,d.Util.waitForAll(g)];case 1:return r.sent(),[2,k]}})})};b._rectifyExternalModelInfo=function(b,c){c=c.referencedInfo.externalModelInfo;if(null===c)throw new d.XmlParseError('"InstanceRef" node does not contain "ExternalModel".');if(!f.ExternalModel.isNameInfo(c))throw new d.InternalLogicError;console.assert(0===c.reservedNodeIdOffset);b=b.newNodeIdOffset();return c=
__assign({},c,{reservedNodeIdOffset:b})};b._reifyProductOccurrence=function(b,c,l,n,m,h,r,q){var g=this,k=a(r.value);if(0!==k.childDataKeys.length)throw new d.InternalLogicError;if(null!==k.externalModelInfo)throw new d.LoadError('Unexpected "ExternalModel". Should be a child of an "InstanceRef".');var p=f.ProductOccurrence.reifySync(b,l,n,m,k,h);h.addProductOccurrence(p);p.markLoaded();h=0;for(r=r.kids;h<r.length;h++)k=r[h],k.value instanceof e?(console.assert(0===k.kids.length),k=this._rectifyExternalModelInfo(n,
k.value),f.ExternalModel.canImplicitlyLoad(k)?(k=l.attachByExternalModelInfo(k,p).then(function(b){return __awaiter(g,void 0,void 0,function(){var a;return __generator(this,function(g){switch(g.label){case 0:return null===b?[2]:[4,f.markContextsLoaded([b])];case 1:return g.sent(),p.addAttachContext(b),a=b.getChildren().map(function(b){return b.getRuntimeId()}),[4,c.promiseTrigger("_subtreeLoaded","subtreeLoaded",a,d.NodeSource.LoadModel)];case 2:return g.sent(),[2]}})})}),q.push(k)):p.addPendingExternalModel(k)):
(console.assert(null===k.value.externalModelInfo),this._reifyProductOccurrence(b,c,l,n,m,p,k,q));return p};b._parseBounding=function(b,c){var g=a(b.value),e=SC.UnspecifiedMeasurementUnit;null!==g.measurementUnit&&(e=g.measurementUnit);var k=1;e===SC.UnspecifiedMeasurementUnit?e=c:c!==SC.UnspecifiedMeasurementUnit&&(k=e/c);k=(new d.Matrix).setScaleComponent(k,k,k);var h=g.nodeInfo.localTransform;null!==h&&(k=d.Matrix.multiply(h,k));h=d.Box.invalid();var r=0;for(b=b.kids;r<b.length;r++){var q=this._parseBounding(b[r],
e);q=k.transformBox(q);h.addBox(q)}b=g.externalModelInfo;if(null!==b){if(!f.ExternalModel.isNameInfo(b))throw new d.InternalLogicError;g=b.bounding;null===g||g.isDegenerate()||(b=b.measurementUnit||SC.UnspecifiedMeasurementUnit,c!==SC.UnspecifiedMeasurementUnit&&b!==SC.UnspecifiedMeasurementUnit&&(c=b/e,c=(new d.Matrix).setScaleComponent(c,c,c),k=d.Matrix.multiply(c,k)),g=k.transformBox(g),h.addBox(g))}return h};b.parseBounding=function(b,c){var a=d.Box.invalid(),g=0;for(b=b.treeInfos;g<b.length;g++)for(var e=
0,f=b[g].kids;e<f.length;e++){var k=this._parseBounding(f[e],c);a.addBox(k)}return a};return b}();f.ModelFile=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(c,b,a,d){var g=this;this._cameraTimeoutId=null;this._isFirstAttachment=!0;this._attachScope=0;null===d&&(d=13);console.assert(0<d);this._engine=c;this._view=b;this._callbackManager=a;this._parentToXmlAttachInfos=new Map;this._viewInfo=new f.ViewInfo(this._view);this._attachPriorityManager=new f.AttachPriorityManager;this._comparePriority=function(b,c){return g._attachPriorityManager.comparePriority(b,c)};this._attachQueue=this._createAttachQueue(d);
this._prefetchScsQueue=this._createPrefetchScsQueue(d);this._registerCameraListener()}a.createWithEmptyModel=function(c,b,d,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){switch(g.label){case 0:return[4,c.loadEmpty()];case 1:return g.sent(),[2,new a(c,b,d,e)]}})})};a.prototype._createAttachQueue=function(c){return new h.PriorityPromiseQueue(c,this._comparePriority,!1)};a.prototype._createPrefetchScsQueue=function(c){return new h.PriorityPromiseQueue(c+15,this._comparePriority,
!1)};a.prototype._reprioritizeAttachments=function(){this._viewInfo=new f.ViewInfo(this._view);this._attachQueue.markDirty();this._prefetchScsQueue.markDirty();this._attachPriorityManager.onViewChange(this._viewInfo)};a.prototype._registerCameraListener=function(){var c=this,b=function(){c._onCameraChange()};this._callbackManager.bind({camera:b,_shutdownBegin:function(){null!==c._cameraTimeoutId&&(clearTimeout(c._cameraTimeoutId),c._cameraTimeoutId=null);c._callbackManager.unbind({camera:b})}})};
a.prototype._onCameraChange=function(){var c=this;null!==this._cameraTimeoutId&&clearTimeout(this._cameraTimeoutId);this._cameraTimeoutId=this._engine.setTimeout(function(){c._cameraTimeoutId=null;c._reprioritizeAttachments()},500)};a.prototype._awaitAttachInfo=function(c,b,a,e,l){var g=this,k=null===e,p=new f.AttachInfoBuilder(b,a),r=!1,q=[],u=h.OpenPromise.create(),t=h.OpenPromise.create(),v=!1,w=function(){console.assert(!v);v=!0;g._cleanupAttachLowLevel();g._callbackManager.unbind(y)},z=null,
y={_priorityMetaDataSent:function(c,a){c===b&&(p.registerPrototypeInstanceCount(a),u.resolve())},_announceModel:function(c,a){c===b&&(r=!0,p.registerMasterModelKey(a))},_inclusion:function(c,a,d){c===b&&(p.registerInclusion(a,d),q.push(d))},_remapModel:function(a,d,g){a===b&&c.remapModel(d,g)},_remapInclusion:function(a,d,g,e){a===b&&c.remapInclusion(d,g,e)},_missingModel:function(c,a){c===b&&(z=a)},_attached:function(c){if(c===b){if(!r){if(null!==z&&(k||l)){console.assert(0===q.length);t.reject(new d.MissingModelError(z));
return}if(1!==q.length){t.reject(new d.LoadError("Bad model: Could not find master model key."));return}p.registerMasterModelKey(q[0])}c=[u];var a=g._isFirstAttachment;if(a){g._isFirstAttachment=!1;var e=g._callbackManager.promiseTrigger("_firstAttachment",null,k?h.AttachType.Direct:h.AttachType.Indirect);c.push(e)}return d.Util.waitForAll(c).catch(function(b){console.assert(!1);throw b;}).then(function(){return __awaiter(g,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return a&&
1===this._engine.getSessionType()?[4,this._callbackManager.promiseTrigger("_firstBoundingReady",null)]:[3,2];case 1:b.sent(),b.label=2;case 2:return w(),t.resolve(p),[2]}})})})}}};this._callbackManager.bind(y);return t.catch(function(b){w();throw b;})};a.prototype._createPriority=function(c,b){return this._attachPriorityManager.createPriority(this._viewInfo,c,b)};a.prototype._cleanupAttachLowLevel=function(){};a.prototype._cleanupAttachHighLevel=function(c,b,a){return __awaiter(this,void 0,void 0,
function(){return __generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,,2,3]),[4,c];case 1:return[2,d.sent()];case 2:return null!==a&&this._forgetXmlAttachment(a),this._attachPriorityManager.destroyPriority(b),[7];case 3:return[2]}})})};a.prototype.newAttachScope=function(){return++this._attachScope};a.prototype._attachByStream=function(c,b,a,e,f,n,m,h){var g=this,k=d.Matrix.toMatrix12(e.m);e=this._createPriority(e,m);var l=this._attachQueue.push(function(){return __awaiter(g,
void 0,void 0,function(){var d,g,e,l=this;return __generator(this,function(p){switch(p.label){case 0:d=this.newAttachScope(),g=this._awaitAttachInfo(b,d,n.get(),m,h),p.label=1;case 1:return p.trys.push([1,4,,5]),[4,c.enqueue(function(){return l._engine.attachModel(d,a,k,f,n.get())})];case 2:return p.sent(),[4,g];case 3:return[2,p.sent()];case 4:throw e=p.sent(),this._cleanupAttachLowLevel(),e;case 5:return[2]}})})},e);return this._cleanupAttachHighLevel(l,e,m)};a._getAllModelKeys=function(c){var b=
c.getMasterModelKey();c=c.getAllInclusions();if(c[1]!==b)for(var a=2;a<c.length;a+=2)if(c[a+1]===b){var d=c[a];c[a]=c[0];c[a+1]=c[1];c[0]=d;c[1]=b;break}b=[];a=0;for(d=1;d<c.length;++a,d+=2)b[a]=c[d];return b};a.prototype.attachByNamedScsBuffer=function(c,b,g,e,l,n,m,h){return __awaiter(this,void 0,void 0,function(){var k,p,u,t,v,w=this;return __generator(this,function(r){c.getAutomaticMeasurementUnitScaling()||(n=SC.UnspecifiedMeasurementUnit);k=f.towardLoadContext(h.parent);p=d.Matrix.toMatrix12(l.m);
u=this._createPriority(l,h);t=function(e){return __awaiter(w,void 0,void 0,function(){var l,r,q,u,t,v,w,y,z,J,K,H,L=this;return __generator(this,function(x){switch(x.label){case 0:return[4,function(){return __awaiter(L,void 0,void 0,function(){var c;return __generator(this,function(a){c=k.getScsModelKeysOf(b);return null===c?(k.initializeScsModelKeysOf(b),[2,e]):[2,c]})})}()];case 1:l=x.sent();r=k.getScsModelKeysOf(b);if(null===r)throw new d.InternalLogicError;q=this.newAttachScope();if(!(l instanceof
Uint8Array))return[3,7];t=!0;v=this._awaitAttachInfo(g,q,m.get(),h,!1);x.label=2;case 2:return x.trys.push([2,5,,6]),[4,c.enqueue(function(){return L._engine.attachScsBuffer(q,l,p,n,m.get(),t)})];case 3:return x.sent(),[4,v];case 4:return u=x.sent(),[3,6];case 5:throw w=x.sent(),this._cleanupAttachLowLevel(),w;case 6:return 0===r.state&&(y=a._getAllModelKeys(u),r.resolve(y)),[3,8];case 7:if(null===l)u=null,0===r.state&&r.resolve(null);else{console.assert(0!==r.state);z=new f.AttachInfoBuilder(q,m.get());
z.registerPrototypeInstanceCount(0);for(J=0;J<l.length;++J)K=l[J],H=this._engine.attachScsModelByKey(q,K,p,n,m.get()),z.registerInclusion(H,K),0===J&&z.registerMasterModelKey(K);u=z}x.label=8;case 8:return[2,u]}})})};v=function(){return __awaiter(w,void 0,void 0,function(){var c,a=this;return __generator(this,function(d){switch(d.label){case 0:return[4,this._prefetchScsQueue.push(function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(c){return[2,k.toScsBuffer(b,e)]})})},
u)];case 1:return c=d.sent(),h.directlyRequested=!0,[2,this._attachQueue.push(function(){return t(c)},u)]}})})}();return[2,this._cleanupAttachHighLevel(v,u,h)]})})};a.prototype._attachByScsBuffer=function(c,b,a,e,f,n){var g=this,k=d.Matrix.toMatrix12(e.m);e=this._createPriority(e,null);var l=this._attachQueue.push(function(){return __awaiter(g,void 0,void 0,function(){var d,g,e,l=this;return __generator(this,function(m){switch(m.label){case 0:d=this.newAttachScope(),g=this._awaitAttachInfo(b,d,n.get(),
null,!1),m.label=1;case 1:return m.trys.push([1,4,,5]),[4,c.enqueue(function(){return l._engine.attachScsBuffer(d,a,k,f,n.get(),!1)})];case 2:return m.sent(),[4,g];case 3:return[2,m.sent()];case 4:throw e=m.sent(),this._cleanupAttachLowLevel(),e;case 5:return[2]}})})},e);return this._cleanupAttachHighLevel(l,e,null)};a.prototype.simpleAttach=function(c,b,a,e,f,n,m,h){c.getAutomaticMeasurementUnitScaling()||(f=SC.UnspecifiedMeasurementUnit);if("string"===typeof a)return this._attachByStream(c,b,a,
e,f,n,m,h);if(null===m)return this._attachByScsBuffer(c,b,a,e,f,n);d.Util.TypeAssert(a);d.Util.TypeAssert(m);throw new d.InternalLogicError;};a.prototype.reset=function(){this._isFirstAttachment=!0;this._attachScope=0;this._parentToXmlAttachInfos.clear();this._attachPriorityManager.reset();this._attachQueue.killDeferred();return this._attachQueue.waitForIdle()};a.prototype.isIdle=function(){return this._attachQueue.isIdle()};a.prototype.notifyDirectRequest=function(c){c=this._parentToXmlAttachInfos.get(c);
if(void 0!==c){for(var b=!1,a=0;a<c.length;a++){var d=c[a];d.directlyRequested||(b=d.directlyRequested=!0)}b&&this._reprioritizeAttachments()}};a.prototype.registerXmlAttachInfo=function(c){var b=c.parent,a=this._parentToXmlAttachInfos.get(b);void 0===a&&(a=[],this._parentToXmlAttachInfos.set(b,a));a.push(c)};a.prototype._forgetXmlAttachment=function(c){var b=c.parent,a=this._parentToXmlAttachInfos.get(b);1===a.length?(console.assert(a[0]===c),this._parentToXmlAttachInfos.delete(b)):(console.assert(1<
a.length),c=a.indexOf(c),console.assert(0<=c),a.splice(c,1))};a.prototype.maxConcurrentAttachments=function(){return this._attachQueue.maxActivePromises()};return a}();f.ScAttacher=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(){this._remappedModelKeys=new Map;this._remappedInclusionKeys=new Map}a.prototype.remapModel=function(c,b){this._remappedModelKeys.set(b,c);this._remappedInclusionKeys.has(c)||this._remappedInclusionKeys.set(c,new Map)};a.prototype.remapInclusion=function(c,b,a){c=this._remappedInclusionKeys.get(c);console.assert(void 0!==c);c.set(a,b)};a.prototype.getEffectiveModelKey=function(c){var b=this._remappedModelKeys.get(c);return void 0!==
b?b:c};a.prototype.getEffectiveInclusionKey=function(c,b){b=this._remappedInclusionKeys.get(b);return void 0!==b&&(b=b.get(c),void 0!==b)?b:c};return a}();d.ScKeyRemapper=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){function a(b){return(new DOMParser).parseFromString(b,"application/xml")}function e(b){return __awaiter(this,void 0,void 0,function(){var c,d;return __generator(this,function(g){switch(g.label){case 0:return[4,h.httpRequest(b)];case 1:return c=g.sent(),d=c.responseXML,null===d&&(d=a(c.responseText)),[2,d]}})})}function c(b){if(!b.hasChildNodes)return null;b=b.firstChild;if(!(b instanceof Comment))return null;b=b.data.split(" ");if(2!==b.length||"HC"!==b[0])return null;
b=b[1].split(".");if(2!==b.length)return null;for(var c=0;c<b.length;c++)if(!h.isBase10Number(b[c]))return null;return[parseInt(b[0],10),parseInt(b[1],10)]}function b(b){b=b.getElementsByTagName("parsererror");if(0<b.length)throw new d.XmlParseError(b[0].textContent||"unknown error");}function g(b,c,a,d){return{getAttachScope:function(){return b},getMasterModelKey:function(){return d},getModelKeys:function(){return[d]},hasInclusions:function(){return!0},getAllInclusions:function(){return[a,d]},getInclusionsOf:function(b){return b===
d?[a,d]:[]},hasModelIncluded:function(b){return b===d},attachedInvisibly:function(){return c},prototypeInstanceCount:function(){return 0}}}var k=function(){function k(b,c,a,d,g){this._loadQueue=new h.PromiseQueue(1,!1);this._activeLoadGeneration=this._activeLoadCount=0;this._isFirstLoad=!0;this._firstAssemblyDataHeader=null;console.assert(b.isInitialized());this._assemblyTree=b;this._scAttacher=c;this._engine=a;this._view=d;this._callbackManager=g;this._isScsSession=2===this._engine.getSessionType();
this._nodesUntilNextSleep=2E3}k.prototype._resolveMeasurementUnits=function(b){if(this._assemblyTree.getAutomaticMeasurementUnitScaling()){var c=f.towardProductOccurrence(b.getParent());if(null===c)throw new d.InternalLogicError;var a=c.getMeasurementUnit(),g=b.getMeasurementUnit();a!==g&&(c=b.getLocalTransform(),null===c&&(c=new d.Matrix),a=g/a,c.m[0]*=a,c.m[5]*=a,c.m[10]*=a,b.setLocalTransformAsInitial(c))}};k.prototype._patchImplicitNodesByModelInc=function(b,c,a,d,g){var e=this,k=0;if(0!==d.length)for(var l,
n=h.Lazy.create(function(){var d=b.get(),k=f.towardAttachContext(d),n=k.getAttachScope();l=k.attachedInvisibly();k=k.split(n,l,d);d.addAttachContext(k);d=new f.InclusionContext(e._assemblyTree,k,c,a);k.addInclusionContext(d);k=f.ProductOccurrence.createDynamic(e._assemblyTree,d,"Of Inclusion ("+c+")",null,null,!l,g);d.addProductOccurrence(k);return k}),m=0;m<d.length;m++){var p=d[m],q=this._assemblyTree.lookupAnyBodyByInstanceInc(c,p);if(null===q){q=n.get();var r="Implicit Body "+ ++k;q=this._assemblyTree.createMeshInstance(!0,
c,p,null,r,q,!1,!1);l&&q.setVisibility(!1)}}};k.prototype._getPrototypeInstanceCountByAttachment=function(b){var c=new Set,a=0;b=b.getAllInclusions();for(var d=0;d<b.length;d+=2){var g=b[d],e=b[d+1];c.has(e)||(c.add(e),a+=this._assemblyTree.getInstanceCountByInclusion(g))}return a};k.prototype._patchImplicitNodesByAttachment=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var g,e,k,l,n,m,p,y,x,A,B=this;return __generator(this,function(q){switch(q.label){case 0:return console.assert(b.isLoaded()),
g=null,e=h.Lazy.create(function(){var d=new f.ScKeyRemapper,e=c.getMasterModelKey();g=new f.AttachContext(d,c.getAttachScope(),c.attachedInvisibly(),e,b);d=new f.InclusionContext(B._assemblyTree,g,0,0);g.addInclusionContext(d);e=f.ProductOccurrence.createDynamic(B._assemblyTree,d,"Implicit Bodies",null,null,!c.attachedInvisibly(),a);d.addProductOccurrence(e);return e}),k=c.prototypeInstanceCount(),0!==k?[3,2]:[4,this._engine.instanceKeyInfo(c.getAttachScope(),0,1)];case 1:k=q.sent()[0],q.label=2;
case 2:return l=this._getPrototypeInstanceCountByAttachment(c),l===k?[2]:[4,this._engine.instanceKeyInfo(c.getAttachScope(),0,0)];case 3:n=q.sent();m=c.getAllInclusions();for(p=0;p<m.length;p+=2)y=m[p],x=m[p+1],A=n.get(x),void 0!==A&&this._patchImplicitNodesByModelInc(e,y,x,A,a);l=this._getPrototypeInstanceCountByAttachment(c);if(l<k)throw new d.InternalLogicError;return null===g?[2]:[4,f.markContextsLoaded([g])];case 4:return q.sent(),b.addAttachContext(g),[2]}})})};k.prototype._updateOnDemandRequests=
function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,g,e;return __generator(this,function(f){if(!this._assemblyTree.onDemandRequestsActive())return[2];c=b.getChildren();a=[];d=0;for(g=c;d<g.length;d++)e=g[d],this._assemblyTree.isBeingRequested(e)&&a.push(e);return[2,this._assemblyTree.requestNodes(this,a,!0)]})})};k.prototype._populateAttachment=function(b,c,a,d,g,e){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(k){switch(k.label){case 0:return console.assert(g===
h.AttachType.Indirect===(null!==e)),[4,this._parseRootNodes(b,c,a,d,e)];case 1:return f=k.sent(),[4,this._postProcessAttachContext(c,d,g,f)];case 2:return k.sent(),[2,f]}})})};k.prototype._postProcessAttachContext=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var g,e,k,l=this;return __generator(this,function(n){switch(n.label){case 0:return[4,f.WalkerAsync.forceLazyPromises(d)];case 1:return n.sent(),[4,this._assemblyTree.enqueue(function(){return f.synchronizePmiVisibilities(l._engine,
d)})];case 2:return n.sent(),(g=this._assemblyTree.markImplicitNodesOutOfHierarchy())&&(g=0<d.getChildren().length||a===h.AttachType.Indirect),[4,this._patchImplicitNodesByAttachment(b,c,g)];case 3:return n.sent(),[4,this._updateOnDemandRequests(d)];case 4:return n.sent(),e=d.getChildren(),k=e.map(function(b){return b.getRuntimeId()}),this._callbackManager.trigger("_attachmentPopulated",k),[2]}})})};k.prototype._parseRootNodes=function(b,c,a,d,g){return __awaiter(this,void 0,void 0,function(){var e,
k,l,n,m,p,q,r=this;return __generator(this,function(u){switch(u.label){case 0:return e=d.getMasterModelKey(),k=d.getInclusionsOf(e),4294967295===e&&(console.assert(0===k.length),k.push(4294967295,4294967295)),l=new f.AttachContext(a,d.getAttachScope(),d.attachedInvisibly(),e,c),null!==g&&l.setReservedNodeIdOffset(g),n=new h.PromiseQueue(1,!0),[4,this._assemblyTree.enqueue(function(){return l.getRootNodeMetaData(r._assemblyTree)})];case 1:m=u.sent();p=function(c){n.push(function(){return r._parseRootNode(b,
l,m,k[c],k[c+1])})};for(q=0;q<k.length;q+=2)p(q);return[4,n.waitForIdle()];case 2:return u.sent(),[2,l]}})})};k.prototype._parseRootNode=function(b,c,a,d,g){return __awaiter(this,void 0,void 0,function(){var e,k;return __generator(this,function(l){switch(l.label){case 0:return console.assert(0!==d),[4,this._populateInclusion(b,c,a,d,g)];case 1:return e=l.sent(),e.hasAuthoredId()?(console.assert(!e.isLoaded()),k=f.towardInclusionContext(e),l=k.getParent(),l=l instanceof f.AttachContext&&l.getParent()instanceof
f.LoadContext?!0:!1,l&&this._setupRootNode(e,!1)):null===e.getName()&&(c.removeProductOccurrence(e)||console.assert(!1)),[2]}})})};k.prototype._setupRootNode=function(b,c){console.assert(!b.isAbsoluteRoot());c&&b.markIsExternalModelRoot(this._assemblyTree);this._resolveMeasurementUnits(b)};k.prototype._populateInclusion=function(b,c,a,d,g){return __awaiter(this,void 0,void 0,function(){var e,k,l=this;return __generator(this,function(n){switch(n.label){case 0:return console.assert(0!==d),e=new f.InclusionContext(this._assemblyTree,
c,d,g),c.addInclusionContext(e),[4,function(){return __awaiter(l,void 0,void 0,function(){var d,g,k;return __generator(this,function(l){if(null===a||0===a.bytes.length)return d=null,null===a&&(d="Missing"),[2,f.ProductOccurrence.createDynamic(this._assemblyTree,e,d,null,null,!c.attachedInvisibly())];g=new f.AssemblyDataParser(a);k=f.ProductOccurrence.parseBinary(b,this._assemblyTree,e,g);return[2,f.ProductOccurrence.reify(b,this,this._assemblyTree,e,k,e)]})})}()];case 1:return k=n.sent(),e.addProductOccurrence(k),
[2,k]}})})};k.prototype._rectifyLateVisibilityChange=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d,g,e;return __generator(this,function(k){a=f.towardAttachContext(c.getParent());d=f.towardProductOccurrence(c.getParent());console.assert(d===f.towardProductOccurrence(a));if(b.attachInvisibly||null===d||!d.isLoaded())return[2];g=d.isVisible();if(a.attachedInvisibly()===!g)return[2];e=g?2:0;return[2,f.updateVisibilitiesByAttachment(this._assemblyTree,this._engine,a,e)]})})};k.prototype._loadCleanup=
function(b,c){console.assert(0<this._activeLoadCount);b.onLoadComplete();null!==c&&this._callbackManager.unbind(c);--this._activeLoadCount;this._assemblyTree.onLoadEnd();this._callbackManager.trigger("visibilityChanged",[],[])};k.prototype._wrap=function(b,c,a,g){var e=this,f=this._activeLoadGeneration;return this._loadQueue.push(function(){return __awaiter(e,void 0,void 0,function(){var e,k,l,n,m,p,q,r,u,C,E,F,G,I=this;return __generator(this,function(t){switch(t.label){case 0:this._assemblyTree.onLoadBegin();
e=null;if(f!==this._activeLoadGeneration)throw this._loadCleanup(c,e),new d.LoadCancelledError;null===this._firstAssemblyDataHeader&&(e={_modelStructureHeaderParsed:function(b){return __awaiter(I,void 0,void 0,function(){return __generator(this,function(c){null!==e&&(null===this._firstAssemblyDataHeader&&(this._firstAssemblyDataHeader=b),this._callbackManager.unbind(e),e=null);return[2]})})}},this._callbackManager.bind(e,!0));t.label=1;case 1:return t.trys.push([1,3,,5]),[4,a];case 2:return t.sent(),
[3,5];case 3:return k=t.sent(),[4,c.purgeContents()];case 4:throw t.sent(),this._loadCleanup(c,e),k;case 5:l=c.getParent();if(null===l)throw this._loadCleanup(c,e),new d.InternalLogicError;n=g===h.AttachType.Direct;if(!n)return[3,8];if(!c.hasChildren())return[3,6];l.addLoadContext(c);return[3,8];case 6:return[4,c.purgeContents()];case 7:t.sent(),t.label=8;case 8:this._loadCleanup(c,e);m=c.getChildren();p=[];q=0;for(r=m;q<r.length;q++)u=r[q],C=this._rectifyLateVisibilityChange(b,u),p.push(C);return[4,
d.Util.waitForAll(p)];case 9:t.sent();if(!this._isFirstLoad)return[3,13];this._isFirstLoad=!1;c.markAsFirstLoad();E=m.map(function(b){return b.getRuntimeId()});F=!1;t.label=10;case 10:return t.trys.push([10,12,,13]),[4,this._callbackManager.promiseTrigger("_firstModelLoaded","firstModelLoaded",E,g,F)];case 11:return t.sent(),[3,13];case 12:throw G=t.sent(),console.assert(!1),G;case 13:return[2,c]}})})})};k.prototype._initLoad=function(b,c,a){++this._activeLoadCount;a=this._isScsSession&&a?new h.PromiseCache:
null;return new f.LoadContext(b,c,a)};k._getNetMatrix=function(b,c){b=f.getNetMatrix(b);null!==c&&(b=d.Matrix.multiply(c,b));return b};k.prototype._lazyAttachInvisibly=function(b,c){return h.Lazy.create(function(){return c.attachInvisibly||!b.isVisible()})};k.prototype._loadBySingleAttach=function(b,c,a,d){var g=this,e=this._initLoad(c,d,!1);d=h.LazyPromise.create(function(){return __awaiter(g,void 0,void 0,function(){var d,g,l,n,m,p,q;return __generator(this,function(r){switch(r.label){case 0:return[4,
a];case 1:return d=r.sent(),g=new f.ScKeyRemapper,l=k._getNetMatrix(c,b.additionalMatrix),n=c.getMeasurementUnit(),m=this._lazyAttachInvisibly(c,b),[4,this._scAttacher.simpleAttach(this._assemblyTree,g,d,l,n,m,null,!1)];case 2:return p=r.sent(),[4,this._populateAttachment(b,e,g,p,h.AttachType.Direct,null)];case 3:return q=r.sent(),[4,f.markContextsLoaded([e,q])];case 4:return r.sent(),q.hasChildren()&&e.addAttachContext(q),[2,{}]}})})});return this._wrap(b,e,d,h.AttachType.Direct)};k.prototype._populateFromXml=
function(b,c,a,g){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,m,h,p,r,A,B,D;return __generator(this,function(q){switch(q.label){case 0:e=a.documentElement;k=e.firstElementChild;for(l=null;null!==k;)"ModelFile"===k.localName&&(console.assert(null===l),l=f.ModelFile.parseXml(b,this._assemblyTree,c,k,g)),k=k.nextElementSibling;if(null===l)throw new d.XmlParseError('Expected "ModelFile" element.');n=!1;if(!this._isFirstLoad)return[3,2];m=SC.UnspecifiedMeasurementUnit;this._assemblyTree.getAutomaticMeasurementUnitScaling()&&
(h=f.towardProductOccurrence(c),m=h.getMeasurementUnit());p=f.ModelFile.parseBounding(l,m);if(p.isDegenerate())return[3,2];n=!0;return[4,this._view.setViewOrientation(d.ViewOrientation.Iso,0,p)];case 1:q.sent(),q.label=2;case 2:return[4,f.ModelFile.reify(b,this._callbackManager,this,this._assemblyTree,c,l)];case 3:r=q.sent();A=0;for(B=r;A<B.length;A++)D=B[A],this._setupRootNode(D,!1);return!this._isFirstLoad||n?[3,5]:[4,this._view.setViewOrientation(d.ViewOrientation.Iso,0)];case 4:q.sent(),q.label=
5;case 5:return[2]}})})};k.prototype._loadByXml=function(a,g,e,k,l){var n=this,m=this._initLoad(g,l,!0);l=h.LazyPromise.create(function(){return __awaiter(n,void 0,void 0,function(){var l,n,p,q,r,u,t,D,C;return __generator(this,function(v){switch(v.label){case 0:return[4,e];case 1:l=v.sent();b(l);n=c(l);if(null===n||!h.versionAtLeast([8,0],n))throw new d.XmlParseError("Bad version.");p=function(b){return k(b,n)};g.addLoadContext(m);q=f.towardInclusionContext(g);r=f.towardAttachContext(q);u=this._scAttacher.newAttachScope();
t=this._lazyAttachInvisibly(g,a);D=r.split(u,t.get(),m);m.addAttachContext(D);C=q.split(this._assemblyTree,D);D.addInclusionContext(C);return[4,this._populateFromXml(a,C,l,p)];case 2:return v.sent(),[4,f.markContextsLoaded([m,D])];case 3:return v.sent(),[2,{}]}})})});return this._wrap(a,m,l,h.AttachType.Indirect)};k.prototype._attachExternalModelByInc=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,d,g,e,k,l;return __generator(this,function(n){switch(n.label){case 0:return console.assert(0!==
b.inclusionKey),a=f.towardAttachContext(c).getAttachScope(),d=b.modelKey,g=this._lazyAttachInvisibly(c,b.config),e=new f.ScKeyRemapper,k=new f.AttachContext(e,a,g.get(),d,c),[4,k.getRootNodeMetaData(this._assemblyTree)];case 1:return l=n.sent(),[4,this._populateInclusion(b.config,k,l,b.inclusionKey,b.modelKey)];case 2:return n.sent(),[2,k]}})})};k.prototype._attachExternalModelInfoByName=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,g,e,k,l,n,m,z,y,x;return __generator(this,function(p){switch(p.label){case 0:a=
new f.ScKeyRemapper;g=f.getNetMatrix(c);e=c.getMeasurementUnit();k=this._lazyAttachInvisibly(c,b.config);l={bounding:b.bounding,parent:c,directlyRequested:!1};if(!this._isScsSession)return[3,2];this._scAttacher.registerXmlAttachInfo(l);return[4,this._scAttacher.attachByNamedScsBuffer(this._assemblyTree,b.modelName,a,b.toAttachData,g,e,k,l)];case 1:return n=p.sent()||0,[3,8];case 2:return p.trys.push([2,7,,8]),[4,b.toAttachData(b.modelName)];case 3:m=p.sent();if(null!==m&&m!==d.EmptyModelName)return[3,
4];n=0;return[3,6];case 4:if("string"!==typeof m)throw d.Util.TypeAssert(m),new d.InternalLogicError;d.Util.TypeAssert(m);this._scAttacher.registerXmlAttachInfo(l);return[4,this._scAttacher.simpleAttach(this._assemblyTree,a,m,g,e,k,l,b.config.allowMissingExternalModels)];case 5:n=p.sent(),p.label=6;case 6:return[3,8];case 7:z=p.sent();if(b.config.allowMissingExternalModels&&z instanceof d.MissingModelError)n=1;else throw z;return[3,8];case 8:if("number"===typeof n){d.Util.TypeAssert(n);y=this._scAttacher.newAttachScope();
x=!k.get();a:{var q=this._assemblyTree,r=n,u=x;p=new f.AttachContext(a,y,u,0,c);switch(r){case 0:break a;case 1:r=new f.InclusionContext(q,p,0,0);p.addInclusionContext(r);q=f.ProductOccurrence.createDynamic(q,r,"Missing",null,null,!u);r.addProductOccurrence(q);break a;default:p=d.Util.TypeAssertNever(r)}}return[2,p]}return[2,this._populateAttachment(b.config,c,a,n,h.AttachType.Indirect,b.reservedNodeIdOffset)]}})})};k.prototype.isIdle=function(){return 0===this._activeLoadCount?(console.assert(this._scAttacher.isIdle()),
!0):!1};k.prototype.waitOnCurrentLoads=function(){return this._loadQueue.waitOnLatest()};k.prototype.cancelPendingLoads=function(){++this._activeLoadGeneration;return this.waitOnCurrentLoads()};k.prototype.loadByStream=function(b,c,a){return a===d.EmptyModelName?(b=new f.LoadContext(c,d.EmptyModelName,null),Promise.resolve(b)):this._loadBySingleAttach(b,c,Promise.resolve(a),a)};k.prototype.loadByScsBuffer=function(b,c,a){return this._loadBySingleAttach(b,c,Promise.resolve(a),"*SCS Buffer*")};k.prototype.loadByScsFile=
function(b,c,a){var d=h.httpRequestBuffer(a);return this._loadBySingleAttach(b,c,d,a)};k.prototype.loadByXmlDoc=function(b,c,d,g){d="string"===typeof d?a(d):d;return this._loadByXml(b,c,Promise.resolve(d),g,"*XML Document*")};k.prototype.loadByXmlFile=function(b,c,a,d){var g=e(a);return this._loadByXml(b,c,g,d,a)};k.prototype.attachByExternalModelInfo=function(b,c){return __awaiter(this,void 0,void 0,function(){var a,g,e,k,l,n,m;return __generator(this,function(h){switch(h.label){case 0:return f.ExternalModel.isNameInfo(b)?
[4,this._attachExternalModelInfoByName(b,c)]:[3,2];case 1:return a=h.sent(),[3,4];case 2:return[4,this._attachExternalModelByInc(b,c)];case 3:a=h.sent(),h.label=4;case 4:g=[];e=a.getChildren();k=0;for(l=e;k<l.length;k++)n=l[k],this._setupRootNode(n,!0),m=this._rectifyLateVisibilityChange(b.config,n),g.push(m);return[4,d.Util.waitForAll(g)];case 5:return h.sent(),[2,a]}})})};k.prototype.loadByAssemblyData=function(b,c,a,d){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,m,p,r,x,A=this;return __generator(this,
function(q){e=h.AttachType.Direct;k=a[0];l=a[1];n=this._scAttacher.newAttachScope();m=!c.isVisible();p=g(n,m,k,l);r=this._initLoad(c,"*Assembly Data*",!1);x=h.LazyPromise.create(function(){return __awaiter(A,void 0,void 0,function(){var c,a,g;return __generator(this,function(m){switch(m.label){case 0:return c=new f.ScKeyRemapper,a=p.getMasterModelKey(),g=new f.AttachContext(c,n,p.attachedInvisibly(),a,r),[4,this._parseRootNode(b,g,d,k,l)];case 1:return m.sent(),[4,this._postProcessAttachContext(r,
p,e,g)];case 2:return m.sent(),[4,f.markContextsLoaded([r,g])];case 3:return m.sent(),g.hasChildren()&&r.addAttachContext(g),[2,{}]}})})});return[2,this._wrap(b,r,x,e)]})})};k.prototype.reset=function(){this._isFirstLoad=!0;this._firstAssemblyDataHeader=null;return this._scAttacher.reset()};k.prototype.notifyFirstLoadIsEmptyModel=function(){console.assert(this._isFirstLoad);this._isFirstLoad=!1};k.prototype.notifyDirectRequest=function(b){this._scAttacher.notifyDirectRequest(b)};k.prototype.onLoadChildProductOccurrence=
function(){if(0===this._nodesUntilNextSleep)return this._nodesUntilNextSleep=2E3,this._engine.sleep(10);--this._nodesUntilNextSleep};k.prototype.firstAssemblyDataHeader=function(){return this._firstAssemblyDataHeader};return k}();f.TreeLoader=k})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(c){var b=c.getCamera(),a=b.getPosition(),e=b.getTarget();e=d.Point3.subtract(e,a);var f=e.length();1E-7>f&&(f=1E-7);this._eyeDistanceInverse=1/f;e.scale(this._eyeDistanceInverse);c=c.getFullCameraMatrix();this._frustum=h.ConvexVolume.createFrustumFromMatrix(c);this._viewProjectionW=h.col4(c,3);this._cameraIsOrtho=b.getProjection()===d.Projection.Orthographic;this._position=h.toVec3(a);this._eye=h.toVec3(e)}a.prototype.calculateAttachHeuristic=
function(c,b){var a=0;if(this._frustum.axisAlignedBoxNotOutside(b,c))return c=h.squaredNorm3(c),c=h.projectSquaredSize(b,c,this._viewProjectionW),0<c&&(a=h.sub3(b,this._position),b=1/(h.dot3(this._eye,a)*this._eyeDistanceInverse+1E-5),a=h.scale3(1/h.norm3(a),a),a=h.dot3(this._eye,a),b=Math.pow(b,6),this._cameraIsOrtho||(b*=5*Math.pow(a,10)),1E-5>b&&(b=1E-5),a=c*b),console.assert(0<=a),-a-1;a=1/(1+Math.exp(h.norm3(c)));console.assert(0<=a&&1>a);return a};return a}();f.ViewInfo=a})(h.Tree||(h.Tree=
{}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(){}a._parseUint_32=function(c){if(!h.isBase10Number(c))return null;c=parseInt(c,10);return 4294967295>=c?c:null};a._parseFloat=function(c){c=parseFloat(c);return isNaN(c)?null:c};a.parseFloat=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseFloat(c)};a._parseScKey=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseUint_32(c)};a.parseDataKey=function(c,b){return this._parseScKey(c,b)};a.parseMeshKey=
function(c,b){return this._parseScKey(c,b)};a.parseInstanceKeyFromInc=function(c,b){c=c.getAttribute(b);if(null===c)return null;c=c.split(" ");return 2!==c.length||null===this._parseUint_32(c[0])?null:this._parseUint_32(c[1])};a.parseNodeId=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseUint_32(c)};a.parseLayerId=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseUint_32(c)};a.parseUint=function(c,b){c=c.getAttribute(b);return null===c?null:this._parseUint_32(c)};
a.parseUints=function(c,b){var a=c.getAttribute(b);if(null===a)return null;c=[];b=0;for(a=a.match(/[0-9]+/g)||[];b<a.length;b++){var d=this._parseUint_32(a[b]);if(null===d)return null;c.push(d)}return c};a.parseFloats=function(c,b){var a=c.getAttribute(b);if(null===a)return null;c=[];b=0;for(a=a.match(/\S+/g)||[];b<a.length;b++){var d=this._parseFloat(a[b]);if(null===d)return null;c.push(d)}return c};a.parseNodeIds=function(c,b){return this.parseUints(c,b)};a._parsePoint3=function(c,b){c=c.getAttribute(b);
if(null===c)return null;c=c.split(" ");if(3!==c.length)return null;b=[];for(var a=0;a<c.length;a++){var e=Number(c[a]);if(isNaN(e))return null;b.push(e)}return new d.Point3(b[0],b[1],b[2])};a.parseBounding=function(c,b){c=c.getElementsByTagName(b);if(1!==c.length)return null;b=c[0];c=this._parsePoint3(b,"Min");if(null===c)return null;b=this._parsePoint3(b,"Max");return null===b?null:new d.Box(c,b)};return a}();f.XmlParser=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){(function(f){function a(c,b){var a="number"===typeof c;return a===("number"===typeof b)?c<b?-1:c>b?1:0:a?-1:1}var e=function(){function c(){console.assert(!1)}c.parseXml=function(b,c){var a=f.XmlParser.parseNodeId(c,"Id");null===a&&(console.assert(!1),a=b.generateDynamicNodeId());b=c.getAttribute("Name");for(var d=null,g=[],e=c.firstElementChild;null!==e;){if("Transformation"===e.localName)console.assert(null===d),d=f.Transform.parseXml(e),d.isIdentity()&&(d=null);else if("Attributes"===e.localName)for(var h=
e.firstElementChild;null!==h;){console.assert("Attr"===h.localName);var r=f.Attribute.parseXml(h);g.push(r);h=h.nextElementSibling}e=e.nextElementSibling}e=c.getAttribute("ExchangeId");c=f.XmlParser.parseLayerId(c,"LayerId");return{nodeId:a,bits:1073741824,name:b,localTransform:d,attributes:g,header:f.AssemblyDataHeader.dynamic,exchangeId:e,layerId:c,genericTypeId:null,genericId:null,userDatas:null}};c.parseBinary=function(b,c,a){a.hasBits1(1)?b=c.parseNodeId():(console.assert(!1),b=b.generateDynamicNodeId());
var d=a.hasBits1(2)?c.parseCString():null,g=1073741824;if(a.hasBits1(4)){var e=c.parseVisibility();e.shown||(g&=-1073741825);e.removed&&(g|=536870912)}e=null;a.hasBits1(8)&&(e=f.Transform.parseBinary(c),e.isIdentity()&&(e=null));var k=null;a.hasBits1(256)&&(k=c.parseDataKey());var h=a.hasBits1(33554432)?c.parseCString():null,q=a.hasBits1(67108864)?c.parseLayerId():null,u=null;a.hasBits2(16)&&(u=c.parseGenericTypeId());var t=null;a.hasBits2(32)&&(t=c.parseGenericId());var v=null;if(a.hasBits1(536870912)){v=
new Map;a=c.parseCount_32();for(var w=0;w<a;++w){var z=c.parseUserDataIndex(),y=c.parseCount_32();y=c.parseBytes(y);v.set(z,y)}}return{nodeId:b,bits:g,name:d,localTransform:e,attributes:null!==k?k:[],header:c.getHeader(),exchangeId:h,layerId:q,genericTypeId:u,genericId:t,userDatas:v}};return c}();f.Node=e;e=function(){function c(b,a,d){this._bits=0;this._nodeId=d.nodeId;this._bits=d.bits;null!==d.name&&(this._name=d.name);null!==d.localTransform&&(this._localTransform=d.localTransform.copy());"number"===
typeof d.attributes?this._lazyAttributes=c._lazyLoadAttributes(b,a,d.attributes,d.header):0<d.attributes.length&&(this._lazyAttributes=h.LazyPromise.create(d.attributes));null!==d.exchangeId&&(this._exchangeId=d.exchangeId);null!==d.layerId&&(this._layerId=d.layerId,b.registerNodeInLayer(this,this._layerId));null!==d.genericTypeId&&(this._genericTypeId=d.genericTypeId);null!==d.genericId&&(this._genericId=d.genericId);null!==d.userDatas&&(this._userDatas=h.copyMap(d.userDatas))}c._lazyLoadAttributes=
function(b,c,a,d){var g=this;return h.LazyPromise.create(function(){return __awaiter(g,void 0,void 0,function(){var g,e,k,l,n,h;return __generator(this,function(m){switch(m.label){case 0:return g=b.getAbstractScEngine(),[4,b.enqueue(function(){return g.safeGetMetaData(c,a)})];case 1:e=m.sent();k=[];if(null!==e)for(l=new f.AssemblyData(d,e),n=new f.AssemblyDataParser(l);n.hasNext();)h=f.Attribute.parseBinary(n),k.push(h);return[2,k]}})})})};c.prototype.hasAuthoredId=function(){return f.isAuthoredId(this._nodeId)};
c.prototype.getAuthoredId=function(){return f.getAuthoredId(this._nodeId)};c.prototype.getName=function(){return void 0!==this._name?this._name:null};c.prototype.getExchangeId=function(){return void 0!==this._exchangeId?this._exchangeId:null};c.prototype.getLayerId=function(){return void 0!==this._layerId?this._layerId:null};c.prototype.getGenericTypeId=function(){return void 0!==this._genericTypeId?this._genericTypeId:null};c.prototype.getGenericId=function(){return void 0!==this._genericId?this._genericId:
null};c.prototype._hasBits=function(b){return h.hasBits(this._bits,b)};c.prototype.isLoaded=function(){return this._hasBits(-2147483648)};c.prototype.markLoaded=function(){this._bits|=-2147483648};c.prototype._setVisibility=function(b){this._bits|=524288;this._bits=b?this._bits|262144:this._bits&-262145};c.prototype.isVisible=function(){return this._hasBits(524288)?this._hasBits(262144):this.isInitiallyShown()};c.prototype.isInitiallyShown=function(){return this._hasBits(536870912)?!1:this._hasBits(1073741824)};
c.prototype.setLocalTransformAsInitial=function(b){this._localTransform=b.copy()};c.prototype.overrideLocalTransform=function(b){this._localTransformOverride=b.copy()};c.prototype.hasLocalTransformOverride=function(){return void 0!==this._localTransformOverride};c.prototype.removeLocalTransformOverride=function(){console.assert(void 0!==this._localTransformOverride);delete this._localTransformOverride};c.prototype.getLocalTransform=function(){return void 0!==this._localTransformOverride?this._localTransformOverride:
void 0!==this._localTransform?this._localTransform:null};c.prototype.getAttributes=function(){return __awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(c){return void 0!==this._lazyAttributes?[2,this._lazyAttributes.then(function(c){if(void 0!==b._lazyAttributes){for(var a=0;a<c.length;a++)b.addAttribute(c[a]);delete b._lazyAttributes}return b.getAttributes()})]:[2,h.TerseArray.toArray(this._attributes)]})})};c.prototype.addAttribute=function(b){this._attributes=h.TerseArray.push(this._attributes,
b)};c.prototype.getUserDataIndices=function(){var b=[];void 0!==this._userDatas&&this._userDatas.forEach(function(c,a){b.push(a)});return b.sort(a)};c.prototype.getUserData=function(b){if(void 0!==this._userDatas){var c=this._userDatas.get(b);if(void 0!==c)return c}throw new d.InvalidIndexError(b);};return c}();f.NodeMixin=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(b){function c(c,a,d,g){a=b.call(this,c,a,g.nodeInfo)||this;a._bits|=g.bits;a._parent=d;a._instanceInc=[g.inclusionKey,g.instanceKey];d=a.getLayerId();null===d||a.isOutOfHierarchy()||c.registerTreeNodeInLayer(a,d);return a}__extends(c,b);c.prototype.setRequested=function(){this._bits|=1024};c.prototype.isRequested=function(){return this._hasBits(1024)};c.prototype.isOutOfHierarchy=function(){return this._hasBits(268435456)};c.prototype.preventFromResetting=
function(){return this._hasBits(16384)};c.prototype.getInstanceInc=function(){return this._instanceInc};c.prototype.getParent=function(){return this._parent};return c}(f.NodeMixin);f.BodyMixin=a;var e=function(b){function c(c,a,d,g){a=b.call(this,c,a,d,g)||this;c.registerBodyInstance(a);return a}__extends(c,b);c.parseXml=function(b,c,a){b=f.Node.parseXml(b,c);c=f.XmlParser.parseInstanceKeyFromInc(c,"MeshInstanceKey");if(null===c)throw new d.XmlParseError('Expected "MeshInstanceKey" attribute.');return{nodeInfo:b,
inclusionKey:a,instanceKey:c,bits:0}};c.parseBinary=function(b,c,a){var g=f.towardAttachContext(c),e=g.getRemapper(),k=g.getMasterModelKey();g=a.parseNodeParseBits();b=f.Node.parseBinary(b,a,g);c=g.hasBits1(131072)?a.parseInclusionKey(e,k):c.getInclusionKey();if(!g.hasBits1(262144))throw new d.AssemblyDataParseError('Expected "ScInstanceKey" in binary data.');a=a.parseInstanceKey();return{nodeInfo:b,inclusionKey:c,instanceKey:a,bits:0}};c.reify=function(b,a,d,g){var e=f.towardAttachContext(d);b=new c(b,
a,d,g);e.attachedInvisibly()&&b.setVisibility(!1);return b};c.createDynamic=function(b,a,d,g,e,h,q){var k=f.towardInclusionContext(h),l=f.towardAttachContext(k).getMasterModelKey();a={nodeInfo:{nodeId:b.massageAuthoredUserId(k,g),bits:1073741824,name:e,localTransform:null,attributes:[],header:f.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},inclusionKey:a,instanceKey:d,bits:q};return new c(b,l,h,a)};c.prototype.getName=function(){var c=b.prototype.getName.call(this);
if(null!==c)return c;c=this.getParent().getBodyInstances();if(1<c.length){for(var a=0;a<c.length;++a)if(this===c[a])return"body "+(a+1);console.assert(!1)}return"body"};c.prototype.setVisibility=function(b){b!==this.isVisible()&&this.getParent().markBranchVisibilityDirty();this._setVisibility(b)};c.prototype.getRuntimeId=function(){return f.getRuntimeId(this._nodeId,this)};return c}(a);f.BodyInstance=e;var c=function(b){function c(c,a,d,g){a=b.call(this,c,a,d,g)||this;c.registerPmiBody(a);return a}
__extends(c,b);c.parseBinary=function(b,c,a,d){b=e.parseBinary(b,c,a);d&&(d=b.nodeInfo,d=__assign({},d,{bits:d.bits&-1073741825}),b=__assign({},b,{nodeInfo:d}));return b};c.reify=function(b,a,d,g){var e=f.towardAttachContext(d);b=new c(b,a,d,g);e.attachedInvisibly()&&b.setVisibility(!1);return b};c.prototype.getName=function(){var b=this.getName();return null!==b?b:"PMI body"};c.prototype.setVisibility=function(b){b!==this.isVisible()&&this.getParent().getParent().markBranchVisibilityDirty();this._setVisibility(b)};
c.prototype.getRuntimeId=function(){return f.getRuntimeId(this._nodeId,this)};return c}(a);f.PmiBody=c;a=function(b){function c(c,a,d,g){a=b.call(this,c,a,d,g)||this;a._bits&=-1073741825;c.registerViewFrame(a);return a}__extends(c,b);c.parseXml=function(b,c,a){return e.parseXml(b,c,a)};c.parseBinary=function(b,c,a){return e.parseBinary(b,c,a)};c.reify=function(b,a,d,g){var e=f.towardAttachContext(d);b=new c(b,a,d,g);e.attachedInvisibly()&&b.setVisibility(!1);return b};c.prototype.getName=function(){var b=
this.getName();return null!==b?b:"CAD View frame"};c.prototype.setVisibility=function(b){b!==this.isVisible()&&this.getParent().getParent().markBranchVisibilityDirty();this._setVisibility(b)};c.prototype.getRuntimeId=function(){return f.getRuntimeId(this._nodeId,this)};return c}(a);f.ViewFrame=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){function a(b,c){var a=new h.PromiseQueue(1,!0);a.push(function(){return b.clear()});for(var d=function(c){a.push(function(){return b.addPlane(c,null)})},g=0;g<c.length;g++)d(c[g]);return a.waitForIdle()}function e(b,c){c.hasLocalTransformOverride()&&(c.removeLocalTransformOverride(),b.push(c))}var c=function(b){function c(a,d,g,e,p){var k=this,l=f.towardAttachContext(d).getMasterModelKey();k=b.call(this,a,l,{nodeId:g.nodeId,bits:0,name:g.name,localTransform:null,
attributes:[],header:f.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null})||this;k._parent=p;k._bits|=g.bits;k._activatedCuttingSectionIndex=null;null!==g.camera&&(k._camera={initial:g.camera.copy(),derived:g.camera.copy()});k._instanceMarkupKeysToShow=h.toSet(g.instanceMarkupKeysToShow);c.isAuthoredViewInfo(g,e)?(k._nodesToShow=c._toRuntimeIds(d,g.nodesToShow),k._nodesToHide=c._toRuntimeIds(d,g.nodesToHide),0<g.transformMap.size&&(k._transformMap=
new Map,g.transformMap.forEach(function(b,c){c=d.toRuntimeId(c);k._transformMap.set(c,b.copy())}))):(k._nodesToShow=h.toSet(g.nodesToShow),k._nodesToHide=h.toSet(g.nodesToHide),0<g.transformMap.size&&(k._transformMap=h.copyMap(g.transformMap)));null!==g.viewFrameInfo&&(k._viewFrame=k._loadViewFrame(a,l,g.viewFrameInfo));0<g.cuttingPlanes.length&&(k._cuttingPlanes=h.TerseArray.fromArray(g.cuttingPlanes));a.registerCadView(k);return k}__extends(c,b);c.parseXml=function(b,c,a){var g=0,e=f.XmlParser.parseNodeId(c,
"Id");if(null===e)throw new d.XmlParseError('Expected "Id" attribute.');var k=c.getAttribute("Name");if(null===k)throw new d.XmlParseError('Expected "Name" attribute');var l=function(b,c,a,g){b=b.getAttribute("Enabled");if(null===b)throw new d.XmlParseError("Expected "+a+" attribute");return c=h.setBit(c,g,"1"===b)},n=c.getAttribute("isAnnotationView");g=null===n?h.setBit(g,134217728,!1):h.setBit(g,134217728,"true"===n);var t=n=null,v=[],w=[],z=[],y=new Map,x=[],A=function(b){var c=f.XmlParser.parseUint(b,
"Projection");if(null===c)throw new d.XmlParseError('Expected "Projection" attribute');var a=b.getAttribute("field");if(null===a)throw new d.XmlParseError('Expected "field" attribute');var g=a.split(" ");if(2!==g.length)throw new d.XmlParseError("Expected 2 field values");a=parseFloat(g[0]);g=parseFloat(g[1]);b=b.getAttribute("definition");if(null===b)throw new d.XmlParseError('Expected "definition" attribute');var e=b.split(" ");if(9!==e.length)throw new d.XmlParseError("Expected 9 definition values");
var k=function(b,c){return new d.Point3(parseFloat(b[c]),parseFloat(b[c+1]),parseFloat(b[c+2]))};b=k(e,0);var l=k(e,3);e=k(e,6);return d.Camera.create(b,l,e,c,a,g)},B=function(b){var c=[];if(null===f.XmlParser.parseUint(b,"Count"))throw new d.XmlParseError('Expected "PMIToShow Count" attribute');b=f.XmlParser.parseNodeIds(b,"IDs");if(null===b)throw new d.XmlParseError('Expected "PMIToShow Ids" attribute');for(var a=0;a<b.length;a+=2)c.push(b[a+1]);return c},D=function(b){var c=[],a=f.XmlParser.parseUint(b,
"Count");if(null===a)throw new d.XmlParseError('Expected "ClipPlanes Count" attribute');b=f.XmlParser.parseFloats(b,"Plane");if(null===b)throw new d.XmlParseError('Expected "Plane" attribute');if(b.length/4!==a)throw new d.XmlParseError("Expected "+a+" Planes");for(a=0;a<b.length;a+=4)c.push(d.Plane.createFromCoefficients(b[a],b[a+1],b[a+2],b[a+3]));return c},C=function(b){var c=new Map,a=f.XmlParser.parseUint(b,"Count");if(null===a)throw new d.XmlParseError('Expected "IDLocalTransform Count" attribute');
b=f.XmlParser.parseFloats(b,"IDTransform");if(null===b)throw new d.XmlParseError('Expected "IDTransform" attribute');if(b.length/13!==a)throw new d.XmlParseError("Expected "+a+" IDTransform values");for(a=0;a<b.length;a+=13){var g=b[a],e=b,k=a,l=new d.Matrix;l.m[1]=e[k+1];l.m[2]=e[k+2];l.m[3]=e[k+3];l.m[4]=e[k+4];l.m[6]=e[k+5];l.m[7]=e[k+6];l.m[8]=e[k+7];l.m[9]=e[k+8];l.m[11]=e[k+9];l.m[12]=e[k+10];l.m[13]=e[k+11];l.m[14]=e[k+12];c.set(g,l)}return c};for(c=c.firstElementChild;null!==c;)"Camera"===
c.localName?(console.assert(null===n),n=A(c)):"Frame"===c.localName?t=f.ViewFrame.parseXml(b,c,a.getInclusionKey()):"PMIToShow"===c.localName?v=B(c):"InstanceToShow"===c.localName?w=f.XmlParser.parseNodeIds(c,"IDs"):"InstanceToHide"===c.localName?z=f.XmlParser.parseNodeIds(c,"IDs"):"ClipPlanes"===c.localName?x=D(c):"IDLocalTransform"===c.localName?y=C(c):"IsCameraSet"===c.localName?g=l(c,g,"IsCameraSet",67108864):"IsPMIFilteringSet"===c.localName?g=l(c,g,"IsPMIFilteringSet",33554432):"IsGeomFilteringSet"===
c.localName?g=l(c,g,"IsGeomFilteringSet",16777216):"IsCrosssectionSet"===c.localName?g=l(c,g,"IsCrosssectionSet",8388608):"IsExplosionSet"===c.localName?g=l(c,g,"IsExplosionSet",4194304):"IsCombineState"===c.localName&&(g=l(c,g,"IsCombineState",2097152)),c=c.nextElementSibling;return{nodeId:e,name:k,camera:n,instanceMarkupKeysToShow:v,viewFrameInfo:t,nodesToShow:null===w?[]:w,nodesToHide:null===z?[]:z,transformMap:y,cuttingPlanes:x,bits:g}};c.parseBinary=function(b,c,a){var g=a.parseViewParseBits(),
e=a.parseNodeId(),k=null;h.hasBits(g,1)&&(k=a.parseCString());var l=0,n=!1;h.hasBits(g,256)?(n=!0,k+=" # Annotation View"):null!==k&&0<=k.indexOf("# Annotation View")&&(n=!0);n&&(l|=134217728);h.hasBits(g,1024)||(l|=33554432);h.hasBits(g,2048)||(l|=16777216);h.hasBits(g,4096)||(l|=8388608);h.hasBits(g,8192)||(l|=4194304);h.hasBits(g,16384)&&(l|=2097152);var t=h.hasBits(g,32768);t&&(l|=1048576);n=null;if(h.hasBits(g,2)){t=t?d.Projection.Perspective:d.Projection.Orthographic;var v=a.parsePoint3_32(),
w=a.parsePoint3_32(),z=a.parsePoint3_32(),y=a.parseFloat_32(),x=a.parseFloat_32();!h.hasBits(g,512)&&(l|=67108864,n=d.Camera.create(v,w,z,t,y,x),0>y||0>x)&&(l|=8192)}t=[];if(h.hasBits(g,4))for(w=a.parseCount_32(),v=0;v<w;++v)z=a.parseInstanceKey(),t.push(z);w=null;h.hasBits(g,8)&&(w=f.ViewFrame.parseBinary(b,c,a));b=[];if(h.hasBits(g,16))for(c=a.parseCount_32(),v=0;v<c;++v)z=a.parseNodeId(),b.push(z);c=[];if(h.hasBits(g,32))for(z=a.parseCount_32(),v=0;v<z;++v)y=a.parseNodeId(),c.push(y);z=new Map;
if(h.hasBits(g,64))for(y=a.parseCount_32(),v=0;v<y;++v){x=a.parseNodeId();var A=f.Transform.parseBinary(a);z.set(x,A)}y=[];if(h.hasBits(g,128))for(g=a.parseCount_32(),v=0;v<g;++v)x=a.parsePlane3_32(),y.push(x);return{nodeId:e,name:k,camera:n,instanceMarkupKeysToShow:t,viewFrameInfo:w,nodesToShow:b,nodesToHide:c,transformMap:z,cuttingPlanes:y,bits:l}};c.reify=function(b,a,d,g){var e=f.towardAttachContext(a);b=new c(b,a,d,0,g);e.attachedInvisibly()&&b.setVisibility(!1);return b};c.createDynamic=function(b,
a,d,g,e,h,q,u,t){for(var k=f.towardInclusionContext(a),l=b.generateDynamicNodeId(),n=[],m=0;m<e.length;m++)for(var p=0,r=e[m].getPmiBodies();p<r.length;p++){var B=r[p],D=f.towardInclusionContext(B);console.assert(k===D);B=B.getInstanceInc()[1];n.push(B)}return new c(b,k,{nodeId:l,name:d,camera:g,instanceMarkupKeysToShow:n,viewFrameInfo:null,nodesToShow:h,nodesToHide:q,transformMap:u,cuttingPlanes:null!==t?[t]:[],bits:67108864},1,a)};c.isAuthoredViewInfo=function(b,c){return 0===c};c._toRuntimeIds=
function(b,c){for(var a=new Set,d=0;d<c.length;d++){var g=b.toRuntimeId(c[d]);a.add(g)}return a};c.prototype._loadViewFrame=function(b,c,a){return f.ViewFrame.reify(b,c,this,a)};c.prototype.getViewFrame=function(){return void 0!==this._viewFrame?this._viewFrame:null};c.prototype.getParent=function(){return this._parent};c.prototype.getRuntimeId=function(){return f.getRuntimeId(this._nodeId,this)};c.prototype.getBranchVisibility=function(){var b=this.isVisible()?2:1;void 0===this._viewFrame||this._viewFrame.isOutOfHierarchy()||
(b|=this._viewFrame.isVisible()?2:1);return b};c.prototype.setVisibility=function(b){this._setVisibility(b)};c.prototype.isPmiFilteringSet=function(){return this._hasBits(33554432)};c.prototype.deactivate=function(b){var c=Promise.resolve();null!==this._activatedCuttingSectionIndex&&(b=b.getCuttingSection(this._activatedCuttingSectionIndex),null!==b&&(c=b.clear()),this._activatedCuttingSectionIndex=null);return c};c.prototype.activate=function(b,c,a,d,g,e,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(k){switch(k.label){case 0:return console.assert(null===this._activatedCuttingSectionIndex),[4,this._activateView(b,c,a,d,f)];case 1:return k.sent(),[2,this._activateCamera(b,c,g,e)]}})})};c.prototype._activateView=function(b,c,g,m,p){return __awaiter(this,void 0,void 0,function(){var k,l,n,t,v,w,z,y,x,A,B,D=this;return __generator(this,function(q){switch(q.label){case 0:return k=b.getRootNode(),null!==p&&console.assert(p.isAConfigurationNode()),l=0,n=new Map,t=[],v=[],w=e,void 0!==this._transformMap&&
(w=function(b,c){var a=D._transformMap,d=c.getRuntimeId();a=a.get(d);void 0!==a?(c.overrideLocalTransform(a),b.push(c)):c.hasLocalTransformOverride()&&(c.removeLocalTransformOverride(),b.push(c))}),z={enterProductOccurrence:function(b){(p===b||0<l)&&++l;var c=b.forEachPmi(function(b){var c=b.getPmiBodies();if(0!==c.length){var a=!0;if(D.isPmiFilteringSet()){a=!1;for(var d=0;d<c.length;d++){var g=c[d];g=g.getInstanceInc()[1];if(D._instanceMarkupKeysToShow.has(g)){a=!0;break}}}null!==p&&(a=a&&0<l);
n.set(b,a);for(b=0;b<c.length;b++)g=c[b],n.set(g,a)}}).then(function(){var c=b.getRuntimeId();D._nodesToHide.has(c)||b.isADrawingSheetNode()?n.set(b,!1):D._nodesToShow.has(c)&&(null!==p?n.set(b,0<l):n.set(b,!0));w(t,b);return b.forEachCadView(function(b){if(void 0!==b._viewFrame){var c=b===D;null!==p&&(c=c&&0<l);n.set(b,c);n.set(b._viewFrame,c)}})});v.push(c)},leaveProductOccurrence:function(){0<l&&--l},enterAnyBody:function(b){w(t,b);for(var c=null,a=b.getParent();null!==a&&null===c&&!(a instanceof
f.Pmi);){var d=a.getRuntimeId();D._nodesToHide.has(d)?(c=!1,n.set(a,!1)):D._nodesToShow.has(d)&&(c=!0,n.set(a,!0));a=f.towardContainerNode(a.getParent())}null===c&&(d=b.getRuntimeId(),D._nodesToShow.has(d)?n.set(b,!0):D._nodesToHide.has(d)&&n.set(b,!1));null!==p&&0===l&&n.set(b,!1)}},[4,f.WalkerAsync.walk(z,k,f.WalkRestriction.None)];case 1:return q.sent(),[4,Promise.all(v)];case 2:return q.sent(),y=[],x=f.updateVisibilities(b,c,g,k,n,!0,!1,null),y.push(x),x=f.updateScMatrices(c,g,t,!1),y.push(x),
[4,d.Util.waitForAll(y)];case 3:q.sent();A=h.TerseArray.toArray(this._cuttingPlanes);if(!(0<A.length))return[3,5];B=m.getCuttingSection(4);if(null===B)return[3,5];this._activatedCuttingSectionIndex=4;return[4,a(B,A)];case 4:return q.sent(),[2,B.activate()];case 5:return[2]}})})};c.prototype._activateCamera=function(b,c,a,g){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,h,m,w,z,y,x,A,B,D,C,E,F,G,I,J,K,H,L,M,N,R,O,P,S,Q,T,U,V,W,X;return __generator(this,function(p){switch(p.label){case 0:return e=
this._camera,void 0!==e?[3,3]:b.disableAutomaticFitWorld()?[3,2]:[4,a.fitWorld(g)];case 1:p.sent(),p.label=2;case 2:return[2];case 3:k=f.towardAttachRoot(this);l=f.towardAttachContext(k);n=f.towardProductOccurrence(l);h=f.getNetMatrix(l);null!==n&&(m=k.getMeasurementUnit(),w=n.getMeasurementUnit(),m!==w&&(z=m/w,y=new d.Matrix,y.setScaleComponent(z,z,z),h=d.Matrix.multiply(y,h)));e.derived=e.initial.transform(h);if(!this._hasBits(8192))return[3,8];x=!1;return void 0===this._viewFrame?[3,5]:[4,f.getBoundingByNodeId(b,
c,[this._viewFrame.getRuntimeId()],7,!1,x)];case 4:return B=p.sent(),[3,7];case 5:return[4,c.getModelBounding(!0,!1,x)];case 6:B=p.sent(),p.label=7;case 7:return A=B,D=d.Point3.subtract(e.derived.getTarget(),e.derived.getPosition()),C=A.extents().length(),E=D.copy().normalize().scale(C),F=A.center(),G=d.Point3.subtract(F,E),e.derived.setPosition(G),e.derived.setTarget(F),e.derived.setWidth(C),e.derived.setHeight(C),[2,a._setCameraPromise(e.derived,g)];case 8:if(e.derived.getProjection()!==d.Projection.Orthographic)return[3,
10];I=d.Point3.subtract(e.derived.getTarget(),e.derived.getPosition());return[4,c.getModelBounding(!0,!1,!1)];case 9:return A=p.sent(),J=d.Point3.subtract(A.center(),e.derived.getPosition()),K=1/I.length(),H=K*d.Point3.dot(I,J),0<H&&(I.scale(K),L=Math.max(e.derived.getWidth(),e.derived.getHeight()),M=d.Point3.add(e.derived.getPosition(),d.Point3.scale(I,H)),N=d.Point3.subtract(M,d.Point3.scale(I,2.5*L)),e.derived.setPosition(N),e.derived.setTarget(M)),[2,a._setCameraPromise(e.derived,g)];case 10:if(e.derived.getProjection()!==
d.Projection.Perspective)return[3,12];R=.01;return[4,c.getModelBounding(!0,!1,!1)];case 11:A=p.sent();O=d.Point3.subtract(A.max,A.min).length();I=d.Point3.subtract(e.derived.getTarget(),e.derived.getPosition());P=I.length();S=P/O;if(0===O||S>R)return[2,a._setCameraPromise(e.derived,g)];Q=O*R*1.001;T=e.derived.getWidth()/P;U=e.derived.getHeight()/P;V=T*Q;W=U*Q;X=I.copy().normalize().scale(Q);F=d.Point3.add(e.derived.getPosition(),X);e.derived.setTarget(F);e.derived.setWidth(V);e.derived.setHeight(W);
return[2,a._setCameraPromise(e.derived,g)];case 12:return[2,a._setCameraPromise(e.derived,g)]}})})};c.prototype.hasPmi=function(b){var c=f.towardInclusionContext(this).getInclusionKey(),a=f.towardInclusionContext(b).getInclusionKey();if(c!==a)return!1;c=0;for(b=b.getPmiBodies();c<b.length;c++)if(a=b[c].getInstanceInc()[1],this._instanceMarkupKeysToShow.has(a))return!0;return!1};c.prototype.isAnnotationView=function(){return this._hasBits(134217728)};c.prototype.setViewFrame=function(b){console.assert(void 0===
this._viewFrame);this._viewFrame=b};return c}(f.NodeMixin);f.CadView=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(f){var a=function(a){function c(b,c,e,f){var g=a.call(this,b,e,f.nodeInfo)||this;g._inclusionContextForNodeId=c;g._modelKey=e;0<f.repItemInfos.length&&(c=g._loadRepresentationItems(b,e,f.repItemInfos),g._repItems=d.TerseArray.fromArray(c));b.registerPartDefinition(g);return g}__extends(c,a);c.parseXml=function(b,c){var a=f.Node.parseXml(b,c);if(null===a.name){var d=c.getAttribute("FilePath");null!==d&&(a=__assign({},a,{name:d}))}d=[];for(c=c.firstElementChild;null!==
c;){if("Body"===c.localName){var g=f.RepresentationItem.parseXml(b,c);d.push(g)}c=c.nextElementSibling}return{nodeInfo:a,repItemInfos:d}};c.parseBinary=function(b,c){var a=c.parseNodeParseBits(),d=f.Node.parseBinary(b,c,a),g=[];if(a.hasBits1(1024)){a=c.parseCount_32();for(var e=0;e<a;++e){var h=f.RepresentationItem.parseBinary(b,c);g.push(h)}}return{nodeInfo:d,repItemInfos:g}};c.reify=function(b,a,d,e){return new c(b,a,d,e)};c.createDynamic=function(b,a,d){var g=b.getRootNode();g=f.towardInclusionContext(g);
a={nodeInfo:{nodeId:b.massageAuthoredUserId(g,a),bits:1073741824,name:d,localTransform:null,attributes:[],header:f.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},repItemInfos:[]};return new c(b,g,0,a)};c.createMissing=function(b){b=this.createDynamic(b,null,null);b._bits|=4096;return b};c.prototype.isMissing=function(){return this._hasBits(4096)};c.prototype._loadRepresentationItems=function(b,c,a){for(var d=[],g=0;g<a.length;g++){var e=f.RepresentationItem.reify(b,
c,a[g],this);this._addRepresentationItem(e);d.push(e)}return d};c.prototype.getRuntimeId=function(){return f.getRuntimeId(this._nodeId,this._inclusionContextForNodeId)};c.prototype.getInclusionContextForNodeId=function(){return this._inclusionContextForNodeId};c.prototype.addReferrer=function(b){var c=f.towardLoadContext(b),a=f.towardLoadContext(this._inclusionContextForNodeId);console.assert(c===a);this._referrers=d.TerseArray.push(this._referrers,b)};c.prototype.createRepItem=function(b,c){b=f.RepresentationItem.createDynamic(b,
c,null,this._modelKey,this);this._addRepresentationItem(b);return b};c.prototype._addRepresentationItem=function(b){this._repItems=d.TerseArray.push(this._repItems,b)};c.prototype.getRepresentationItems=function(){return d.TerseArray.toArray(this._repItems)};c.prototype.getReferrers=function(){return d.TerseArray.toArray(this._referrers)};c.prototype.removeAllReferrers=function(){for(var b=0,c=this.getReferrers();b<c.length;b++){var a=c[b].removePartDefinition();console.assert(this===a)}delete this._referrers};
c.prototype.getModelKey=function(){return this._modelKey};return c}(f.NodeMixin);f.PartDefinition=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){(function(c){c[c.Unknown=0]="Unknown";c[c.Text=1]="Text";c[c.Dimension=2]="Dimension";c[c.Arrow=3]="Arrow";c[c.Balloon=4]="Balloon";c[c.CircleCenter=5]="CircleCenter";c[c.Coordinate=6]="Coordinate";c[c.Datum=7]="Datum";c[c.Fastener=8]="Fastener";c[c.Gdt=9]="Gdt";c[c.Locator=10]="Locator";c[c.MeasurementPoint=11]="MeasurementPoint";c[c.Roughness=12]="Roughness";c[c.Welding=13]="Welding";c[c.Table=14]="Table";c[c.Other=15]="Other";c[c.GeometricalTolerance=16]=
"GeometricalTolerance"})(f.PmiType||(f.PmiType={}));(function(c){c[c.Ident=1]="Ident";c[c.Target=2]="Target"})(f.PmiSubTypeDatum||(f.PmiSubTypeDatum={}));(function(c){c[c.Distance=1]="Distance";c[c.DistanceOffset=2]="DistanceOffset";c[c.DistanceCumulate=3]="DistanceCumulate";c[c.Chamfer=4]="Chamfer";c[c.Slope=5]="Slope";c[c.Ordinate=6]="Ordinate";c[c.Radius=7]="Radius";c[c.RadiusTangent=8]="RadiusTangent";c[c.RadiusCylinder=9]="RadiusCylinder";c[c.RadiusEdge=10]="RadiusEdge";c[c.Diameter=11]="Diameter";
c[c.DiameterTangent=12]="DiameterTangent";c[c.DiameterCylinder=13]="DiameterCylinder";c[c.DiameterEdge=14]="DiameterEdge";c[c.DiameterCone=15]="DiameterCone";c[c.Length=16]="Length";c[c.LengthCurvilinear=17]="LengthCurvilinear";c[c.LengthCircular=18]="LengthCircular";c[c.Angle=19]="Angle"})(f.PmiSubTypeDimension||(f.PmiSubTypeDimension={}));(function(c){c[c.Fcf=1]="Fcf"})(f.PmiSubTypeGdt||(f.PmiSubTypeGdt={}));(function(c){c[c.Line=1]="Line";c[c.Spot=2]="Spot"})(f.PmiSubTypeWelding||(f.PmiSubTypeWelding=
{}));(function(c){c[c.SymbolUser=1]="SymbolUser";c[c.SymbolUtility=2]="SymbolUtility";c[c.SymbolCustom=3]="SymbolCustom";c[c.GeometricReference=4]="GeometricReference";c[c.Region=5]="Region"})(f.PmiSubTypeOther||(f.PmiSubTypeOther={}));var a=function(){return function(c){this.faceIds=[];this.edgeIds=[];this.body=c}}();f.PmiTopologyReference=a;var e=function(c){function b(a,d,e,n){var g=f.towardAttachContext(d).getMasterModelKey();var k=0;e.initiallyShown&&(k|=1073741824);k=c.call(this,a,g,{nodeId:e.nodeId,
bits:k,name:e.name,localTransform:null,attributes:e.attributesDataKey?e.attributesDataKey:[],header:f.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null})||this;k._bits|=16384;k._parent=n;k._packed=b._pack(e.pmiType,e.pmiSubType);n=0;for(var l=e.pmiBodyInfos;n<l.length;n++)k._pmiBodies=h.TerseArray.push(k._pmiBodies,k._loadPmiBody(a,g,l[n]));0<e.topoRefInfos.length&&(k._topoRefs=b._loadTopoRefs(d,e.topoRefInfos));if(0<e.topoRefs.length)if(void 0===
k._topoRefs)k._topoRefs=e.topoRefs.slice();else for(d=0,e=e.topoRefs;d<e.length;d++)k._topoRefs.push(e[d]);a.registerPmi(k);return k}__extends(b,c);b.parseBinary=function(b,c,a){var d=a.parsePmiParseBits(),g=a.parseNodeId(),e=null;h.hasBits(d,1)&&(e=a.parseCString());var k=null;h.hasBits(d,4)&&(k=a.parseDataKey());var l=1;h.hasBits(d,16)&&(l=a.parseCount_32());for(var u=[],t=h.hasBits(d,8),v=0;v<l;++v){var w=f.PmiBody.parseBinary(b,c,a,t);u.push(w)}b=0<u.length?h.hasBits(u[0].nodeInfo.bits,1073741824):
!1;c=a.parsePmiType();l=a.parsePmiSubType();t=[];if(h.hasBits(d,2))for(d=a.parseCount_32(),v=0;v<d;++v)w=f.ReferenceOnTopology.parseBinary(a),t.push(w);return{nodeId:g,name:e,attributesDataKey:k,pmiBodyInfos:u,initiallyShown:b,pmiType:c,pmiSubType:l,topoRefInfos:t,topoRefs:[]}};b.reify=function(c,a,d,e){var g=f.towardAttachContext(a);c=new b(c,a,d,e);g.attachedInvisibly()&&c.setVisibility(!1);return c};b.createDynamic=function(c,a,d,e,f,h,r){e={nodeId:c.generateDynamicNodeId(),name:null,attributesDataKey:null,
pmiBodyInfos:h,initiallyShown:!0,pmiType:e,pmiSubType:f,topoRefInfos:[],topoRefs:r};return new b(c,a,e,d)};b._loadTopoRefs=function(b,c){for(var a=[],d=0;d<c.length;d++){var g=f.ReferenceOnTopology.reify(b,c[d]);a.push(g)}return a};b.prototype._loadPmiBody=function(b,c,a){return f.PmiBody.reify(b,c,this,a)};b.prototype.getPmiBodies=function(){return h.TerseArray.toArray(this._pmiBodies)};b._pack=function(b,c){return b+100*c};b.prototype.getPmiType=function(){return this._packed%100};b.prototype.getPmiSubType=
function(){return Math.floor(this._packed/100)%100};b.prototype.getParent=function(){return this._parent};b.prototype.getRuntimeId=function(){return f.getRuntimeId(this._nodeId,this)};b.prototype.getBranchVisibility=function(){for(var b=this.isVisible()?2:1,c=0,a=h.TerseArray.toArray(this._pmiBodies);c<a.length;c++){var d=a[c];d.isOutOfHierarchy()||(b|=d.isVisible()?2:1)}return b};b.prototype.setVisibility=function(b){this._setVisibility(b)};b.prototype.getPmiTopologyReferences=function(b){if(void 0===
this._topoRefs)return[];for(var c=new Map,g=0,e=this._topoRefs;g<e.length;g++){var f=e[g],h=f.getBodyInstanceInc();h=b.lookupAnyBodyByInstanceInc(h[0],h[1]);if(null!==h){var r=c.get(h);void 0===r&&(r=new a(h),c.set(h,r));switch(f.getTopoItemType()){case d.PmiTopoRef.Face:r.faceIds.push(f.getItemIndex());break;case d.PmiTopoRef.Edge:r.edgeIds.push(f.getItemIndex())}}}var q=[];c.forEach(function(b){q.push(b)});return q};return b}(f.NodeMixin);f.Pmi=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal=
{}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){function a(c,b){for(var a=[],e=0;e<c.length;e++){var f=b(c[e]);f&&a.push(f)}return d.Util.waitForAll(a)}var e=function(c){function b(a,e,l,n,m,p,r){var g=this;r=b._amendInfo(n,r);var k=f.towardAttachContext(m).getMasterModelKey();g=c.call(this,n,k,r.nodeInfo)||this;g._parent=p;g._bits=g._bits|r.productBits|32768;var t=r.nodeInfo.header;p=[];null!==r.prototypeDataKey&&(console.assert(null!==l),g._prototypeContext=g._loadPrototypeContext(e,l,n,m,r.prototypeDataKey,
t));console.assert(null===r.quickAccessPartDefinitionDataId||null===r.partDefinition);null!==r.partDefinition?Array.isArray(r.partDefinition)?g._partDefinition=g._lazyLoadPartDefinitionById(n,m,r.partDefinition,t):g._partDefinition=g._lazyLoadPartDefinitionByInfo(n,m,r.partDefinition,k):null!==r.quickAccessPartDefinitionDataId&&(g._partDefinition=g._lazyLoadPartDefinitionById(n,m,r.quickAccessPartDefinitionDataId,t));if(0<r.childDataKeys.length){console.assert(null!==l);var v=function(){return __awaiter(g,
void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,this._loadProductOccurrences(e,l,n,m,r.childDataKeys,t)];case 1:return b=c.sent(),this._children=h.TerseArray.fromArray(b),[2]}})})}();p.push(v)}0<r.bodyInstanceInfos.length&&(k=g._loadBodyInstances(n,k,r.bodyInstanceInfos),g._bodyInstances=h.TerseArray.fromArray(k));0<r.cadViewInfos.length&&(k=g._loadCadViews(n,m,r.cadViewInfos),g._cadViews=h.TerseArray.fromArray(k));0<r.pmiInfos.length&&(k=g._loadPmis(n,
m,r.pmiInfos),g._pmis=h.TerseArray.fromArray(k));null!==r.measurementUnit&&(g._measurementUnit=r.measurementUnit);null!==r.externalModelInfo&&(console.assert(null!==a),console.assert(null!==l),f.ExternalModel.canImplicitlyLoad(r.externalModelInfo)?(v=g._loadAndAttachExternalModel(l,m,r.externalModelInfo),p.push(v)):g._pendingExternalModels=h.TerseArray.push(g._pendingExternalModels,r.externalModelInfo));k=0;for(v=r.layerInfos;k<v.length;k++){var w=v[k];n.createOrUpdateLayerName(w.id,w.name)}k=0;for(v=
r.filters;k<v.length;k++)n.addFilter(v[k]);k=g.getLayerId();null===k||g.isOutOfHierarchy()||n.registerTreeNodeInLayer(g,k);n.registerProductOccurrence(g);if(null===a){if(0<p.length)throw new d.InternalLogicError;}else a.resolve(d.Util.waitForAll(p));return g}__extends(b,c);b.parseXml=function(b,c,a,d,e){var g=a.getInclusionKey(),k=f.Node.parseXml(c,d),l=f.XmlParser.parseFloat(d,"Unit"),h=[],n=[],m=[],w=[],z=null,y=null,x=null;for(d=d.firstElementChild;null!==d;){if("PartDefinition"===d.localName){z=
f.PartDefinition.parseXml(c,d);break}else if("BodyInstance"===d.localName){var A=f.BodyInstance.parseXml(c,d,g);h.push(A)}else if("Material"===d.localName)console.assert(null===y),y=f.SimpleMaterial.parseXml(d);else if("ExternalModel"===d.localName){if(console.assert(null===x),A=d.getAttribute("Name"),null!==A){x=f.XmlParser.parseFloat(d,"Unit");var B=f.XmlParser.parseBounding(d,"BoundingBox");x={config:b,modelName:A,bounding:B,measurementUnit:x,toAttachData:e,reservedNodeIdOffset:0}}}else"CADView"===
d.localName?(A=f.CadView.parseXml(c,d,a),w.push(A)):"Filter"===d.localName?n.push(f.Filter.parseXml(d)):"Layer"===d.localName&&(A=f.Layer.parseXml(d),null!==A&&m.push(A));d=d.nextElementSibling}return{nodeInfo:k,productBits:0,childDataKeys:[],prototypeDataKey:null,partDefinition:z,quickAccessPartDefinitionDataId:null,externalModelInfo:x,bodyInstanceInfos:h,cadViewInfos:w,pmiInfos:[],measurementUnit:l,simpleMaterial:y,layerInfos:m,filters:n}};b.parseBinary=function(b,c,a,d){var g=f.towardAttachContext(a),
e=g.getRemapper(),k=d.parseNodeParseBits();if(k.hasBits1(2097152)){var l=d.parseAssemblyDataVersion();l}k.hasBits2(8)&&g.setGenericTypeMaps(d.parseGenericTypes());l=f.Node.parseBinary(c,d,k);var h=0;k.hasBits1(4194304)&&(h=d.parseProductBits());var n=[];if(k.hasBits1(16))for(var v=d.parseCount_32(),w=0;w<v;++w){var z=d.parseDataKey();n.push(z)}z=v=null;if(k.hasBits1(32)&&(v=d.parseDataKey(),k.hasBits1(64))){z=d.parseModelKey(e);console.assert(0!==z);var y=d.parseDataKey();z=[z,y]}y=[];if(k.hasBits1(128)){var x=
d.parseCount_32();for(w=0;w<x;++w){var A=f.BodyInstance.parseBinary(c,a,d);y.push(A)}}x=null;k.hasBits1(524288)&&(w=d.parseModelKey(e),console.assert(0!==w),x=d.parseInclusionKey(e,w),x={config:b,inclusionKey:x,modelKey:w});b=null;k.hasBits1(512)&&(w=d.parseModelKey(e),0===w&&(w=g.getMasterModelKey()),b=d.parseDataKey(),b=[w,b]);g=[];if(k.hasBits1(32768))for(e=d.parseCount_32(),w=0;w<e;++w)A=f.CadView.parseBinary(c,a,d),g.push(A);e=[];if(k.hasBits1(65536))for(A=d.parseCount_32(),w=0;w<A;++w){var B=
f.Pmi.parseBinary(c,a,d);e.push(B)}a=null;k.hasBits1(16384)&&(a=d.parseFloat_64());k.hasBits1(16777216)&&(w=d.parsePoint3_64(),A=d.parsePoint3_64(),c.setViewAxes(w,A));c=[];if(k.hasBits1(134217728))for(A=d.parseCount_32(),w=0;w<A;++w)B=f.Layer.parseBinary(d),c.push(B);A=[];if(k.hasBits1(268435456))for(k=d.parseCount_32(),w=0;w<k;++w)B=f.Filter.parseBinary(d),A.push(B);return{nodeInfo:l,productBits:h,childDataKeys:n,prototypeDataKey:v,partDefinition:b,quickAccessPartDefinitionDataId:z,externalModelInfo:x,
bodyInstanceInfos:y,cadViewInfos:g,pmiInfos:e,measurementUnit:a,simpleMaterial:null,layerInfos:c,filters:A}};b.reifySync=function(c,a,d,e,h,p){console.assert(0===h.childDataKeys.length);console.assert(null===h.externalModelInfo);var g=f.towardAttachContext(e);c=new b(null,c,a,d,e,p,h);g.attachedInvisibly()&&c.setVisibility(!1);return c};b.reify=function(c,a,d,e,f,p){return __awaiter(this,void 0,void 0,function(){var g,k;return __generator(this,function(l){switch(l.label){case 0:return g=h.OpenPromise.create(),
k=new b(g,c,a,d,e,p,f),[4,g];case 1:return l.sent(),[2,k]}})})};b.createDynamic=function(c,a,e,h,m,p,r,q){void 0===r&&(r=!1);void 0===q&&(q=null);var g=f.towardInclusionContext(a);e={nodeInfo:{nodeId:c.massageAuthoredUserId(g,h),bits:p?1073741824:0,name:e,localTransform:m,attributes:[],header:f.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},productBits:r?268435456:0,childDataKeys:[],prototypeDataKey:null,partDefinition:null,quickAccessPartDefinitionDataId:null,
bodyInstanceInfos:[],externalModelInfo:null,cadViewInfos:[],pmiInfos:[],measurementUnit:q,simpleMaterial:null,layerInfos:[],filters:[]};h=new d.LoadSubtreeConfig;h.attachInvisibly=!p;return new b(null,h,null,c,g,a,e)};b.createMissing=function(b,c){b=this.createDynamic(b,c,"Missing",null,null,!1);b._bits|=4096;return b};b.prototype.isMissing=function(){return this._hasBits(4096)};b._amendInfo=function(b,c){if(null!==c.nodeInfo.name)return c;var a=null;h.hasBits(c.productBits,2)?a=b.generateProductName():
h.hasBits(c.productBits,4)?a=b.generateGroupName():h.hasBits(c.productBits,32)?a=b.generateDrawingSheetName():h.hasBits(c.productBits,8)&&(a=b.generateDrawingViewName());if(null===a)return c;b=__assign({},c.nodeInfo,{name:a});return __assign({},c,{nodeInfo:b})};b.prototype._loadExternalModel=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d,g;return __generator(this,function(e){if(f.ExternalModel.isNameInfo(a))return[2,b.attachByExternalModelInfo(a,this)];d=this.getAuthoredId();
g=f.towardLoadContext(c);return g.handleExternalModel(d,c,a.inclusionKey)?[2,b.attachByExternalModelInfo(a,this)]:[2,null]})})};b.prototype._loadAndAttachExternalModel=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(g){switch(g.label){case 0:return[4,this._loadExternalModel(b,c,a)];case 1:return d=g.sent(),null!==d&&this.addAttachContext(d),[2,d]}})})};b.prototype.loadPendingExternalModels=function(b){return __awaiter(this,void 0,void 0,function(){var c,
a,d,g,e,r,q,u,t,v;return __generator(this,function(k){switch(k.label){case 0:if(!this.hasPendingExternalModels())return[2,[]];c=f.towardInclusionContext(this);a=[];d=0;for(g=h.TerseArray.toArray(this._pendingExternalModels);d<g.length;d++)e=g[d],r=this._loadAndAttachExternalModel(b,c,e),a.push(r);delete this._pendingExternalModels;q=[];u=0;return[4,Promise.all(a)];case 1:t=k.sent(),k.label=2;case 2:if(!(u<t.length))return[3,4];v=t[u];null!==v&&q.push(v);k.label=3;case 3:return u++,[3,2];case 4:return[2,
q]}})})};b.prototype._lazyLoadPartDefinitionByInfo=function(b,c,a,d){b=f.PartDefinition.reify(b,c,d,a);return h.LazyPromise.create(b)};b.prototype._lazyLoadPartDefinitionById=function(b,c,a,d){var g=this,e=b.getAbstractScEngine(),k=f.towardLoadContext(c),l=b.lookupPartDefinitionByDataId(k,a[0],a[1]);if(null!==l)return h.LazyPromise.create(function(){return __awaiter(g,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,l];case 1:return b=c.sent(),b.addReferrer(this),
[2,b]}})})});l=h.LazyPromise.create(function(){return __awaiter(g,void 0,void 0,function(){var g,k,l,h,n,m,p;return __generator(this,function(q){switch(q.label){case 0:return g=a[0],k=a[1],[4,b.enqueue(function(){return e.safeGetMetaData(g,k)})];case 1:return l=q.sent(),null!==l?(h=new f.AssemblyData(d,l),n=new f.AssemblyDataParser(h),m=f.PartDefinition.parseBinary(b,n),p=f.PartDefinition.reify(b,c,g,m),p.addReferrer(this),[2,p]):[2,f.PartDefinition.createMissing(b)]}})})});b.registerPartDefinitionByDataId(k,
a[0],a[1],l);return l};b._loadProductOccurrence=function(c,a,d,e,h,p){return __awaiter(this,void 0,void 0,function(){var g,k;return __generator(this,function(l){g=new f.AssemblyDataParser(h);k=b.parseBinary(c,d,e,g);return[2,b.reify(c,a,d,e,k,p)]})})};b.prototype._loadPrototypeContext=function(c,a,d,e,m,p){var g=this,k=f.towardAttachContext(e),l=f.towardLoadContext(k),n=k.getMasterModelKey();k=d.lookupPrototypeByDataId(l,n,m);null===k&&(k=h.LazyPromise.create(function(){return __awaiter(g,void 0,
void 0,function(){var g,k,l;return __generator(this,function(h){switch(h.label){case 0:return g=d.getAbstractScEngine(),[4,d.enqueue(function(){return g.safeGetMetaData(n,m)})];case 1:return k=h.sent(),null!==k?(l=new f.AssemblyData(p,k),[2,b._loadProductOccurrence(c,a,d,e,l,v)]):[2,b.createMissing(d,v)]}})})}),k=new f.SharedPrototypeContext(k),d.registerPrototypeByDataId(l,n,m,k));var v=new f.PrototypeContext(k,e);v.addReferrer(this);return v};b.prototype._loadProductOccurrences=function(c,a,d,e,
m,p){return __awaiter(this,void 0,void 0,function(){var g,k,l,n,v,w,z,y,x,A,B;return __generator(this,function(q){switch(q.label){case 0:return g=f.towardAttachContext(e),l=k=g.getMasterModelKey(),n=d.getAbstractScEngine(),[4,d.enqueue(function(){return n.safeGetMetaDatas(l,m)})];case 1:v=q.sent(),w=[],z=0,q.label=2;case 2:if(!(z<m.length))return[3,9];y=void 0;if(null===v)return[3,6];x=v[z];v[z]=h.emptyBytes;A=new f.AssemblyData(p,x);return[4,b._loadProductOccurrence(c,a,d,e,A,this)];case 3:return y=
q.sent(),(B=a.onLoadChildProductOccurrence())?[4,B]:[3,5];case 4:q.sent(),q.label=5;case 5:return[3,7];case 6:y=b.createMissing(d,this),q.label=7;case 7:w.push(y),q.label=8;case 8:return++z,[3,2];case 9:return[2,w]}})})};b.prototype._loadBodyInstances=function(b,c,a){for(var d=[],g=0;g<a.length;g++){var e=f.BodyInstance.reify(b,c,this,a[g]);d.push(e)}return d};b.prototype._loadCadViews=function(b,c,a){for(var d=[],g=0;g<a.length;g++){var e=f.CadView.reify(b,c,a[g],this);d.push(e);e.markLoaded()}return d};
b.prototype._loadPmis=function(b,c,a){for(var d=[],g=0;g<a.length;g++){var e=f.Pmi.reify(b,c,a[g],this);d.push(e)}return d};b.prototype.getParent=function(){return this._parent};b.prototype.getRuntimeId=function(){return f.getRuntimeId(this._nodeId,this)};b.prototype.isAbsoluteRoot=function(){return-2===this._nodeId};b.prototype.getPrototype=function(){return void 0!==this._prototypeContext?this._prototypeContext:null};b.prototype.isAConfigurationNode=function(){return this._hasBits(1)};b.prototype.isADefaultNode=
function(){return this._hasBits(16)};b.prototype.isAProductNode=function(){return h.hasBits(this._bits,2)};b.prototype.isAGroupNode=function(){return h.hasBits(this._bits,4)};b.prototype.isADrawingSheetNode=function(){return h.hasBits(this._bits,32)};b.prototype.isADrawingViewNode=function(){return h.hasBits(this._bits,8)};b.prototype.addProductOccurrence=function(b){console.assert(b.getParent()===this);this._children=h.TerseArray.push(this._children,b);this._itemWasAdded()};b.prototype.addBodyInstance=
function(b){console.assert(b.getParent()===this);this._bodyInstances=h.TerseArray.push(this._bodyInstances,b);this._itemWasAdded()};b.prototype.addCadView=function(b){console.assert(b.getParent()===this);this._cadViews=h.TerseArray.push(this._cadViews,b);this._itemWasAdded()};b.prototype.addPmi=function(b){console.assert(b.getParent()===this);this._pmis=h.TerseArray.push(this._pmis,b);this._itemWasAdded()};b.prototype.addLoadContext=function(b){console.assert(b.getParent()===this);this._childContexts=
h.TerseArray.push(this._childContexts,b);this._itemWasAdded()};b.prototype.addAttachContext=function(b){console.assert(b.getParent()===this);this._childContexts=h.TerseArray.push(this._childContexts,b);this._itemWasAdded()};b.prototype._followPrototypesWhileEmpty=function(){if(void 0===this._prototypeContext||void 0!==this._children||void 0!==this._childContexts)return this;var b=this._prototypeContext.getProductOccurrence();return b.isResolved()?b.getResolved()._followPrototypesWhileEmpty():this};
b.prototype.getRawPartDefinition=function(){if(void 0!==this._partDefinition)return this._partDefinition;if(void 0!==this._prototypeContext){var b=this._prototypeContext.getProductOccurrence();if(b.isResolved())return b.getResolved().getRawPartDefinition()}return null};b.prototype.getPartDefinition=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){b=this.getRawPartDefinition();if(b instanceof h.LazyPromise)return[2,h.Boxed.create(b)];if(b instanceof
Promise)return[2,b];d.Util.TypeAssert(b);return[2,null]})})};b.prototype.getPartDefinitionSync=function(){console.assert(this.isLoaded());if(void 0!==this._partDefinition&&this._partDefinition.isResolved())return this._partDefinition.getResolved();if(void 0!==this._prototypeContext){var b=this._prototypeContext.getProductOccurrence();if(b.isResolved())return b.getResolved().getPartDefinitionSync()}return null};b.prototype._getChildren=function(){for(var b=h.TerseArray.toArray(this._children),c=0,
a=h.TerseArray.toArray(this._childContexts);c<a.length;c++){var d=a[c].getChildren();h.append(b,d)}return b};b.prototype.getChildren=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,this._followPrototypesWhileEmpty()];case 1:return b=c.sent(),[2,b._getChildren()]}})})};b.prototype.getChildrenSync=function(){console.assert(this.isLoaded());var b=this.tryGetChildrenSync();if(null===b)throw new d.InternalLogicError;return b};
b.prototype.tryGetChildrenSync=function(){var b=this._followPrototypesWhileEmpty();return b instanceof Promise?null:b._getChildren()};b.prototype.forEachChild=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return[4,this.getChildren()];case 1:return c=d.sent(),[2,a(c,b)]}})})};b.prototype.forEachBodyInstance=function(b){var c=this.getBodyInstances();return a(c,b)};b.prototype.forEachPmi=function(b){var c=this.getPmis();return a(c,
b)};b.prototype.forEachCadView=function(b){var c=this.getCadViews();return a(c,b)};b.prototype.hasBodyInstances=function(){return void 0!==this._bodyInstances};b.prototype.getBodyInstances=function(){return h.TerseArray.toArray(this._bodyInstances)};b.prototype.getCadViews=function(){return h.TerseArray.toArray(this._cadViews)};b.prototype.getPmis=function(){return h.TerseArray.toArray(this._pmis)};b.prototype.setMeasurementUnit=function(b){this._measurementUnit=b};b.prototype.unsetMeasurementUnit=
function(){this._measurementUnit=void 0};b.prototype.hasMeasurementUnit=function(){return void 0!==this._measurementUnit};b.prototype.getMeasurementUnit=function(){for(var b=this;null!==b;){if(void 0!==b._measurementUnit)return b._measurementUnit;b=f.towardProductOccurrence(b._parent)}return 1};b.prototype.getPhysicalProperties=function(){return __awaiter(this,void 0,void 0,function(){var b,c,a,d,e;return __generator(this,function(g){switch(g.label){case 0:return[4,this.getPartDefinition()];case 1:return b=
g.sent(),null===b?[2,null]:[4,b.value];case 2:c=g.sent();a=c.getRepresentationItems();if(1!==a.length)return[2,null];d=a[0];e=d.getPhysicalProperties();return[2,e]}})})};b.prototype.setPartDefinition=function(b){console.assert(void 0===this._partDefinition);this._partDefinition=h.LazyPromise.create(b)};b.prototype.setPrototype=function(b){console.assert(void 0===this._prototypeContext);this._prototypeContext=b;this._markBranchVisibilityDirty(!1)};b.prototype.removePrototype=function(){if(void 0===
this._prototypeContext)throw new d.InternalLogicError;var b=this._prototypeContext;delete this._prototypeContext;this._markBranchVisibilityDirty(!1);return b};b.prototype.getBranchVisibility=function(){this._updateBranchVisibility();return this._getBranchVisibility()};b.prototype._getBranchVisibility=function(){var b=this.isVisible()?2:1;this._hasBits(65536)&&(b|=2);this._hasBits(131072)&&(b|=1);return b};b.prototype._setBranchVisibility=function(b){this.isVisible()?console.assert(h.hasBits(b,2)):
console.assert(h.hasBits(b,1));this._bits&=-196609;h.hasBits(b,1)&&(this._bits|=131072);h.hasBits(b,2)&&(this._bits|=65536)};b.prototype._updateBranchVisibility=function(){if(this._hasBits(32768)){var b=this.isVisible()?2:1,c=this._getSubBranchVisibilities();null!==c&&(b|=c);this._setBranchVisibility(b);this._bits&=-32769}};b.prototype._getSubBranchVisibilities=function(){for(var b=0,c=0,a=this.getChildrenSync();c<a.length;c++){var d=a[c].getBranchVisibility();b|=d;if(3===b)return 3}d=0;for(c=this.getBodyInstances();d<
c.length;d++)if(a=c[d],!a.isOutOfHierarchy()&&(b|=a.isVisible()?2:1,3===b))return 3;c=0;for(a=this.getPmis();c<a.length;c++)if(d=a[c].getBranchVisibility(),b|=d,3===b)return 3;c=0;for(a=this.getCadViews();c<a.length;c++)if(d=a[c].getBranchVisibility(),b|=d,3===b)return 3;return 0===b?null:b};b.prototype._itemWasAdded=function(){3!==this._getBranchVisibility()&&this._markBranchVisibilityDirty(!0)};b.prototype._onItemRemoved=function(){1!==this._getBranchVisibility()&&this._markBranchVisibilityDirty(!1)};
b.prototype.markBranchVisibilityDirty=function(){this._markBranchVisibilityDirty(!1)};b.prototype._markBranchVisibilityDirty=function(b){if(!(this._hasBits(32768)||b&&3===this._getBranchVisibility()))if(this._bits|=32768,this._parent instanceof f.PrototypeContext)for(var c=0,a=this._parent.getReferrers();c<a.length;c++)a[c]._markBranchVisibilityDirty(b);else if(c=f.towardProductOccurrence(this._parent),null!==c)return c._markBranchVisibilityDirty(b)};b.prototype.setVisibility=function(b){this.isVisible()!==
b&&(this._setVisibility(b),this._markBranchVisibilityDirty(!1))};b.prototype._removeDirectChild=function(b){var c=h.TerseArray.toArray(this._children),a=c.length;c=c.filter(function(c){return c!==b});if(c.length===a)return!1;0===c.length?delete this._children:this._children=h.TerseArray.fromArray(c);this._onItemRemoved();return!0};b.prototype._removeIndirectChild=function(b){for(var c=!1,a=h.TerseArray.toArray(this._childContexts),d=0,g=a;d<g.length;d++)if(g[d].removeProductOccurrence(b)){c=!0;break}if(!c)return!1;
a=a.filter(function(b){return b.hasChildren()});0===a.length?delete this._childContexts:this._childContexts=h.TerseArray.fromArray(a);this._onItemRemoved();return!0};b.prototype.removeProductOccurrence=function(b){return this._removeDirectChild(b)?!0:this._removeIndirectChild(b)};b.prototype.removeBodyInstance=function(b){var c=h.TerseArray.toArray(this._bodyInstances),a=c.length;c=c.filter(function(c){return c!==b});if(c.length===a)return!1;0===c.length?delete this._bodyInstances:this._bodyInstances=
h.TerseArray.fromArray(c);this._onItemRemoved();return!0};b.prototype.purgeContents=function(){var b=this;this._markBranchVisibilityDirty(!1);var c=[];if(void 0!==this._partDefinition&&!this._partDefinition.isUnforced()){var e=this._partDefinition.then(function(c){c.removeAllReferrers();delete b._partDefinition});c.push(e)}void 0!==this._prototypeContext&&(e=this._prototypeContext.purgeContents(),c.push(e),delete this._prototypeContext);e=h.TerseArray.toArray(this._children);e=a(e,function(b){return b.purgeContents()});
c.push(e);delete this._children;e=h.TerseArray.toArray(this._childContexts);e=a(e,function(b){return b.purgeContents()});c.push(e);delete this._childContexts;delete this._bodyInstances;delete this._cadViews;delete this._pmis;delete this._measurementUnit;return d.Util.waitForAll(c)};b.prototype.removePartDefinition=function(){if(void 0===this._partDefinition||!this._partDefinition.isResolved())throw new d.InternalLogicError;var b=this._partDefinition;delete this._partDefinition;return b.getResolved()};
b.prototype.isOutOfHierarchy=function(){return this._hasBits(268435456)};b.prototype.markIsExternalModelRoot=function(b){console.assert(!this._hasBits(2048));this._bits|=2048;b.markSeenExternalModel()};b.prototype.isExternalModelRoot=function(){return this._hasBits(2048)};b.prototype.addPendingExternalModel=function(b){this._pendingExternalModels=h.TerseArray.push(this._pendingExternalModels,b)};b.prototype.hasPendingExternalModels=function(){return!h.TerseArray.isEmpty(this._pendingExternalModels)};
return b}(f.NodeMixin);f.ProductOccurrence=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){function a(b,c){return void 0!==b&&c<b.length?b[c]:null}function e(b,c,a){void 0===b&&(b=[]);b.length=Math.max(b.length,c+1);b[c]=a;return b}var c;(function(b){b[b.Unknown=0]="Unknown";b[b.BRep=1]="BRep";b[b.Tessellation=2]="Tessellation";b[b.Wireframe=3]="Wireframe";b[b.PointCloud=4]="PointCloud"})(c=f.BodyType||(f.BodyType={}));var b=function(b){function g(c,a,d,g){a=b.call(this,c,a,d.nodeInfo)||this;a._parent=g;a._bodyType=d.bodyType;0<d.faceMeasurementProps.length&&
(a._faceMeasurementProps=d.faceMeasurementProps.slice());0<d.edgeMeasurementProps.length&&(a._edgeMeasurementProps=d.edgeMeasurementProps.slice());null!==d.physicalProps&&(a._physicalProps=d.physicalProps);if(0<d.faceAttributes.length){a._faceAttributes=[];for(var e=0,f=d.faceAttributes;e<f.length;e++)g=f[e],a._faceAttributes.push(g.copy())}if(0<d.edgeAttributes.length)for(a._edgeAttributes=[],e=0,d=d.edgeAttributes;e<d.length;e++)g=d[e],a._edgeAttributes.push(g.copy());c.registerRepresentationItem(a);
return a}__extends(g,b);g.parseXml=function(b,a){b=f.Node.parseXml(b,a);a=f.XmlParser.parseMeshKey(a,"TCKey_Mesh");return{nodeInfo:b,meshKey:a,bodyType:c.Unknown,faceMeasurementProps:[],edgeMeasurementProps:[],physicalProps:null,faceAttributes:[],edgeAttributes:[]}};g.parseBinary=function(b,c){var a=c.parseNodeParseBits();b=f.Node.parseBinary(b,c,a);var g=c.parseBodyType(),e=null;a.hasBits1(8192)&&(e=c.parseMeshKey());var k=[];if(a.hasBits1(2048))for(var l=c.parseCount_32(),h=0;h<l;++h){var n=f.MeasurementProperty.Face.parseBinary(c);
k.push(n)}n=[];if(a.hasBits1(4096))for(l=c.parseCount_32(),h=0;h<l;++h){var w=f.MeasurementProperty.Edge.parseBinary(c);n.push(w)}l=null;a.hasBits1(1048576)&&(l=f.PhysicalProperties.parseBinary(c));w=[];if(a.hasBits2(1)){var z=c.parseCount_32();for(h=0;h<z;h++){for(var y=[],x=c.parseCount_32(),A=0;A<x;A++){var B=f.Attribute.parseBinary(c);y.push(B)}w.push(new d.SubentityAttributes(y))}}z=[];if(a.hasBits2(2))for(a=c.parseCount_32(),h=0;h<a;h++){y=[];x=c.parseCount_32();for(A=0;A<x;A++)B=f.Attribute.parseBinary(c),
y.push(B);z.push(new d.SubentityAttributes(y))}return{nodeInfo:b,meshKey:e,bodyType:g,faceMeasurementProps:k,edgeMeasurementProps:n,physicalProps:l,faceAttributes:w,edgeAttributes:z}};g.reify=function(b,c,a,d){return new g(b,c,a,d)};g.createDynamic=function(b,a,d,e,k){var l=k.getInclusionContextForNodeId();a={nodeInfo:{nodeId:b.massageAuthoredUserId(l,a),bits:1073741824,name:d,localTransform:null,attributes:[],header:f.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,
userDatas:null},meshKey:null,bodyType:c.Unknown,faceMeasurementProps:[],edgeMeasurementProps:[],physicalProps:null,faceAttributes:[],edgeAttributes:[]};return new g(b,e,a,k)};g.prototype.setPhysicalProperties=function(b){this._physicalProps=b};g.prototype.getPhysicalProperties=function(){return void 0!==this._physicalProps?this._physicalProps:null};g.prototype.getParent=function(){return this._parent};g.prototype.getFaceCount=function(){return void 0!==this._faceMeasurementProps?this._faceMeasurementProps.length:
0};g.prototype.getEdgeCount=function(){return void 0!==this._edgeMeasurementProps?this._edgeMeasurementProps.length:0};g.prototype.getFaceAttributes=function(b){return a(this._faceAttributes,b)};g.prototype.getEdgeAttributes=function(b){return a(this._edgeAttributes,b)};g.prototype.getFaceMeasurementProperty=function(b){return a(this._faceMeasurementProps,b)};g.prototype.getEdgeMeasurementProperty=function(b){return a(this._edgeMeasurementProps,b)};g.prototype.setFaceMeasurementProperty=function(b,
c){this._faceMeasurementProps=e(this._faceMeasurementProps,b,c.copy())};g.prototype.setEdgeMeasurementProperty=function(b,c){this._edgeMeasurementProps=e(this._edgeMeasurementProps,b,c.copy())};g.prototype.getBodyType=function(){return this._bodyType};g.prototype.getRuntimeId=function(){return f.getRuntimeId(this._nodeId,this._parent.getInclusionContextForNodeId())};return g}(f.NodeMixin);f.RepresentationItem=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(c,b,a){this._type=c;this._title=b;this._value=a}a.parseBinary=function(c){var b=c.parseCString(),d=c.parseAttributeType();c=c.parseCString();return new a(d,b,c)};a.parseXml=function(c){console.assert("Attr"===c.localName);var b=d.AttributeType.Undefined,g="",e="",f=c.getAttribute("Name");if(null!==f&&(g=f,"__PRC_RESERVED_ATTRIBUTE_A3DF_ProductInformation"===g))return new a(b,g,e);f=c.getAttribute("Type");if(null!==f)switch(f){case "i":b=
d.AttributeType.Int;break;case "f":b=d.AttributeType.Float;break;case "t":b=d.AttributeType.Time;break;case "s":b=d.AttributeType.String}c=c.getAttribute("Value");null!==c&&(e=c);return new a(b,g,e)};a.prototype.getType=function(){return this._type};a.prototype.getTitle=function(){return this._title};a.prototype.getValue=function(){return this._value};a.prototype.copy=function(){return new a(this._type,this._title.slice(),this._value.slice())};return a}();f.Attribute=a})(h.Tree||(h.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(c){this._colorTable=[];this._colorTable=c.slice()}a.parseXml=function(c){console.assert("ColorTable"===c.localName);var b=[];c=c.getAttribute("data");if(null!==c){c=c.split(" ");console.assert(0===c.length%3);for(var g=0;g<c.length;g+=3){var e=parseFloat(c[g]),f=parseFloat(c[g+1]),h=parseFloat(c[g+2]);e=new d.Color(e,f,h);b.push(e)}}return new a(b)};a.prototype.getColor=function(c){if(0<=c&&0===c%3&&(c/=3,c<this._colorTable.length))return this._colorTable[c];
console.assert(!1);return null};return a}();f.ColorTable=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(f){var a=function(){function b(){this.isInclusive=!1;this.ids=[]}b.parseBinary=function(c){var a=new b;a.isInclusive=c.parseBoolean();for(var d=c.parseCount_32(),g=0;g<d;g++)a.ids.push(c.parseNodeId());return a};b.parseXml=function(c){var a=new b;a.isInclusive="1"===c.getAttribute("Inclusive");var d=f.XmlParser.parseNodeIds(c,"Ids");null!==d?(a.ids=d,c=c.getAttribute("Count"),null!==c&&(c=parseInt(c,10),console.assert(c===a.ids.length))):console.error("'Entities' tag has missing or malformed 'Ids' attribute");
return a};return b}();f.FilterEntities=a;var e=function(){function b(){this.isInclusive=!1;this.ids=[]}b.parseBinary=function(c){var a=new b;a.isInclusive=c.parseBoolean();for(var d=c.parseCount_32(),g=0;g<d;g++)a.ids.push(c.parseLayerId());return a};b.parseXml=function(c){var a=new b;a.isInclusive="1"===c.getAttribute("Inclusive");var d=f.XmlParser.parseUints(c,"Ids");null!==d?(a.ids=d,c=c.getAttribute("Count"),null!==c&&(c=parseInt(c,10),console.assert(c===a.ids.length))):console.error("'Layers' tag has missing or malformed 'Ids' attribute");
return a};return b}();f.FilterLayers=e;var c=function(){function b(){this.isDisplayfilter=!1;this.name=null;this.isActive=!1;this.entities=this.layers=null}b.parseBinary=function(c){var g=new b,f=null,h=null,m=c.parseLayerParseBits();g.isDisplayfilter=c.parseBoolean();d.hasBits(m,1)&&(g.name=c.parseCString());g.isActive=c.parseBoolean();d.hasBits(m,2)&&(f=e.parseBinary(c));d.hasBits(m,4)&&(h=a.parseBinary(c));g.layers=f;g.entities=h;return g};b.parseXml=function(c){var d=new b,g=c.getAttribute("Name");
null!==g&&(d.name=g);d.isDisplayfilter="1"===c.getAttribute("Display");d.isActive="1"===c.getAttribute("Active");for(g=c.firstElementChild;null!==g;g=g.nextElementSibling)"Layers"===g.localName?(console.assert(null===d.layers),d.layers=e.parseXml(g)):"Entities"===g.localName?(console.assert(null===d.entities),d.entities=a.parseXml(g)):console.error("Unknown tag: "+c.localName);return d};return b}();f.Filter=c})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(f){var a=function(){function a(c,b,a,d){this.id=c;this.name=b;this.nodes=a;this.treeNodes=d}a.parseBinary=function(c){var b=c.parseLayerParseBits(),a=c.parseLayerId(),e=null;d.hasBits(b,1)&&(e=c.parseCString());return{id:a,name:e}};a.parseXml=function(c){var b=c.getAttribute("Name");c=f.XmlParser.parseUint(c,"Id");return null===c?(console.error("'Layer' tag missing 'Id' attribute"),null):{id:c,name:b}};return a}();f.Layer=a})(d.Tree||(d.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(c,b,a,d,e,f,h,p,r){this._ambientAlpha=c;this._diffuseAlpha=b;this._emissiveAlpha=a;this._specularAlpha=d;this._shininess=e;null!==f&&(this._ambientIndex=f);null!==h&&(this._diffuseIndex=h);null!==p&&(this._emissiveIndex=p);null!==r&&(this._specularIndex=r)}a.parseXml=function(c){console.assert("MaterialTable"===c.localName);var b=f.XmlParser.parseFloat(c,"AmbientAlpha")||0,d=f.XmlParser.parseFloat(c,"DiffuseAlpha")||0,e=f.XmlParser.parseFloat(c,
"EmissiveAlpha")||0,l=f.XmlParser.parseFloat(c,"SpecularAlpha")||0,h=f.XmlParser.parseFloat(c,"Shininess")||0,m=f.XmlParser.parseUint(c,"AmbientIndice"),p=f.XmlParser.parseUint(c,"DiffuseIndice"),r=f.XmlParser.parseUint(c,"EmissiveIndice");c=f.XmlParser.parseUint(c,"SpecularIndice");return new a(b,d,e,l,h,m,p,r,c)};a.prototype.getAmbientColorIndex=function(){return void 0!==this._ambientIndex?this._ambientIndex:null};a.prototype.getDiffuseColorIndex=function(){return void 0!==this._diffuseIndex?this._diffuseIndex:
null};a.prototype.getEmissiveColorIndex=function(){return void 0!==this._emissiveIndex?this._emissiveIndex:null};a.prototype.getSpecularColorIndex=function(){return void 0!==this._specularIndex?this._specularIndex:null};a.prototype.getAmbientAlpha=function(){return this._ambientAlpha};a.prototype.getDiffuseAlpha=function(){return this._diffuseAlpha};a.prototype.getEmissiveAlpha=function(){return this._emissiveAlpha};a.prototype.getSpecularAlpha=function(){return this._specularAlpha};a.prototype.getShininess=
function(){return this._shininess};return a}();f.Material=a;a=function(){function a(c,b){null!==c&&(this._color=c);null!==b&&(this._alpha=b)}a.parseXml=function(c){console.assert("Material"===c.localName);var b=null,g=null;c=c.getAttribute("Color");if(null!==c){var e=c.split(" ");if(4!==e.length)throw new d.XmlParseError('Expected "Color" attribute to have four channel components.');b=parseFloat(e[0]);g=parseFloat(e[1]);c=parseFloat(e[2]);e=parseFloat(e[3]);b=new d.Color(b,g,c);g=e}return new a(b,
g)};a.prototype.getColor=function(){return void 0!==this._color?this._color:null};a.prototype.getAlpha=function(){return void 0!==this._alpha?this._alpha:null};return a}();f.SimpleMaterial=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b,a){this.surfaceArea=c;this.volume=b;this.centerOfGravity=a}a.parseBinary=function(c){var b=c.parseFloat_64(),d=c.parseFloat_64();c=c.parsePoint3_64();return new a(b,d,c)};return a}();d.PhysicalProperties=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b,a,d){this._inclusionKey=c;this._bodyInstanceKey=b;this._topoItemType=a;this._itemIndex=d}a.parseBinary=function(c){var b=c.parseInstanceKey(),a=c.parsePmiTopoRef();c=c.parseIndex_32();return{bodyInstanceKey:b,topoItemType:a,itemIndex:c}};a.reify=function(c,b){c=c.getInclusionKey();return new a(c,b.bodyInstanceKey,b.topoItemType,b.itemIndex)};a.fromBodyInstance=function(c,b,d){c=c.getInstanceInc();return new a(c[0],c[1],b,d)};a.prototype.getBodyInstanceInc=
function(){return[this._inclusionKey,this._bodyInstanceKey]};a.prototype.getTopoItemType=function(){return this._topoItemType};a.prototype.getItemIndex=function(){return this._itemIndex};return a}();d.ReferenceOnTopology=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b){console.assert(null!==c||null!==b);this._materialIndex=c;this._colorIndex=b}a.parseXml=function(c){console.assert("Style"===c.localName);var b=d.XmlParser.parseUint(c,"MaterialIndex");c=d.XmlParser.parseUint(c,"ColorIndex");return new a(b,c)};a.prototype.getMaterialIndex=function(){return this._materialIndex};a.prototype.getColorIndex=function(){return this._colorIndex};return a}();d.Style=a})(d.Tree||(d.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(){}a.parseBinary=function(c){for(var b=new d.Matrix,a=0;4>a;++a)for(var e=0;3>e;++e)b.m[4*a+e]=c.parseFloat_32();return b};a.parseXml=function(c){console.assert("Transformation"===c.localName);var b=new d.Matrix;c=c.getAttribute("RelativeTransfo");if(null!==c){c=c.split(" ");console.assert(16===c.length);for(var a=0;16>a;++a){var e=parseFloat(c[a]);console.assert(!isNaN(e));b.m[a]=e}}return b};return a}();f.Transform=a})(h.Tree||(h.Tree=
{}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){function a(b){b.markLoaded();var c=0;for(b=b.getRepresentationItems();c<b.length;c++)b[c].markLoaded()}function e(b){b=b.getRawPartDefinition();if(null!==b){if(b instanceof h.LazyPromise)return b.isResolved()?void 0:b.then(a);d.Util.TypeAssert(b);return b.then(function(b){if(null!==b&&(b=b.value,!b.isResolved()))return b.then(a)})}}function c(b){var c=f.forcePrototype(b);return void 0!==c?c.then(function(){return e(b)}):e(b)}f.forcePartDefinition=c;f.forcePartDefinitions=
function(b){return __awaiter(this,void 0,void 0,function(){var a,e;return __generator(this,function(g){switch(g.label){case 0:return a=[],e={enterProductOccurrence:function(b){b=c(b);void 0!==b&&a.push(b)}},[4,f.WalkerAsync.walk(e,b,f.WalkRestriction.None)];case 1:return g.sent(),[2,d.Util.waitForAll(a)]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){function a(c){c=c.getPrototype();if(null!==c){var b=c.getProductOccurrence();return(b.isResolved()?e(b.getResolved()):b.then(e)).then(function(){console.assert(b.isResolved());b.getResolved().markLoaded()})}}function e(c){return __awaiter(this,void 0,void 0,function(){var b,g;return __generator(this,function(e){switch(e.label){case 0:return b=[],g={enterProductOccurrence:function(c){c=a(c);void 0!==c&&b.push(c)}},[4,f.WalkerAsync.walk(g,c,f.WalkRestriction.None)];
case 1:return e.sent(),[2,d.Util.waitForAll(b)]}})})}f.forcePrototype=a;f.forcePrototypes=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){function a(c,b,a,e,l,n){var g=[];return(c=c.walk({enterAnyBody:function(b){if(!l.has(b)){l.add(b);if(b instanceof f.BodyInstance){if(!h.hasBits(a,1)||b.isOutOfHierarchy()&&!e)return}else if(b instanceof f.PmiBody){if(!h.hasBits(a,2))return}else if(d.Util.TypeAssert(b),!h.hasBits(a,4))return;b=b.getInstanceInc();g.push(b[0],b[1])}}},b,n))?c.then(function(){return g}):g}function e(c,b,d,e,l){return a(f.WalkerSync,c,b,d,e,l)}f.gatherInstanceIncs=function(c,b,d,
e){return a(f.WalkerAsync,c,b,d,e,f.WalkRestriction.None)};f.gatherInstanceIncsSync=e;f.gatherInstanceIncsByNodeIdsSync=function(c,b,a,k){for(var g=null,h=new Set,m=0;m<b.length;m++){var p=b[m],r=c.lookupAnyTreeNode(p);if(null===r)throw new d.InvalidNodeIdError(p);p=f.isOutOfHierarchy(r);p=e(r,a,p,h,k);if(null===g)g=p;else for(r=0;r<p.length;r++)g.push(p[r])}return null!==g?g:[]}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.gatherParentsOfPendingExternalModels=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(g){switch(g.label){case 0:return e=[],c=function(b){b.hasPendingExternalModels()&&e.push(b)},b={enterProductOccurrence:c},[4,d.WalkerAsync.walk(b,a,d.WalkRestriction.None)];case 1:return g.sent(),[2,e]}})})}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){f.getBoundingByNodeId=function(a,e,c,b,g,k){return __awaiter(this,void 0,void 0,function(){var l;return __generator(this,function(h){l=f.gatherInstanceIncsByNodeIdsSync(a,c,b,f.WalkRestriction.None);if(0===l.length)throw new d.CommunicatorError("Cannot get the bounding of node without geometry.");return[2,e.getPartsBounding(l,g,k)]})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.getNodeColorMap=function(a,e,c){return __awaiter(this,void 0,void 0,function(){var b,g,f,l,h,m,p,r,q,u;return __generator(this,function(k){switch(k.label){case 0:return b=[],g=[],f={enterAnyBody:function(c){c instanceof d.BodyInstance&&(b.push(c),c=c.getInstanceInc(),g.push(c[0],c[1]))}},[4,d.WalkerAsync.walk(f,a,d.WalkRestriction.None)];case 1:return k.sent(),l=new Map,[4,e.getPartColor(g,c)];case 2:h=k.sent();m=h.length;console.assert(m===b.length);for(p=
0;p<m;++p)r=h[p],null!==r&&(q=b[p],u=q.getParent().getRuntimeId(),l.set(u,r));return[2,l]}})})}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){f.getVisibilityState=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,g;return __generator(this,function(k){switch(k.label){case 0:return e=new Set,c=new Set,b={enterAnyBody:function(b){if(b instanceof f.BodyInstance){var a=b.getParent().getRuntimeId();b.isVisible()?(e.add(a),c.delete(a)):e.has(a)||c.add(a)}}},[4,f.WalkerAsync.walk(b,a,f.WalkRestriction.None)];case 1:return k.sent(),g=e.size>=c.size,[2,new d.VisibilityState(g,g?c:e)]}})})}})(h.Tree||
(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){function a(a,c){var b=function(b){c.push(b)};return f.WalkerAsync.walk({enterProductOccurrence:b,enterAnyBody:b,enterCadView:b,enterPmi:b,enterPartDefinition:b,enterRepresentationItem:b},a,f.WalkRestriction.None)}f.markContextsLoaded=function(e){return __awaiter(this,void 0,void 0,function(){var c,b,g,f,l,h,m,p,r;return __generator(this,function(k){switch(k.label){case 0:c=[];b=[];g=0;for(f=e;g<f.length;g++)l=f[g],h=a(l,b),c.push(h);return[4,d.Util.waitForAll(c)];
case 1:k.sent();m=0;for(p=b;m<p.length;m++)r=p[m],r.markLoaded();return[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.resetTransforms=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b;return __generator(this,function(g){switch(g.label){case 0:return e=!1,c=function(b){b.hasLocalTransformOverride()&&(b.removeLocalTransformOverride(),e=!0)},b={enterProductOccurrence:c,enterPmi:c,enterCadView:c,enterAnyBody:function(b){b.preventFromResetting()||c(b)}},[4,d.WalkerAsync.walk(b,a,d.WalkRestriction.None)];case 1:return g.sent(),[2,e]}})})}})(d.Tree||(d.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.setMeshLevels=function(a,e,c){var b=[],g=new Set,f=function(b){if(g.has(b))return!1;g.add(b);return!0};f={followProductOccurrence:f,followPmi:f,followCadView:f,followAnyBody:f,enterAnyBody:function(c){c.isOutOfHierarchy()||(c=c.getInstanceInc(),b.push(c[0],c[1]))}};for(var l=0;l<e.length;l++)d.WalkerSync.walk(f,e[l],d.WalkRestriction.None);a.setMeshLevel(b,c)}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){f.updateScMatrices=function(a,e,c,b){return __awaiter(this,void 0,void 0,function(){var g,k,l,n,m,p,r,q,u,t,v,w,z=this;return __generator(this,function(y){switch(y.label){case 0:g=[];k=[];l=[];n=new Set;m=function(b){if(n.has(b))return!1;n.add(b);b=b.getLocalTransform();if(null!==b){var c=h.last(g);c=d.Matrix.multiply(b,c);g.push(c)}return!0};p=function(b){null!==b.getLocalTransform()&&(console.assert(1<g.length),g.pop())};r={followProductOccurrence:m,leaveProductOccurrence:p,
followPmi:m,leavePmi:p,followCadView:m,leaveCadView:p,followAnyBody:m,enterAnyBody:function(c){if(!c.isOutOfHierarchy()||b)c=c.getInstanceInc(),l.push(c[0],c[1]),k.push(h.last(g))},leaveAnyBody:p};q=new h.PromiseQueue(1,!0);u=function(b){var c=h.Lazy.create(function(){return __awaiter(z,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return console.assert(0===g.length),c=f.getNetMatrix(b.getParent()),g.push(c),[4,f.WalkerAsync.walk(r,b,f.WalkRestriction.None)];
case 1:return a.sent(),console.assert(1===g.length),g.pop(),[2]}})})});q.push(c)};t=0;for(v=c;t<v.length;t++)w=v[t],u(w);return[4,q.waitForIdle()];case 1:return y.sent(),console.assert(2*k.length===l.length),[4,a.setMatrices(l,k)];case 2:return y.sent(),e.trigger("_updateTransform",b),[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(f){function a(b){for(var c=[],a=0;a<b.length;a++){var d=b[a].getInstanceInc();c.push(d[0],d[1])}return c}function e(b){for(var c=[],a=0;a<b.length;a++){var d=b[a].getRuntimeId();c.push(d)}return c}function c(b,c,k,l,h,m,p,r,q){return __awaiter(this,void 0,void 0,function(){var g,n,v,w,z,y,x,A,B,D,C,E,F,G;return __generator(this,function(u){switch(u.label){case 0:if(l instanceof f.AttachContext)switch(console.assert(0===h.size),console.assert(null===k),console.assert(null===
q),console.assert(null!==m),g=function(b){l.getChildren().forEach(function(c){h.set(c,b)})},m){case 0:console.assert(!0===r);g(!1);break;case 1:g(!0);break;case 2:console.assert(p),console.assert(!0===r)}else console.assert(null===m);null!==q&&console.assert(q.isAConfigurationNode());n=0;null===r&&(r=b.getInitiallyHiddenStayHidden());v=[];w=[];z=[];y=function(b){var c=x(b,!1);null!==c&&b.setVisibility(c)};x=function(b,c){var a=h.get(b);void 0!==a?z.push(a):0<z.length&&z.push(d.last(z));if(f.isOutOfHierarchy(b))return null;
if(null!==q&&0===n)return!1;if(void 0!==a)return a;a=b.isVisible();var g=b.isInitiallyShown();if(0<z.length){if(c=d.last(z),c!==a)return c&&!g&&r?b instanceof f.PmiBody&&(b=b.getParent(),!0===h.get(b))?!0:null:c}else if(p&&a!==g&&!c)return g;return null};A=function(b){0<z.length&&z.pop()};B={enterProductOccurrence:function(b){(q===b||0<n)&&++n;y(b)},leaveProductOccurrence:function(b){A(b);0<n&&--n},enterPmi:y,leavePmi:A,enterCadView:y,leaveCadView:A,enterAnyBody:function(b){var c=b.preventFromResetting();
c=x(b,c);null!==c&&(b.setVisibility(c),c?v.push(b):w.push(b))},leaveAnyBody:A};return[4,f.WalkerAsync.walk(B,l,f.WalkRestriction.None)];case 1:return u.sent(),console.assert(0===z.length),null===m?(D=a(v),C=a(w),c.pauseRendering(),c.setPartVisibility(D,!0,!0),c.setPartVisibility(C,!1,!0),c.resumeRendering(),null!==k&&(E=e(v),F=e(w),k.trigger("visibilityChanged",E,F))):(G=l.getAttachScope(),console.assert(0!==G),c.setVisibilityByAttachment(G,m)),[2]}})})}f.updateVisibilitiesByAttachment=function(b,
a,d,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,c(b,a,null,d,new Map,e,2===e,1!==e,null)]})})};f.updateVisibilities=function(b,a,d,e,f,h,p,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,c(b,a,d,e,f,null,h,p,r)]})})};f.synchronizePmiVisibilities=function(b,c){return __awaiter(this,void 0,void 0,function(){var d,g,e,h,p;return __generator(this,function(k){switch(k.label){case 0:return d=[],g=[],e={enterAnyBody:function(b){if(b instanceof
f.PmiBody||b instanceof f.ViewFrame){var c=b.isVisible();b.setVisibility(c);c?d.push(b):g.push(b)}}},[4,f.WalkerAsync.walk(e,c,f.WalkRestriction.None)];case 1:return k.sent(),h=a(d),p=a(g),b.pauseRendering(),b.synchronizeVisibilities(h,!0),b.synchronizeVisibilities(p,!1),b.resumeRendering(),[2]}})})}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(c,b){this._visitor=new f.TotalVisitor(c,b)}a.walk=function(c,b,d){if(d===f.WalkRestriction.LoadedNodesOnly&&!b.isLoaded())return Promise.resolve();var g=new a(c,d);if(b instanceof f.NodeMixin)return g._walkAnyTreeNode(b);var e=new h.ActionQueue(1,!1);c=function(b){e.push(function(){return g._walkAnyTreeNode(b)})};d=0;for(b=b.getChildren();d<b.length;d++)c(b[d]);return e.waitForIdle()};a.forceLazyPromises=function(c){return this.walk({},
c,f.WalkRestriction.None)};a.prototype._walkAnyTreeNode=function(c){c instanceof f.ProductOccurrence?c=this._walkProductOccurrence(c):c instanceof f.Pmi?c=this._walkPmi(c):c instanceof f.CadView?c=this._walkCadView(c):(d.Util.TypeAssert(c),c=this._walkAnyBody(c));return void 0===c?Promise.resolve():c};a.prototype._walkRepresentationItem=function(c){this._visitor.followRepresentationItem(c)&&(this._visitor.enterRepresentationItem(c),this._visitor.leaveRepresentationItem(c))};a.prototype._walkPartDefinition=
function(c){if(this._visitor.followPartDefinition(c)){this._visitor.enterPartDefinition(c);for(var b=0,a=c.getRepresentationItems();b<a.length;b++)this._walkRepresentationItem(a[b]);this._visitor.leavePartDefinition(c)}};a.prototype._walkAnyBody=function(c){this._visitor.followAnyBody(c)&&(this._visitor.enterAnyBody(c),this._visitor.leaveAnyBody(c))};a.prototype._walkPmi=function(c){if(this._visitor.followPmi(c)){this._visitor.enterPmi(c);for(var b=0,a=c.getPmiBodies();b<a.length;b++)this._walkAnyBody(a[b]);
this._visitor.leavePmi(c)}};a.prototype._walkCadView=function(c){if(this._visitor.followCadView(c)){this._visitor.enterCadView(c);var b=c.getViewFrame();null!==b&&this._walkAnyBody(b);this._visitor.leaveCadView(c)}};a.prototype._walkProductOccurrence=function(c){var b=this,a=new h.ActionQueue(1,!1);if(this._visitor.followProductOccurrence(c)){this._visitor.enterProductOccurrence(c);var e=c.getRawPartDefinition();null!==e&&(e instanceof h.LazyPromise?a.push(function(){if(e.isResolved())return b._walkPartDefinition(e.getResolved())}):
(d.Util.TypeAssert(e),a.push(function(){return e.then(function(c){return null!==c&&(c=c.value,c.isResolved())?b._walkPartDefinition(c.getResolved()):Promise.resolve()})})));var f=c.tryGetChildrenSync();if(null!==f)for(var n=function(c){a.push(function(){return b._walkProductOccurrence(c)})},m=0;m<f.length;m++)n(f[m]);else a.push(function(){return c.getChildren().then(function(c){if(0!==c.length){for(var a=new h.ActionQueue(1,!1),d=function(c){a.push(function(){return b._walkProductOccurrence(c)})},
g=0;g<c.length;g++)d(c[g]);if(!a.isIdle())return a.waitForIdle()}})});f=function(c){a.push(function(){return b._walkAnyBody(c)})};n=0;for(m=c.getBodyInstances();n<m.length;n++)f(m[n]);f=function(c){a.push(function(){return b._walkPmi(c)})};n=0;for(m=c.getPmis();n<m.length;n++)f(m[n]);f=function(c){a.push(function(){return b._walkCadView(c)})};n=0;for(m=c.getCadViews();n<m.length;n++)f(m[n]);a.push(function(){return b._visitor.leaveProductOccurrence(c)})}if(!a.isIdle())return a.waitForIdle()};return a}();
f.WalkerAsync=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){function a(b){return b.isLoaded()}function e(){return!0}var c;(function(b){b[b.None=0]="None";b[b.LoadedNodesOnly=1]="LoadedNodesOnly"})(c=f.WalkRestriction||(f.WalkRestriction={}));var b=function(){return function(b,f){this.followProductOccurrence=e;this.leaveProductOccurrence=this.enterProductOccurrence=h.nop;this.followPartDefinition=e;this.leavePartDefinition=this.enterPartDefinition=h.nop;this.followRepresentationItem=e;this.leaveRepresentationItem=this.enterRepresentationItem=
h.nop;this.followAnyBody=e;this.leaveAnyBody=this.enterAnyBody=h.nop;this.followCadView=e;this.leaveCadView=this.enterCadView=h.nop;this.followPmi=e;this.leavePmi=this.enterPmi=h.nop;f===c.LoadedNodesOnly?(console.assert(void 0===b.followProductOccurrence),console.assert(void 0===b.followAnyBody),console.assert(void 0===b.followCadView),console.assert(void 0===b.followPmi),this.followPmi=this.followCadView=this.followAnyBody=this.followProductOccurrence=a):d.Util.TypeAssert(f);void 0!==b.followProductOccurrence&&
(this.followProductOccurrence=b.followProductOccurrence);void 0!==b.enterProductOccurrence&&(this.enterProductOccurrence=b.enterProductOccurrence);void 0!==b.leaveProductOccurrence&&(this.leaveProductOccurrence=b.leaveProductOccurrence);void 0!==b.followPartDefinition&&(this.followPartDefinition=b.followPartDefinition);void 0!==b.enterPartDefinition&&(this.enterPartDefinition=b.enterPartDefinition);void 0!==b.leavePartDefinition&&(this.leavePartDefinition=b.leavePartDefinition);void 0!==b.followRepresentationItem&&
(this.followRepresentationItem=b.followRepresentationItem);void 0!==b.enterRepresentationItem&&(this.enterRepresentationItem=b.enterRepresentationItem);void 0!==b.leaveRepresentationItem&&(this.leaveRepresentationItem=b.leaveRepresentationItem);void 0!==b.followAnyBody&&(this.followAnyBody=b.followAnyBody);void 0!==b.enterAnyBody&&(this.enterAnyBody=b.enterAnyBody);void 0!==b.leaveAnyBody&&(this.leaveAnyBody=b.leaveAnyBody);void 0!==b.followCadView&&(this.followCadView=b.followCadView);void 0!==b.enterCadView&&
(this.enterCadView=b.enterCadView);void 0!==b.leaveCadView&&(this.leaveCadView=b.leaveCadView);void 0!==b.followPmi&&(this.followPmi=b.followPmi);void 0!==b.enterPmi&&(this.enterPmi=b.enterPmi);void 0!==b.leavePmi&&(this.leavePmi=b.leavePmi)}}();f.TotalVisitor=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(){function a(c,b){this._visitor=new d.TotalVisitor(c,b)}a.walk=function(c,b,g){if(g!==d.WalkRestriction.LoadedNodesOnly||b.isLoaded())return c=new a(c,g),b instanceof d.ProductOccurrence?c._walkProductOccurrence(b):b instanceof d.Pmi?c._walkPmi(b):b instanceof d.CadView?c._walkCadView(b):c._walkAnyBody(b)};a.prototype._walkRepresentationItem=function(c){console.assert(c.isLoaded());this._visitor.followRepresentationItem(c)&&(this._visitor.enterRepresentationItem(c),
this._visitor.leaveRepresentationItem(c))};a.prototype._walkPartDefinition=function(c){console.assert(c.isLoaded());if(this._visitor.followPartDefinition(c)){this._visitor.enterPartDefinition(c);for(var b=0,a=c.getRepresentationItems();b<a.length;b++)this._walkRepresentationItem(a[b]);this._visitor.leavePartDefinition(c)}};a.prototype._walkAnyBody=function(c){console.assert(c.isLoaded());this._visitor.followAnyBody(c)&&(this._visitor.enterAnyBody(c),this._visitor.leaveAnyBody(c))};a.prototype._walkPmi=
function(c){console.assert(c.isLoaded());if(this._visitor.followPmi(c)){this._visitor.enterPmi(c);for(var b=0,a=c.getPmiBodies();b<a.length;b++)this._walkAnyBody(a[b]);this._visitor.leavePmi(c)}};a.prototype._walkCadView=function(c){console.assert(c.isLoaded());if(this._visitor.followCadView(c)){this._visitor.enterCadView(c);var b=c.getViewFrame();null!==b&&this._walkAnyBody(b);this._visitor.leaveCadView(c)}};a.prototype._walkProductOccurrence=function(c){console.assert(c.isLoaded());if(this._visitor.followProductOccurrence(c)){this._visitor.enterProductOccurrence(c);
var b=c.getPartDefinitionSync();null!==b&&this._walkPartDefinition(b);b=0;for(var a=c.getChildrenSync();b<a.length;b++)this._walkProductOccurrence(a[b]);b=0;for(a=c.getBodyInstances();b<a.length;b++)this._walkAnyBody(a[b]);b=0;for(a=c.getPmis();b<a.length;b++)this._walkPmi(a[b]);b=0;for(a=c.getCadViews();b<a.length;b++)this._walkCadView(a[b]);this._visitor.leaveProductOccurrence(c)}};return a}();d.WalkerSync=a})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function a(){this.plane=new d.Plane;this.instanceNodeId=this.meshId=this.referenceGeometry=null;this.color=d.Color.createFromFloat(.65,.65,.65);this.lineColor=d.Color.black();this.opacity=.35;this.matrix=new d.Matrix}a.prototype.toJson=function(){return this._toJson()};a.prototype._toJson=function(){return{plane:{normal:this.plane.normal,d:this.plane.d},referenceGeometry:this.referenceGeometry}};a.prototype.forJson=function(){return this.toJson()};a.prototype.fromJson=
function(a){a=h.deepClone(a);var c=a.plane;this.plane=new d.Plane;var b=c.normal;this.plane.normal=new d.Point3(b.x,b.y,b.z);this.plane.d=c.d;a=a.referenceGeometry;if(Array.isArray(a))for(c=0;c<a.length;++c)a[c]=d.Point3.fromJson(a[c]);this.referenceGeometry=a};a.prototype.getMatrix=function(){return this.matrix.copy()};a.prototype.setMatrix=function(a){this.matrix=a.copy()};a.prototype.setReferenceGeometry=function(a){if(a){this.referenceGeometry=[];for(var c=0;c<a.length;c++)this.referenceGeometry.push(a[c].copy())}else this.referenceGeometry=
null};a.prototype.getReferenceGeometry=function(){if(this.referenceGeometry){for(var a=[],c=0,b=this.referenceGeometry;c<b.length;c++)a.push(b[c].copy());return a}return null};a.prototype.createMeshData=function(){var a=this.referenceGeometry;if(null===a)return null;var c=new d.MeshData,b=[],g=[];b.push(a[0].x,a[0].y,a[0].z);b.push(a[1].x,a[1].y,a[1].z);b.push(a[3].x,a[3].y,a[3].z);b.push(a[1].x,a[1].y,a[1].z);b.push(a[2].x,a[2].y,a[2].z);b.push(a[3].x,a[3].y,a[3].z);for(var f=d.Plane.createFromPoints(a[0],
a[1],a[2]).normal,l=0;6>l;l++)g.push(f.x,f.y,f.z);c.addFaces(b,g);c.addPolyline([a[0].x,a[0].y,a[0].z,a[1].x,a[1].y,a[1].z]);c.addPolyline([a[1].x,a[1].y,a[1].z,a[2].x,a[2].y,a[2].z]);c.addPolyline([a[2].x,a[2].y,a[2].z,a[3].x,a[3].y,a[3].z]);c.addPolyline([a[3].x,a[3].y,a[3].z,a[0].x,a[0].y,a[0].z]);return c};return a}();h.CuttingPlane=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(a,d,c,b,g){this._cuttingPlanes=[];this._isActive=!1;this._viewer=a;this._model=d;this._callbackManager=c;this._cuttingManager=b;this._engine=g}f.deprecated=function(a,d,c){var b=c.value;c.value=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];this._callbackManager.trigger("deprecated","CuttingSection",d);return b.apply(this,a)};return c};f.prototype.addPlane=function(a,e){void 0===e&&(e=null);return __awaiter(this,void 0,void 0,function(){var c,
b;return __generator(this,function(g){switch(g.label){case 0:c=this._engine.getCuttingSectionLimits();if(this._cuttingPlanes.length>=c.maxCuttingPlanesPerSection)return[2,!1];b=new d.Internal.CuttingPlane;b.plane=a.copy();b.setReferenceGeometry(e);this._cuttingPlanes.push(b);return this._isActive?[4,this._resetCuttingPlane(b)]:[2,!0];case 1:return g.sent(),[4,this._engine.updateCuttingSection(this)];case 2:return g.sent(),[2,!0]}})})};f.prototype.setPlane=function(a,d,c){void 0===c&&(c=null);return __awaiter(this,
void 0,void 0,function(){var b;return __generator(this,function(g){switch(g.label){case 0:b=this._cuttingPlanes[a];if(void 0===b)return[3,2];b.plane=d.copy();b.setReferenceGeometry(c);return this._isActive?[4,this._resetCuttingPlane(b)]:[3,2];case 1:return g.sent(),[2,this._engine.updateCuttingSection(this)];case 2:return[2]}})})};f.prototype.updatePlane=function(a,e,c,b,g){void 0===c&&(c=new d.Matrix);void 0===b&&(b=!1);void 0===g&&(g=!1);return __awaiter(this,void 0,void 0,function(){var f,l,h;
return __generator(this,function(k){switch(k.label){case 0:f=this._cuttingPlanes[a];if(void 0===f)return[3,3];f.plane=e.copy();if(!this._isActive)return[3,3];if(null===f.instanceNodeId)return[3,2];this._engine.pauseRendering();l=f.getMatrix();g&&(l=new d.Matrix);h=d.Matrix.multiply(l,c);b&&f.setMatrix(h);return[4,Promise.all([this._model.setNodeMatrix(f.instanceNodeId,h),this._engine.updateCuttingSection(this)])];case 1:return k.sent(),this._engine.resumeRendering(),[3,3];case 2:return[2,this._engine.updateCuttingSection(this)];
case 3:return[2]}})})};f.prototype.removePlane=function(a){var e=[],c=this._cuttingPlanes[a];void 0!==c&&(null!==c.meshId&&null!==c.instanceNodeId&&e.push(this._destroyMeshes([c.meshId],[c.instanceNodeId])),this._cuttingPlanes.splice(a,1));this._isActive&&e.push(this._engine.updateCuttingSection(this));return d.Util.waitForAll(e)};f.prototype.getPlane=function(a){a=this._cuttingPlanes[a];return void 0!==a?a.plane.copy():null};f.prototype.getNodeId=function(a){a=this._cuttingPlanes[a];return void 0!==
a?a.instanceNodeId:null};f.prototype.getReferenceGeometry=function(a){a=this._cuttingPlanes[a];return void 0!==a?a.getReferenceGeometry():null};f.prototype.getPlaneIndexByNodeId=function(a){for(var d=0;d<this._cuttingPlanes.length;d++)if(this._cuttingPlanes[d].instanceNodeId===a)return d;return null};f.prototype.setPlaneOpacity=function(a,d){a=this._cuttingPlanes[a];void 0!==a&&(a.opacity=d,null!==a.instanceNodeId&&this._model.setNodesOpacity([a.instanceNodeId],d))};f.prototype.setPlaneTransparency=
function(a,d){this.setPlaneOpacity(a,d);return Promise.resolve()};f.prototype.setItemTransparency=function(a,d){this.setPlaneOpacity(a,d);return Promise.resolve()};f.prototype.setColor=function(a){for(var d=[],c=0,b=this._cuttingPlanes;c<b.length;c++){var g=b[c];g.color.assign(a);null!==g.instanceNodeId&&d.push(g.instanceNodeId)}this._model.setNodesFaceColor(d,a);return Promise.resolve()};f.prototype.setOpacity=function(a){for(var d=[],c=0,b=this._cuttingPlanes;c<b.length;c++){var g=b[c];g.opacity=
a;null!==g.instanceNodeId&&d.push(g.instanceNodeId)}this._model.setNodesOpacity(d,a)};f.prototype.setTransparency=function(a){this.setOpacity(a);return Promise.resolve()};f.prototype.getCount=function(){return this._cuttingPlanes.length};f.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.deactivate()];case 1:return a.sent(),this._cuttingPlanes.length=0,[2]}})})};f.prototype.activate=function(){return __awaiter(this,
void 0,void 0,function(){var a,e,c,b,g;return __generator(this,function(f){switch(f.label){case 0:if(this._isActive)return[2];this._isActive=!0;if(!(0<this._cuttingPlanes.length))return[3,2];this._cuttingManager.hasActiveCuttingSection()||this._engine.setDefaultDepthRange(0,.9999995231628418);a=[];e=[];c=0;for(b=this._cuttingPlanes;c<b.length;c++)g=b[c],a.push(this._createCuttingPlaneGeometry(g).then(function(b){null!==b&&e.push(b)}));return[4,d.Util.waitForAll(a)];case 1:f.sent(),this._initCuttingPlanesByNodeId(e),
f.label=2;case 2:return[2,this._engine.addCuttingSection(this)]}})})};f.prototype.deactivate=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(e){return this._isActive?(this._isActive=!1,a=[],a.push(this._destroyGeometry()),a.push(this._engine.removeCuttingSection(this)),this._cuttingManager.hasActiveCuttingSection()||this._engine.setDefaultDepthRange(0,1),[2,d.Util.waitForAll(a)]):[2]})})};f.prototype.isActive=function(){return this._isActive};f.prototype.toJson=
function(){return this._toJson()};f.prototype._toJson=function(){for(var a=[],d=0;d<this._cuttingPlanes.length;d++)a[d]=this._cuttingPlanes[d].toJson();return{planes:a}};f.prototype.forJson=function(){return this.toJson()};f.prototype.fromJson=function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,g,f,l;return __generator(this,function(k){switch(k.label){case 0:return[4,this.clear()];case 1:k.sent();e=d.Internal.deepClone(a);c=e.planes;b=0;for(g=c;b<g.length;b++)f=g[b],l=new d.Internal.CuttingPlane,
l.fromJson(f),this._cuttingPlanes.push(l);return[2,this.activate()]}})})};f.prototype._initCuttingPlanesByNodeId=function(a){this._model.setInstanceModifier(d.InstanceModifier.DoNotCut,a,!0);this._model.setInstanceModifier(d.InstanceModifier.DoNotExplode,a,!0);this._cuttingManager.getStandinGeometryPickable()||this._model.setInstanceModifier(d.InstanceModifier.DoNotSelect,a,!0)};f.prototype._destroyGeometry=function(){for(var a=[],d=[],c=0,b=this._cuttingPlanes;c<b.length;c++){var g=b[c];null!==g.meshId&&
a.push(g.meshId);null!==g.instanceNodeId&&d.push(g.instanceNodeId);g.meshId=null;g.instanceNodeId=null}return this._destroyMeshes(a,d)};f.prototype._getInstanceNodeIds=function(){for(var a=[],d=0,c=this._cuttingPlanes;d<c.length;d++){var b=c[d].instanceNodeId;null!==b&&a.push(b)}return a};f.prototype._resetCuttingPlane=function(a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:if(null===a.meshId||null===a.instanceNodeId)return[3,2];
d=this._destroyMeshes([a.meshId],[a.instanceNodeId]);a.meshId=null;a.instanceNodeId=null;return[4,d];case 1:return c.sent(),[2,this._createInstanceGeometry(a)];case 2:if(null!==a.referenceGeometry)return[2,this._createInstanceGeometry(a)];c.label=3;case 3:return[2]}})})};f.prototype._createInstanceGeometry=function(a){return __awaiter(this,void 0,void 0,function(){var d,c;return __generator(this,function(b){switch(b.label){case 0:return d=[],[4,this._createCuttingPlaneGeometry(a)];case 1:return c=
b.sent(),null!==c&&d.push(c),this._initCuttingPlanesByNodeId(d),[2]}})})};f.prototype._destroyMeshes=function(a,e){return __awaiter(this,void 0,void 0,function(){var c,b,g,f;return __generator(this,function(k){switch(k.label){case 0:return c=[],c.push(this._model.deleteMeshInstances(e)),c.push(this._model.deleteMeshes(a)),[4,d.Util.waitForAll(c)];case 1:k.sent();b=0;for(g=e;b<g.length;b++)f=g[b],this._viewer.selectionManager._incrementalBlacklistedInstanceNodes.delete(f);return[2]}})})};f.prototype._createCuttingPlaneGeometry=
function(a){return __awaiter(this,void 0,void 0,function(){var e,c,b,g,f,l,h,m;return __generator(this,function(k){switch(k.label){case 0:e=a.createMeshData();if(null===e)return[2,null];e.setBackfacesEnabled(!0);return[4,this._model.createMesh(e)];case 1:return c=k.sent(),a.meshId=c,b=d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.DoNotXRay,g=a.plane.copy(),f=g.normal.copy().scale(-g.d),l=(new d.Matrix).setTranslationComponent(f.x,
f.y,f.z),a.setMatrix(l.copy()),h=new d.MeshInstanceData(c,l,null,a.color,null,null,b),h.setOpacity(a.opacity),h.setLineColor(a.lineColor),this._engine.pauseRendering(),[4,this._model.createMeshInstance(h,void 0,!0,!0)];case 2:return m=k.sent(),a.instanceNodeId=m,this._viewer.selectionManager._incrementalBlacklistedInstanceNodes.add(m),this._model.setDepthRange([m],4.76837158203125E-7,1),this._engine.resumeRendering(),[2,m]}})})};__decorate([f.deprecated],f.prototype,"setPlaneTransparency",null);__decorate([f.deprecated],
f.prototype,"setItemTransparency",null);__decorate([f.deprecated],f.prototype,"setTransparency",null);__decorate([f.deprecated],f.prototype,"forJson",null);return f}();d.CuttingSection=h})(Communicator||(Communicator={}));
(function(d){(function(d){function f(a,d){for(var c=0;c<d.length;c++)a.push(d[c])}d.emptyBytes=new Uint8Array(0);d.copyArray=function(a){return a.slice()};d.append=function(a,d){for(var c=0;c<d.length;c++)a.push(d[c])};d.last=function(a){console.assert(0<a.length);return a[a.length-1]};d.all=function(a){for(var d=0;d<a.length;d++)if(!a[d])return!1;return!0};d.chunkify=function(a,d){for(var c=[],b=0;b<a.length;b+=d)c.push(a.slice(b,b+d));return c};d.filterInPlace=function(a,d){for(var c=0,b=0;b<a.length;++b){var g=
a[b];d(g)&&(a[c++]=g)}a.length=c};d.mapInPlace=function(a,d){for(var c=0;c<a.length;++c)a[c]=d(a[c]);return a};d.concatInPlace=f;d.concatAll=function(a){for(var d=[],c=0;c<a.length;c++)f(d,a[c]);return d}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(){this._leftToRight=new Map;this._rightToLeft=new Map}a.prototype.set=function(a,c){this._leftToRight.set(a,c);this._rightToLeft.set(c,a)};a.prototype.getLeft=function(a){return this._rightToLeft.get(a)};a.prototype.getRight=function(a){return this._leftToRight.get(a)};return a}();d.Bimap=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(a){this.value=a}a.create=function(d){return new a(d)};return a}();d.Boxed=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(){this._stopTime=this._currentTime=0}a.prototype.stop=function(){this._stopTime=this._currentTime};a.prototype.isTicking=function(){this._refreshCurrentTime();return 0<this._remainingDuration()};a.prototype.tickFor=function(a){this._refreshCurrentTime();this._remainingDuration()>=a||(this._stopTime=this._currentTime+a)};a.prototype._remainingDuration=function(){return this._stopTime-this._currentTime};a.prototype._refreshCurrentTime=function(){this._currentTime=
Date.now()};return a}();d.Clock=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(a){this._planes=[];this._absPlanes=[];this._signs=[];this._distanceScale=[];for(var c=a.length,b=0;b<a.length;b++)this._planes.push(a[b].slice());for(a=0;a<c;++a)for(this._planes[a][3]=-this._planes[a][3],this._absPlanes[a]=d.cwiseAbs3(this._planes[a]),this._signs[a]=[0,0,0],b=0;3>b;++b)this._signs[a][b]=0<=this._planes[a][b]?1:-1;for(a=0;a<c;++a)b=d.squaredNorm3(this._planes[a]),this._distanceScale[a]=0===b?0:1/b}a.fromPlaneCoefficients=function(d){for(var c=
[],b=0;b<d.length;b++){var g=d[b];c.push([g.x,g.y,g.z,g.w])}return new a(c)};a.createFrustumFromMatrix=function(e){for(var c=[],b=0;3>b;++b)c[b]=d.sub4(d.col4(e,3),d.col4(e,b));for(b=0;3>b;++b)c[b+3]=d.add4(d.col4(e,3),d.col4(e,b));return new a(c)};a.prototype.testAxisAlignedBox=function(a,c){for(var b=this._planes.length,g=2,e=0;e<b;++e){var f=d.dot3(this._planes[e],a),h=d.dot3(this._absPlanes[e],c);if(f+h<=this._planes[e][3])return 0;f-h<this._planes[e][3]&&(g=1)}return g};a.prototype.axisAlignedBoxNotOutside=
function(a,c){for(var b=this._planes.length,g=0;g<b;++g)if(d.dot3(this._planes[g],d.add3(a,d.cwiseProduct3(c,this._signs[g])))<=this._planes[g][3])return!1;return!0};a.prototype.sphereNotOutside=function(a,c){for(var b=this._planes.length,g=0;g<b;++g){var e=d.dot3(this._planes[g],a)-this._planes[g][3];if(0>e&&e*e*this._distanceScale[g]>=c)return!1}return!0};a.prototype.sphereFullyInside=function(a,c){for(var b=this._planes.length,g=0;g<b;++g){var e=d.dot3(this._planes[g],a)-this._planes[g][3];if(0>
e||e*e*this._distanceScale[g]<c)return!1}return!0};a.prototype.pointInside=function(a){for(var c=this._planes.length,b=0;b<c;++b)if(0>d.dot3(this._planes[b],a)-this._planes[b][3])return!1;return!0};return a}();d.ConvexVolume=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){d.nop=function(){};d.identity=function(d){return d}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function f(a,e){return new Promise(function(c,b){var g=new XMLHttpRequest;g.open("GET",a,!0);e&&(g.responseType=e);g.onload=function(e){4===g.readyState&&(200===g.status?c(g):(e=new d.LoadError('XMLHttpRequest failed to GET "'+a+'" with status '+g.status+"."),b(e)))};g.onerror=function(a){b(a)};g.send()})}h.httpRequest=f;h.httpRequestBuffer=function(a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:return[4,
f(a,"arraybuffer")];case 1:return d=c.sent(),[2,new Uint8Array(d.response)]}})})}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){d.copyMap=function(d){var a=new Map;d.forEach(function(d,c){a.set(c,d)});return a};d.copySet=function(d){var a=new Set;d.forEach(function(d){a.add(d)});return a};d.toSet=function(d){for(var a=new Set,e=0;e<d.length;e++)a.add(d[e]);return a}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(a){this._deferredValue=a}a.create=function(d){return new a(d)};a.prototype.get=function(){null!==this._deferredValue&&(this._resolvedValue=this._deferredValue(),this._deferredValue=null);return this._resolvedValue};return a}();d.Lazy=f})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.Lazy=d.Util.Lazy;var f=function(){function a(a){this._value=a}a.create=function(c){return new a(c)};a.prototype.get=function(){"function"===typeof this._value&&(this._value=this._value());return this._value};return a}();h.LazyObject=f;var a=function(){function a(a){"function"===typeof a&&(a=f.create(a));a instanceof Promise&&(a=this._rectifyResult(a));this._value=a}a.create=function(c){return new a(c)};a.prototype.isUnforced=function(){return this._value instanceof f};
a.prototype.isResolved=function(){return!(this._value instanceof f)&&!(this._value instanceof Promise)};a.prototype.getResolved=function(){console.assert(this.isResolved());return this._value};a.prototype.then=function(a,b){this._value instanceof f&&(this._value=this._rectifyResult(this._value.get()));if(this._value instanceof Promise)return this._value.then(a,b);d.Util.TypeAssert(this._value);return Promise.resolve(this._value).then(a,b)};a.prototype._rectifyResult=function(a){var b=this;return a instanceof
Promise?a.then(function(a){return b._value=a}):a};return a}();h.LazyPromise=a})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){d.fromIntegerMap=function(d){if(d instanceof Map)return d;for(var a=new Map,e=0,c=Object.keys(d);e<c.length;e++){var b=c[e],g=d[b];a.set(parseInt(b,10),g)}return a};d.fromRealNumberMap=function(d){if(d instanceof Map)return d;for(var a=new Map,e=0,c=Object.keys(d);e<c.length;e++){var b=c[e];a.set(Number(b),d[b])}return a};d.fromStringMap=function(d){if(d instanceof Map)return d;for(var a=new Map,e=0,c=Object.keys(d);e<c.length;e++){var b=c[e];a.set(b,d[b])}return a}})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(h){h.Todo=function(){for(var f=0;f<arguments.length;f++);throw new d.InternalLogicError;}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(h){h.TypeAssert=function(d){};h.TypeAssertNever=function(f){throw new d.InternalLogicError;}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){d=d.Internal||(d.Internal={});d=d.CompileTime||(d.CompileTime={});d.enable=!0;d.disable=!1})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(a){this._heap=[];this._comparator=a}a.prototype.clear=function(){this._heap.length=0};Object.defineProperty(a.prototype,"length",{get:function(){return this._heap.length},enumerable:!0,configurable:!0});a.prototype.peek=function(){return this._heap[0]};a.prototype.push=function(a){this._heap.push(a);this._siftUp()};a.prototype.pop=function(){var a=this.peek(),c=this.length-1;0<c&&this._swap(0,c);this._heap.pop();this._siftDown();return a};a.prototype.replace=
function(a){var c=this.peek();this._heap[0]=a;this._siftDown();return c};a.prototype._greater=function(a,c){return this._comparator(this._heap[a],this._heap[c])};a.prototype._swap=function(a,c){var b=[this._heap[c],this._heap[a]];this._heap[a]=b[0];this._heap[c]=b[1]};a.prototype._siftUp=function(){for(var a=this.length-1;0<a&&this._greater(a,(a+1>>>1)-1);)this._swap(a,(a+1>>>1)-1),a=(a+1>>>1)-1};a.prototype._siftDown=function(){for(var a=0;(a<<1)+1<this.length&&this._greater((a<<1)+1,a)||a+1<<1<
this.length&&this._greater(a+1<<1,a);){var c=a+1<<1<this.length&&this._greater(a+1<<1,(a<<1)+1)?a+1<<1:(a<<1)+1;this._swap(a,c);a=c}};return a}();d.PriorityQueue=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){d.waitForAll=function(d){return Promise.all(d)}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){return function(){this.items=[];this.next=null}}(),a=function(){function a(){this.clear()}a.prototype.clear=function(){this._tail=this._head=new f;this._size=0};Object.defineProperty(a.prototype,"length",{get:function(){return this._size},enumerable:!0,configurable:!0});a.prototype.push=function(a){++this._size;if(1024===this._tail.items.length){var b=new f;this._tail=this._tail.next=b}this._tail.items.push(a)};a.prototype.pop=function(){console.assert(0<
this._size);console.assert(0<this._head.items.length);--this._size;var a=this._head.items.shift();if(0===this._head.items.length){var b=this._head.next;null===b?console.assert(this._head===this._tail):this._head=b}return a};return a}();d.Queue=a})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){var f=function(){return function(a,d){this.value=a;this.kids=d.slice()}}();d.RoseTree=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function f(a){var d=[];a.forEach(function(a){d.push(a)});return d}h.setToArray=f;h.setSubtraction=function(a,e){a=f(a).filter(function(a){return!e.has(a)});return d.Internal.toSet(a)}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){d.utf8ArrayToStr=function(a){if("undefined"!==typeof window&&8192>a.length&&"escape"in window){var b=void 0;try{var c=String.fromCharCode.apply(null,a),d=window.escape(c);b=decodeURIComponent(d)}catch(p){b=""}return b}b="";d=a.length;for(c=0;c<d;){var e=a[c++];switch(e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(e);break;case 12:case 13:var f=a[c++];b+=String.fromCharCode((e&31)<<6|f&63);break;case 14:f=a[c++];var h=a[c++];b+=String.fromCharCode((e&
15)<<12|(f&63)<<6|(h&63)<<0)}}return b};var f=/^\d+$/;d.isBase10Number=function(a){return f.test(a)};var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz`~!@#$%^&*()_+-=[]{};:'\",.<>\\|/?".split("");d.compressUint=function(c){console.assert(0<=c);if(0===c)return a[0];for(var b=[];0!==c;){var d=Math.floor(c/a.length);b.push(a[c%a.length]);c=d}return b.join("")};var e="0000000 000000 00000 0000 000 00 0 ".split(" ");d.zeroPadHex32=function(a){a=a.toString(16);return e[a.length-1]+a}})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){(function(d){d.isEmpty=function(a){return null===a||void 0===a};d.toArray=function(a){return Array.isArray(a)?a.slice():null===a||void 0===a?[]:[a]};d.fromArray=function(a){return 0===a.length?null:1===a.length?a[0]:a};d.push=function(a,d){return a?Array.isArray(a)?(a.push(d),a):[a,d]:d}})(d.TerseArray||(d.TerseArray={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function a(){this._afterActionIdlePromise=this._beforeActionIdlePromise=this._action=this._timerId=null}a.prototype.isIdle=function(a){if(0===a)return null===this._timerId;d.Util.TypeAssert(a);return null===this._action};a.prototype.waitForIdle=function(a){if(0===a){if(null===this._timerId)return Promise.resolve();null===this._beforeActionIdlePromise&&(this._beforeActionIdlePromise=h.OpenPromise.create());return this._beforeActionIdlePromise}d.Util.TypeAssert(a);
if(null===this._action)return Promise.resolve();null===this._afterActionIdlePromise&&(this._afterActionIdlePromise=h.OpenPromise.create());return this._afterActionIdlePromise};a.prototype._triggerIdlePromise=function(a){0===a?null!==this._beforeActionIdlePromise&&(this._beforeActionIdlePromise.resolve(),this._beforeActionIdlePromise=null):(d.Util.TypeAssert(a),null!==this._afterActionIdlePromise&&(this._afterActionIdlePromise.resolve(),this._afterActionIdlePromise=null))};a.prototype._clearTimeout=
function(){null!==this._timerId&&(clearTimeout(this._timerId),this._timerId=null)};a.prototype.clear=function(){this._clearTimeout();this._triggerIdlePromise(0);this._action=null;this._triggerIdlePromise(1)};a.prototype.set=function(a,c){var b=this;this._clearTimeout();this._action=c;this._timerId=setTimeout(function(){b._timerId=null;b._triggerIdlePromise(0);var a=b._afterActionIdlePromise;b._afterActionIdlePromise=null;b._action();null===b._timerId&&(b._action=null);null!==a&&a.resolve()},a)};return a}();
h.Timer=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){d=d.Internal||(d.Internal={});d=d.Unicode||(d.Unicode={});d.Subscript2="\u00b2";d.Subscript3="\u00b3"})(Communicator||(Communicator={}));
(function(d){(function(d){function f(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]}function a(a){var c=a[0],b=a[1];a=a[2];return c*c+b*b+a*a}d.toVec3=function(a){return[a.x,a.y,a.z]};d.cwiseAbs3=function(a){return[Math.abs(a[0]),Math.abs(a[1]),Math.abs(a[2])]};d.cwiseProduct3=function(a,c){return[a[0]*c[0],a[1]*c[1],a[2]*c[2]]};d.add3=function(a,c){return[a[0]+c[0],a[1]+c[1],a[2]+c[2]]};d.sub3=function(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2]]};d.add4=function(a,c){return[a[0]+c[0],a[1]+c[1],a[2]+c[2],
a[3]+c[3]]};d.sub4=function(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2],a[3]-c[3]]};d.dot3=f;d.squaredNorm3=a;d.norm3=function(d){return Math.sqrt(a(d))};d.scale3=function(a,c){return[a*c[0],a*c[1],a*c[2]]};d.row4=function(a,c){a=a.m;c*=4;return[a[c],a[c+1],a[c+2],a[c+3]]};d.col4=function(a,c){a=a.m;return[a[c],a[c+4],a[c+8],a[c+12]]};d.projectSquaredSize=function(a,c,b){a=f(a,b)+b[3];a*=a;1E-5>a&&(a=1E-5);return c/a}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(a,c){this._failed=!1;this._failureError=null;this._activePromiseCount=0;this._idlePromise=null;console.assert(0<a,"Don't create a non-progressible queue.");this._maxActivePromises=a;this._suppressFailures=c;this._deferredActions=new d.Queue}a.prototype.isIdle=function(){return 0===this._activePromiseCount};a.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(this.isIdle()){if(this._failed)throw this._failureError;
return[2]}null===this._idlePromise&&(this._idlePromise=d.OpenPromise.create());return[2,this._idlePromise]})})};a.prototype.push=function(a){"function"===typeof a&&(a=d.Lazy.create(a));this._activePromiseCount<this._maxActivePromises?(console.assert(0===this._deferredActions.length),this._immediateAction(a)):this._deferredActions.push(a)};a.prototype._immediateAction=function(a){var c=this;if(this._failed)return console.assert(0===this._deferredActions.length),!0;try{var b=a.get()}catch(g){this._suppressFailures||
(this._failed=!0,this._failureError=g,this._deferredActions.clear())}if(void 0===b)return!0;++this._activePromiseCount;b.then(function(b){c._finalizePromise();return b}).catch(function(b){c._finalizePromise();throw b;});return!1};a.prototype._finalizePromise=function(){--this._activePromiseCount;this._failed&&console.assert(0===this._deferredActions.length);if(0<this._deferredActions.length){do{var a=this._deferredActions.pop();if(!this._immediateAction(a))break}while(0<this._deferredActions.length)
}this._tryActivateIdlePromise()};a.prototype._tryActivateIdlePromise=function(){0===this._activePromiseCount&&(console.assert(0===this._deferredActions.length),null!==this._idlePromise&&(this._failed?this._idlePromise.reject(this._failureError):this._idlePromise.resolve(),this._idlePromise=null))};return a}();d.ActionQueue=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(a){this._idlePromise=this._pending=this._active=null;this._suppressFailures=a}a.prototype.isIdle=function(){return null===this._active};a.prototype.waitForIdle=function(){if(this.isIdle())return Promise.resolve();null===this._idlePromise&&(this._idlePromise=d.OpenPromise.create());return this._idlePromise};a.prototype.set=function(a){var c=this;"function"===typeof a&&(a=d.Lazy.create(a));if(null===this._active){var b=void 0;try{b=a.get()}catch(g){return this._advance(!this._suppressFailures,
g)}if(void 0===b)return this._advance(!1,null);this._active=b.then(function(){c._advance(!1,null)}).catch(function(b){c._advance(!c._suppressFailures,b)})}else this._pending=a};a.prototype._advance=function(a,c){this._active=null;a&&(this._pending=null);null===this._pending?null!==this._idlePromise&&(a?this._idlePromise.reject(c):this._idlePromise.resolve(),this._idlePromise=null):(a=this._pending,this._pending=null,this.set(a))};a.prototype.clear=function(){this._pending=null};return a}();d.CurrentAction=
f})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function a(){this._action=new d.Util.CurrentAction(!0);this._latestPromise=null;this._timestamp=0}a.prototype.isIdle=function(){return null===this._latestPromise&&this._action.isIdle()};a.prototype.set=function(a){var c=this,b=++this._timestamp;null!==this._latestPromise&&this._latestPromise.reject(void 0);var d=h.OpenPromise.create();this._latestPromise=d;this._action.clear();this._action.waitForIdle().then(function(){b===c._timestamp&&c._action.set(function(){if(b===
c._timestamp){d===c._latestPromise&&(c._latestPromise=null);"function"===typeof a&&(a=h.Lazy.create(a));try{var g=a.get()}catch(l){return c._advance(d,!0,l)}return void 0===g?c._advance(d,!1,null):g.then(function(){return c._advance(d,!1,null)},function(b){return c._advance(d,!0,b)})}})});return d};a.prototype._advance=function(a,c,b){a===this._latestPromise&&(this._latestPromise=null);c?a.reject(b):a.resolve()};return a}();h.CurrentActionSync=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator=
{}));(function(d){(function(d){(function(d){d.create=function(){var a,d,c=new Promise(function(b,c){a=b;d=c});c.resolve=a;c.reject=d;return c}})(d.OpenPromise||(d.OpenPromise={}))})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));(function(d){(d.Internal||(d.Internal={})).OpenPromise=d.Util.OpenPromise})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(){this._cache=new Map}a.prototype.clear=function(){this._cache.clear()};a.prototype.load=function(a,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(d){b=this._cache.get(a);if(void 0!==b)return[2,b];this._cache.set(a,c);return[2,c]})})};return a}();d.PromiseCache=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(b,a,c){this._lazyPromise=b;this._wrapperPromise=a;null!==c&&(this.compareValue=c)}a.prototype.kill=function(){this._lazyPromise=null};a.prototype.fetch=function(b,a){var c=this;null===this._lazyPromise?(this._wrapperPromise.reject(null),setTimeout(a,0)):b(this._lazyPromise).then(function(b){c._wrapperPromise.resolve(b)}).catch(function(b){c._wrapperPromise.reject(b)})};return a}();d._DeferredPromise=f;var a=function(){function a(b,a,c){this._failed=
!1;this._failureError=null;this._activePromiseCount=0;this._idlePromise=null;this._latestPromise=Promise.resolve();this._needsResorting=!1;console.assert(0<b,"Don't create a non-progressible queue.");this._maxActivePromises=b;this._deferredPromises=a;this._failureFailsAll=c}a.prototype.maxActivePromises=function(){return this._maxActivePromises};a.prototype.isIdle=function(){return 0===this._activePromiseCount};a.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(b){if(this.isIdle()){if(this._failureFailsAll&&this._failed)throw this._failureError;return[2]}null===this._idlePromise&&(this._idlePromise=d.OpenPromise.create());return[2,this._idlePromise]})})};a.prototype.killDeferred=function(){for(var b=[];0<this._deferredPromises.length;){var a=this._dequeue();a.kill();b.push(a)}for(var c=0;c<b.length;c++)a=b[c],this._queue(a)};a.prototype._push=function(b,a){"function"===typeof b&&(b=d.Lazy.create(b));return this._latestPromise=b=this._activePromiseCount<
this._maxActivePromises?this._immediatePromise(b):this._deferPromise(b,a)};a.prototype._resort=function(){console.assert(this._needsResorting);this._needsResorting=!1;for(var b=[];0<this._deferredPromises.length;){var a=this._dequeue();b.push(a)}for(var c=0;c<b.length;c++)a=b[c],this._queue(a)};a.prototype._deferPromise=function(b,a){var c=d.OpenPromise.create();b=new f(b,c,a);this._queue(b);return c};a.prototype._immediatePromise=function(b){return __awaiter(this,void 0,void 0,function(){var a,c;
return __generator(this,function(d){switch(d.label){case 0:if(this._failureFailsAll&&this._failed)throw this._failureError;++this._activePromiseCount;d.label=1;case 1:return d.trys.push([1,3,,4]),[4,b.get()];case 2:return a=d.sent(),this._finalizePromise(),[2,a];case 3:throw c=d.sent(),this._failureFailsAll&&!this._failed&&(this._failed=!0,this._failureError=c,null!==this._idlePromise&&this._idlePromise.reject(c)),this._finalizePromise(),c;case 4:return[2]}})})};a.prototype._finalizePromise=function(){var b=
this;--this._activePromiseCount;0<this._deferredPromises.length?(this._needsResorting&&this._resort(),this._dequeue().fetch(function(a){return b._immediatePromise(a)},function(){b._finalizePromise()})):0===this._activePromiseCount&&(null!==this._idlePromise&&(this._failureFailsAll&&this._failed?this._idlePromise.reject(this._failureError):this._idlePromise.resolve(),this._idlePromise=null),this._latestPromise=Promise.resolve())};return a}();d.PromiseQueueImpl=a;var e=function(a){function b(b,c){return a.call(this,
b,new d.Queue,c)||this}__extends(b,a);b.prototype._queue=function(b){this._deferredPromises.push(b)};b.prototype._dequeue=function(){return this._deferredPromises.pop()};b.prototype.push=function(b){return this._push(b,null)};b.prototype.waitOnLatest=function(){return this._latestPromise.then(d.nop,d.nop)};return b}(a);d.PromiseQueue=e;a=function(a){function b(b,c,e){var g=this;g=new d.PriorityQueue(function(b,a){return c(b.compareValue,a.compareValue)});return g=a.call(this,b,g,e)||this}__extends(b,
a);b.prototype._queue=function(b){this._deferredPromises.push(b)};b.prototype._dequeue=function(){return this._deferredPromises.pop()};b.prototype.push=function(b,a){return this._push(b,a)};b.prototype.markDirty=function(){this._needsResorting=!0};return b}(a);d.PriorityPromiseQueue=a})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.create=function(){var a,d,c=new Promise(function(b,g){a=function(a){c.state=1;b(a)};d=function(b){c.state=2;g(b)}});c.state=0;c.resolve=a;c.reject=d;return c}})(d.TrackedOpenPromise||(d.TrackedOpenPromise={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.create=function(a,d){var c=new Promise(function(b,g){d.then(function(){c.isReady=!0;b(a)},g)});c.unsafeValue=a;c.readyPromise=d;c.isReady=!1;return c}})(d.UnsafePromise||(d.UnsafePromise={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function c(b,c,e,f){var g=a.call(this)||this;g._position=new d.Point2(b,c);g._modifiers=e;g._inputType=f;return g}__extends(c,a);c.prototype.getPosition=function(){return this._position.copy()};c.prototype.shiftDown=function(){return(this._modifiers&d.KeyModifiers.Shift)===d.KeyModifiers.Shift};c.prototype.altDown=function(){return(this._modifiers&d.KeyModifiers.Alt)===d.KeyModifiers.Alt};c.prototype.controlDown=function(){return(this._modifiers&d.KeyModifiers.Control)===
d.KeyModifiers.Control};c.prototype.commandDown=function(){return(this._modifiers&d.KeyModifiers.Command)===d.KeyModifiers.Command};c.prototype.getEventType=function(){return this._inputType};c.prototype.getModifiers=function(){return this._modifiers};return c}(h.InputEvent);h.MouseInputEventBase=f;var a=function(a){function c(b,c,d,e,f,h){b=a.call(this,b,c,f,h)||this;b._button=d;b._buttons=e;return b}__extends(c,a);c.prototype.getButton=function(){return this._button};c.prototype.getButtons=function(){return this._buttons};
return c}(f);h.MouseInputEvent=a;f=function(a){function c(b,c,d,e,f,h){b=a.call(this,b,c,f,h)||this;b._wheelDelta=d;b._buttons=e;return b}__extends(c,a);c.prototype.getWheelDelta=function(){return this._wheelDelta};c.prototype.getButtons=function(){return this._buttons};return c}(f);h.MouseWheelInputEvent=f})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function a(a){this._selection=a}a.prototype.getType=function(){return this._selection?this._selection.getSelectionType():d.SelectionType.None};a.prototype.getSelection=function(){return this._selection};a._createNull=function(){return new a(d.Selection.SelectionItem.create())};return a}();h.NodeSelectionEvent=f})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c,b,g,e,f){var k=a.call(this)||this;k._id=c;k._position=new d.Point2(b,g);k._buttons=e;k._inputType=f;return k}__extends(e,a);e.prototype.getId=function(){return this._id};e.prototype.getPosition=function(){return this._position};e.prototype.getEventType=function(){return this._inputType};e.prototype.getButtons=function(){return this._buttons};return e}(h.InputEvent);h.TouchInputEvent=f})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(){}a.calculate=function(a,c,b,d){var g=2/(c+2*b+d);a=a<=c?this._PA(a,g,c):a>=c&&a<=c+b?this._PA(a,g,c):this._PC(a,g,c,b,d);return a=Math.min(a,1)};a._PA=function(a,c,b){return a*a*.5*c/b};a._PB=function(a,c,b){return this._PA(b,c,b)+(a-b)*c};a._PC=function(a,c,b,d,f){return this._PB(b+d,c,b)+(a-(b+d))*c*(1-.5*(a-(b+d))/f)};return a}();d.EaseInEaseOut=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function a(a,c,b,g,f){this._startTime=this._completeCallback=null;this._progress=0;this._targetMoveDelta=this._positionMoveDelta=null;this._interpolationUsesRotation=!1;this._endQuaternion=this._beginQuaternion=null;this._fieldHeightDelta=this._fieldWidthDelta=this._viewVectorLengthDelta=this._viewVectorLength=0;this._beginCam=a.copy();this._endCam=c.copy();a=d.Point3.subtract(this._endCam.getTarget(),this._endCam.getPosition()).normalize();c=this._endCam.getUp().normalize();
c=d.Point3.cross(c,a);a=d.Point3.cross(a,c);this._endCam.setUp(a.normalize());this._completeCallback=g;this._duration=b;this._view=f}a.prototype.isComplete=function(){return 1<=this._progress};a.prototype.getCallback=function(){return this._completeCallback};a.prototype.stop=function(){};a.prototype.start=function(){this._startTime=Date.now();this._progress=0;this._init();this._view.getProjectionMode()!==this._endCam.getProjection()&&this._view.setProjectionMode(this._endCam.getProjection())};a.prototype.update=
function(){if(null!==this._startTime){var a=(Date.now()-this._startTime)/this._duration;a=Math.min(a,1);a=Math.max(a,0);a=h.EaseInEaseOut.calculate(a,.49,.02,.49);a=Math.min(a,1);a=Math.max(a,0);var c=d.Point3.scale(this._positionMoveDelta,a),b=d.Point3.scale(this._targetMoveDelta,a),g=this._beginCam.getUp(),f=d.Point3.add(this._beginCam.getPosition(),c);b=d.Point3.add(this._beginCam.getTarget(),b);c=this._beginCam.getWidth()+a*this._fieldWidthDelta;var l=this._beginCam.getHeight()+a*this._fieldHeightDelta;
if(this._interpolationUsesRotation){f=this._viewVectorLength+this._viewVectorLengthDelta*a;var n=d.Quaternion.interpolate(this._beginQuaternion,this._endQuaternion,a);n=d.Quaternion.toMatrix(n);f=new d.Point3(b.x-n.m[8]*f,b.y-n.m[9]*f,b.z-n.m[10]*f);g.set(n.m[4],n.m[5],n.m[6])}g=d.Camera.create(f,b,g,this._endCam.getProjection(),c,l,this._endCam.getNearLimit());this._view.setCamera(g);this._progress=a;1<=this._progress&&this._view.setCamera(this._endCam)}};a.prototype.getMatrixFromCamera=function(a){var c=
d.Point3.subtract(a.getTarget(),a.getPosition()).normalize();a=a.getUp().normalize();a=d.Point3.cross(a,c);var b=d.Point3.cross(c,a);return d.Matrix.createFromBasis(a,b,c)};a.prototype._init=function(){var a=d.Point3.subtract(this._beginCam.getTarget(),this._beginCam.getPosition()),c=d.Point3.subtract(this._endCam.getTarget(),this._endCam.getPosition()),b=a.length(),g=c.length()-b;a.normalize();c.normalize();c=d.Point3.subtract(a,c);var f=d.Point3.subtract(this._endCam.getUp(),this._beginCam.getUp());
a=!0;1E-4>c.length()&&1E-4>f.length()&&(a=!1);f=c=null;if(a){c=this.getMatrixFromCamera(this._beginCam);f=this.getMatrixFromCamera(this._endCam);c=d.Quaternion.createFromMatrix(c);f=d.Quaternion.createFromMatrix(f);var l=d.Quaternion.subtract(c,f).magnitudeSquared();d.Quaternion.add(c,f).magnitudeSquared()<l&&f.negate()}this._interpolationUsesRotation=a;this._beginQuaternion=c;this._endQuaternion=f;this._viewVectorLength=b;this._viewVectorLengthDelta=g;this._positionMoveDelta=d.Point3.subtract(this._endCam.getPosition(),
this._beginCam.getPosition());this._targetMoveDelta=d.Point3.subtract(this._endCam.getTarget(),this._beginCam.getTarget());this._fieldWidthDelta=this._endCam.getWidth()-this._beginCam.getWidth();this._fieldHeightDelta=this._endCam.getHeight()-this._beginCam.getHeight()};return a}();h.CameraInterpolation=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var f=function(){function a(){this._activeInterpolation=null;this._updateTimer=new d.Timer;this._updateInterval=16}a.prototype.stop=function(){this._activeInterpolation&&this._activeInterpolation.stop();this._activeInterpolation=null;this._updateTimer.clear()};a.prototype.start=function(a,c){void 0===c&&(c=!0);if(this._activeInterpolation&&!c)return!1;this.stop();this._activeInterpolation=a;this._activeInterpolation.start();this.update();return!0};a.prototype.update=function(){var a=
this;if(this._activeInterpolation)if(this._activeInterpolation.update(),this._activeInterpolation.isComplete()){var c=this._activeInterpolation.getCallback();null!==c&&c()}else this._updateTimer.isIdle(0)&&this._updateTimer.set(this._updateInterval,function(){a.update()})};return a}();d.InterpolationManager=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(){this._positionOffset=d.Point2.zero();this._position=d.Point2.zero();this._activeNoteText=null;this._createTextBox()}a.prototype._createTextBox=function(){var a=this;this._container=document.createElement("div");this._container.className="noteTextElement";this._textArea=document.createElement("textarea");this._textArea.oninput=function(){null!==a._activeNoteText&&a._activeNoteText.saveTextValue()};this._container.appendChild(this._textArea);
var b=7;["blue","red","green","white","black"].forEach(function(c){var g=document.createElement("button");g.className="noteButton color "+c;g.style.top=b+"px";b+=25;g.id=c+"_button";switch(c){case "blue":var e=d.Color.blue();break;case "red":e=d.Color.red();break;case "green":e=d.Color.green();break;case "white":e=d.Color.white();break;case "black":e=d.Color.black();break;default:e=d.Color.white()}g.onmousedown=function(){null!==a._activeNoteText&&a._activeNoteText.setColor(e)};a._container.appendChild(g)});
var g=document.createElement("button");g.className="noteButton trash";g.style.top=b+"px";g.onmousedown=function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return null===this._activeNoteText?[3,2]:[4,this._activeNoteText.remove()];case 1:b.sent(),b.label=2;case 2:return[2]}})})};this._container.appendChild(g)};a.prototype.setPositionOffset=function(a){this._positionOffset=a};a.prototype.getPositionOffset=function(){return this._positionOffset.copy()};
a.prototype.setPosition=function(a){this._position=d.Point2.add(a,this._positionOffset);this._container.style.left=this._position.x+"px";this._container.style.top=this._position.y+"px"};a.prototype.getPosition=function(){return this._position.copy()};a.prototype.setText=function(a){var b=this._container.querySelector("textarea");null!==b&&(b.value=a)};a.prototype.getText=function(){var a=this._container.querySelector("textarea");return null!==a?a.value:""};a.prototype.setSize=function(a){this._container.style.width=
a.x+"px";this._container.style.height=a.y+"px"};a.prototype.getSize=function(){var a=this._container.getBoundingClientRect();return new d.Point2(a.width,a.height)};a.prototype.focus=function(){this._textArea.focus();this._textArea.style.pointerEvents="auto"};a.prototype.blur=function(){this._container.blur()};a.prototype.hide=function(){this._container.style.visibility="hidden";this._activeNoteText=null};a.prototype.show=function(a){this._container.style.visibility="visible";this._activeNoteText=
a};a.prototype.getHtmlContainer=function(){return this._container};a.prototype.setHtmlContainer=function(a){this._container=a};return a}();f.NoteTextElement=a})(h.Note||(h.Note={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){return function(){this.rotate=this.viewPlane=this.plane=this.axis=null}}(),a=function(){return function(a,b,g,e,f,h){this.vector=b;this.matrix=g;this.nodeId=e;this.position=a;this.handleType=f;this.translation=d.Point3.zero();this.groupId=h}}(),e=function(c){function b(b){var a=c.call(this)||this;a._meshIds=new f;a._scaleModifier=1;a._id=0;a._handleData=new Map;a._translationFromInitialHandlePosition=d.Point3.zero();a._groupIdRotationMatrix=new Map;a._viewer=
b;a._callbacks={camera:function(){a._updateCamera()},_assemblyTreeReady:function(){return __awaiter(a,void 0,void 0,function(){var b,a,c,d,g=this;return __generator(this,function(e){this._updateViewport();this._hideOverlay();b=this._createMeshId(this._getAxisMeshData()).then(function(b){g._meshIds.axis=b});a=this._createMeshId(this._getPlaneMeshData()).then(function(b){g._meshIds.plane=b});c=this._createMeshId(this._getViewPlaneMeshData()).then(function(b){g._meshIds.viewPlane=b});d=this._createMeshId(this._getRotateMeshData()).then(function(b){g._meshIds.rotate=
b});b;a;c;d;return[2]})})},modelSwitchStart:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.removeHandles()];case 1:return b.sent(),[2]}})})}};a._viewer.setCallbacks(a._callbacks);return a}__extends(b,c);b.prototype.remove=function(){null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),this._callbacks=null);c.prototype.remove.call(this)};b.prototype._getAxisMeshData=function(){return d.Util.generateConeCylinderMeshData(b._cylinderRadius,
b._segmentCount,b._cylinderHeight,b._coneBaseRadius,b._capHeight,b._taperHeight)};b.prototype._getPlaneMeshData=function(){var a=new d.Point3(b._planeOffset,0,b._planeOffset),c=new d.Point3(b._planeOffset+b._planeLength,0,b._planeOffset),e=new d.Point3(b._planeOffset+b._planeLength,0,b._planeOffset+b._planeLength),f=new d.Point3(b._planeOffset,0,b._planeOffset+b._planeLength),h=[a.x,a.y,a.z,c.x,c.y,c.z,e.x,e.y,e.z,a.x,a.y,a.z,e.x,e.y,e.z,f.x,f.y,f.z],p=new d.Point3(0,-1,0);p=[p.x,p.y,p.z,p.x,p.y,
p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z];var r=new d.MeshData;r.addFaces(h,p);r.setBackfacesEnabled(!0);r.addPolyline([a.x,a.y,a.z,c.x,c.y,c.z]);r.addPolyline([c.x,c.y,c.z,e.x,e.y,e.z]);r.addPolyline([e.x,e.y,e.z,f.x,f.y,f.z]);r.addPolyline([f.x,f.y,f.z,a.x,a.y,a.z]);return r};b.prototype._getViewPlaneMeshData=function(){return d.Util.generateSphereMeshData()};b.prototype._getRotateMeshData=function(b,a,c){void 0===b&&(b=35);void 0===a&&(a=12);void 0===c&&(c=.5);var g=b*Math.PI/180*.5;
b=[];for(var e=-g;e<=g;e+=.1){var f=Math.sin(e)*a;b.push(Math.cos(e)*a);b.push(0);b.push(f)}a=new d.Point3(0,0,1);c=d.Util.createCylinderMeshDataFromArc(b,a,10,c);c.setBackfacesEnabled(!0);return c};b.prototype.setAxisMeshData=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.axis?[3,2]:[4,this._createMeshId(b)];case 1:return a=c.sent(),this._meshIds.axis=a,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.axis,
b)];case 3:return[2]}})})};b.prototype.setPlaneMeshData=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.plane?[3,2]:[4,this._createMeshId(b)];case 1:return a=c.sent(),this._meshIds.plane=a,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.plane,b)];case 3:return[2]}})})};b.prototype.setViewPlaneMeshData=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,
function(c){switch(c.label){case 0:return null!==this._meshIds.viewPlane?[3,2]:[4,this._createMeshId(b)];case 1:return a=c.sent(),this._meshIds.viewPlane=a,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.viewPlane,b)];case 3:return[2]}})})};b.prototype.setRotateMeshData=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.rotate?[3,2]:[4,this._createMeshId(b)];case 1:return a=c.sent(),
this._meshIds.rotate=a,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.rotate,b)];case 3:return[2]}})})};b.prototype.getOverlayId=function(){return d.BuiltinOverlayIndex.Handles};b.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.Handles,!1)};b.prototype.hideOverlay=function(){this._hideOverlay();return Promise.resolve()};b.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.Handles,!0);
this._updateCamera()};b.prototype.showOverlay=function(){this._showOverlay();return Promise.resolve()};b.prototype._updateViewport=function(){this._viewer.overlayManager.setViewport(d.BuiltinOverlayIndex.Handles,d.OverlayAnchor.UpperLeftCorner,0,d.OverlayUnit.ProportionOfCanvas,0,d.OverlayUnit.ProportionOfCanvas,1,d.OverlayUnit.ProportionOfCanvas,1,d.OverlayUnit.ProportionOfCanvas)};b.prototype.updateViewport=function(){this._updateViewport();return Promise.resolve()};b.prototype.addHandles=function(b,
a,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){switch(g.label){case 0:return this._scaleModifier=a,this._translationFromInitialHandlePosition.assign(d.Point3.zero()),[4,this.createDefaultHandles(b,c)];case 1:return g.sent(),this._showOverlay(),[2]}})})};b.prototype._updateCamera=function(){this._viewer.overlayManager.setCamera(d.BuiltinOverlayIndex.Handles,this._viewer.view.getCamera())};b.prototype.getVector=function(b){b=this._handleData.get(b);return void 0!==
b&&(b=b.vector,null!==b)?b.copy():null};b.prototype.getHandleType=function(b){b=this._handleData.get(b);return void 0===b?null:b.handleType};b.prototype.getHandleGroupId=function(a){a=this._handleData.get(a);return void 0===a?b.defaultGroupId:a.groupId};b.prototype.getPosition=function(b){if(b=this._handleData.get(b)){var a=b.translation.copy();return b.position.copy().add(this._translationFromInitialHandlePosition).add(a)}return null};b.prototype.getHandleNodeIds=function(){var b=[];this._handleData.forEach(function(a,
c){b.push(c)});return b};b.prototype.removeHandles=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(a){switch(a.label){case 0:return b=this.getHandleNodeIds(),this._handleData.clear(),this._groupIdRotationMatrix.clear(),this._id=0,this._hideOverlay(),[4,this._viewer.model.deleteMeshInstances(b)];case 1:return a.sent(),[2]}})})};b.prototype.isEmpty=function(){return 0===this._handleData.size};b.prototype.createDefaultHandles=function(a,c){return __awaiter(this,
void 0,void 0,function(){var g;return __generator(this,function(e){switch(e.label){case 0:return g=[],g.push(this.addViewPlaneHandle(a,b._viewPlaneColor,c)),g.push(this.addAxisTranslationHandle(a,new d.Point3(1,0,0),b._xColor,null,c)),g.push(this.addAxisTranslationHandle(a,new d.Point3(0,1,0),b._yColor,null,c)),g.push(this.addAxisTranslationHandle(a,new d.Point3(0,0,1),b._zColor,null,c)),g.push(this.addPlaneTranslationHandle(a,new d.Point3(1,0,0),b._zColor,d.Color.black(),new d.Point3(0,-1,0),c)),
g.push(this.addPlaneTranslationHandle(a,new d.Point3(0,1,0),b._xColor,d.Color.black(),new d.Point3(0,0,-1),c)),g.push(this.addPlaneTranslationHandle(a,new d.Point3(0,0,1),b._yColor,d.Color.black(),new d.Point3(-1,0,0),c)),g.push(this.addRotateHandle(a,new d.Point3(1,0,0),b._zColor,new d.Point3(0,-1,0),c)),g.push(this.addRotateHandle(a,new d.Point3(0,1,0),b._xColor,new d.Point3(0,0,-1),c)),g.push(this.addRotateHandle(a,new d.Point3(0,0,1),b._yColor,new d.Point3(-1,0,0),c)),[4,Promise.all(g)];case 1:return e.sent(),
[2]}})})};b.prototype._createMeshId=function(b){return __awaiter(this,void 0,void 0,function(){var a,c;return __generator(this,function(d){switch(d.label){case 0:return a=this._viewer.model,[4,a.createMesh(b)];case 1:return c=d.sent(),a._preventMeshDeletion(c),[2,c]}})})};b.prototype.addAxisTranslationHandle=function(b,c,e,f,h){return __awaiter(this,void 0,void 0,function(){var g,k,l,m;return __generator(this,function(n){switch(n.label){case 0:if(null!==this._meshIds.axis)return[3,2];g=this._meshIds;
return[4,this._createMeshId(this._getAxisMeshData())];case 1:g.axis=n.sent(),n.label=2;case 2:return k="handle-axis-translation-"+this._id++,l=this._getRotationMatrixFromVector(c,f),[4,this._createMeshInstance(this._meshIds.axis,k,e,null,b.copy(),l.copy())];case 3:return m=n.sent(),this._handleData.set(m,new a(b.copy(),c.copy(),l.copy(),m,d.HandleType.Axis,h)),[2,m]}})})};b.prototype.addViewPlaneHandle=function(b,c,e){return __awaiter(this,void 0,void 0,function(){var g,f;return __generator(this,
function(k){switch(k.label){case 0:if(null!==this._meshIds.viewPlane)return[3,2];g=this._meshIds;return[4,this._createMeshId(this._getViewPlaneMeshData())];case 1:g.viewPlane=k.sent(),k.label=2;case 2:return[4,this._createMeshInstance(this._meshIds.viewPlane,"handle-sphere-instance",c,null,b,new d.Matrix)];case 3:return f=k.sent(),this._handleData.set(f,new a(b.copy(),null,new d.Matrix,f,d.HandleType.ViewPlane,e)),[2,f]}})})};b.prototype.addPlaneTranslationHandle=function(b,c,e,f,h,p){return __awaiter(this,
void 0,void 0,function(){var g,k,l,m;return __generator(this,function(n){switch(n.label){case 0:if(null!==this._meshIds.plane)return[3,2];g=this._meshIds;return[4,this._createMeshId(this._getPlaneMeshData())];case 1:g.plane=n.sent(),n.label=2;case 2:return k="handle-plane-translation-"+this._id++,l=this._getRotationMatrixFromVector(c,h),[4,this._createMeshInstance(this._meshIds.plane,k,e,f,b,l)];case 3:return m=n.sent(),this._handleData.set(m,new a(b.copy(),c.copy(),l.copy(),m,d.HandleType.Plane,
p)),[2,m]}})})};b.prototype.addRotateHandle=function(b,c,e,f,h){return __awaiter(this,void 0,void 0,function(){var g,k,l,m;return __generator(this,function(n){switch(n.label){case 0:if(null!==this._meshIds.rotate)return[3,2];g=this._meshIds;return[4,this._createMeshId(this._getRotateMeshData())];case 1:g.rotate=n.sent(),n.label=2;case 2:return k="handle-rotate-"+this._id++,l=this._getRotationMatrixFromVector(c,f),[4,this._createMeshInstance(this._meshIds.rotate,k,e,null,b,l)];case 3:return m=n.sent(),
this._handleData.set(m,new a(b.copy(),c.copy(),l.copy(),m,d.HandleType.Rotate,h)),[2,m]}})})};b.prototype._getRotationMatrixFromVector=function(b,a){a||(a=new d.Point3(1,0,0),.001>d.Point3.cross(a,b).squaredLength()&&(a=new d.Point3(0,1,0)));a=d.Point3.cross(a,b).normalize();var c=d.Point3.cross(a,b).normalize();b.normalize();var g=new d.Matrix;g.m[0]=a.x;g.m[1]=a.y;g.m[2]=a.z;g.m[3]=0;g.m[4]=b.x;g.m[5]=b.y;g.m[6]=b.z;g.m[7]=0;g.m[8]=c.x;g.m[9]=c.y;g.m[10]=c.z;g.m[11]=0;g.m[12]=0;g.m[13]=0;g.m[14]=
0;g.m[15]=1;return g};b.prototype._createMeshInstance=function(b,a,c,e,f,h){return __awaiter(this,void 0,void 0,function(){var g,k,l;return __generator(this,function(m){g=this._createTransformationMatrix(f,new d.Matrix);g=d.Matrix.multiply(h,g);k=new d.MeshInstanceData(b,g,a,c||void 0,e||void 0);k.setOpacity(1);k.setCreationFlags(d.MeshInstanceCreationFlags.SuppressCameraScale|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.ExcludeBounding|
d.MeshInstanceCreationFlags.DoNotXRay|d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.AlwaysDraw);k.setOverlayIndex(d.BuiltinOverlayIndex.Handles);l=this._viewer.model;return[2,l.createMeshInstance(k,void 0,!0,!0)]})})};b.prototype._createTransformationMatrix=function(a,c){var g=b._defaultScale*this._scaleModifier;g=(new d.Matrix).setScaleComponent(g,g,g);g=d.Matrix.multiply(g,c);g.setTranslationComponent(a.x,a.y,a.z);return g};b.prototype._getHandlePosition=function(b){var a=
null;this._handleData.forEach(function(c){c.groupId===b&&(a=c.position.copy())});return a};b.prototype.getGroupIdRotationMatrix=function(b){b=this._groupIdRotationMatrix.get(b);return void 0===b?new d.Matrix:b.copy()};b.prototype.updatePosition=function(b,a,c,e,f){return __awaiter(this,void 0,void 0,function(){var g,k,l,h,m=this;return __generator(this,function(n){switch(n.label){case 0:g=this._viewer.model;k=[];l=new Map;h=this._getHandlePosition(e);if(null===h)return[2];this._handleData.forEach(function(n,
p){var q=n.groupId,r=void 0!==f.get(q);if(q===e||r){var u=n.position.copy();u.add(b.copy());var t=n.translation.copy();u.add(t);t=d.Matrix.multiply(m.getGroupIdRotationMatrix(q),a);t=d.Matrix.multiply(n.matrix,t);r&&(r=d.Point3.subtract(u,h),a.transform(r,u),u.add(h));r=m._createTransformationMatrix(u,t);c&&(n.position.assign(u),l.set(q,d.Matrix.multiply(m.getGroupIdRotationMatrix(q),a)));k.push(g.setNodeMatrix(p,r))}});l.forEach(function(b,a){m._groupIdRotationMatrix.set(a,b.copy())});return[4,Promise.all(k)];
case 1:return n.sent(),[2]}})})};b.prototype.resetTranslation=function(){var b=this;this._translationFromInitialHandlePosition&&(this._handleData.forEach(function(a){a.translation.add(b._translationFromInitialHandlePosition)}),this._translationFromInitialHandlePosition.assign(d.Point3.zero()))};b.prototype.getTranslation=function(){return this._translationFromInitialHandlePosition};b.className="Communicator.Markup.HandleMarkup";b.defaultGroupId=-1;b._defaultScale=.02;b._cylinderRadius=.5;b._coneBaseRadius=
.9;b._cylinderHeight=7;b._capHeight=1.2;b._taperHeight=.2;b._segmentCount=20;b._planeOffset=1;b._planeLength=2.5;b._xColor=new d.Color(168,56,59);b._yColor=new d.Color(96,166,50);b._zColor=new d.Color(41,81,185);b._viewPlaneColor=d.Color.white();return b}(h.MarkupItem);h.HandleMarkup=e})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function a(a,c,b){this._markupItems=new Map;this._selectedMarkup=this._activeView=null;this._pendingUpdateHandleTimer=new h.Timer;this._pickTolerance=0;this._callbackManager=a;this._domElements=c;this._markupRenderer=b}a.prototype.shutdown=function(){this.setActiveView(null);this._markupItems.forEach(function(a){a.remove()});this._markupItems.clear()};a.prototype._updateLater=function(a){var c=this;this._pendingUpdateHandleTimer.isIdle(0)&&this._pendingUpdateHandleTimer.set(0,
function(){c.update()});null!==a&&this._pendingUpdateHandleTimer.waitForIdle(1).then(function(){a.resolve()})};a.prototype.updateLater=function(){this._updateLater(null)};a.prototype.update=function(){this._pendingUpdateHandleTimer.clear();this.renderMarkup();this.renderActiveViewMarkup()};a.prototype.registerMarkupItem=function(a){var c=d.GUID.create();this._markupItems.set(c,a);return c};a.prototype.unregisterMarkupItem=function(a){var c=this._markupItems.get(a);c&&(c.remove&&c.remove(),this._markupItems.delete(a))};
a.prototype.getActiveView=function(){return this._activeView};a.prototype.setActiveView=function(a){return __awaiter(this,void 0,void 0,function(){var c,b,d,e,f,n;return __generator(this,function(g){switch(g.label){case 0:this._selectedMarkup&&(this._selectedMarkup.onDeselect(),this._selectedMarkup=null);c=this._activeView;this._activeView=a;if(null===c||c===a)return[3,2];b=c.getMarkup();d=0;for(e=b;d<e.length;d++)f=e[d],f.remove();n=h.OpenPromise.create();this._updateLater(n);return[4,n];case 1:return g.sent(),
this._callbackManager.trigger("viewDeactivated",c),[3,4];case 2:return[4,this._pendingUpdateHandleTimer.waitForIdle(1)];case 3:g.sent(),g.label=4;case 4:return[2]}})})};a.prototype.renderMarkup=function(){this._markupRenderer._setCanvas(this._domElements.getMarkupSvgElement());this._markupRenderer._clear();this._markupItems.forEach(function(a){a.draw()});this._markupRenderer._finalize()};a.prototype.renderActiveViewMarkup=function(){this._markupRenderer._setCanvas(this._domElements.getRedlineSvgElement());
this._markupRenderer._clear();if(this._activeView){for(var a=0,c=this._activeView.getMarkup();a<c.length;a++)c[a].draw();this._markupRenderer._finalize()}};a.prototype.getPickTolerance=function(){return this._pickTolerance};a.prototype.setPickTolerance=function(a){this._pickTolerance=a};a.prototype.pick=function(a){var c=this;if(this._activeView)for(var b=0,d=this._activeView.getMarkup();b<d.length;b++){var e=d[b];if(e.hitWithTolerance(a,this._pickTolerance)||e.hit(a))return e}var f=null;this._markupItems.forEach(function(b){null===
f&&(b.hitWithTolerance(a,c._pickTolerance)||b.hit(a))&&(f=b)});return f};a.prototype.select=function(a){if(this._selectedMarkup&&a!==this._selectedMarkup)this._selectedMarkup.onDeselect();if(this._selectedMarkup=a)this._selectedMarkup.onSelect();this.update()};a.prototype.getSelected=function(){return this._selectedMarkup};return a}();h.MarkupItemManager=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._center=d.Point2.zero();b._radius=1;return b}__extends(b,a);b.prototype.set=function(b,a){this._center.assign(b);this.setRadius(a)};b.prototype.getCenter=function(){return this._center.copy()};b.prototype.setCenter=function(b){this._center.assign(b)};b.prototype.getRadius=function(){return this._radius};b.prototype.setRadius=function(b){this._radius=b};return b}(f.FilledShape);f.Circle=
a;var e=function(){return function(a,b){this.center=a.copy();this.radius=b}}();f._MarkupCircleData=e;a=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._circles=[];return b}__extends(b,a);b.prototype.clear=function(){this._circles=[]};b.prototype.addCircle=function(b,a){this._circles.push(new e(b,a))};b.prototype.getCircles=function(){return this._circles};return b}(f.FilledShape);f.CircleCollection=a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){(function(f){var a=function(a){function b(b,c){var g=a.call(this)||this;g._p1=b?b.copy():d.Point2.zero();g._p2=c?c.copy():d.Point2.zero();return g}__extends(b,a);b.prototype.set=function(b,a){this._p1.assign(b);this._p2.assign(a)};b.prototype.getP1=function(){return this._p1.copy()};b.prototype.setP1=function(b){this._p1.assign(b)};b.prototype.getP2=function(){return this._p2};b.prototype.setP2=function(b){this._p2.assign(b)};return b}(f.EndcapShape);f.Line=a;var e=function(){return function(a,
b){this.p1=a.copy();this.p2=b.copy()}}();f._MarkupLineData=e;a=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._lines=[];return b}__extends(b,a);b.prototype.addLine=function(b,a){this._lines.push(new e(b,a))};b.prototype.getLines=function(){return this._lines};b.prototype.clear=function(){this._lines=[]};return b}(f.EndcapShape);f.LineCollection=a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(){this._padding=5;this._text=new f.TextMarkupBase;this._box=new f.RectangleBase;this._box.setFillOpacity(0);this._box.setFillColor(d.Color.white())}a.prototype._assign=function(b){this._text._assign(b._text);this._box._assign(b._box);this._padding=b._padding};a.prototype.getTextPortion=function(){return this._text};a.prototype.getBoxPortion=function(){return this._box};a.prototype.getPadding=function(){return this._padding};a.prototype.setPadding=
function(b){this._padding=b};return a}();f.TextBoxBase=a;var e=function(a){function b(b,c){var g=a.call(this)||this;g._position=d.Point2.zero();g._textStr="";b&&g._position.assign(b);c&&(g._textStr=c);return g}__extends(b,a);b.prototype._assign=function(b){a.prototype._assign.call(this,b);this._position.assign(b._position)};b.prototype.getPosition=function(){return this._position.copy()};b.prototype.setPosition=function(b){this._position.assign(b)};b.prototype.getTextString=function(){return this._textStr};
b.prototype.setTextString=function(b){this._textStr=b};return b}(a);f.TextBox=e;a=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._textStrings=[];return b}__extends(b,a);b.prototype.clear=function(){this._textStrings=[]};b.prototype.addString=function(b,a){this._textStrings.push(new f._MarkupTextData(b,a))};b.prototype.getStrings=function(){return this._textStrings};return b}(a);f.TextBoxCollection=a})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){var f=function(){return function(a,c){this.markupView=a;this.itemResults=c}}();h._MarkupViewConstruction=f;var a=function(){function a(a,b,d,e,f,h){void 0===h&&(h=null);this._faceVisibility=this._lineVisibility=!0;this._markupItems=new Set;this._sheetId=null;this._colorMap=new Map;this._snapshotImage=null;this._defaultVisibility=!0;this._visibilityExceptions=new Set;this._uniqueId=a;this._camera=d;this._name=b;this._explodeMagnitude=e;this._cuttingPlaneData=f;this._sheetId=h}
a.prototype.getCamera=function(){return this._camera};a.prototype.getSheetId=function(){return this._sheetId};a.prototype.getUniqueId=function(){return this._uniqueId};a.prototype.getName=function(){return this._name};a.prototype.setName=function(a){this._name=a};a.prototype.getLineVisibility=function(){return this._lineVisibility};a.prototype.setLineVisibility=function(a){this._lineVisibility=a};a.prototype.getFaceVisibility=function(){return this._faceVisibility};a.prototype.setFaceVisibility=function(a){this._faceVisibility=
a};a.prototype.addMarkupItem=function(a){this._markupItems.add(a)};a.prototype.getMarkup=function(){return d.Util.setToArray(this._markupItems)};a.prototype.removeMarkup=function(a){a.remove();return this._markupItems.delete(a)};a.prototype.getCuttingPlaneData=function(){return this._cuttingPlaneData};a.prototype.setCuttingPlaneData=function(a){this._cuttingPlaneData=a};a.prototype.getExplodeMagnitude=function(){return this._explodeMagnitude};a.prototype.setExplodeMagnitude=function(a){this._explodeMagnitude=
a};a.prototype.getColorMap=function(){return this._colorMap};a.prototype.setColorMap=function(a){this._colorMap=a};a.prototype.getDefaultVisibility=function(){return this._defaultVisibility};a.prototype.setDefaultVisibility=function(a){this._defaultVisibility=a};a.prototype.getVisibilityExceptions=function(){return this._visibilityExceptions};a.prototype.setVisibilityExceptions=function(a){this._visibilityExceptions=a};a.prototype.getSnapshotImage=function(){return this._snapshotImage};a.prototype.setSnapshotImage=
function(a){this._snapshotImage=a};a.prototype._handleLoadMarkupItem=function(a){return a instanceof h.MarkupItem?(this.addMarkupItem(a),!0):!1};a._fromJson=function(c,b){return __awaiter(this,void 0,void 0,function(){var g,e,l,h,m,p,r,q,u,t,v,w,z,y,x,A,B,D,C,E,F,G;return __generator(this,function(k){switch(k.label){case 0:g=c;e=d.Camera.fromJson(g.camera);g.hasOwnProperty("sheetId")&&g.sheetId&&(h=parseInt(c.sheetId,10),isNaN(h)||(l=h));m=new a(g.uniqueId,g.name,e,g.explodeMagnitude,g.cuttingData,
l);m.setLineVisibility(g.lineVisibility);m.setFaceVisibility(g.faceVisibility);void 0!==g.defaultVisibility&&void 0!==g.visibilityExceptions&&(m.setDefaultVisibility(g.defaultVisibility),p=new Set,g.visibilityExceptions.forEach(function(b){p.add(b)}),m.setVisibilityExceptions(p));r=new Map;q=g.colors;if(Array.isArray(q))for(u=0,t=q;u<t.length;u++)v=t[u],w=v[0],z=d.Color.fromJson(v[1]),r.set(w,z);m.setColorMap(r);y=[];console.assert(Array.isArray(g.markup));x=0;for(A=g.markup;x<A.length;x++)if(B=A[x],
D=d.Internal.classFromString(B.className))C=D.fromJson(B,b),C instanceof Promise?y.push(C.then(function(b){return m._handleLoadMarkupItem(b)})):y.push(Promise.resolve(m._handleLoadMarkupItem(C)));E=g.imageSrc;void 0!==E&&0<E.length&&(F=new Image,F.src=E,m.setSnapshotImage(F));return[4,Promise.all(y)];case 1:return G=k.sent(),[2,new f(m,G)]}})})};a.prototype.toJson=function(){return this._toJson()};a.prototype._toJson=function(){var a={uniqueId:this._uniqueId,name:this._name,camera:this._camera.toJson(),
cuttingData:this._cuttingPlaneData,explodeMagnitude:this._explodeMagnitude,lineVisibility:this._lineVisibility,faceVisibility:this._faceVisibility,markup:[],sheetId:this._sheetId,defaultVisibility:this._defaultVisibility,visibilityExceptions:[],colors:[],imageSrc:""};this._markupItems.forEach(function(b){var c=b.toJson();c.className=b.getClassName();a.markup.push(c)});this._visibilityExceptions.forEach(function(b){a.visibilityExceptions.push(b)});this._colorMap.forEach(function(b,c){a.colors.push([c,
b.toJson()])});null!==this._snapshotImage&&(a.imageSrc=this._snapshotImage.src);return a};a.prototype.forJson=function(){return this.toJson()};return a}();h.MarkupView=a})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c,b,d,e,f,h){var g=a.call(this)||this;g._markupViews=new Map;g._defaultViewCounter=1;g._markupItemManager=b;g._callbackManager=d;g._explodeManager=e;g._cuttingManager=f;g._viewer=c;g._sheetManager=h;g._initEvents();return g}__extends(e,a);e.prototype._initEvents=function(){var a=this;this._callbackManager.bind({modelSwitchStart:function(){a._markupItemManager.shutdown()}})};e.prototype.getView=function(a){a=this._markupViews.get(a);return void 0!==
a?a:null};e.prototype.getViewKeys=function(){var a=[];this._markupViews.forEach(function(b,c){a.push(c)});return a};e.prototype.loadData=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,f,n,m=this;return __generator(this,function(g){b=[];c=0;for(e=a;c<e.length;c++)f=e[c],n=d.Markup.MarkupView._fromJson(f,this._viewer).then(function(b){if(!h.all(b.itemResults))return!1;b=b.markupView;var a=b.getUniqueId();return m._markupViews.has(a)?!1:(m._markupViews.set(a,b),m._callbackManager.trigger("viewLoaded",
b),!0)}),b.push(n);return[2,Promise.all(b)]})})};e.prototype.exportMarkup=function(){var a=[];this._markupViews.forEach(function(b){a.push(b.toJson())});return a};e.prototype.createView=function(a,b,g,e,f,h){void 0===a&&(a=this._createDefaultViewName());void 0===b&&(b=!0);void 0===g&&(g=null);void 0===e&&(e=null);void 0===f&&(f=null);void 0===h&&(h=null);var c=this._viewer.view,k=d.GUID.create();a=new d.Markup.MarkupView(k,a,c.getCamera(),this._explodeManager.getMagnitude(),this._cuttingManager.toJson(),
g);this._markupViews.set(k,a);a.setLineVisibility(c.getLineVisibility());a.setFaceVisibility(c.getFaceVisibility());null!==e&&(a.setDefaultVisibility(e.defaultVisibility),a.setVisibilityExceptions(e.visibilityExceptions));null!==f&&a.setColorMap(f);null!==h&&a.setSnapshotImage(h);this._markupItemManager.setActiveView(a);b&&this._callbackManager.trigger("viewCreated",a);return a};e.prototype._activateSheet=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return null!==
a?[2,this._sheetManager.setActiveSheetId(a,!0,!1)]:[2]})})};e.prototype._activateViewImpl=function(a,b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return[4,this._activateSheet(a.getSheetId())];case 1:return d.sent(),c=this._viewer.view,c.setFaceVisibility(a.getFaceVisibility()),c.setLineVisibility(a.getLineVisibility()),0<b?[4,this._markupItemManager.setActiveView(null)]:[3,4];case 2:return d.sent(),[4,c._setCameraPromise(a.getCamera(),
b)];case 3:return d.sent(),[3,5];case 4:c.setCamera(a.getCamera()),d.label=5;case 5:return[4,this._setActiveView(a)];case 6:return d.sent(),[2]}})})};e.prototype._activateView=function(a,b){a=this._markupViews.get(a);return void 0!==a?(b=this._activateViewImpl(a,b),h.UnsafePromise.create(!0,b)):h.UnsafePromise.create(!1,Promise.resolve())};e.prototype.activateView=function(a,b){void 0===b&&(b=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,
this._activateView(a,b)]})})};e.prototype.deprecatedActivateView=function(a,b){void 0===b&&(b=d.DefaultTransitionDuration);return this._activateView(a,b).unsafeValue};e.prototype._setActiveView=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,d,e,f;return __generator(this,function(g){switch(g.label){case 0:return this._viewer.model.isDrawing()?null!==a.getSheetId()?[3,2]:[4,this._viewer.deactivateSheets()]:[3,5];case 1:return g.sent(),[3,4];case 2:b=a.getVisibilityExceptions();c=
a.getDefaultVisibility();if(!(0<b.size&&c))return[3,4];d=[];b.forEach(function(b){d.push(b)});return[4,this._viewer.model.setNodesVisibility(d,!1)];case 3:g.sent(),g.label=4;case 4:return[3,8];case 5:b=a.getVisibilityExceptions();if(!(0<b.size))return[3,8];c=a.getDefaultVisibility();e=this._viewer.model.getAbsoluteRootNode();return[4,this._viewer.model.setNodesVisibility([e],c)];case 6:return g.sent(),f=[],b.forEach(function(b){f.push(b)}),[4,this._viewer.model.setNodesVisibility(f,!c)];case 7:g.sent(),
g.label=8;case 8:return[4,this._markupItemManager.setActiveView(a)];case 9:return g.sent(),[4,this._cuttingManager.fromJson(a.getCuttingPlaneData())];case 10:return g.sent(),[4,this._viewer.model.setNodesColors(a.getColorMap())];case 11:return g.sent(),[4,this._explodeManager.setMagnitude(a.getExplodeMagnitude())];case 12:return g.sent(),[2]}})})};e.prototype.deleteView=function(a){var b=this._markupViews.get(a);return void 0!==b?(this._callbackManager.trigger("viewDeleted",b),b===this._markupItemManager.getActiveView()&&
this._markupItemManager.setActiveView(null),this._markupViews.delete(a),!0):!1};e.prototype._createDefaultViewName=function(){return"View "+this._defaultViewCounter++};e.prototype.toJson=function(){return this.exportMarkup()};e.prototype.forJson=function(){return this.toJson()};return e}(d.MarkupTypeManager);h.MarkupViewManager=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(a){function c(b,c,e,f,h){void 0===c&&(c=null);void 0===e&&(e=null);void 0===f&&(f=null);void 0===h&&(h=null);var g=a.call(this)||this;g._uniqueId=d.GUID.create();g._lineMeshId=null;g._lineMeshInstanceId=null;g._lineColor=d.Color.red();g._lineOpacity=1;g._linePattern=null;g._linePatternLength=null;g._linePatternLengthUnit=null;g._viewer=b;g._firstPoint=c;g._secondPoint=e;g._firstNodeId=f;g._secondNodeId=h;return g}__extends(c,a);c.prototype.setLineColor=
function(b){this._lineColor=b};c.prototype.getLineColor=function(){return this._lineColor};c.prototype.setLineOpacity=function(b){this._lineOpacity=b};c.prototype.getLineOpacity=function(){return this._lineOpacity};c.prototype.setLinePattern=function(b,a,c){this._linePattern=b;this._linePatternLength=a;this._linePatternLengthUnit=c};c.prototype.getLinePattern=function(){return void 0!==this._linePattern?this._linePattern:null};c.prototype.getLinePatternLength=function(){return void 0!==this._linePatternLength?
this._linePatternLength:null};c.prototype.getLinePatternLengthUnit=function(){return void 0!==this._linePatternLengthUnit?this._linePatternLengthUnit:null};c.prototype.setFirstPoint=function(b){this._firstPoint=b};c.prototype.getFirstPoint=function(){return this._firstPoint};c.prototype.setSecondPoint=function(b){this._secondPoint=b};c.prototype.getSecondPoint=function(){return this._secondPoint};c.prototype.setFirstNodeId=function(b){this._firstNodeId=b};c.prototype.getFirstNodeId=function(){return this._firstNodeId};
c.prototype.setSecondNodeId=function(b){this._secondNodeId=b};c.prototype.getSecondNodeId=function(){return this._secondNodeId};c.prototype.getNodeId=function(){return this._lineMeshInstanceId};c.prototype.removeLine=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(a){switch(a.label){case 0:return b=this._viewer.model,null===this._lineMeshInstanceId?[3,3]:[4,b.deleteMeshInstances([this._lineMeshInstanceId])];case 1:return a.sent(),this._lineMeshInstanceId=
null,null===this._lineMeshId?[3,3]:[4,b.deleteMeshes([this._lineMeshId])];case 2:a.sent(),this._lineMeshId=null,a.label=3;case 3:return[2]}})})};c.prototype.updateLine=function(){return __awaiter(this,void 0,void 0,function(){var b,a,c,e,f;return __generator(this,function(g){switch(g.label){case 0:return[4,this.removeLine()];case 1:g.sent();if(null===this._firstPoint||null===this._secondPoint)return[3,4];b=new d.MeshData;b.addPolyline([this._firstPoint.x,this._firstPoint.y,this._firstPoint.z,this._secondPoint.x,
this._secondPoint.y,this._secondPoint.z]);a=this._viewer.model;return[4,a.createMesh(b)];case 2:return this._lineMeshId=c=g.sent(),e=new d.MeshInstanceData(c),e.setLineColor(this._lineColor),e.setLineOpacity(this._lineOpacity),e.setCreationFlags(d.MeshInstanceCreationFlags.ExcludeBounding),[4,a.createMeshInstance(e)];case 3:f=g.sent(),null!==this._linePattern&&a.setNodesLinePattern([f],this._linePattern,this._linePatternLength,this._linePatternLengthUnit),this._lineMeshInstanceId=f,g.label=4;case 4:return[2]}})})};
c.prototype.getId=function(){return this._uniqueId};c.prototype.setId=function(b){this._uniqueId=b};c.prototype.getClassName=function(){return c.className};c.prototype._toJson=function(){return{className:this.getClassName(),uniqueId:this._uniqueId,firstPoint:this.getFirstPoint(),secondPoint:this.getSecondPoint(),firstNodeId:this.getFirstNodeId(),secondNodeId:this.getSecondNodeId(),lineColor:this.getLineColor(),lineOpacity:this.getLineOpacity(),linePattern:this.getLinePattern(),linePatternLength:this.getLinePatternLength(),
linePatternLengthUnit:this.getLinePatternLengthUnit()}};c.prototype.toJson=function(){return this._toJson()};c.fromJson=function(b,a){return __awaiter(this,void 0,void 0,function(){var g,e;return __generator(this,function(f){g=b;e=new c(a,d.Point3.fromJson(g.firstPoint),d.Point3.fromJson(g.secondPoint),g.firstNodeId,g.secondNodeId);e.setId(g.uniqueId);e.setLineColor(d.Color.fromJson(g.lineColor));e.setLineOpacity(g.lineOpacity);null!=g.linePattern&&null!=g.linePatternLength&&null!=g.linePatternLengthUnit&&
e.setLinePattern(g.linePattern,g.linePatternLength,g.linePatternLengthUnit);return[2,e]})})};c.className="Communicator.Markup.Line.LineMarkup";return c}(h.MarkupItem);f.LineMarkup=a})(h.Line||(h.Line={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(a){function c(b){var c=a.call(this)||this;c._stage=0;c._finalized=!1;c._uniqueId="";c._positions=[];c._name="";c._measurementValue=0;c._unitMultiplier=1;c._textShape=new h.Shape.TextBox;c._visibility=!0;c._positions=[];c._lineShapes=[];c._viewer=b;return c}__extends(c,a);c.prototype.getName=function(){return this._name};c.prototype.setName=function(b){this._name=b};c.prototype._getStage=function(){return this._stage};c.prototype._nextStage=function(){this._stage++};
c.prototype._setId=function(b){this._uniqueId=b};c.prototype._getId=function(){return this._uniqueId};c.prototype.adjust=function(b){b};c.prototype._isFinalized=function(){return this._finalized};c.prototype.update=function(){};c.prototype.draw=function(){this.update()};c.prototype.setVisibility=function(b){this._visibility=b;this.draw();var a=this._viewer._getCallbackManager();b?a.trigger("measurementShown",this):a.trigger("measurementHidden",this)};c.prototype.getVisibility=function(){return this._visibility};
c.prototype.toJson=function(){return{}};c.prototype.forJson=function(){return this.toJson()};c.prototype.getMeasurementValue=function(){return this._measurementValue};c.prototype.getUnitMultiplier=function(){return this._unitMultiplier};c.prototype.setMeasurementText=function(b){this._textShape.setTextString(b)};c.prototype.getMeasurementText=function(){return this._textShape.getTextString()};c.prototype._setMeasurementValue=function(b){this._measurementValue=b/this._unitMultiplier;this.setMeasurementText(d.Util.formatWithUnit(this._measurementValue,
this._unitMultiplier));this._viewer.trigger("measurementValueSet",this)};c._serializePointArray=function(b){for(var a=[],c=0;c<b.length;c++)a.push(b[c].toJson());return a};c._constructPointArray=function(b){for(var a=[],c=0;c<b.length;c++){var e=d.Point3.fromJson(b[c]);a.push(e)}return a};return c}(h.MarkupItem);f.MeasureMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(f){var a=function(a){function c(b){var c=a.call(this,b)||this;c._lineEdgeShape=new d.Shape.Polyline;c._linePositions=[];c._name="MeasureLength";c._positions=[];c._lineShapes=[];c._lineEdgeShape.setStrokeWidth(4);c._lineEdgeShape.setStrokeColor(b.measureManager.getMeasurementEdgeColor());return c}__extends(c,a);c.prototype.setLineGeometry=function(b){this._lineEdgeShape.setStrokeColor(this._viewer.measureManager.getMeasurementEdgeColor());this._linePositions=b;this._stage=
1};c.prototype.reset=function(){this._stage=0};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b)};c.prototype.update=function(){a.prototype.update.call(this);var b=this._viewer.measureManager,c=b.getMeasurementColor();b=b.getMeasurementEdgeColor();this._lineShapes.forEach(function(b){b.setStrokeColor(c)});this._lineEdgeShape.setStrokeColor(b)};c.prototype.draw=function(){};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureLengthMarkup"};return c}(f.MeasureMarkup);
f.MeasureLengthMarkup=a})(d.Measure||(d.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(a){function c(b,c,e,f){var g=a.call(this,b)||this;g._circlePoints=[];g._radius=0;g._surfaceCenter=d.Point3.zero();g._circlePlane=new d.Plane;g._arrowsInvert=!1;g._name="MeasureCircleEdgeLength";g._lineProperties=c;g._matrix=e.copy();g._unitMultiplier=f;g._textShape.getBoxPortion().setFillOpacity(1);g._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));for(c=0;5>c;c++)g._lineShapes.push(new h.Shape.Line),g._lineShapes[c].setStrokeColor(b.measureManager.getMeasurementColor());
return g}__extends(c,a);c.prototype.createCircleData=function(){d.Util.generatePointsOnCircle(this._circlePoints,this._lineProperties.origin,this._lineProperties.radius,32,this._lineProperties.normal);this._matrix.transformArray(this._circlePoints,this._circlePoints);this._positions[0]=this._circlePoints[0].copy();this._positions[1]=this._circlePoints[16].copy();var b=new d.Point3(this._lineProperties.radius,0,0),a=new d.Point3(0,0,0);this._matrix.transform(b,b);this._matrix.transform(a,a);this._radius=
d.Point3.subtract(a,b).length();d.Point3.subtract(this._positions[1],this._positions[0]);this._positions[4]=this._positions[1].copy();this._surfaceCenter=this._matrix.transform(this._lineProperties.origin);b=new d.Point3(this._circlePoints[0].x,this._circlePoints[0].y,this._circlePoints[0].z);a=new d.Point3(this._circlePoints[1].x,this._circlePoints[1].y,this._circlePoints[1].z);this._circlePlane=d.Plane.createFromPoints(b,a,this._surfaceCenter)};c.prototype.setLineGeometry=function(b){a.prototype.setLineGeometry.call(this,
b);this._positions[0]=this._linePositions[0];this._positions[0].equals(this._positions[this._positions.length-1])?this._positions[1]=this._positions[Math.floor(this._positions.length/2)]:this._positions[1]=this._linePositions[this._linePositions.length-1];this._positions[1]=this._linePositions[this._linePositions.length-1];this._positions[2]=this._linePositions[1].copy();this.createCircleData();this._setMeasurementValue(this._radius)};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);
var c=this._viewer.view.raycastFromPoint(b);if(null!==c){b=this._surfaceCenter;var e=this._circlePlane,f=e.rayIntersection(c);null===f&&(f=d.Point3.add(b,c.direction.copy().scale(-2*this._radius)),f=d.Plane.createFromPointAndNormal(f,c.direction).rayIntersection(c),console.assert(null!==f),c=new d.Ray(f,e.normal),f=e.rayIntersection(c),null===f&&(f=e.rayIntersection(c.negate())));null===f&&(console.assert(!1),f=b.copy());c=d.Point3.subtract(f,b).normalize().scale(this._radius);e=d.Point3.add(b,c);
b=d.Point3.subtract(b,c);this._positions[0]=e;this._positions[1]=b;this._positions[2]=e.copy();this._positions[3]=b.copy();this._positions[4]=f.copy();this._positions[5]=this._surfaceCenter.copy();this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var b=new d.Point3((this._positions[4].x+this._positions[5].x)/2,(this._positions[4].y+this._positions[5].y)/2,(this._positions[4].z+this._positions[5].z)/2),a=d.Point3.subtract(this._positions[5],
this._positions[4]);this._arrowsInvert=2*d.Point3.subtract(this._positions[2],b).length()>a.length()};c.prototype.update=function(){a.prototype.update.call(this);var b=this._viewer.view;if(0<this._stage){this._lineEdgeShape.clearPoints();for(var c=0,e=this._linePositions;c<e.length;c++){var f=d.Point2.fromPoint3(b.projectPoint(e[c]));this._lineEdgeShape.pushPoint(f)}}if(1<this._stage){c=Array(6);for(e=0;e<this._positions.length;e++)c[e]=d.Point2.fromPoint3(b.projectPoint(this._positions[e]));this._textShape&&
this._textShape.setPosition(c[4]);this._lineShapes[0].set(c[5],c[2]);this._lineShapes[1].set(c[5],c[4]);b=this._viewer.measureManager.getMeasurementColor();this._lineShapes[0].setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[0].setStartEndcapType(h.Shape.EndcapType.None);this._lineShapes[0].setEndcapsInverted(this._arrowsInvert);this._lineShapes[0].setEndEndcapColor(b);this._lineShapes[0].setStartEndcapColor(b)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()){this.update();
var b=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:b.drawPolyline(this._lineEdgeShape);break;case 2:case 3:for(var a=0;2>a;a++)b.drawLine(this._lineShapes[a]);b.drawTextBox(this._textShape);b.drawPolyline(this._lineEdgeShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){var b=f.MeasureMarkup._serializePointArray(this._linePositions),a=f.MeasureMarkup._serializePointArray(this._positions);return{matrix:this._matrix.toJson(),lineOrigin:this._lineProperties.origin,
lineRadius:this._lineProperties.radius,lineNormal:this._lineProperties.normal,linePositions:b,positions:a,text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){var g=d.Matrix.fromJson(b.matrix),e=b.lineRadius,h=d.Point3.fromJson(b.lineOrigin),m=d.Point3.fromJson(b.lineNormal);e=new d.SubentityProperties.CircleElement(e,h,m);a=new c(a,
e,g,b.unitMultiplier||1);g=f.MeasureMarkup._constructPointArray(b.linePositions);e=f.MeasureMarkup._constructPointArray(b.positions);a.setLineGeometry(g);a._positions=e;a._textShape.setTextString(b.text);a._stage=3;a._measurementValue=b.measurementValue;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureCircleEdgeLengthMarkup"};return c}(f.MeasureLengthMarkup);f.MeasureCircleEdgeLengthMarkup=a})(h.Measure||(h.Measure=
{}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(a){function c(b){b=a.call(this,b)||this;b._faceSelection=[];b._arcArray=[];b._lineGeometryShape=new h.Shape.Polyline;b.planeIntersectionLine=[];b._pointOnLine=d.Point3.zero();b._clickpointOriginal2=d.Point3.zero();b._clickpointOriginal1=d.Point3.zero();b._plane1=new d.Plane;b._plane2=new d.Plane;b._secondPoint=d.Point3.zero();b._firstPoint=d.Point3.zero();b._textPos=d.Point3.zero();b._intermediatePoint=d.Point3.zero();b._textAnchorPoint=d.Point3.zero();
b._angle=0;b._name="MeasureFaceFaceAngle";b._lineGeometryShape.setStrokeWidth(2);b._lineGeometryShape.setStrokeColor(b._viewer.measureManager.getMeasurementColor());b._textShape=new h.Shape.TextBox;b._textShape.getBoxPortion().setFillOpacity(1);b._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));for(var c=0;5>c;c++)b._lineShapes.push(new h.Shape.Line),b._lineShapes[c].setStrokeColor(b._viewer.measureManager.getMeasurementColor());return b}__extends(c,a);c.prototype.getFirstSelection=
function(){return this._faceSelection[0]};c.prototype.setFirstFace=function(b){this._viewer.model.setNodeFaceColor(b.getNodeId(),b.getFaceEntity().getCadFaceIndex(),new d.Color(255,0,0));this._faceSelection.push(b);this._firstPoint=this._faceSelection[0].getPosition().copy();this._plane1.setFromPointAndNormal(b.getPosition(),b.getFaceEntity().getNormal());this._clickpointOriginal1=this._firstPoint.copy();this._stage++};c.prototype.setSecondFace=function(b){this._faceSelection[1]=b;this._secondPoint=
this._faceSelection[1].getPosition().copy();this._viewer.model.setNodeFaceColor(b.getNodeId(),b.getFaceEntity().getCadFaceIndex(),new d.Color(255,0,0));this._plane2.setFromPointAndNormal(b.getPosition(),b.getFaceEntity().getNormal());this.planeIntersectionLine[0]=new d.Point3(0,0,0);this.planeIntersectionLine[1]=new d.Point3(0,0,0);if(2!==d.Util.intersect3d2Planes(this._plane1,this._firstPoint,this._plane2,this._secondPoint,this.planeIntersectionLine[0],this.planeIntersectionLine[1]))return!1;b=d.Point3.subtract(this.planeIntersectionLine[1],
this.planeIntersectionLine[0]);b.normalize();this.planeIntersectionLine[0].set(this.planeIntersectionLine[0].x-100*b.x,this.planeIntersectionLine[0].y-100*b.y,this.planeIntersectionLine[0].z-100*b.z);this.planeIntersectionLine[1].set(this.planeIntersectionLine[1].x+100*b.x,this.planeIntersectionLine[1].y+100*b.y,this.planeIntersectionLine[1].z+100*b.z);d.Util.computePointToLineDistance(this._secondPoint,this.planeIntersectionLine[0],this.planeIntersectionLine[1],this._pointOnLine);var a=new d.Point3(0,
0,0),c=new d.Point3(0,0,0);a.set(this._firstPoint.x+b.x,this._firstPoint.y+b.y,this._firstPoint.z+b.z);d.Util.computePointToLineDistance(this._pointOnLine,this._firstPoint,a,c);this._firstPoint=c.copy();this._clickpointOriginal2=this._secondPoint.copy();a=new d.Matrix;c=d.Point3.subtract(this._secondPoint,this._pointOnLine);var e=c.length(),f=d.Point3.subtract(this._firstPoint,this._pointOnLine);f.normalize();this._intermediatePoint.set(this._pointOnLine.x+f.x*e,this._pointOnLine.y+f.y*e,this._pointOnLine.z+
f.z*e);this._angle=d.Util.computeAngleBetweenVector(c,f);if(0===this._angle)return!1;this._measurementValue=this._angle;this._textShape.setTextString(this._measurementValue.toFixed(2)+"\u00b0");this._viewer.trigger("measurementValueSet",this);this._textPos=this._pointOnLine.copy();e=!1;var h=new d.Point3(0,0,0);f=new d.Point3(0,0,0);d.Util.computeOffaxisRotation(b,1,a);a.transform(c,f);h.set(f.x+this._pointOnLine.x,f.y+this._pointOnLine.y,f.z+this._pointOnLine.z);h=d.Point3.subtract(h,this._firstPoint);
var p=h.length();d.Util.computeOffaxisRotation(b,-1,a);a.transform(c,f);h.set(f.x+this._pointOnLine.x,f.y+this._pointOnLine.y,f.z+this._pointOnLine.z);d.Point3.subtract(h,this._firstPoint);h.length()<p&&(e=!0);h=this._angle/30;for(p=0;p<=this._angle;p+=h)e?d.Util.computeOffaxisRotation(b,-p,a):d.Util.computeOffaxisRotation(b,p,a),a.transform(c,f),this._arcArray.push(new d.Point3(f.x+this._pointOnLine.x,f.y+this._pointOnLine.y,f.z+this._pointOnLine.z));this._stage++;return!0};c.prototype.adjust=function(b){a.prototype.adjust.call(this,
b);if(!(1>=this._stage)&&(b=this._viewer.view.raycastFromPoint(b),null!==b)){var c=new d.Point3(b.origin.x+1E6*b.direction.x,b.origin.y+1E6*b.direction.y,b.origin.z+1E6*b.direction.z),e=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(b.origin,c,this._pointOnLine,this._firstPoint,this._secondPoint,e);this._textPos=e.copy();new d.Point3(0,0,0);b=d.Point3.subtract(e,this._pointOnLine);c=b.length();b=d.Point3.subtract(this._secondPoint,this._pointOnLine);b.normalize();this._secondPoint.set(this._pointOnLine.x+
b.x*c,this._pointOnLine.y+b.y*c,this._pointOnLine.z+b.z*c);b=d.Point3.subtract(this.planeIntersectionLine[1],this.planeIntersectionLine[0]);b.normalize();c=new d.Matrix;e=d.Point3.subtract(this._secondPoint,this._pointOnLine);var f=e.length(),h=d.Point3.subtract(this._firstPoint,this._pointOnLine);h.normalize();this._intermediatePoint.set(this._pointOnLine.x+h.x*f,this._pointOnLine.y+h.y*f,this._pointOnLine.z+h.z*f);h=!1;f=new d.Point3(0,0,0);var m=new d.Point3(0,0,0);d.Util.computeOffaxisRotation(b,
1,c);c.transform(e,m);f.set(m.x+this._pointOnLine.x,m.y+this._pointOnLine.y,m.z+this._pointOnLine.z);f=d.Point3.subtract(f,this._firstPoint);var p=f.length();d.Util.computeOffaxisRotation(b,-1,c);c.transform(e,m);f.set(m.x+this._pointOnLine.x,m.y+this._pointOnLine.y,m.z+this._pointOnLine.z);f=d.Point3.subtract(f,this._firstPoint);f.length()<p&&(h=!0);p=99999;f=this._viewer.view.projectPoint(this._textPos);this._arcArray=[];for(var r=this._angle/30,q=0;q<=this._angle;q+=r){h?d.Util.computeOffaxisRotation(b,
-q,c):d.Util.computeOffaxisRotation(b,q,c);c.transform(e,m);var u=new d.Point3(m.x+this._pointOnLine.x,m.y+this._pointOnLine.y,m.z+this._pointOnLine.z);u=this._viewer.view.projectPoint(u);u=(new d.Point3(f.x-u.x,f.y-u.y,f.z-u.z)).length();p>u&&(p=u);this._arcArray.push(new d.Point3(m.x+this._pointOnLine.x,m.y+this._pointOnLine.y,m.z+this._pointOnLine.z))}20>=p?this._textAnchorPoint=this._textPos:(c=this._viewer.view.projectPoint(this._intermediatePoint),b=this._viewer.view.projectPoint(this._secondPoint),
c=new d.Point3(c.x-f.x,c.y-f.y,c.z-f.z),b=new d.Point3(b.x-f.x,b.y-f.y,b.z-f.z),c=c.length(),b=b.length(),this._textAnchorPoint=c<b?this._intermediatePoint:this._secondPoint)}};c.prototype._nextStage=function(){this._stage++;2<this._stage&&(this._finalized=!0,this.cleanup())};c.prototype.cleanup=function(){var b=this,a=function(a){a=b._faceSelection[a];b._viewer.model.unsetNodeFaceColor(a.getNodeId(),a.getFaceEntity().getCadFaceIndex())};2<=this._stage&&a(1);1<=this._stage&&a(0)};c.prototype.update=
function(){a.prototype.update.call(this);var b=this._viewer.view;if(1<this._stage){this._lineGeometryShape.clearPoints();for(var c=0,e=this._arcArray;c<e.length;c++)this._lineGeometryShape.pushPoint(d.Point2.fromPoint3(b.projectPoint(e[c])));this._lineGeometryShape.setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineGeometryShape.setStartEndcapType(h.Shape.EndcapType.Arrowhead);this._lineGeometryShape.setEndEndcapSize(5);this._lineGeometryShape.setStartEndcapSize(5);this._lineGeometryShape.setEndEndcapColor(this._viewer.measureManager.getMeasurementColor());
this._lineGeometryShape.setStartEndcapColor(this._viewer.measureManager.getMeasurementColor());c=Array(10);c[0]=b.projectPoint(this._textPos);c[1]=b.projectPoint(this._firstPoint);c[2]=b.projectPoint(this._clickpointOriginal1);c[3]=b.projectPoint(this._secondPoint);c[4]=b.projectPoint(this._clickpointOriginal2);c[5]=b.projectPoint(this._intermediatePoint);c[6]=b.projectPoint(this._textAnchorPoint);this._behindView=!1;b=Array(10);for(e=0;6>=e;e++)0>=c[e].z&&(this._behindView=!0),b[e]=d.Point2.fromPoint3(c[e]);
this._textShape&&this._textShape.setPosition(b[0]);this._lineShapes[0].set(b[1],b[2]);this._lineShapes[1].set(b[1],b[5]);this._lineShapes[2].set(b[3],b[4]);this._lineShapes[3].set(b[6],b[0])}};c.prototype.draw=function(){var b=0!==this._viewer.explodeManager.getMagnitude();if(this._visibility&&!b&&(this.update(),!this._behindView&&2<=this._stage&&4>=this._stage)){b=this._viewer.markupManager.getRenderer();for(var a=0;4>a;a++)b.drawLine(this._lineShapes[a]);b.drawTextBox(this._textShape);b.drawPolyline(this._lineGeometryShape)}};
c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var b=[],a=0,c=this._arcArray;a<c.length;a++){var d=c[a].toJson();b.push(d)}return{text:this._textShape.getTextString(),textPos:this._textPos.toJson(),arcArray:b,firstPoint:this._firstPoint.toJson(),clickpointOriginal1:this._clickpointOriginal1.toJson(),secondPoint:this._secondPoint.toJson(),clickpointOriginal2:this._clickpointOriginal2.toJson(),intermediatePoint:this._intermediatePoint.toJson(),textAnchorPoint:this._textAnchorPoint.toJson(),
measurementValue:this._measurementValue,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);for(var g=0,e=b.arcArray;g<e.length;g++){var f=d.Point3.fromJson(e[g]);a._arcArray.push(f)}a._textShape.setTextString(b.text);a._textPos.assign(d.Point3.fromJson(b.textPos));a._firstPoint.assign(d.Point3.fromJson(b.firstPoint));a._clickpointOriginal1=d.Point3.fromJson(b.clickpointOriginal1);a._secondPoint.assign(d.Point3.fromJson(b.secondPoint));
a._clickpointOriginal2=d.Point3.fromJson(b.clickpointOriginal2);a._intermediatePoint.assign(d.Point3.fromJson(b.intermediatePoint));a._textAnchorPoint.assign(d.Point3.fromJson(b.textAnchorPoint));a._measurementValue=b.measurementValue;a._stage=3;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureFaceFaceAngleMarkup"};return c}(f.MeasureMarkup);f.MeasureFaceFaceAngleMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||
(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(a){function c(b){b=a.call(this,b)||this;b._faceSelection=[];b._line1PreviewShape1=new h.Shape.Line;b._line1PreviewShape2=new h.Shape.Line;b._line2PreviewShape1=new h.Shape.Line;b._line2PreviewShape2=new h.Shape.Line;b._matrix1=new d.Matrix;b._matrix2=new d.Matrix;b._lineGeometryShape=new h.Shape.Polyline;b._parallelFaces=!1;b._triangulatedDistance=!0;b._pointsOnSameRay=!1;b._arrowsInvert=!1;b._faceData=[];b._distance=0;b._surfaceCenter=[d.Point3.zero(),
d.Point3.zero()];b._surfaceAxis1=[d.Point3.zero(),d.Point3.zero()];b._surfaceAxis2=[d.Point3.zero(),d.Point3.zero()];b._cylinderAxisInfinite1=[d.Point3.zero(),d.Point3.zero()];b._cylinderAxisInfinite2=[d.Point3.zero(),d.Point3.zero()];b._firstPointHelper=d.Point3.zero();b._secondPointHelper=d.Point3.zero();b._secondPoint=d.Point3.zero();b._firstPoint=d.Point3.zero();b._textPos=d.Point3.zero();b._name="MeasureFaceFaceDistance";b._lineGeometryShape.setStrokeWidth(2);b._lineGeometryShape.setStrokeColor(b._viewer.measureManager.getMeasurementColor());
b._textShape=new h.Shape.TextBox;b._textShape.getBoxPortion().setFillOpacity(1);b._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));for(var c=0;5>c;c++)b._lineShapes.push(new h.Shape.Line),b._lineShapes[c].setStrokeColor(b._viewer.measureManager.getMeasurementColor());return b}__extends(c,a);c.prototype.setUnitMultiplier=function(b){this._unitMultiplier=b};c.prototype.setFirstFace=function(b,a,c,e){var g=b.getNodeId(),f=b.getFaceEntity(),k=b.getPosition();this._matrix1=c.copy();this._viewer.model.setNodeFaceColor(g,
f.getCadFaceIndex(),new d.Color(255,0,0));this._faceSelection[0]=b;this._firstPoint=k.copy();this._faceData[0]=a;this._faceData[0]instanceof d.SubentityProperties.PlaneElement?(b=this._faceData[0],a=new d.Point3(b.origin.x+b.normal.x,b.origin.y+b.normal.y,b.origin.z+b.normal.z),this._matrix1.transform(a,this._surfaceAxis1[0]),this._matrix1.transform(b.origin,this._surfaceCenter[0])):this._faceData[0]instanceof d.SubentityProperties.CylinderElement&&this.createCylinderData(this._faceData[0],c,e);this._stage++};
c.prototype.getFirstSelection=function(){return this._faceSelection[0]||null};c.prototype.getFirstFaceData=function(){return this._faceData[0]||null};c.prototype.cleanup=function(){var b=this._viewer.model;2<=this._stage&&b.unsetNodeFaceColor(this._faceSelection[1].getNodeId(),this._faceSelection[1].getFaceEntity().getCadFaceIndex());1<=this._stage&&b.unsetNodeFaceColor(this._faceSelection[0].getNodeId(),this._faceSelection[0].getFaceEntity().getCadFaceIndex())};c.prototype.createCylinderData=function(b,
a,c){c=d.Point3.subtract(c.max,c.min).length()/4;var g=new d.Point3(b.origin.x+1E4*b.normal.x,b.origin.y+1E4*b.normal.y,b.origin.z+1E4*b.normal.z),e=new d.Point3(b.origin.x-1E4*b.normal.x,b.origin.y-1E4*b.normal.y,b.origin.z-1E4*b.normal.z),f=new d.Point3(0,0,0);d.Util.computePointToLineDistance(b.origin,g,e,f);this._surfaceCenter[this._stage]=new d.Point3(0,0,0);a.transform(f,this._surfaceCenter[this._stage]);g=new d.Point3(f.x+b.normal.x,f.y+b.normal.y,f.z+b.normal.z);this._surfaceAxis1[this._stage]=
new d.Point3(0,0,0);a.transform(g,this._surfaceAxis1[this._stage]);g.set(f.x-b.normal.x,f.y-b.normal.y,f.z-b.normal.z);this._surfaceAxis2[this._stage]=new d.Point3(0,0,0);a.transform(g,this._surfaceAxis2[this._stage]);new d.Point3(0,0,0);b=this._surfaceAxis1[this._stage].copy();b=d.Point3.subtract(b,this._surfaceCenter[this._stage]);b.normalize();this._surfaceAxis1[this._stage].set(this._surfaceCenter[this._stage].x+b.x*c,this._surfaceCenter[this._stage].y+b.y*c,this._surfaceCenter[this._stage].z+
b.z*c);this._surfaceAxis2[this._stage].set(this._surfaceCenter[this._stage].x-b.x*c,this._surfaceCenter[this._stage].y-b.y*c,this._surfaceCenter[this._stage].z-b.z*c);this._cylinderAxisInfinite1[this._stage]=new d.Point3(this._surfaceCenter[this._stage].x+b.x*c*1E3,this._surfaceCenter[this._stage].y+b.y*c*1E3,this._surfaceCenter[this._stage].z+b.z*c*1E3);this._cylinderAxisInfinite2[this._stage]=new d.Point3(this._surfaceCenter[this._stage].x-b.x*c*1E3,this._surfaceCenter[this._stage].y-b.y*c*1E3,
this._surfaceCenter[this._stage].z-b.z*c*1E3)};c.prototype.setSecondFace=function(b,a,c,e,f){return __awaiter(this,void 0,void 0,function(){var g,k,l,h,n,t,v,w,z,y,x,A,B,D,C,E,F,G,I,J,K,H;return __generator(this,function(m){switch(m.label){case 0:g=this._faceSelection[0];k=this._faceData[0];if(void 0===g||void 0===k)throw new d.CommunicatorError("setSecondFace() called before setFirstFace()");if(c instanceof d.SubentityProperties.PlaneElement)l=k,h=new d.Point3(l.origin.x+l.normal.x,l.origin.y+l.normal.y,
l.origin.z+l.normal.z),this._matrix1.transform(h,this._surfaceAxis1[0]),this._matrix1.transform(l.origin,this._surfaceCenter[0]);else if(c instanceof d.SubentityProperties.CylinderElement)this.createCylinderData(c,e,f);else return[2];return[4,this._viewer.model.computeMinimumFaceFaceDistance(g.getNodeId(),g.getFaceEntity().getCadFaceIndex(),a.getNodeId(),a.getFaceEntity().getCadFaceIndex())];case 1:n=m.sent();if(0===n.distance)return[2];this._matrix2=e.copy();this._secondPoint=a.getPosition().copy();
if(!(k instanceof d.SubentityProperties.PlaneElement&&c instanceof d.SubentityProperties.PlaneElement))return[3,2];t=c;h=new d.Point3(t.origin.x+t.normal.x,t.origin.y+t.normal.y,t.origin.z+t.normal.z);this._matrix2.transform(h,this._surfaceAxis1[1]);this._matrix2.transform(t.origin,this._surfaceCenter[1]);v=new d.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);w=new d.Point3(this._surfaceAxis1[1].x-
this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,this._surfaceAxis1[1].z-this._surfaceCenter[1].z);v.normalize();w.normalize();z=new d.Point3(-v.x,-v.y,-v.z);v.equalsWithTolerance(w,1E-5)||z.equalsWithTolerance(w,1E-5)?(this._secondPointHelper=new d.Point3(this._secondPoint.x,this._secondPoint.y,this._secondPoint.z),this._firstPointHelper=new d.Point3(this._firstPoint.x,this._firstPoint.y,this._firstPoint.z),y=new d.Plane,y.setFromPointAndNormal(this._surfaceCenter[0],v),
x=new d.Plane,x.setFromPointAndNormal(this._surfaceCenter[1],w),A=new d.Point3(this._firstPoint.x+v.x,this._firstPoint.y+v.y,this._firstPoint.z+v.z),d.Util.intersectionPlaneLine2(g.getPosition(),A,x,this._secondPoint),z.equalsWithTolerance(w,1E-5)&&(B=new d.Point3(-v.x,-v.y,-v.z),y.setFromPointAndNormal(this._surfaceCenter[0],B)),this._distance=D=Math.abs(x.d-y.d)/y.normal.length(),this._setMeasurementValue(this._distance),this._parallelFaces=!0,this._triangulatedDistance=!1,C=new d.Point3(0,1,0),
E=d.Point3.subtract(this._secondPoint,this._firstPoint),F=new d.Point3(0,0,0),F=d.Point3.subtract(this._secondPointHelper,this._firstPoint),G=d.Util.computeAngleBetweenVector(C,E),I=d.Util.computeAngleBetweenVector(C,F),this._textPos.assign(this._secondPoint),.1>G-I&&-.1<G-I&&(this._pointsOnSameRay=!0)):(this._firstPoint.assign(n.pos1),this._secondPoint.assign(n.pos2),this._textPos.assign(n.pos2),this._distance=n.distance,this._setMeasurementValue(this._distance));return[3,8];case 2:if(!(k instanceof
d.SubentityProperties.CylinderElement&&c instanceof d.SubentityProperties.CylinderElement))return[3,3];v=new d.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);w=new d.Point3(this._surfaceAxis1[1].x-this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,this._surfaceAxis1[1].z-this._surfaceCenter[1].z);v.normalize();w.normalize();z=new d.Point3(-v.x,-v.y,-v.z);if(v.equalsWithTolerance(w,
1E-5)||z.equalsWithTolerance(w,1E-5)){J=new d.Point3(0,0,0);d.Util.computePointToLineDistance(this._firstPoint,this._cylinderAxisInfinite1[0],this._cylinderAxisInfinite2[0],J);this._firstPoint=J.copy();K=new d.Point3(this._firstPoint.x,this._firstPoint.y,this._firstPoint.z);K=d.Point3.subtract(K,this._surfaceCenter[0]);K.set(0,0,0);d.Util.computePointToLineDistance(this._firstPoint,this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],J);this._secondPoint=J.copy();D=d.Point3.subtract(this._secondPoint,
this._firstPoint).length();if(1E-7>D)return[2];this._triangulatedDistance=!1;this._textPos.assign(this._secondPoint);this._setMeasurementValue(D)}else{this._distance=d.Util.distanceLineLine(this._cylinderAxisInfinite1[0],this._cylinderAxisInfinite2[0],this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],this._firstPoint,this._secondPoint);if(1E-7>this._distance)return[2];this._textPos.assign(this._firstPoint);this._setMeasurementValue(this._distance)}return[3,8];case 3:if(!(k instanceof d.SubentityProperties.CylinderElement&&
c instanceof d.SubentityProperties.PlaneElement))return[3,5];v=new d.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);return[4,this._viewer.model.computeMinimumFaceLineDistance(a.getNodeId(),a.getFaceEntity().getCadFaceIndex(),new d.Ray(this._surfaceCenter[0],v))];case 4:H=m.sent();this._distance=H.distance;if(1E-7>this._distance)return[2];this._firstPoint.assign(H.pos1);this._secondPoint.assign(H.pos2);
this._textPos.assign(H.pos2);this._viewer.model.setNodeFaceColor(a.getNodeId(),a.getFaceEntity().getCadFaceIndex(),new d.Color(255,0,0));this._faceData[1]=c;this._faceSelection[1]=a;this._stage++;this.adjust(b);this._setMeasurementValue(this._distance);return[3,8];case 5:if(!(k instanceof d.SubentityProperties.PlaneElement&&c instanceof d.SubentityProperties.CylinderElement))return[3,7];v=new d.Point3(this._surfaceAxis1[1].x-this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,
this._surfaceAxis1[1].z-this._surfaceCenter[1].z);return[4,this._viewer.model.computeMinimumFaceLineDistance(g.getNodeId(),g.getFaceEntity().getCadFaceIndex(),new d.Ray(this._surfaceCenter[1],v))];case 6:H=m.sent();this._distance=H.distance;if(1E-7>this._distance)return[2];this._firstPoint.assign(H.pos1);this._secondPoint.assign(H.pos2);this._textPos.assign(H.pos2);this._viewer.model.setNodeFaceColor(a.getNodeId(),a.getFaceEntity().getCadFaceIndex(),new d.Color(255,0,0));this._faceData[1]=c;this._faceSelection[1]=
a;this._stage++;this.adjust(b);this._setMeasurementValue(this._distance);return[3,8];case 7:this._firstPoint.assign(n.pos1);this._secondPoint.assign(n.pos2);this._textPos.assign(n.pos2);this._distance=n.distance;if(1E-7>this._distance)return[2];this._setMeasurementValue(this._distance);m.label=8;case 8:return this._viewer.model.setNodeFaceColor(a.getNodeId(),a.getFaceEntity().getCadFaceIndex(),new d.Color(255,0,0)),this._faceData[1]=c,this._faceSelection[1]=a,this._stage++,this.adjust(b),[2]}})})};
c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);if(!(1>=this._stage)){var c=this._viewer.view.raycastFromPoint(b);if(null!==c){var e=new d.Point3(c.origin.x+1E6*c.direction.x,c.origin.y+1E6*c.direction.y,c.origin.z+1E6*c.direction.z),f=d.Util.oneVectorCross(c.direction);new d.Point3(0,0,0);var h=d.Point3.cross(c.direction,f);h.normalize();new d.Point3((this._firstPoint.x+this._secondPoint.x)/2,(this._firstPoint.y+this._secondPoint.y)/2,(this._firstPoint.z+this._secondPoint.z)/2);var m=
this._textPos.copy();f.set(m.x+f.x,m.y+f.y,m.z+f.z);h.set(m.x+h.x,m.y+h.y,m.z+h.z);b=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(c.origin,e,m,f,h,b);2===this._stage?d.Util.computePointToLineDistance(b,this._firstPoint,this._secondPoint,this._textPos):this._parallelFaces||this._triangulatedDistance?(c=new d.Point3(0,0,0),this._pointsOnSameRay||(d.Util.computePointToLineDistance(b,this._secondPoint,this._secondPointHelper,c),new d.Point3(0,0,0),b=d.Point3.subtract(c,this._secondPoint),this._secondPoint=
c.copy(),this._firstPoint.set(this._firstPoint.x+b.x,this._firstPoint.y+b.y,this._firstPoint.z+b.z),this._textPos.set(this._textPos.x+b.x,this._textPos.y+b.y,this._textPos.z+b.z))):(c=new d.Point3(0,0,0),d.Util.computePointToLineDistance(b,this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],c),b=d.Point3.subtract(c,this._secondPoint),this._secondPoint=c.copy(),this._firstPoint.set(this._firstPoint.x+b.x,this._firstPoint.y+b.y,this._firstPoint.z+b.z),this._textPos.set(this._textPos.x+b.x,
this._textPos.y+b.y,this._textPos.z+b.z));this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}}};c.prototype._updateArrowsInverted=function(){var b=new d.Point3((this._firstPoint.x+this._secondPoint.x)/2,(this._firstPoint.y+this._secondPoint.y)/2,(this._firstPoint.z+this._secondPoint.z)/2),a=d.Point3.subtract(this._secondPoint,this._firstPoint);2*d.Point3.subtract(this._textPos,b).length()>a.length()?this._arrowsInvert=!0:this._arrowsInvert=!1};c.prototype._nextStage=function(){this._stage++;
if(3<this._stage||2<this._stage&&this._triangulatedDistance)this._finalized=!0,this.cleanup()};c.prototype.update=function(){a.prototype.update.call(this);var b=this._viewer.view;this._behindView=!1;if(0!==this._stage){for(var c=Array(10),e=[],f=0;10>f;f++)e.push(new d.Point3(0,0,0));this._faceData[0]instanceof d.SubentityProperties.CylinderElement&&(e[0]=b.projectPoint(this._surfaceCenter[0]),e[1]=b.projectPoint(this._surfaceAxis1[0]),e[2]=b.projectPoint(this._surfaceAxis2[0]),c[0]=d.Point2.fromPoint3(e[0]),
c[1]=d.Point2.fromPoint3(e[1]),c[2]=d.Point2.fromPoint3(e[2]),this._line1PreviewShape1.set(c[0],c[1]),this._line1PreviewShape2.set(c[0],c[2]));1<this._stage&&this._faceData[1]instanceof d.SubentityProperties.CylinderElement&&(e[0]=b.projectPoint(this._surfaceCenter[1]),e[1]=b.projectPoint(this._surfaceAxis1[1]),e[2]=b.projectPoint(this._surfaceAxis2[1]),c[0]=d.Point2.fromPoint3(e[0]),c[1]=d.Point2.fromPoint3(e[1]),c[2]=d.Point2.fromPoint3(e[2]),this._line2PreviewShape1.set(c[0],c[1]),this._line2PreviewShape2.set(c[0],
c[2]));1<this._stage&&(e[0]=b.projectPoint(this._textPos),e[1]=b.projectPoint(this._firstPoint),e[2]=b.projectPoint(this._secondPoint),c[0]=d.Point2.fromPoint3(e[0]),c[1]=d.Point2.fromPoint3(e[1]),c[2]=d.Point2.fromPoint3(e[2]),this._textShape&&this._textShape.setPosition(c[0]),this._lineShapes[0].setEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[0].setStartEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[0].setEndcapsInverted(this._arrowsInvert),this._lineShapes[0].setEndEndcapColor(this._viewer.measureManager.getMeasurementColor()),
this._lineShapes[0].setStartEndcapColor(this._viewer.measureManager.getMeasurementColor()),this._lineShapes[0].set(c[1],c[2]),this._faceData[1]instanceof d.SubentityProperties.CylinderElement&&this._faceData[0]instanceof d.SubentityProperties.CylinderElement?(e[3]=b.projectPoint(this._surfaceCenter[0]),e[4]=b.projectPoint(this._surfaceCenter[1]),c[3]=d.Point2.fromPoint3(e[3]),c[4]=d.Point2.fromPoint3(e[4]),this._lineShapes[1].set(c[1],c[3]),this._lineShapes[2].set(c[2],c[4]),this._lineShapes[3].set(c[0],
c[1])):(e[3]=b.projectPoint(this._firstPointHelper),e[4]=b.projectPoint(this._secondPointHelper),c[3]=d.Point2.fromPoint3(e[3]),c[4]=d.Point2.fromPoint3(e[4]),this._lineShapes[1].set(c[2],c[4]),this._lineShapes[2].set(c[1],c[3]),this._lineShapes[3].set(c[1],c[0])));for(f=0;6>f;f++)0>e[f].z&&(this._behindView=!0)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var b=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:this._faceData[0]instanceof
d.SubentityProperties.CylinderElement&&(b.drawLine(this._line1PreviewShape1),b.drawLine(this._line1PreviewShape2));break;case 2:case 3:case 4:this._faceData[0]instanceof d.SubentityProperties.CylinderElement&&this._faceData[1]instanceof d.SubentityProperties.CylinderElement?(3>this._stage&&(b.drawLine(this._line1PreviewShape1),b.drawLine(this._line1PreviewShape2),b.drawLine(this._line2PreviewShape1),b.drawLine(this._line2PreviewShape2)),b.drawLine(this._lineShapes[0]),b.drawLine(this._lineShapes[1]),
b.drawLine(this._lineShapes[2])):(this._viewer.markupManager.getRenderer().drawLine(this._lineShapes[0]),this._parallelFaces&&(b.drawLine(this._lineShapes[1]),b.drawLine(this._lineShapes[2]))),b.drawLine(this._lineShapes[3]),b.drawTextBox(this._textShape)}}};c._serializeFaceProp=function(b){return b instanceof d.SubentityProperties.CylinderElement?{type:"CylinderElement",origin:b.origin.toJson(),normal:b.normal.toJson(),radius:b.radius}:b instanceof d.SubentityProperties.PlaneElement?{type:"PlaneElement",
origin:b.origin.toJson(),normal:b.normal.toJson()}:null};c._constructFaceProp=function(b){if("CylinderElement"===b.type){var a=d.Point3.fromJson(b.origin),c=d.Point3.fromJson(b.normal);return new d.SubentityProperties.CylinderElement(b.radius,a,c)}return"PlaneElement"===b.type?(a=d.Point3.fromJson(b.origin),c=d.Point3.fromJson(b.normal),new d.SubentityProperties.PlaneElement(a,c)):null};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var b=[],a=0,d=this._faceData;a<
d.length;a++)b.push(c._serializeFaceProp(d[a]));a=[];d=0;for(var e=this._surfaceCenter;d<e.length;d++)a.push(e[d].toJson());d=[];for(var f=0,h=this._surfaceAxis1;f<h.length;f++)e=h[f],d.push(e.toJson());f=[];h=0;for(var p=this._surfaceAxis2;h<p.length;h++)e=p[h],f.push(e.toJson());return{text:this._textShape.getTextString(),textPos:this._textPos.toJson(),firstPoint:this._firstPoint.toJson(),secondPoint:this._secondPoint.toJson(),firstPointHelper:this._firstPointHelper.toJson(),secondPointHelper:this._secondPointHelper.toJson(),
measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,parallelFaces:this._parallelFaces,faceData:b,surfaceCenter:a,surfaceAxis1:d,surfaceAxis2:f,name:this.getName(),className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);a.setName(b.name);a._textShape.setTextString(b.text);a._textPos.assign(d.Point3.fromJson(b.textPos));a._firstPoint.assign(d.Point3.fromJson(b.firstPoint));a._firstPointHelper.assign(d.Point3.fromJson(b.firstPointHelper));
a._secondPoint.assign(d.Point3.fromJson(b.secondPoint));a._secondPointHelper.assign(d.Point3.fromJson(b.secondPointHelper));console.assert(Array.isArray(b.faceData));for(var g=0,e=b.faceData;g<e.length;g++){var f=c._constructFaceProp(e[g]);console.assert(null!==f);a._faceData.push(f)}a._surfaceCenter[0].assign(b.surfaceCenter[0]);a._surfaceCenter[1].assign(b.surfaceCenter[1]);a._surfaceAxis1[0].assign(b.surfaceAxis1[0]);a._surfaceAxis1[1].assign(b.surfaceAxis1[1]);a._surfaceAxis2[0].assign(b.surfaceAxis2[0]);
a._surfaceAxis2[1].assign(b.surfaceAxis2[1]);a._stage=4;a._parallelFaces=b.parallelFaces;a._measurementValue=b.measurementValue;a._unitMultiplier=b.unitMultiplier||1;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureFaceFaceDistanceMarkup"};return c}(f.MeasureMarkup);f.MeasureFaceFaceDistanceMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(a){function c(b){var c=a.call(this,b)||this;c._firstPointShape=new h.Shape.Circle;c._secondPointShape=new h.Shape.Circle;c._arrowsInvert=!1;c._name="MeasurePointPointDistance";c._lineShapes=[];for(var e=0;6>e;e++)c._lineShapes.push(new h.Shape.Line),c._lineShapes[e].setStrokeColor(c._viewer.measureManager.getMeasurementColor()),c._lineShapes[e].setEndEndcapColor(c._viewer.measureManager.getMeasurementColor()),c._lineShapes[e].setStartEndcapColor(c._viewer.measureManager.getMeasurementColor());
c._viewer=b;c.initCircle(c._firstPointShape);c.initCircle(c._secondPointShape);c._textShape=new h.Shape.TextBox;c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));return c}__extends(c,a);c.prototype.initCircle=function(b){b.setRadius(2.5);b.setFillColor(this._viewer.measureManager.getMeasurementColor())};c.prototype.setUnitMultiplier=function(b){this._unitMultiplier=b};c.prototype.setFirstPointPosition=function(b){this._stage=1;this._positions[0]=
b.copy()};c.prototype.setSecondPointPosition=function(b){this._stage=2;this._positions[1]=b.copy();this._positions[2]=b.copy();this._setMeasurementValue(d.Point3.subtract(this._positions[1],this._positions[0]).length())};c.prototype._getStage=function(){return this._stage};c.prototype.finalize=function(){this._stage++};c.prototype.getFirstPointPosition=function(){return this._positions[0]};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);var c=this._viewer.view.raycastFromPoint(b);if(null!==
c){b=this._positions[0];var e=this._positions[1],f=new d.Point3(1,0,0);e.equals(b)||(f=d.Point3.subtract(e,b));var h=this._viewer.view.getCamera().getUp(),m=d.Point3.cross(c.direction,h).normalize(),p=new d.Point3((b.x+e.x)/2,(b.y+e.y)/2,(b.z+e.z)/2);h=new d.Point3(p.x+h.x,p.y+h.y,p.z+h.z);var r=new d.Point3(p.x+m.x,p.y+m.y,p.z+m.z),q=new d.Point3(c.origin.x+1E6*c.direction.x,c.origin.y+1E6*c.direction.y,c.origin.z+1E6*c.direction.z);m=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(c.origin,q,p,
h,r,m);this._positions[2].assign(m);new d.Point3(0,0,0);c=Math.abs(f.x)<=Math.abs(f.y)&&Math.abs(f.x)<=Math.abs(f.z)?new d.Point3(1,0,0):Math.abs(f.y)<=Math.abs(f.x)&&Math.abs(f.y)<=Math.abs(f.z)?new d.Point3(0,1,0):new d.Point3(0,0,1);c=d.Point3.cross(c,f);p=d.Point3.cross(c,f);c.set(b.x+c.x,b.y+c.y,b.z+c.z);p.set(b.x+p.x,b.y+p.y,b.z+p.z);h=new d.Point3(m.x+1E4*f.x,m.y+1E4*f.y,m.z+1E4*f.z);f=new d.Point3(m.x-1E4*f.x,m.y-1E4*f.y,m.z-1E4*f.z);d.Util.intersectionPlaneLine(h,f,b,c,p,m);f=d.Point3.subtract(m,
b);this._positions[3]=new d.Point3(b.x+f.x,b.y+f.y,b.z+f.z);this._positions[4]=new d.Point3(e.x+f.x,e.y+f.y,e.z+f.z);this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var b=new d.Point3((this._positions[3].x+this._positions[4].x)/2,(this._positions[3].y+this._positions[4].y)/2,(this._positions[3].z+this._positions[4].z)/2),a=d.Point3.subtract(this._positions[4],this._positions[3]);2*d.Point3.subtract(this._positions[2],b).length()>
a.length()?this._arrowsInvert=!0:this._arrowsInvert=!1};c.prototype.update=function(){a.prototype.update.call(this);var b=this._viewer.view,c=Array(6);if(0<this._stage){this._behindView=!1;for(var e=0;e<this._positions.length;e++)0>=b.projectPoint(this._positions[e]).z&&(this._behindView=!0),c[e]=d.Point2.fromPoint3(b.projectPoint(this._positions[e]));this._firstPointShape.setCenter(c[0])}1<this._stage&&(this._textShape&&this._textShape.setPosition(c[2]),this._secondPointShape.setCenter(c[1]),this._lineShapes[0].set(c[0],
c[1]),this._lineShapes[1].set(c[3],c[4]),this._lineShapes[2].set(c[0],c[3]),this._lineShapes[3].set(c[1],c[4]),this._lineShapes[4].set(c[3],c[2]),this._lineShapes[5].set(c[3],c[4]),this._lineShapes[5].setEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[5].setStartEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[5].setEndcapsInverted(this._arrowsInvert))};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var b=
this._viewer.markupManager.getRenderer();switch(this._stage){case 1:b.drawCircle(this._firstPointShape);break;case 2:case 3:b.drawCircle(this._firstPointShape);b.drawCircle(this._secondPointShape);for(var a=0,c=this._lineShapes;a<c.length;a++)b.drawLine(c[a]);b.drawTextBox(this._textShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{name:this._name,measurePoint1:this._positions[0].copy(),measurePoint2:this._positions[1].copy(),leaderPoint1:this._positions[3].copy(),
leaderPoint2:this._positions[4].copy(),textPoint:this._positions[2].copy(),text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);a._name=b.name;a._positions[0]=d.Point3.fromJson(b.measurePoint1);a._positions[1]=d.Point3.fromJson(b.measurePoint2);a._positions[2]=d.Point3.fromJson(b.textPoint);a._textShape.setTextString(b.text);
a._positions[3]=d.Point3.fromJson(b.leaderPoint1);a._positions[4]=d.Point3.fromJson(b.leaderPoint2);a._measurementValue=b.measurementValue;a._unitMultiplier=b.unitMultiplier||1;a._updateArrowsInverted();a._stage=2;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasurePointPointDistanceMarkup"};return c}(f.MeasureMarkup);f.MeasurePointPointDistanceMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){(function(f){var a=function(a){function c(b,c,e,f){b=a.call(this,b)||this;b._lineProperties=null;b._worldSpaceLength=0;b._arrowsInvert=!1;b._name="MeasureStraightEdgeLength";b._lineProperties=c;b._matrix=e.copy();b._matrix.setTranslationComponent(0,0,0);b._unitMultiplier=f;c=b._viewer.measureManager.getMeasurementColor();for(e=0;5>e;e++)f=new h.Shape.Line,f.setStrokeColor(c),f.setEndEndcapColor(c),f.setStartEndcapColor(c),b._lineShapes.push(f);c=b._textShape.getBoxPortion();c.setFillOpacity(1);
c.setFillColor(new d.Color(255,255,255));return b}__extends(c,a);c.prototype.setLineGeometry=function(b){a.prototype.setLineGeometry.call(this,b);this._positions[0]=this._linePositions[0];this._positions[2]=this._linePositions[0].copy();this._positions[1]=this._linePositions[this._linePositions.length-1];null!==this._lineProperties&&-1!==this._lineProperties.length?(b=new d.Point3(this._lineProperties.length,0,0),this._matrix.transform(b,b),b=this._worldSpaceLength=b.length()):b=d.Point3.subtract(this._positions[1],
this._positions[0]).length();this._setMeasurementValue(b)};c.prototype.adjust=function(b){a.prototype.adjust.call(this,b);var c=this._viewer.view,e=c.raycastFromPoint(b);if(null!==e){b=this._positions[0];var f=this._positions[1],h=new d.Point3(1,0,0);f.equals(b)||(h=d.Point3.subtract(f,b));var m=c.getCamera().getUp();c=d.Point3.cross(e.direction,m).normalize();var p=d.Point3.add(b,f).scale(.5);m=d.Point3.add(p,m);var r=d.Point3.add(p,c),q=d.Point3.add(d.Point3.scale(e.direction,1E6),e.origin);c=new d.Point3(0,
0,0);d.Util.intersectionPlaneLine(e.origin,q,p,m,r,c);this._positions[2].assign(c);new d.Point3(0,0,0);e=Math.abs(h.x)<=Math.abs(h.y)&&Math.abs(h.x)<=Math.abs(h.z)?new d.Point3(1,0,0):Math.abs(h.y)<=Math.abs(h.x)&&Math.abs(h.y)<=Math.abs(h.z)?new d.Point3(0,1,0):new d.Point3(0,0,1);e=d.Point3.cross(e,h);p=d.Point3.cross(e,h);e.add(b);p.add(b);m=d.Point3.add(d.Point3.scale(h,1E4),c);h=d.Point3.add(d.Point3.scale(h,-1E4),c);d.Util.intersectionPlaneLine(m,h,b,e,p,c);h=d.Point3.subtract(c,b);this._positions[3]=
d.Point3.add(b,h);this._positions[4]=d.Point3.add(f,h);this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var b=d.Point3.add(this._positions[3],this._positions[4]).scale(.5),a=d.Point3.subtract(this._positions[4],this._positions[3]);this._arrowsInvert=2*d.Point3.subtract(this._positions[2],b).squaredLength()>a.squaredLength()};c.prototype.update=function(){a.prototype.update.call(this);var b=this._viewer.view;this._behindView=!1;
if(0<this._stage){this._lineEdgeShape.clearPoints();for(var c=Array(this._linePositions.length),e=0;e<this._linePositions.length;e++)c[e]=b.projectPoint(this._linePositions[e]),0>=c[e].z&&(this._behindView=!0),this._lineEdgeShape.pushPoint(d.Point2.fromPoint3(c[e]))}if(1<this._stage){var f=Array(6);c=Array(6);for(e=0;e<this._positions.length;e++)c[e]=b.projectPoint(this._positions[e]),0>=c[e].z&&(this._behindView=!0),f[e]=d.Point2.fromPoint3(c[e]);this._textShape&&this._textShape.setPosition(f[2]);
b=this._viewer.measureManager.getMeasurementColor();this._lineShapes[0].set(f[3],f[4]);this._lineShapes[1].set(f[0],f[3]);this._lineShapes[2].set(f[1],f[4]);this._lineShapes[3].set(f[3],f[2]);this._lineShapes[4].set(f[3],f[4]);this._lineShapes[4].setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[4].setStartEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[4].setEndcapsInverted(this._arrowsInvert);this._lineShapes[4].setEndEndcapColor(b);this._lineShapes[4].setStartEndcapColor(b)}};
c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var b=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:b.drawPolyline(this._lineEdgeShape);break;case 2:case 3:for(var a=0,c=this._lineShapes;a<c.length;a++)b.drawLine(c[a]);b.drawTextBox(this._textShape);b.drawPolyline(this._lineEdgeShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{name:this._name,
measurePoint1:this._positions[0].copy(),measurePoint2:this._positions[1].copy(),leaderPoint1:this._positions[3].copy(),leaderPoint2:this._positions[4].copy(),textPoint:this._positions[2].copy(),text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName(),matrix:this._matrix.toJson()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){var e=d.Matrix.fromJson(b.matrix);a=new c(a,null,e,b.unitMultiplier||
1);a._name=b.name;a._positions[0]=d.Point3.fromJson(b.measurePoint1);a._positions[1]=d.Point3.fromJson(b.measurePoint2);a._positions[2]=d.Point3.fromJson(b.textPoint);a._textShape.setTextString(b.text);a._positions[3]=d.Point3.fromJson(b.leaderPoint1);a._positions[4]=d.Point3.fromJson(b.leaderPoint2);a._measurementValue=b.measurementValue;a._updateArrowsInverted();a._stage=2;return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureStraightEdgeLengthMarkup"};
return c}(f.MeasureLengthMarkup);f.MeasureStraightEdgeLengthMarkup=a})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function f(b,a){var c=Math.abs(b.x);var e=Math.abs(b.y),g=Math.abs(b.z);c=c<=e&&c<=g?new d.Point3(1,0,0):e<=c&&e<=g?new d.Point3(0,1,0):new d.Point3(0,0,1);b=d.Point3.cross(c,b);return a?(a.assign(b),a):b}function a(b,a,c,d){var e=c.normal.x*(a.x-b.x)+c.normal.y*(a.y-b.y)+c.normal.z*(a.z-b.z);if(1E-5>Math.abs(e))return!1;c=-(c.d+c.normal.x*b.x+c.normal.y*b.y+c.normal.z*b.z)/e;d.x=b.x+c*(a.x-b.x);d.y=b.y+c*(a.y-b.y);d.z=b.z+c*(a.z-b.z);return 0>c||1<c?!1:!0}function e(b){return Math.PI/
180*b}function c(b){return 180/Math.PI*b}function b(b,a,c){a=d.Point3.subtract(a,b);b=d.Point3.subtract(c,b);b=d.Point3.dot(b,a)/a.squaredLength();return Math.max(0,Math.min(1,b))}h.oneVectorCross=f;h.intersectionPlaneLine2=a;h.computePointToLineDistance=function(b,a,c,e){var g=d.Point3.subtract(c,a),f=g.squaredLength(),k=0;0<f&&(k=((b.x-a.x)*(c.x-a.x)+(b.y-a.y)*(c.y-a.y)+(b.z-a.z)*(c.z-a.z))/f);g.set(g.x*k,g.y*k,g.z*k);e.set(a.x+g.x,a.y+g.y,a.z+g.z);new d.Point3(0,0,0);return d.Point3.subtract(b,
e).length()};h.formatWithUnit=function(b,a){a=.01>Math.abs(a-25.4/72)?"points":.01>Math.abs(a-25.4)?"inch":.01>Math.abs(a-1)?"mm":.01>Math.abs(a-10)?"cm":.01>Math.abs(a-25.4/6)?"picas":.01>Math.abs(a-12*25.4)?"ft":.01>Math.abs(a-914.4)?"yd":.01>Math.abs(a-1E3)?"m":.01>Math.abs(a-1E6)?"km":.01>Math.abs(a-1609344)?"mi":"mm";for(var c,d=2;9>d&&(c=b.toFixed(d),0===parseFloat(c));d++);0===parseFloat(c)&&(c="0");return c+a};h.degreesToRadians=e;h.radiansToDegrees=c;h.computeOffaxisRotation=function(b,a,
c){b=b.copy().normalize();var g=e(a);a=Math.cos(g);g=Math.sin(g);var f=1-a,k=f*b.x*b.y,h=f*b.x*b.z,l=f*b.y*b.z;void 0===c&&(c=new d.Matrix);c.m[0]=f*b.x*b.x+a;c.m[1]=g*b.z+k;c.m[2]=h-g*b.y;c.m[3]=0;c.m[4]=k-g*b.z;c.m[5]=f*b.y*b.y+a;c.m[6]=g*b.x+l;c.m[7]=0;c.m[8]=g*b.y+h;c.m[9]=l-g*b.x;c.m[10]=f*b.z*b.z+a;c.m[11]=0;c.m[12]=0;c.m[13]=0;c.m[14]=0;c.m[15]=1;return c};h.intersect3d2Planes=function(b,a,c,e,f,h){var g=d.Point3.cross(b.normal,c.normal),k=Math.abs(g.x),l=Math.abs(g.y),m=Math.abs(g.z);if(1E-7>
k+l+m)return c=d.Point3.subtract(e,a),0===d.Point3.dot(b.normal,c)?1:0;k=k>l?k>m?1:3:l>m?2:3;l=d.Point3.zero();a=-d.Point3.dot(b.normal,a);e=-d.Point3.dot(c.normal,e);switch(k){case 1:l.x=0;l.y=(e*b.normal.z-a*c.normal.z)/g.x;l.z=(a*c.normal.y-e*b.normal.y)/g.x;break;case 2:l.x=(a*c.normal.z-e*b.normal.z)/g.y;l.y=0;l.z=(e*b.normal.x-a*c.normal.x)/g.y;break;case 3:l.x=(e*b.normal.y-a*c.normal.y)/g.z,l.y=(a*c.normal.x-e*b.normal.x)/g.z,l.z=0}f.assign(l);h.set(l.x+g.x,l.y+g.y,l.z+g.z);return 2};h.intersectionPlaneLine=
function(b,c,e,f,h,p){var g=new d.Plane;g.normal.x=(f.y-e.y)*(h.z-e.z)-(f.z-e.z)*(h.y-e.y);g.normal.y=(f.z-e.z)*(h.x-e.x)-(f.x-e.x)*(h.z-e.z);g.normal.z=(f.x-e.x)*(h.y-e.y)-(f.y-e.y)*(h.x-e.x);g.normal.normalize();g.d=-g.normal.x*e.x-g.normal.y*e.y-g.normal.z*e.z;return a(b,c,g,p)};h.computeAngleBetweenVector=function(b,a){b=b.copy().normalize();var e=a.copy().normalize();a=d.Point3.cross(b,e).length();b=d.Point3.dot(b,e);return c(Math.atan2(a,b))};h.generatePointsOnCircle=function(b,a,c,e,h){for(var g=
2*Math.PI/e,k=0;k<e;k++)b[k]=new d.Point3(0,c*Math.cos(g*k),c*Math.sin(g*k));b[e]=b[0].copy();c=f(h);c.normalize();g=d.Point3.cross(c,h);g.normalize();k=new d.Matrix;var l=k.m;l[0]=h.x;l[1]=h.y;l[2]=h.z;l[3]=0;l[4]=c.x;l[5]=c.y;l[6]=c.z;l[7]=0;l[8]=g.x;l[9]=g.y;l[10]=g.z;l[11]=0;l[12]=0;l[13]=0;l[14]=0;l[15]=1;k.transformArray(b,b);for(k=0;k<=e;k++)b[k].set(b[k].x+a.x,b[k].y+a.y,b[k].z+a.z)};h.distanceLineLine=function(b,a,c,e,f,h){var g=0,k=0,l=d.Point3.subtract(a,b),m=d.Point3.subtract(e,c),n=d.Point3.dot(l,
b),p=d.Point3.dot(l,m),z=d.Point3.dot(l,l),y=d.Point3.dot(l,c),x=d.Point3.dot(m,m),A=d.Point3.dot(m,c),B=d.Point3.dot(m,b);e=d.Point3.dot(l,e);var D=d.Point3.dot(m,a),C=z*x-p*p;0===C?(0!==z?(y=(y-n)/z,0>y?y=0:1<y&&(y=1),n=(e-n)/z,0>n?n=0:1<n&&(n=1)):n=y=0,0!==x?(B=(B-A)/x,0>B?B=0:1<B&&(B=1),x=(D-A)/x,0>x?x=0:1<x&&(x=1)):x=B=0,g=(y+n)/2,k=(B+x)/2):(a=(p*B-p*A-x*n+x*y)/C,p=(z*B-z*A+p*y-p*n)/C,y=(y-n)/z,B=(B-A)/x,n=(e-n)/z,x=(D-A)/x,0<=a&&1>=a&&0<=p&&1>=p?(g=a,k=p):0>a&&0<=p&&1>=p?(g=a,k=B):1<a&&0<=
p&&1>=p?(g=a,k=x):0<=a&&1>=a&&0>p?(g=y,k=p):0<=a&&1>=a&&1<p?(g=n,k=p):0>a&&0>p?(g=y,k=B):0>a&&1<p?(g=n,k=B):1<a&&0>p?(g=y,k=x):1<a&&1<p&&(g=n,k=x),0>g?g=0:1<g&&(g=1),0>k?k=0:1<k&&(k=1));f.x=g*l.x+b.x;f.y=g*l.y+b.y;f.z=g*l.z+b.z;h.x=k*m.x+c.x;h.y=k*m.y+c.y;h.z=k*m.z+c.z;return d.Point3.subtract(h,f).length()};h.lineLineIntersect=function(b,a,c,e){var g=d.Point3.zero(),f=d.Point3.zero(),k=d.Point3.zero(),h=d.Point3.zero(),l=d.Point3.zero();k.x=b.x-c.x;k.y=b.y-c.y;k.z=b.z-c.z;h.x=e.x-c.x;h.y=e.y-c.y;
h.z=e.z-c.z;if(1E-12>Math.abs(h.x)&&1E-12>Math.abs(h.y)&&1E-12>Math.abs(h.z))return null;l.x=a.x-b.x;l.y=a.y-b.y;l.z=a.z-b.z;if(1E-12>Math.abs(l.x)&&1E-12>Math.abs(l.y)&&1E-12>Math.abs(l.z))return null;a=k.x*h.x+k.y*h.y+k.z*h.z;e=h.x*l.x+h.y*l.y+h.z*l.z;var n=k.x*l.x+k.y*l.y+k.z*l.z;k=h.x*h.x+h.y*h.y+h.z*h.z;var v=(l.x*l.x+l.y*l.y+l.z*l.z)*k-e*e;if(1E-12>Math.abs(v))return null;n=(a*e-n*k)/v;a=(a+e*n)/k;g.x=b.x+n*l.x;g.y=b.y+n*l.y;g.z=b.z+n*l.z;f.x=c.x+a*h.x;f.y=c.y+a*h.y;f.z=c.z+a*h.z;return g};
h.closestPointScalarFromPointToSegment=b;h.closestPointFromPointToSegment=function(a,c,e){e=b(a,c,e);c=d.Point3.subtract(c,a).scale(e);return d.Point3.add(a,c)};h.isPointOnLineSegment=function(a,c,e,f){var g=b(a,c,e);if(0>g||1<g)return!1;c=d.Point3.subtract(c,a).scale(g);a=d.Point3.add(a,c);return d.Point3.subtract(a,e).squaredLength()<=f*f}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a;(function(a){a[a.Created=0]="Created";a[a.Hidden=1]="Hidden";a[a.Shown=2]="Shown"})(a=f._NoteTextEvent||(f._NoteTextEvent={}));var e=function(c){function b(b,a,e,f,h){var g=c.call(this)||this;g._uniqueId=d.GUID.create();g._noteElementId=null;g._position=d.Point3.zero();g._text="";g._color=d.Color.white();g._sphereRadius=.03;g._deleted=!1;g._active=!1;g._callbacks=null;g._viewer=b;g._noteTextManager=a;g._selectionPosition=e;g._selectionNormal=f;g._partId=
h;g._noteTextManager.addNote(g);g._init();return g}__extends(b,c);b.prototype._init=function(){return __awaiter(this,void 0,void 0,function(){var b,c,d,e,f,h=this;return __generator(this,function(g){switch(g.label){case 0:return b=this._createPinTransformationMatrix(this._selectionPosition,this._selectionNormal),[4,Promise.all([this._createPinStemInstance(b),this._createPinSphereInstance(b)])];case 1:return c=g.sent(),d=c[0],e=c[1],this._stemInstanceId=d,this._sphereInstanceId=e,[4,this._restore(!1)];
case 2:return g.sent(),this._callbacks={visibilityChanged:function(){h._matchPartVisibility()}},this._viewer.setCallbacks(this._callbacks),f=this._viewer._getCallbackManager(),f.trigger("_noteTextEvent",a.Created,this),[2]}})})};b.prototype._matchPartVisibility=function(){if(void 0!==this._sphereInstanceId&&void 0!==this._stemInstanceId){var b=this._viewer.model,a=b.getNodeVisibility(this._partId),c=b.getNodeVisibility(this._sphereInstanceId);a===c||this._noteTextManager.getExplodeActive()||b.setNodesVisibility([this._stemInstanceId,
this._sphereInstanceId],a);b=this._noteTextManager.getActiveItem();null===b||b.getStemInstanceId()!==this._stemInstanceId||a||this.hide()}};b.prototype.updatePosition=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(a){switch(a.label){case 0:return void 0===this._sphereInstanceId?[2]:[4,this._viewer.model.getNodeRealBounding(this._sphereInstanceId)];case 1:return this._pinBoundingBox=b=a.sent(),this._position=this._pinBoundingBox.center(),this.setText(this._text),
[2]}})})};b.prototype._restore=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._noteTextManager.setActiveItemHandle(this._viewer.markupManager.registerMarkup(this)),this._noteTextManager.setActiveItem(this),this._show(b),this._updateColor(),[4,this.draw()];case 1:return a.sent(),[2]}})})};b.prototype.restore=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._restore(!0)]})})};
b.prototype.setText=function(b){this._text=b;this._noteTextManager.getNoteTextElement().setText(b)};b.prototype.saveTextValue=function(){this._text=this._noteTextManager.getNoteTextElement().getText()};b.prototype.draw=function(){return __awaiter(this,void 0,void 0,function(){var b,a,c;return __generator(this,function(e){switch(e.label){case 0:if(this._deleted||!this._active)return[2];this._behindView=!1;return[4,this.updatePosition()];case 1:return e.sent(),b=this._viewer.view.projectPoint(this._position),
0>=b.z&&(this._behindView=!0),this._behindView?null!==this._noteElementId&&null!==document.getElementById(this._noteElementId)&&(this._viewer.markupManager.removeMarkupElement(this._noteElementId),this._noteElementId=null):(a=new d.Point2(b.x,b.y),c=this._noteTextManager.getNoteTextElement(),c.setPosition(a),null===this._noteElementId&&(this._noteElementId=this._viewer.markupManager.addMarkupElement(c.getHtmlContainer()))),[2]}})})};b.prototype.hit=function(b){var a=this._noteTextManager.getNoteTextElement(),
c=a.getPosition();a=a.getSize();return d.Internal.pointInRect(b,c,a)};b.prototype.hitWithTolerance=function(b,a){var c=this._noteTextManager.getNoteTextElement(),e=c.getPosition();c=c.getSize();return d.Internal.pointInRect(b,e,c,a)};b.prototype.getClassName=function(){return b.className};b.prototype.getUniqueId=function(){return this._uniqueId};b.prototype.getSphereInstanceId=function(){return this._sphereInstanceId};b.prototype.getStemInstanceId=function(){return this._stemInstanceId};b.prototype.onSelect=
function(){this._noteTextManager.getNoteTextElement().focus()};b.prototype.onDeselect=function(){this._noteTextManager.getNoteTextElement().blur()};b.prototype.hide=function(){var b=this._noteTextManager.getNoteTextElement();b.hide();this.setText(b.getText());this._noteTextManager.setActiveItem(null);this._active=!1;this._viewer._getCallbackManager().trigger("_noteTextEvent",a.Hidden,this)};b.prototype._show=function(b){this._noteTextManager.getNoteTextElement().show(this);this._active=!0;b&&this._viewer._getCallbackManager().trigger("_noteTextEvent",
a.Shown,this)};b.prototype.show=function(){this._show(!0)};b.prototype.remove=function(){return __awaiter(this,void 0,void 0,function(){var b,a;return __generator(this,function(e){switch(e.label){case 0:return null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),this._callbacks=null),b=this._viewer.model,a=[],void 0!==this._stemInstanceId&&a.push(b.deleteMeshInstances([this._stemInstanceId])),void 0!==this._sphereInstanceId&&a.push(b.deleteMeshInstances([this._sphereInstanceId])),
this.hide(),this._noteTextManager.removeNote(this),this._deleted=!0,[4,d.Util.waitForAll(a)];case 1:return e.sent(),c.prototype.remove.call(this),[2]}})})};b.prototype.getRemoved=function(){return this._deleted};b.prototype.setColor=function(b){this._color=b;this._updateColor();return Promise.resolve()};b.prototype.getColor=function(){return this._color};b.prototype.getPartId=function(){return this._partId};b.prototype._updateColor=function(){void 0!==this._sphereInstanceId&&this._viewer.model.setNodesFaceColor([this._sphereInstanceId],
this._color)};b.prototype._createPinTransformationMatrix=function(b,a){var c=0,e=a.x;Math.abs(a.y)<Math.abs(e)&&(e=a.y,c=1);Math.abs(a.z)<Math.abs(e)&&(c=2);e=[0,0,0];e[c]=1;c=d.Point3.createFromArray(e);c=d.Point3.cross(a,c).normalize();e=d.Point3.cross(a,c);var g=new d.Matrix;g.m=[a.x,a.y,a.z,0,c.x,c.y,c.z,0,e.x,e.y,e.z,0,0,0,0,1];g=d.Matrix.multiply(g,(new d.Matrix).setScaleComponent(this._sphereRadius,this._sphereRadius,this._sphereRadius));g.setTranslationComponent(b.x,b.y,b.z);return g};b.prototype._createPinStemInstance=
function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g;return __generator(this,function(f){a=this._noteTextManager.getPinStemMeshId();if(null===a)throw new d.CommunicatorError("stem mesh hasn't been created yet");c=new d.MeshInstanceData(a,b,"pin-stem-instance",void 0,d.Color.black());c.setOpacity(1);e=d.MeshInstanceCreationFlags.SuppressCameraScale|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.DoNotXRay|d.MeshInstanceCreationFlags.ExcludeBounding|
d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.AlwaysDraw;c.setCreationFlags(e);g=this._viewer.model;return[2,g.createMeshInstance(c,void 0,!0)]})})};b.prototype._createPinSphereInstance=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g;return __generator(this,function(f){a=this._noteTextManager.getPinSphereMeshId();if(null===a)throw new d.CommunicatorError("sphere mesh hasn't been created yet");c=new d.MeshInstanceData(a,b,"pin-sphere-instance",
d.Color.white(),void 0);c.setOpacity(1);e=d.MeshInstanceCreationFlags.SuppressCameraScale|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.DoNotXRay|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.AlwaysDraw;c.setCreationFlags(e);g=this._viewer.model;return[2,g.createMeshInstance(c,void 0,!0)]})})};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=
function(){return{uniqueId:this._uniqueId,className:this.getClassName(),selectionPosition:this._selectionPosition.toJson(),selectionNormal:this._selectionNormal.toJson(),text:this._text,color:this._color,partId:this._partId}};b.prototype.forJson=function(){return this.toJson()};b._fromJson=function(a,c,e){if(!e.findById(a.uniqueId)){var g=d.Point3.fromJson(a.selectionPosition),f=d.Point3.fromJson(a.selectionNormal);c=new b(c,e,g,f,a.partId);c._uniqueId=a.uniqueId;c.setText(a.text);c.setColor(d.Color.fromJson(a.color));
return c}return null};b.fromJson=function(a,c,d){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(g){e=b._fromJson(a,c,d);return[2,e]})})};b.className="Communicator.Markup.Note.NoteText";return b}(h.MarkupItem);f.NoteText=e})(h.Note||(h.Note={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c){var b=a.call(this)||this;b._pinSphereMeshId=null;b._pinStemMeshId=null;b._noteTextList=[];b._activeItemHandle=null;b._activeItem=null;b._explodeActive=!1;b._cuttingActive=!1;b._isolateActive=!1;b._stemLength=2;b._sphereIterations=2;b._viewer=c;b._noteTextElement=new d.Markup.Note.NoteTextElement;b._noteTextElement.setPositionOffset(new d.Point2(12,-24));b._viewer.setCallbacks({sceneReady:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,
function(b){switch(b.label){case 0:return[4,this._init()];case 1:return b.sent(),[2]}})})}});return b}__extends(e,a);e.prototype._init=function(){return __awaiter(this,void 0,void 0,function(){var a,b,d,f;return __generator(this,function(c){switch(c.label){case 0:return null===e._globalPinSphereMeshData&&(e._globalPinSphereMeshData=this._createPinSphereMeshData()),null===e._globalPinStemMeshData&&(e._globalPinStemMeshData=this._createPinStemMeshData()),a=this._viewer.model,b=a.createMesh(e._globalPinSphereMeshData),
d=a.createMesh(e._globalPinStemMeshData),[4,Promise.all([b,d])];case 1:return f=c.sent(),this._pinSphereMeshId=f[0],this._pinStemMeshId=f[1],[2]}})})};e.prototype._createPinStemMeshData=function(){var a=new d.MeshData;a.addPolyline([0,0,0,this._stemLength,0,0]);return a};e.prototype._createPinSphereMeshData=function(){var a=(1+Math.sqrt(5))/2,b=Math.sqrt(10+2*Math.sqrt(5))/(4*a),e=b/2;a=b/(2*a);var f=[];f[0]=new d.Point3(-a,e,0);f[1]=new d.Point3(a,e,0);f[2]=new d.Point3(-a,-e,0);f[3]=new d.Point3(a,
-e,0);f[4]=new d.Point3(0,-a,e);f[5]=new d.Point3(0,a,e);f[6]=new d.Point3(0,-a,-e);f[7]=new d.Point3(0,a,-e);f[8]=new d.Point3(e,0,-a);f[9]=new d.Point3(e,0,a);f[10]=new d.Point3(-e,0,-a);f[11]=new d.Point3(-e,0,a);for(e=0;e<f.length;e++){var h=f[e];h.normalize()}var n=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],m=12;a=function(b){var a=[];n.map(function(b){var c=f[b[0]],
e=f[b[1]],g=f[b[2]];f[m++]=(new d.Point3(c.x+e.x,c.y+e.y,c.z+e.z)).scale(.5).normalize();f[m++]=(new d.Point3(e.x+g.x,e.y+g.y,e.z+g.z)).scale(.5).normalize();f[m++]=(new d.Point3(g.x+c.x,g.y+c.y,g.z+c.z)).scale(.5).normalize();a.push([b[0],m-3,m-1]);a.push([m-3,m-2,m-1]);a.push([m-3,b[1],m-2]);a.push([m-2,b[2],m-1])});n=a};for(e=0;e<this._sphereIterations;e++)a(e);a=[];b=[];for(var p=0,r=n;p<r.length;p++){var q=r[p];for(e=0;3>e;e++)h=f[q[e]],a.push(h.x+this._stemLength+1),a.push(h.y),a.push(h.z),
h=h.normalize(),b.push(h.x),b.push(h.y),b.push(h.z)}e=new d.MeshData;e.addFaces(a,b);e.setFaceWinding(d.FaceWinding.CounterClockwise);return e};e.prototype.getPinStemMeshId=function(){return this._pinStemMeshId};e.prototype.getPinSphereMeshId=function(){return this._pinSphereMeshId};e.prototype.getNoteTextElement=function(){return this._noteTextElement};e.prototype.setNoteTextElement=function(a){this._noteTextElement.hide();this._noteTextElement=a};e.prototype.getNoteTextList=function(){return this._noteTextList};
e.prototype.addNote=function(a){this._noteTextList.push(a);this._activeItem=a};e.prototype.removeNote=function(a){a=this._noteTextList.indexOf(a);this._noteTextList.splice(a,1)};e.prototype.updatePinVisibility=function(){return __awaiter(this,void 0,void 0,function(){var a,b,d,e,f,h,m;return __generator(this,function(c){if(0<this._noteTextList.length){a=[];b=0;for(d=this._noteTextList;b<d.length;b++)e=d[b],f=e.getSphereInstanceId(),h=e.getStemInstanceId(),void 0!==f&&a.push(f),void 0!==h&&a.push(h);
m=this._viewer.model.setNodesVisibility(a,!this._explodeActive);this._explodeActive&&this._noteTextElement.hide();return[2,m]}return[2]})})};e.prototype.explode=function(a){this._explodeActive=0<a;return this.updatePinVisibility()};e.prototype.getExplodeActive=function(){return this._explodeActive};e.prototype.checkCuttingActive=function(){this._cuttingActive=!1;if(0<this._noteTextList.length)for(var a=this._viewer.cuttingManager,b=0;b<a.getCuttingSectionCount();b++){var d=a.getCuttingSection(b);
if(null!==d&&d.isActive()){this._cuttingActive=!0;break}}return this.updatePinVisibility()};e.prototype.getCuttingActive=function(){return this._cuttingActive};e.prototype.setIsolateActive=function(a){this._isolateActive=a};e.prototype.getIsolateActive=function(){return this._isolateActive};e.prototype.getActiveItem=function(){return this._activeItem};e.prototype.setActiveItem=function(a){this._activeItem=a};e.prototype.getActiveItemHandle=function(){return this._activeItemHandle};e.prototype.setActiveItemHandle=
function(a){this._activeItemHandle=a};e.prototype.getItemList=function(){return this._noteTextList};e.prototype.selectPin=function(a){this._activeItem&&this._activeItem.hide();a=a.getNodeId();return null!==a&&(a=this._getNoteTextFromNodeId(a),null!==a)?(a.restore(),!0):!1};e.prototype.checkPinInstance=function(a){return null!==this._getNoteTextFromNodeId(a)};e.prototype._getNoteTextFromNodeId=function(a){for(var b=0,c=this._noteTextList;b<c.length;b++){var d=c[b];if(d.getSphereInstanceId()===a||d.getStemInstanceId()===
a)return d}return null};e.prototype.findById=function(a){for(var b=0,c=this._noteTextList;b<c.length;b++)if(a===c[b].getUniqueId())return!0;return!1};e.prototype.loadData=function(a){for(var b=[],c=0;c<a.length;c++){var e=d.Markup.Note.NoteText.fromJson(a[c],this._viewer,this).then(function(b){return null!==b});b.push(e)}return Promise.all(b)};e.prototype.exportMarkup=function(){for(var a=[],b=0,d=this._noteTextList;b<d.length;b++)a.push(d[b].toJson());return a};e._globalPinSphereMeshData=null;e._globalPinStemMeshData=
null;return e}(d.MarkupTypeManager);h.NoteTextManager=f})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(f){var a=function(a){function c(b){var c=a.call(this)||this;c._viewer=b;return c}__extends(c,a);c.prototype.onDragStart=function(b){b;return!1};c.prototype.onDragMove=function(b){b;return!1};c.prototype.onDragEnd=function(b){b;return!1};c.prototype.remove=function(){this._viewer.trigger("redlineDeleted",this);this._viewer.markupManager.refreshMarkup()};return c}(d.MarkupItem);f.RedlineItem=a})(d.Redline||(d.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){(function(f){var a=function(a){function c(b){b=a.call(this,b)||this;b._uniqueId=d.GUID.create();b._centerPt=d.Point3.zero();b._radiusPt=d.Point3.zero();b._circleShape=new h.Shape.Circle;b._previousDragPlanePosition=d.Point3.zero();b._circleShape.setFillOpacity(0);b._circleShape.setStrokeColor(d.Color.red());b._circleShape.setStrokeWidth(2);return b}__extends(c,a);c.prototype.setCenter=function(b){this._centerPt.assign(b)};c.prototype.getCenter=function(){return this._centerPt.copy()};c.prototype.setRadiusPoint=
function(b){this._radiusPt.assign(b)};c.prototype.getRadiusPoint=function(){return this._radiusPt.copy()};c.prototype.getUniqueId=function(){return this._uniqueId};c.prototype._update=function(){var b=this._viewer.view,a=d.Point2.fromPoint3(b.projectPoint(this._centerPt));b=d.Point2.fromPoint3(b.projectPoint(this._radiusPt));b=d.Point2.distance(a,b);this._circleShape.set(a,b)};c.prototype.draw=function(){this._update();this._viewer.markupManager.getRenderer().drawCircle(this._circleShape)};c.prototype.hit=
function(b){this._update();var a=this._circleShape.getStrokeWidth();b=d.Point2.distance(this._circleShape.getCenter(),b)-this._circleShape.getRadius();return Math.abs(b)<=a};c.prototype.hitWithTolerance=function(b,a){this._update();a=this._circleShape.getStrokeWidth()+a;b=d.Point2.distance(this._circleShape.getCenter(),b)-this._circleShape.getRadius();return Math.abs(b)<=a};c.prototype.onSelect=function(){this._circleShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._circleShape.setStrokeWidth(2)};
c.prototype.isValid=function(){return this._circleShape.getRadius()>c._validRadiusTolerance};c.prototype.onDragStart=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&this._previousDragPlanePosition.assign(b);return!1};c.prototype.onDragMove=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&(a=d.Point3.subtract(b,this._previousDragPlanePosition),this._centerPt.add(a),this._radiusPt.add(a),this._previousDragPlanePosition.assign(b));
return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,centerPoint:this._centerPt.toJson(),radiusPoint:this._radiusPt.toJson(),className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);a._uniqueId=b.uniqueId;a.setCenter(d.Point3.fromJson(b.centerPoint));a.setRadiusPoint(d.Point3.fromJson(b.radiusPoint));return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=
function(){return"Communicator.Markup.Redline.RedlineCircle"};c._validRadiusTolerance=1;return c}(f.RedlineItem);f.RedlineCircle=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._points=[];return b}__extends(c,a);c.prototype.clearPoints=function(){this._points=[]};c.prototype.getPoints=function(){return this._points};c.prototype.pushPoint=function(b){this._points.push(b.copy())};return c}(d.EndcapShape);d.Polyline=a;a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._polylines=[];return b}__extends(c,a);c.prototype.clear=function(){this._polylines=
[]};c.prototype.createPolyline=function(){var b=[];this._polylines.push(b);return b};c.prototype.getPolylines=function(){return this._polylines};return c}(d.EndcapShape);d.PolylineCollection=a})(d.Shape||(d.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(a){function c(b){b=a.call(this,b)||this;b._uniqueId=d.GUID.create();b._points=[];b._polylineShape=new h.Shape.Polyline;b._previousDragPlanePosition=d.Point3.zero();b._polylineShape.setStrokeWidth(2);b._polylineShape.setStrokeColor(d.Color.red());return b}__extends(c,a);c.prototype.addPoint=function(b){this._points.push(b.copy())};c.prototype.getPoints=function(){var b=[];this._points.forEach(function(a){b.push(a.copy())});return b};c.prototype._update=
function(){var b=this._viewer.view;this._polylineShape.clearPoints();for(var a=0,c=this._points;a<c.length;a++){var e=d.Point2.fromPoint3(b.projectPoint(c[a]));this._polylineShape.pushPoint(e)}};c.prototype.draw=function(){this._update();this.isValid()&&this._viewer.markupManager.getRenderer().drawPolyline(this._polylineShape)};c.prototype.hit=function(b){this._update();var a=this._polylineShape.getStrokeWidth(),c=this._polylineShape.getPoints();if(1<c.length)for(var e=1;e<c.length;e++)if(d.Internal.pointOnLineSegment2d(b,
c[e-1],c[e],a))return!0;return!1};c.prototype.hitWithTolerance=function(b,a){this._update();a=this._polylineShape.getStrokeWidth()+a;var c=this._polylineShape.getPoints();if(1<c.length)for(var e=1;e<c.length;e++)if(d.Internal.pointOnLineSegment2d(b,c[e-1],c[e],a))return!0;return!1};c.prototype.onSelect=function(){this._polylineShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._polylineShape.setStrokeWidth(2)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlinePolyline"};
c.prototype.isValid=function(){return 1<this._points.length};c.prototype.onDragStart=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&this._previousDragPlanePosition.assign(b);return!1};c.prototype.onDragMove=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);if(null!==b){a=d.Point3.subtract(b,this._previousDragPlanePosition);for(var c=0,e=this._points;c<e.length;c++)e[c].add(a);this._polylineShape.clearPoints();
this._previousDragPlanePosition.assign(b)}return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var b=[],a=0,c=this._points;a<c.length;a++)b.push(c[a].toJson());return{uniqueId:this._uniqueId,points:b}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);a._uniqueId=b.uniqueId;var e=0;for(b=b.points;e<b.length;e++)a.addPoint(d.Point3.fromJson(b[e]));return a};c.construct=function(b,a){return c.fromJson(b,a)};return c}(f.RedlineItem);
f.RedlinePolyline=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(a){function c(b){b=a.call(this,b)||this;b._uniqueId=d.GUID.create();b._point1=d.Point3.zero();b._point2=d.Point3.zero();b._rectangleShape=new h.Shape.Rectangle;b._previousDragPlanePosition=d.Point3.zero();b._rectangleShape.setFillOpacity(0);b._rectangleShape.setStrokeColor(d.Color.red());b._rectangleShape.setStrokeWidth(2);return b}__extends(c,a);c.prototype.setPoint1=function(b){this._point1.assign(b)};c.prototype.getPoint1=function(){return this._point1.copy()};
c.prototype.setPoint2=function(b){this._point2.assign(b)};c.prototype.getPoint2=function(){return this._point2.copy()};c.prototype.getUniqueId=function(){return this._uniqueId};c.prototype._update=function(){var b=this._viewer.view,a=b.projectPoint(this._point1),c=b.projectPoint(this._point2);b=new d.Point2(Math.min(a.x,c.x),Math.min(a.y,c.y));a=new d.Point2(Math.max(a.x,c.x),Math.max(a.y,c.y));a=d.Point2.subtract(a,b);this._rectangleShape.setPosition(b);this._rectangleShape.setSize(a)};c.prototype.draw=
function(){this._update();this._viewer.markupManager.getRenderer().drawRectangle(this._rectangleShape)};c.prototype.hit=function(b){this._update();var a=this._rectangleShape.getStrokeWidth(),c=this._rectangleShape.getPosition(),e=this._rectangleShape.getSize(),f=new d.Point2(c.x+e.x,c.y),h=new d.Point2(c.x,c.y+e.y);e=new d.Point2(c.x+e.x,c.y+e.y);return d.Internal.pointOnLineSegment2d(b,c,f,a)||d.Internal.pointOnLineSegment2d(b,f,e,a)||d.Internal.pointOnLineSegment2d(b,e,h,a)||d.Internal.pointOnLineSegment2d(b,
h,c,a)?!0:!1};c.prototype.hitWithTolerance=function(b,a){this._update();a=this._rectangleShape.getStrokeWidth()+a;var c=this._rectangleShape.getPosition(),e=this._rectangleShape.getSize(),g=new d.Point2(c.x+e.x,c.y),f=new d.Point2(c.x,c.y+e.y);e=new d.Point2(c.x+e.x,c.y+e.y);return d.Internal.pointOnLineSegment2d(b,c,g,a)||d.Internal.pointOnLineSegment2d(b,g,e,a)||d.Internal.pointOnLineSegment2d(b,e,f,a)||d.Internal.pointOnLineSegment2d(b,f,c,a)?!0:!1};c.prototype.onSelect=function(){this._rectangleShape.setStrokeWidth(4)};
c.prototype.onDeselect=function(){this._rectangleShape.setStrokeWidth(2)};c.prototype.isValid=function(){var b=this._rectangleShape.getSize();return b.x>c._validSizeTolerance.x&&b.y>c._validSizeTolerance.y};c.prototype.onDragStart=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&this._previousDragPlanePosition.assign(b);return!1};c.prototype.onDragMove=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==
b&&(a=d.Point3.subtract(b,this._previousDragPlanePosition),this._point1.add(a),this._point2.add(a),this._previousDragPlanePosition.assign(b));return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),point1:this._point1.toJson(),point2:this._point2.toJson()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a);a._uniqueId=b.uniqueId;a.setPoint1(d.Point3.fromJson(b.point1));
a.setPoint2(d.Point3.fromJson(b.point2));return a};c.construct=function(b,a){return c.fromJson(b,a)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlineRectangle"};c._validSizeTolerance=new d.Point2(5,5);return c}(f.RedlineItem);f.RedlineRectangle=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(a,b){this._sizeChanged=!1;this._sizeUpdateCallback=a;this._textUpdateCallback=b;this._createTextBox()}a.prototype._createTextBox=function(){var c=this;this._currentSize=a._defaultSize.copy();this._textArea=document.createElement("textarea");this._textArea.style.position="absolute";this._textArea.style.width=a._defaultSize.x+"px";this._textArea.style.height=a._defaultSize.y+"px";this._textArea.style.zIndex="1";this._textArea.style.pointerEvents=
"none";this._textArea.style.resize="none";this.setBorderWidth(2);this._textArea.onmousemove=function(b){b.stopPropagation();b=new d.Point2(parseInt(c._textArea.style.width,10),parseInt(c._textArea.style.height,10));c.setSize(b)};this._textArea.onmouseup=function(b){b.stopPropagation();c._sizeChanged&&(c._sizeChanged=!1,c._sizeUpdateCallback(c._currentSize))};this._textArea.oninput=function(){c._textUpdateCallback(c._textArea.value)}};a.prototype.setPosition=function(a){this._textArea.style.left=a.x+
"px";this._textArea.style.top=a.y+"px"};a.prototype.setBorderWidth=function(a){this._textArea.style.outline=a+"px solid red"};a.prototype.setText=function(a){this._textArea.textContent=a};a.prototype.setSize=function(a){this._currentSize.equals(a)||(this._sizeChanged=!0,this._currentSize.assign(a),this._textArea.style.width=a.x+"px",this._textArea.style.height=a.y+"px")};a.prototype.focus=function(){this._textArea.focus();this._textArea.style.pointerEvents="auto";this._textArea.style.resize="both"};
a.prototype.blur=function(){this._textArea.blur();this._textArea.style.pointerEvents="none";this._textArea.style.resize="none"};a.prototype.getTextArea=function(){return this._textArea};a._defaultSize=new d.Point2(100,100);return a}();f.RedlineTextElement=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(a){function c(b,e){void 0===e&&(e=c.defaultText);var g=a.call(this,b)||this;g._uniqueId=d.GUID.create();g._position=d.Point3.zero();g._size=new d.Point2(100,100);g._redlineElementId=null;g._previousDragPlanePosition=d.Point3.zero();g._text=e;g._redlineTextElement=new f.RedlineTextElement(function(b){g.setSize(b)},function(b){g.setText(b)});g._redlineTextElement.setText(g._text);g._callbacks={selectionArray:function(){g.onDeselect()}};g._viewer.setCallbacks(g._callbacks);
return g}__extends(c,a);c.prototype.setPosition=function(b){this._position.assign(b)};c.prototype.getPosition=function(){return this._position.copy()};c.prototype.setSize=function(b){this._viewer.trigger("redlineUpdated",this);this._size.assign(b)};c.prototype.setText=function(b){this._viewer.trigger("redlineUpdated",this);this._text=b};c.prototype.draw=function(){var b=d.Point2.fromPoint3(this._viewer.view.projectPoint(this._position));this._redlineTextElement.setPosition(b);null===this._redlineElementId&&
(this._redlineElementId=this._viewer.markupManager.addMarkupElement(this._redlineTextElement.getTextArea()))};c.prototype.hit=function(b){var a=this._redlineTextElement.getTextArea(),c=new d.Point2(parseFloat(a.style.left||"0"),parseFloat(a.style.top||"0"));a=new d.Point2(parseFloat(a.style.width||"0"),parseFloat(a.style.height||"0"));return d.Internal.pointInRect(b,c,a)};c.prototype.hitWithTolerance=function(b,a){var c=this._redlineTextElement.getTextArea(),e=new d.Point2(parseFloat(c.style.left||
"0"),parseFloat(c.style.top||"0"));c=new d.Point2(parseFloat(c.style.width||"0"),parseFloat(c.style.height||"0"));return d.Internal.pointInRect(b,e,c,a)};c.prototype.getClassName=function(){return c.className};c.prototype.onSelect=function(){this._redlineTextElement.setBorderWidth(4);this._redlineTextElement.focus()};c.prototype.onDeselect=function(){this._redlineTextElement.setBorderWidth(2);this._redlineTextElement.blur()};c.prototype.isValid=function(){return 0<this._text.length};c.prototype.remove=
function(){this._redlineElementId&&(this._viewer.markupManager.removeMarkupElement(this._redlineElementId),this._redlineElementId=null);null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),this._callbacks=null);a.prototype.remove.call(this)};c.prototype.onDragStart=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&this._previousDragPlanePosition.assign(b);return!1};c.prototype.onDragMove=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,
a);if(null!==b){a=d.Point3.subtract(b,this._previousDragPlanePosition);var c=this.getPosition();c.add(a);this.setPosition(c);this._previousDragPlanePosition.assign(b)}return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),position:this._position.toJson(),size:this._size.toJson(),text:this._text}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,a){a=new c(a,b.text);a._uniqueId=
b.uniqueId;a.setPosition(d.Point3.fromJson(b.position));a.setSize(d.Point2.fromJson(b.size));return a};c.construct=function(b,a){return c.fromJson(b,a)};c.className="Communicator.Markup.Redline.RedlineText";c.defaultText="Type Here...";return c}(f.RedlineItem);f.RedlineText=a})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){var a=function(){function a(){this._svgDefsElement=this._svgCanvas=null;this._svgElements=[];this._svgTextElements=[]}a.prototype._setCanvas=function(a){this._svgCanvas=a;this._svgDefsElement=document.createElementNS(f.Util.svgNamespace,"defs");this._svgCanvas.appendChild(this._svgDefsElement)};a.prototype._clear=function(){if(null===this._svgCanvas||null===this._svgDefsElement)throw new d.CommunicatorError("canvas not set");for(;this._svgCanvas.firstChild;)this._svgCanvas.removeChild(this._svgCanvas.firstChild);
this._svgElements=[];for(this._svgTextElements=[];this._svgDefsElement.firstChild;)this._svgDefsElement.removeChild(this._svgDefsElement.firstChild);this._svgCanvas.appendChild(this._svgDefsElement)};a.prototype._finalize=function(){if(null===this._svgCanvas)throw new d.CommunicatorError("canvas not set");for(var a=0,b=this._svgElements;a<b.length;a++){var e=b[a];this._svgCanvas.appendChild(e)}a=0;for(b=this._svgTextElements;a<b.length;a++)e=b[a],this._svgCanvas.appendChild(e)};a.prototype.drawCircle=
function(a){return this._addCircleNode(a.getCenter(),a.getRadius(),a)};a.prototype.drawCircles=function(a){for(var b=[],c=0,d=a.getCircles();c<d.length;c++){var e=d[c];e=this._addCircleNode(e.center,e.radius,a);b.push(e)}return b};a.prototype.drawLine=function(a){return this._addLineElement(a.getP1(),a.getP2(),a)};a.prototype.drawLines=function(a){for(var b=[],c=0,d=a.getLines();c<d.length;c++){var e=d[c];e=this._addLineElement(e.p1,e.p2,a);b.push(e)}return b};a.prototype.drawText=function(a){return this._addTextElement(a.getText(),
a.getPosition(),a)};a.prototype.drawTexts=function(a){for(var b=[],c=0,d=a.getStrings();c<d.length;c++){var e=d[c];e=this._addTextElement(e.text,e.position,a);b.push(e)}return b};a.prototype.measureText=function(a,b){if(null===this._svgCanvas)throw new d.CommunicatorError("canvas not set");a=this._createTextElement(a,d.Point2.zero(),b);this._svgCanvas.appendChild(a);b=a.getBoundingClientRect();b=new d.Point2(b.width,b.height);this._svgCanvas.removeChild(a);return b};a.prototype.measureTextBox=function(a){var b=
this.measureText(a.getTextString(),a.getTextPortion());b.x+=2*a.getBoxPortion().getStrokeWidth();b.y+=2*a.getBoxPortion().getStrokeWidth();b.x+=2*a.getPadding();b.y+=2*a.getPadding();return b};a.prototype.drawPolyline=function(a){return this._addPolylineElement(a.getPoints(),a)};a.prototype.drawPolylines=function(a){for(var b=[],c=0,d=a.getPolylines();c<d.length;c++){var e=this._addPolylineElement(d[c],a);b.push(e)}return b};a.prototype.drawPolygon=function(a){return this._addPolygonElement(a.getPoints(),
a)};a.prototype.drawPolygons=function(a){for(var b=[],c=0,d=a.getPolygons();c<d.length;c++){var e=this._addPolygonElement(d[c],a);b.push(e)}return b};a.prototype.drawRectangle=function(a){return this._addRectangleElement(a.getPosition(),a.getSize(),a)};a.prototype.drawRectangles=function(a){for(var b=[],c=0,d=a.getRectangles();c<d.length;c++){var e=d[c];e=this._addRectangleElement(e.position,e.size,a);b.push(e)}return b};a.prototype.drawTextBox=function(a){return this._addTextBoxElement(a.getTextString(),
a.getPosition(),a)};a.prototype.drawTextBoxes=function(a){for(var b=[],c=0,d=a.getStrings();c<d.length;c++){var e=d[c];e=this._addTextBoxElement(e.text,e.position,a);b.push(e)}return b};a.prototype._addTextBoxElement=function(a,b,d){var c=this.measureText(a,d.getTextPortion());c.x+=2*d.getPadding();c.y+=2*d.getPadding();var e=[];c=this._addRectangleElement(b,c,d.getBoxPortion(),!0);e.push(c);b=b.copy();b.x+=d.getPadding();b.y+=d.getPadding()/2+d.getBoxPortion().getStrokeWidth();a=this._addTextElement(a,
b,d.getTextPortion());e.push(a);return e};a.prototype._renderEndcaps=function(a,b,e,k){if(null===this._svgDefsElement)throw new d.CommunicatorError("canvas not set");e.getStartEndcapType()===d.Markup.Shape.EndcapType.Arrowhead?(e.getEndcapsInverted()?(a=f.Util.createEndArrowMarker(e.getStartEndcapSize(),e.getStartEndcapColor()),a.refX.baseVal.value=e.getStartEndcapSize()):a=f.Util.createStartArrowMarker(e.getStartEndcapSize(),e.getStartEndcapColor()),k.style.markerStart="url(#"+a.id+")",this._svgDefsElement.appendChild(a)):
e.getStartEndcapType()===d.Markup.Shape.EndcapType.Circle&&(a=f.Util.createCircleMarker(a,e.getStrokeWidth(),e.getStartEndcapSize(),e.getStartEndcapColor()),this._addSVGElement(a));e.getEndEndcapType()===d.Markup.Shape.EndcapType.Arrowhead?(a=e.getEndcapsInverted()?f.Util.createStartArrowMarker(e.getEndEndcapSize(),e.getEndEndcapColor()):f.Util.createEndArrowMarker(e.getEndEndcapSize(),e.getEndEndcapColor()),k.style.markerEnd="url(#"+a.id+")",this._svgDefsElement.appendChild(a)):e.getEndEndcapType()===
d.Markup.Shape.EndcapType.Circle&&(a=f.Util.createCircleMarker(b,e.getStrokeWidth(),e.getEndEndcapSize(),e.getEndEndcapColor()),this._addSVGElement(a))};a.prototype._createTextElement=function(a,b,d){var c=document.createElementNS(f.Util.svgNamespace,"text"),e=0;for(a=a.split("\n");e<a.length;e++){var g=a[e],h=document.createElementNS(f.Util.svgNamespace,"tspan");h.textContent=g;h.setAttributeNS(null,"x",""+b.x);h.setAttributeNS(null,"dy","1.2em");c.appendChild(h)}(e=d.getFontFamily())&&c.setAttributeNS(null,
"font-family",e);c.setAttributeNS(null,"font-size",d.getFontSize().toString());c.setAttributeNS(null,"x",""+b.x);c.setAttributeNS(null,"y",""+b.y);this._setGenericFillAttributes(c,d);this._setGenericStrokeAttributes(c,d);return c};a.prototype._addTextElement=function(a,b,d){a=this._createTextElement(a,b,d);this._addSVGTextItemElement(a);return a};a.prototype._addRectangleElement=function(a,b,d,e){void 0===e&&(e=!1);var c=document.createElementNS(f.Util.svgNamespace,"rect");c.setAttributeNS(null,"x",
a.x.toString());c.setAttributeNS(null,"y",a.y.toString());c.setAttributeNS(null,"width",b.x.toString());c.setAttributeNS(null,"height",b.y.toString());a=d.getBorderRadius();0<a&&(c.setAttributeNS(null,"rx",a.toString()),c.setAttributeNS(null,"ry",a.toString()));this._setGenericFillAttributes(c,d);this._setGenericStrokeAttributes(c,d);e?this._addSVGTextItemElement(c):this._addSVGElement(c);return c};a.prototype._addLineElement=function(a,b,d){var c=document.createElementNS(f.Util.svgNamespace,"line");
c.setAttributeNS(null,"x1",a.x.toString());c.setAttributeNS(null,"y1",a.y.toString());c.setAttributeNS(null,"x2",b.x.toString());c.setAttributeNS(null,"y2",b.y.toString());this._setGenericStrokeAttributes(c,d);this._addSVGElement(c);this._renderEndcaps(a,b,d,c);return c};a.prototype._addPolygonElement=function(a,b){a=f.Util.svgPointString(a);var c=document.createElementNS(f.Util.svgNamespace,"polygon");c.setAttributeNS(null,"points",a);this._setGenericStrokeAttributes(c,b);this._setGenericFillAttributes(c,
b);this._addSVGElement(c);return c};a.prototype._addPolylineElement=function(a,b){var c=f.Util.svgPointString(a),d=document.createElementNS(f.Util.svgNamespace,"polyline");d.setAttributeNS(null,"points",c);d.setAttributeNS(null,"fill","none");this._renderEndcaps(a[0],a[a.length-1],b,d);this._setGenericStrokeAttributes(d,b);this._addSVGElement(d);return d};a.prototype._addCircleNode=function(a,b,d){var c=document.createElementNS(f.Util.svgNamespace,"circle");c.setAttributeNS(null,"cx",a.x.toString());
c.setAttributeNS(null,"cy",a.y.toString());c.setAttributeNS(null,"r",b.toString());this._setGenericFillAttributes(c,d);this._setGenericStrokeAttributes(c,d);this._addSVGElement(c);return c};a.prototype._setGenericFillAttributes=function(a,b){a.setAttributeNS(null,"fill",f.Util.svgColorRgbString(b.getFillColor()));a.setAttributeNS(null,"fill-opacity",b.getFillOpacity().toString())};a.prototype._setGenericStrokeAttributes=function(a,b){a.setAttributeNS(null,"stroke",f.Util.svgColorRgbString(b.getStrokeColor()));
a.setAttributeNS(null,"stroke-width",b.getStrokeWidth().toString())};a.prototype._addSVGTextItemElement=function(a){this._svgTextElements.push(a)};a.prototype._addSVGElement=function(a){this._svgElements.push(a)};return a}();f.SVGMarkupRenderer=a})(h.SVG||(h.SVG={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(f){(function(a){function e(a){return"rgb("+a.r+", "+a.g+", "+a.b+")"}a.svgNamespace="http://www.w3.org/2000/svg";a.svgColorRgbString=e;a.svgPointString=function(a){for(var b="",c=0;c<a.length;c++)c&&(b+=" "),b+=a[c].x+","+a[c].y;return b};a.createStartArrowMarker=function(c,b){var g=1.1*c,f=new d.Point2(g,0),h=new d.Point2(g,c),n=new d.Point2(0,c/2),m=document.createElementNS(a.svgNamespace,"marker");m.id=d.GUID.create();m.markerWidth.baseVal.value=g;m.markerHeight.baseVal.value=
c;m.setOrientToAuto();m.refY.baseVal.value=c/2;c="M"+f.x+","+f.y+" L"+h.x+","+h.y+" L"+n.x+","+n.y+" Z";g=document.createElementNS(a.svgNamespace,"path");g.setAttribute("d",c);g.setAttributeNS(null,"fill",e(b));m.appendChild(g);return m};a.createEndArrowMarker=function(c,b){var g=1.1*c,f=d.Point2.zero(),h=new d.Point2(0,c),n=new d.Point2(g,c/2),m=document.createElementNS(a.svgNamespace,"marker");m.id=d.GUID.create();m.markerWidth.baseVal.value=g;m.markerHeight.baseVal.value=c;m.setOrientToAuto();
m.refY.baseVal.value=c/2;m.refX.baseVal.value=c;c="M"+f.x+","+f.y+" L"+h.x+","+h.y+" L"+n.x+","+n.y+" Z";g=document.createElementNS(a.svgNamespace,"path");g.setAttribute("d",c);g.setAttributeNS(null,"fill",e(b));m.appendChild(g);return m};a.createCircleMarker=function(c,b,d,f){d/=2;f=e(f);var g=document.createElementNS(a.svgNamespace,"circle");g.setAttributeNS(null,"cx",c.x.toString());g.setAttributeNS(null,"cy",c.y.toString());g.setAttributeNS(null,"r",d.toString());g.setAttributeNS(null,"fill",
f);0<b&&(g.setAttributeNS(null,"stroke-width",b.toString()),g.setAttributeNS(null,"stroke",f));return g}})(f.Util||(f.Util={}))})(h.SVG||(h.SVG={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._points=[];return b}__extends(c,a);c.prototype.clearPoints=function(){this._points=[]};c.prototype.getPoints=function(){return this._points};c.prototype.pushPoint=function(a){this._points.push(a.copy())};return c}(d.FilledShape);d.Polygon=a;a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._polygons=[];return b}__extends(c,a);c.prototype.clear=function(){this._polygons=
[]};c.prototype.createPolygon=function(){var a=[];this._polygons.push(a);return a};c.prototype.getPolygons=function(){return this._polygons};return c}(d.FilledShape);d.PolygonCollection=a})(d.Shape||(d.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(a,e){this.origin=d.Point3.zero();this.direction=new d.Point3(0,0,1);a&&this.origin.assign(a);e&&this.direction.assign(e)}f.prototype.copy=function(){return new f(this.origin,this.direction)};f.prototype.assign=function(a){this.origin.assign(a.origin);this.direction.assign(a.direction);return this};f.prototype.negate=function(){this.direction.negate();return this};return f}();d.Ray=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(){this.normal=d.Point3.zero();this.d=0}f.prototype.setFromPointAndNormal=function(a,e){this.normal.assign(e);this.d=-d.Point3.dot(e,a);return this};f.prototype.setFromPoints=function(a,e,c){this.normal=d.Point3.cross(d.Point3.subtract(e,a),d.Point3.subtract(c,a)).normalize();this.d=-d.Point3.dot(a,this.normal)};f.prototype.setFromCoefficients=function(a,d,c,b){this.normal.set(a,d,c);this.d=b};f.prototype.getCoefficients=function(){var a=this.normal;return[a.x,
a.y,a.z,this.d]};f.prototype.distanceToPoint=function(a){return d.Point3.dot(this.normal,a)+this.d};f.prototype.rayIntersection=function(a){var e=d.Point3.zero();return this.intersectsRay(a,e)?e:null};f.prototype.intersectsRay=function(a,e){var c=d.Point3.dot(this.normal,a.direction),b=this.distanceToPoint(a.origin),g=-b/c;return 0<=g&&0<Math.abs(c)?(e&&(c=a.direction.copy().scale(g),e.set(a.origin.x+c.x,a.origin.y+c.y,a.origin.z+c.z)),!0):0<=g&&0>=Math.abs(b)?(e&&e.assign(a.origin),!0):!1};f.prototype.determineSide=
function(a){return 0<this.normal.x*a.x+this.normal.y*a.y+this.normal.z*a.z+this.d?!0:!1};f.prototype.copy=function(){var a=new f;a.normal.assign(this.normal);a.d=this.d;return a};f.prototype.assign=function(a){this.normal.assign(a.normal);this.d=a.d};f.prototype.equals=function(a){return this.normal.equals(a.normal)&&this.d===a.d};f.createFromPointAndNormal=function(a,d){return(new f).setFromPointAndNormal(a,d)};f.createFromPoints=function(a,d,c){var b=new f;b.setFromPoints(a,d,c);return b};f.createFromCoefficients=
function(a,d,c,b){var e=new f;e.setFromCoefficients(a,d,c,b);return e};return f}();d.Plane=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b}d.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this};d.prototype.set=function(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b};d.prototype.assign=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w};d.zero=function(){return new d(0,0,0,0)};return d}();d.Point4=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function f(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b}f.prototype.set=function(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b};f.prototype.copy=function(){return new f(this.x,this.y,this.z,this.w)};f.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w};f.prototype.fromArray=function(a){this.x=a[0];this.y=a[1];this.z=a[2];this.w=a[3];return this};f.prototype.toArray=function(a){a[0]=this.x;a[1]=this.y;a[2]=this.z;a[3]=this.w;return this};
f.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this};f.prototype.magnitudeSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w};f.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)};f.add=function(a,d){return new f(a.x+d.x,a.y+d.y,a.z+d.z,a.w+d.w)};f.subtract=function(a,d){return new f(a.x-d.x,a.y-d.y,a.z-d.z,a.w-d.w)};f.Identity=function(){return new f(0,0,0,1)};f.toMatrix=
function(a){var e=a.x*a.x+a.y*a.y+a.z*a.z+a.w*a.w;e=2/e;var c=a.x*e,b=a.y*e,g=a.z*e;e=a.w*c;var f=a.w*b,h=a.w*g;c*=a.x;var n=a.x*b,m=a.x*g;b*=a.y;var p=a.y*g;a=a.z*g;g=new d.Matrix;g.m[0]=1-(b+a);g.m[1]=n+h;g.m[2]=m-f;g.m[3]=0;g.m[4]=n-h;g.m[5]=1-(c+a);g.m[6]=p+e;g.m[7]=0;g.m[8]=m+f;g.m[9]=p-e;g.m[10]=1-(c+b);g.m[11]=0;g.m[12]=0;g.m[13]=0;g.m[14]=0;g.m[15]=1;return g};f.createFromMatrix=function(a){var d=[],c=a.m[0]+a.m[5]+a.m[10];if(0<c){var b=Math.sqrt(c+1);d[3]=.5*b;b=.5/b;d[0]=b*(a.m[6]-a.m[9]);
d[1]=b*(a.m[8]-a.m[2]);d[2]=b*(a.m[1]-a.m[4])}else{c=0;a.m[5]>a.m[0]&&(c=1);a.m[10]>a.m[4*c+c]&&(c=2);b=[1,2,0];var g=b[c],k=b[g];b=Math.sqrt(a.m[4*c+c]-(a.m[4*g+g]+a.m[4*k+k])+1);d[c]=.5*b;b=.5/b;d[3]=b*(a.m[4*g+k]-a.m[4*k+g]);d[g]=b*(a.m[4*c+g]+a.m[4*g+c]);d[k]=b*(a.m[4*c+k]+a.m[4*k+c])}return f.Identity().fromArray(d)};f.interpolate=function(a,d,c){var b=[],e=[],k=[];a.toArray(b);d.toArray(e);a=b[0]*e[0]+b[1]*e[1]+b[2]*e[2]+b[3]*e[3];if(1+a>f._epsilon){if(1-a>f._epsilon){d=f._arccos(a);var h=1/
Math.sin(d);a=h*Math.sin((1-c)*d);c=h*Math.sin(c*d)}else a=1-c;for(d=0;4>d;++d)k[d]=a*b[d]+c*e[d]}else for(k[0]=-b[1],k[1]=b[0],k[2]=-b[3],k[3]=b[2],a=Math.sin(.5*Math.PI*(1-c)),c=Math.sin(.5*Math.PI*c),d=0;3>d;++d)k[d]=a*b[d]+c*k[d];return f.Identity().fromArray(k)};f._arccos=function(a){return-1>a?Math.PI:1<a?0:Math.acos(a)};f._epsilon=1E-5;return f}();d.Quaternion=h})(Communicator||(Communicator={}));
(function(d){(function(h){var f;(function(a){a[a.None=0]="None";a[a.IgnoreCapping=1]="IgnoreCapping"})(f=h.SelectionRequirements||(h.SelectionRequirements={}));var a=function(){function a(){}a.prototype.onMouseDown=function(a){a};a.prototype.onMouseMove=function(a){a};a.prototype.onMouseUp=function(a){a};a.prototype.onMousewheel=function(a){a};a.prototype.onTouchStart=function(a){a};a.prototype.onTouchMove=function(a){a};a.prototype.onTouchEnd=function(a){a};a.prototype.onKeyDown=function(a){a};a.prototype.onKeyUp=
function(a){a};a.prototype.onDeactivate=function(){};a.prototype.onActivate=function(){};a.prototype.onViewOrientationChange=function(){};a.prototype.stopInteraction=function(){};a.prototype.needsSelection=function(a,b,d){return!1};a.prototype._selectionMask=function(a){return d.SelectionMask.All};a.prototype.selectionRequirements=function(a){return f.None};a.prototype._onlySelectOverlays=function(a){return!1};return a}();h.Operator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){function a(a,b){this._button=a;this._modifier=b}a.prototype.getButton=function(){return this._button};a.prototype.getModifier=function(){return this._modifier};return a}();h.ButtonModifier=f;var a=function(a){function c(b){var c=a.call(this)||this;c._ptFirst=d.Point2.zero();c._ptPrevious=d.Point2.zero();c._ptCurrent=d.Point2.zero();c._dragging=!1;c._dragCount=0;c._primaryTouchId=null;c._mapping=[];c._buttonModifierActive=!1;c._doubleClickInterval=200;c._firstMouseDownTime=
null;c._isDoubleClick=!1;c._viewer=b;return c}__extends(c,a);c.prototype.onDoubleClick=function(a){};c.prototype.onMouseDown=function(a){this._firstMouseDownTime?Date.now()-this._firstMouseDownTime<this._doubleClickInterval?(this._isDoubleClick=!0,this._firstMouseDownTime=null):this._firstMouseDownTime=Date.now():(this._firstMouseDownTime=Date.now(),this._isDoubleClick=!1);if(this._isDoubleClick)this.onDoubleClick(a);else{if(this._buttonModifierActive=this.checkMapping(a))a=a.getPosition(),this._ptFirst.assign(a),
this._ptPrevious.assign(a),this._ptCurrent.assign(a);this._dragging=!0}};c.prototype.onMouseMove=function(a){this.isActive()&&(this._ptPrevious.assign(this._ptCurrent),this._ptCurrent.assign(a.getPosition()),this._dragging&&!this._ptCurrent.equals(this._ptPrevious)&&(++this._dragCount,1===this._dragCount&&this._viewer.trigger("beginInteraction")))};c.prototype.onMouseUp=function(a){this._buttonModifierActive&&this.stopInteraction();this._dragging=!1};c.prototype.stopInteraction=function(){this._viewer.trigger("endInteraction");
this._dragging=!1;this._dragCount=0;this._buttonModifierActive=!1};c.prototype.isDragging=function(){return this._dragging};c.prototype.isActive=function(){return(this._buttonModifierActive||null!==this._primaryTouchId)&&!this._isDoubleClick&&!this._viewer.getContextMenuStatus()};c.prototype.onTouchStart=function(a){if(null===this._primaryTouchId){this._primaryTouchId=a.getId();var b=a.getPosition();b=new d.Event.MouseInputEvent(b.x,b.y,d.Button.None,a.getButtons(),d.KeyModifiers.None,d.MouseInputType.Down);
b._setCompositePickResult(a._getCompositePickResult());this.onMouseDown(b)}a.setHandled(this.setHandled())};c.prototype.onTouchMove=function(a){if(this._primaryTouchId===a.getId()){var b=a.getPosition();b=new d.Event.MouseInputEvent(b.x,b.y,d.Button.None,a.getButtons(),d.KeyModifiers.None,d.MouseInputType.Move);b._setCompositePickResult(a._getCompositePickResult());this.onMouseMove(b)}a.setHandled(this.setHandled())};c.prototype.onTouchEnd=function(a){if(this._primaryTouchId===a.getId()){var b=a.getPosition();
b=new d.Event.MouseInputEvent(b.x,b.y,d.Button.None,a.getButtons(),d.KeyModifiers.None,d.MouseInputType.Up);b._setCompositePickResult(a._getCompositePickResult());this.onMouseUp(b);this._primaryTouchId=null}a.setHandled(this.setHandled())};c.prototype.addMapping=function(a,c){void 0===c&&(c=d.KeyModifiers.None);this._mapping.push(new f(a,c))};c.prototype.clearMapping=function(){this._mapping=[]};c.prototype.setMapping=function(a,c){void 0===c&&(c=d.KeyModifiers.None);this._mapping=[];this._mapping.push(new f(a,
c))};c.prototype.checkMapping=function(a){if(0===this._mapping.length)return!0;for(var b=0,c=this._mapping;b<c.length;b++){var d=c[b];if(d.getButton()===a.getButton()&&d.getModifier()===a.getModifiers())return!0}return!1};c.prototype.setHandled=function(){return!1};c.prototype.onDeactivate=function(){var a=this.stopInteraction();this._primaryTouchId=null;return a};return c}(h.Operator);h.OperatorBase=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function c(b){b=a.call(this,b)||this;b._rectangle=new d.Markup.Shape.Rectangle;b._markupHandle=null;b._dim=new d.Point2(0,0);b.initialPosition=new d.Point2(0,0);b.currentPosition=new d.Point2(0,0);b.min=new d.Point2(0,0);b.max=new d.Point2(0,0);b._name="_RectangleMarkup";b._rectangle.setFillOpacity(0);return b}__extends(c,a);c.prototype.draw=function(){this._viewer.markupManager.getRenderer().drawRectangle(this._rectangle)};c.prototype.updateCurrentPosition=
function(a){this.currentPosition.assign(a);this._rectangle.setStrokeColor(this.initialPosition.x<this.currentPosition.x?d.Color.red():d.Color.blue());this.min.assign(this.initialPosition);this.max.assign(this.currentPosition);this.max.x<this.min.x&&(a=this.max.x,this.max.x=this.min.x,this.min.x=a);this.max.y<this.min.y&&(a=this.max.y,this.max.y=this.min.y,this.min.y=a);this._dim.assign(this.max);this._dim.subtract(this.min);this._updateRectangleVertices()};c.prototype._updateRectangleVertices=function(){this._rectangle.setPosition(this.min);
this._rectangle.setSize(this._dim)};c.prototype.activate=function(a){this.initialPosition.assign(a);this.currentPosition.assign(a);this.min.assign(a);this.max.assign(a);this._dim.set(0,0);this._rectangle.setStrokeWidth(1);this._updateRectangleVertices();this._markupHandle=this._viewer.markupManager.registerMarkup(this)};c.prototype.deactivate=function(){this.initialPosition.set(0,0);this.currentPosition.set(0,0);this.min.set(0,0);this.max.set(0,0);this._dim.set(0,0);this._rectangle.setStrokeWidth(0);
this._updateRectangleVertices();var a=this._viewer.markupManager;null!==this._markupHandle&&(a.unregisterMarkup(this._markupHandle),this._markupHandle=null);a.refreshMarkup()};c.prototype.isActive=function(){return null!==this._markupHandle};return c}(d.Markup.Measure.MeasureMarkup),a=function(a){function c(b){var c=a.call(this,b)||this;c._forceEffectiveSceneVisibilityMask=d.SelectionMask.None;c._rectangleMarkup=new f(b);c._incrementalSelection=d.Util.IncrementalSelection.create("SelectionManager",
b);b.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.clearSelection()];case 1:return a.sent(),[2,this.waitForIdle()]}})})},selectionArray:function(a){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return 0!==a.length?[3,2]:[4,this._incrementalSelection.stopSelection()];case 1:b.sent(),b.label=2;case 2:return[2]}})})}});return c}
__extends(c,a);c.prototype.getForceEffectiveSceneVisibilityMask=function(){return this._forceEffectiveSceneVisibilityMask};c.prototype.setForceEffectiveSceneVisibilityMask=function(a){this._forceEffectiveSceneVisibilityMask=a};c.prototype.hasActiveSelection=function(){return!this._incrementalSelection.isIdle()};c.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._incrementalSelection.waitForIdle()]})})};c.prototype.clearSelection=
function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._incrementalSelection.clearSelection()]})})};c.prototype._allowSelection=function(a,c){return a.x===c.x||a.y===c.y?!1:!0};c.prototype._createBeginConfig=function(a,c,e){var b=new d.IncrementalPickConfig;b.forceEffectiveSceneVisibilityMask=this._forceEffectiveSceneVisibilityMask;b.ignoreCuttingSections=!1;b.ignoreUnrequestedInstances=!0;e&&(b.mustBeFullyContained=!0);return{pickConfig:b,areaCssMin:a,
areaCssMax:c}};c.prototype._performSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,f,h;return __generator(this,function(g){switch(g.label){case 0:return b=this._rectangleMarkup.min.copy(),c=this._rectangleMarkup.max.copy(),e=this._rectangleMarkup.initialPosition.x<this._rectangleMarkup.currentPosition.x,a?[4,this.clearSelection()]:[3,2];case 1:g.sent(),g.label=2;case 2:if(!this._allowSelection(b,c))return[2];f=this._createBeginConfig(b,c,e);g.label=3;case 3:return g.trys.push([3,
5,,6]),[4,this._incrementalSelection.performSelection(f)];case 4:return[2,g.sent()];case 5:h=g.sent();if(!(h instanceof d.SelectionInvalidatedError))throw h;return[3,6];case 6:return[2]}})})};c.prototype.setHandled=function(){return!0};c.prototype.onKeyUp=function(b){b.getKeyCode()===d.KeyCode.Escape&&this.clearSelection();a.prototype.onKeyUp.call(this,b)};c.prototype.onMouseDown=function(b){a.prototype.onMouseDown.call(this,b);this.isActive()&&(b.setHandled(!0),this._rectangleMarkup.isActive()&&
this._rectangleMarkup.deactivate(),this._rectangleMarkup.activate(b.getPosition()))};c.prototype.onMouseMove=function(b){a.prototype.onMouseMove.call(this,b);this.isActive()&&this._rectangleMarkup.isActive()&&(b.setHandled(!0),this._rectangleMarkup.updateCurrentPosition(b.getPosition()),this._viewer.markupManager.refreshMarkup())};c.prototype.onMouseUp=function(b){if(this.isActive()&&this._rectangleMarkup.isActive()){b.setHandled(!0);this._rectangleMarkup.updateCurrentPosition(b.getPosition());var c=
!b.controlDown();this._performSelection(c)}this._rectangleMarkup.isActive()&&this._rectangleMarkup.deactivate();a.prototype.onMouseUp.call(this,b)};return c}(h.OperatorBase);h.AreaSelectionOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c){var b=a.call(this,c)||this;b._axisTriad=c.view.getAxisTriad();return b}__extends(e,a);e.prototype.needsSelection=function(a,b,e){return(a===d.EventType.MouseUp||a===d.EventType.TouchEnd)&&this._axisTriad.getEnabled()&&this._axisTriad._geometryHasBeenCreated()&&this._axisTriad._insideOverlay(e)?!0:!1};e.prototype._selectionMask=function(a){return d.SelectionMask.Face};e.prototype._onlySelectOverlays=function(){return!0};e.prototype.onMouseUp=
function(c){if(this._axisTriad.getEnabled()&&25>d.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()){var b=c._getPickResult(this._selectionMask(d.EventType.MouseUp));b=this._axisTriad._onClickSelection(b);b}a.prototype.onMouseUp.call(this,c)};return e}(h.OperatorBase);h.AxisTriadOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(){return function(a,c,b,d,f){this.section=a;this.node=c;this.planeIndex=b;this.plane=d;this.selectionPosition=f;this.origPlaneD=d.d}}(),a=function(a){function c(b,c){b=a.call(this,b)||this;b._handled=!1;b._context=null;b._cuttingManager=c;return b}__extends(c,a);c.prototype.onMouseDown=function(b){a.prototype.onMouseDown.call(this,b);this._handled=!1;this.isActive()&&this._cuttingManager.hasActiveCuttingSection()&&this._startSelection(b)};c.prototype.onMouseMove=
function(b){a.prototype.onMouseMove.call(this,b);var c=this._context;this.isActive()&&null!==c&&(b.setHandled(!0),this._updatePlane(b.getPosition(),c,!1),this._viewer.trigger("cuttingPlaneDrag",c.section,c.planeIndex))};c.prototype._updatePlane=function(a,c,e){var b=c.selectionPosition,g=c.plane.normal.copy().add(c.selectionPosition),f=this._viewer.view.unprojectPoint(a,0);a=this._viewer.view.unprojectPoint(a,.5);null!==f&&null!==a&&(b=d.Util.lineLineIntersect(b,g,f,a),null!==b&&(b=d.Point3.subtract(b,
c.selectionPosition),b=0>d.Point3.dot(b,c.plane.normal)?b.length():-b.length(),c.plane.d=c.origPlaneD+b,b=c.plane.normal.copy().scale(-b),b=(new d.Matrix).setTranslationComponent(b.x,b.y,b.z),c.section.updatePlane(c.planeIndex,c.plane,b,e,!1)),this._cuttingManager.delayCapping())};c.prototype.onMouseUp=function(b){if(this.isActive()){var c=this._context;null!==c&&(this._updatePlane(b.getPosition(),c,!0),this._viewer.trigger("cuttingPlaneDragEnd",c.section,c.planeIndex));this._context=null;b.setHandled(this._handled)}a.prototype.onMouseUp.call(this,
b)};c.prototype.setHandled=function(){return this._handled};c.prototype._startSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,h,m,p,r,q;return __generator(this,function(g){switch(g.label){case 0:return this._context=null,b=a.getPosition(),c=d.SelectionMask.Face|d.SelectionMask.Line,e=new d.PickConfig(c),e.ignoreCappingGeometry=!0,e.forceEffectiveSceneVisibilityMask=d.SelectionMask.Face,[4,this._viewer.view.compositePickFromPoint(b,e)];case 1:h=g.sent();m=h.fetchMostRelevant(c);
if(null===m)return[2];p=m.getNodeId();r=this._cuttingManager.getCuttingSectionFromNodeId(p);null!==r&&(a.setHandled(!0),this._handled=!0,q=r.getPlaneIndexByNodeId(p),this._context=new f(r,p,q,r.getPlane(q),m.getPosition()),this._cuttingManager.delayCapping(),this._viewer.trigger("cuttingPlaneDragStart",r,q));return[2]}})})};return c}(h.OperatorBase);h.CuttingPlaneOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c){var b=a.call(this,c)||this;b._draggingHandle=!1;b._newRotationMatrix=new d.Matrix;b._translation=d.Point3.zero();b._newTranslation=d.Point3.zero();b._nodeIdGroupMap=new Map;b._groupIdCount=0;b._activeChildrenGroupIds=new Map;b._initialLocalNodeMatrices=[];b._newLocalNodeMatrices=[];b._trackedPoints=[];b._trackedPointsPositions=[];b._trackedPointCount=0;b._previousContextClick=!1;b._overlayIndex=null;b._activeHandleNodeId=null;b._handleEventType=
d.HandleEventType.Translate;b._highlightedHandleId=null;b._handleSize=1;b._explodeActive=!1;b._measureActive=!1;b._settingMatrixInProgress=!1;b._handleMarkup=new d.Markup.HandleMarkup(c);c.setCallbacks({explode:function(a){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return(this._explodeActive=0<a)?[4,this.removeHandles()]:[3,2];case 1:b.sent(),b.label=2;case 2:return[2]}})})},measurementBegin:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,
function(a){switch(a.label){case 0:return this._measureActive=!0,[4,this.removeHandles()];case 1:return a.sent(),[2]}})})},measurementCreated:function(){b._measureActive=!1}});return b}__extends(e,a);e.prototype.setAxisMeshData=function(a){return this._handleMarkup.setAxisMeshData(a)};e.prototype.setPlaneMeshData=function(a){return this._handleMarkup.setPlaneMeshData(a)};e.prototype.setViewPlaneMeshData=function(a){return this._handleMarkup.setViewPlaneMeshData(a)};e.prototype.setRotateMeshData=function(a){return this._handleMarkup.setRotateMeshData(a)};
e.prototype.addTrackedPoint=function(a){var b=this._trackedPointCount;this._trackedPoints[b]=a.copy();this._trackedPointsPositions[b]=a.copy();++this._trackedPointCount;return b};e.prototype.getTrackedPoints=function(){return this._trackedPointsPositions};e.prototype.clearTrackedPoints=function(){this._trackedPoints.length=0;this._trackedPointCount=this._trackedPointsPositions.length=0};e.prototype.isEnabled=function(){return!this._explodeActive&&!this._measureActive&&!this._viewer.isDrawingSheetActive()};
e.prototype._guardEnabled=function(){if(!this.isEnabled()){var a=this._explodeActive?"Handles are not enabled when the model is exploded":this._measureActive?"Handles are not enabled while a measurement is in progress.":this._viewer.isDrawingSheetActive()?"Handles are not enabled for 2d drawings.":"Handles are not enabled.";throw new d.CommunicatorError(a);}};e.prototype.setHandleSize=function(a){this._handleSize=a};e.prototype.addHandles=function(a,b,d){void 0===b&&(b=null);void 0===d&&(d=null);
return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(e){switch(e.label){case 0:return this._previousContextClick=!1,this._guardEnabled(),b?[3,2]:[4,this._viewer.model.getNodesBounding(a)];case 1:return c=e.sent(),[2,this.addHandles(a,c.center())];case 2:return null===d&&(d=this.generateGroupId()),this._nodeIdGroupMap.set(d,a),[2,this._handleMarkup.addHandles(b,this._handleSize,d)]}})})};e.prototype.generateGroupId=function(){return this._groupIdCount++};e.prototype._massageGroupId=
function(a){return null===a?d.Markup.HandleMarkup.defaultGroupId:a};e.prototype.addAxisTranslationHandle=function(a,b,d,e,f){void 0===e&&(e=null);void 0===f&&(f=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addAxisTranslationHandle(a,b,d,e,this._massageGroupId(f))]})})};e.prototype.addAxisRotationHandle=function(a,b,d,e,f){void 0===e&&(e=null);void 0===f&&(f=null);return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addRotateHandle(a,b,d,e,this._massageGroupId(f))]})})};e.prototype.addPlaneTranslationHandle=function(a,b,d,e,f,h){void 0===f&&(f=null);void 0===h&&(h=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addPlaneTranslationHandle(a,b,d,e,f,this._massageGroupId(h))]})})};
e.prototype.addViewPlaneTranslationHandle=function(a,b,d){void 0===d&&(d=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addViewPlaneHandle(a,b,this._massageGroupId(d))]})})};e.prototype.setNodeIds=function(a,b){void 0===b&&(b=null);this._nodeIdGroupMap.set(this._massageGroupId(b),a)};e.prototype.getNodeIds=function(a){void 0===a&&(a=null);a=this._nodeIdGroupMap.get(this._massageGroupId(a));
return void 0===a?[]:a.slice()};e.prototype.showHandles=function(){this._handleMarkup.showOverlay()};e.prototype.updatePosition=function(a,b,d,e){void 0===e&&(e=null);return this._handleMarkup.updatePosition(a,b,d,this._massageGroupId(e),this._activeChildrenGroupIds)};e.prototype.getPosition=function(){var a=this._handleMarkup.getHandleNodeIds();return 0<a.length&&(a=this._handleMarkup.getPosition(a[0]),null!==a)?a.copy():null};e.prototype.removeHandles=function(){this._newRotationMatrix=new d.Matrix;
this._translation=d.Point3.zero();this._highlightedHandleId=null;this._nodeIdGroupMap.clear();this._groupIdCount=0;return this._handleMarkup.removeHandles()};e.prototype.getTranslation=function(){return this._translation};e.prototype._initLocalNodeMatrices=function(a){var b=this._viewer.model;this._initialLocalNodeMatrices=[];for(var c=0;c<a.length;c++)this._initialLocalNodeMatrices.push(b.getNodeMatrix(a[c]))};e.prototype._getHandleEventType=function(a){return this._handleMarkup.getHandleType(a)===
d.HandleType.Rotate?d.HandleEventType.Rotate:d.HandleEventType.Translate};e.prototype._rotate=function(a,b,e,f){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(g){switch(g.label){case 0:if(!this._draggingHandle||this._settingMatrixInProgress)return[2];c=this.getNodeIds(f);return[4,this._genericTransform(a,b,d.Point3.zero(),e,c,f)];case 1:return g.sent(),this._viewer.trigger("handleEvent",d.HandleEventType.Rotate,c,this._initialLocalNodeMatrices,this._newLocalNodeMatrices),
[2]}})})};e.prototype._translate=function(a,b,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(g){switch(g.label){case 0:if(!this._draggingHandle||this._settingMatrixInProgress)return[2];c=this.getNodeIds(e);return[4,this._genericTransform(d.Point3.zero(),0,a,b,c,e)];case 1:return g.sent(),this._viewer.trigger("handleEvent",d.HandleEventType.Translate,c,this._initialLocalNodeMatrices,this._newLocalNodeMatrices),[2]}})})};e.prototype._genericTransform=function(a,
b,e,f,h,n){return __awaiter(this,void 0,void 0,function(){var c,g,k,l,u,t,v,w,z,y,x,A,B,D,C,E;return __generator(this,function(m){switch(m.label){case 0:this._settingMatrixInProgress=!0;c=this._viewer.model;g=new d.Matrix;this._newTranslation=e;0<a.squaredLength()&&(g=this._getRotationMatrix(a,d.Point3.zero(),b),this._newRotationMatrix=g.copy());k=[];k.push(this.updatePosition(this._newTranslation,this._newRotationMatrix,!1,n));this._newLocalNodeMatrices=[];for(l=0;l<h.length;l++)u=this._newTranslation.copy(),
t=h[l],v=this._initialLocalNodeMatrices[l].copy(),w=a.copy(),z=f.copy(),y=void 0,x=c.getNodeParent(t),null!==x?(y=c.getNodeNetMatrix(x),A=d.Matrix.inverse(y),null!==A&&(A.transform(z,z),A.setTranslationComponent(0,0,0),A.transform(w,w),A.transform(u,u))):y=null,0<a.squaredLength()&&(g=this._getRotationMatrix(w,z,y&&0>y.upperLeft3x3Determinant()?-b:b),v=d.Matrix.multiply(v,g)),v.setTranslationComponent(v.m[12]+u.x,v.m[13]+u.y,v.m[14]+u.z),k.push(c.setNodeMatrix(t,v)),this._newLocalNodeMatrices.push(v);
B=this._newRotationMatrix.copy();B.setTranslationComponent(e.x,e.y,e.z);for(l=0;l<this._trackedPoints.length;++l)D=this._trackedPoints[l].copy(),C=d.Point3.subtract(D,f),B.transform(C,C),E=d.Point3.add(C,f),this._trackedPointsPositions[l]=E;return[4,d.Util.waitForAll(k)];case 1:return m.sent(),this._settingMatrixInProgress=!1,[2]}})})};e.prototype._testRotate=function(a,b,e){void 0===e&&(e=null);return __awaiter(this,void 0,void 0,function(){var c,g;return __generator(this,function(f){switch(f.label){case 0:e=
this._massageGroupId(e);c=this._getActiveNodeIdByGroupId(e);if(null===c)return[3,3];g=this._handleMarkup.getPosition(c);if(null===g)return[2];this._startDragging(c,d.HandleEventType.Rotate);return[4,this._rotate(a,b,g,e)];case 1:return f.sent(),[4,this._stopDragging()];case 2:f.sent(),f.label=3;case 3:return[2]}})})};e.prototype._testTranslate=function(a,b){void 0===b&&(b=null);return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(e){switch(e.label){case 0:b=this._massageGroupId(b);
c=this._getActiveNodeIdByGroupId(b);if(null===c)return[3,3];this._startDragging(c,d.HandleEventType.Translate);return[4,this._translate(a,d.Point3.zero(),b)];case 1:return e.sent(),[4,this._stopDragging()];case 2:e.sent(),e.label=3;case 3:return[2]}})})};e.prototype._getActiveNodeIdByGroupId=function(a){for(var b=this._handleMarkup.getHandleNodeIds(),c=0;c<b.length;++c){var d=b[c];if(this._handleMarkup.getHandleGroupId(d)===a)return d}return null};e.prototype._startDragging=function(a,b){var c=this;
this._activeHandleNodeId=a;this._handleEventType=b;var d=this._handleMarkup.getHandleGroupId(a),e=this.getNodeIds(d),f=new Map;this._nodeIdGroupMap.forEach(function(a,b){b!==d&&a.forEach(function(a){for(var d=c._viewer.model.getNodeParent(a);null!==d;){if(-1!==e.indexOf(d)){f.set(b,a);break}d=c._viewer.model.getNodeParent(d)}})});this._activeChildrenGroupIds=f;0<e.length&&(this._initLocalNodeMatrices(e),this._viewer.trigger("handleEventStart",this._handleEventType,e,this._initialLocalNodeMatrices),
this._draggingHandle=!0)};e.prototype._stopDragging=function(){return __awaiter(this,void 0,void 0,function(){var a,b;return __generator(this,function(c){switch(c.label){case 0:this._draggingHandle=!1;if(null===this._activeHandleNodeId)return[3,2];a=this._handleMarkup.getHandleGroupId(this._activeHandleNodeId);return[4,this.updatePosition(this._newTranslation,this._newRotationMatrix,!0,a)];case 1:c.sent(),b=this.getNodeIds(a),this._activeHandleNodeId=null,this._activeChildrenGroupIds.clear(),this._viewer.trigger("handleEventEnd",
this._handleEventType,b,this._initialLocalNodeMatrices,this._newLocalNodeMatrices),this._newRotationMatrix=new d.Matrix,this._handleMarkup.resetTranslation(),this._translation.add(this._newTranslation),this._newTranslation=d.Point3.zero(),this._trackedPoints=this._trackedPointsPositions.slice(),c.label=2;case 2:return[2]}})})};e.prototype.onMouseDown=function(c){a.prototype.onMouseDown.call(this,c);this._overlayIndex=null;var b=c._getPickResult(this._selectionMask(d.EventType.MouseDown));if(null!==
b&&b.isNodeEntitySelection()){b=b.getNodeId();var e=this._viewer.model.getNodeName(b);null!==e&&"handle-"===e.slice(0,7)&&(c.setHandled(!0),c=this._getHandleEventType(b),this._startDragging(b,c))}};e.prototype._onHandleDrag=function(){if(null!==this._activeHandleNodeId){var a=this._viewer.view.getCamera();d.Point3.zero();d.Point3.zero();var b=this._handleMarkup.getHandleType(this._activeHandleNodeId),e=this._handleMarkup.getVector(this._activeHandleNodeId),f=this._handleMarkup.getPosition(this._activeHandleNodeId);
if(null!==b&&null!==f){var h=this._handleMarkup.getHandleGroupId(this._activeHandleNodeId);switch(b){case d.HandleType.Axis:null!==e&&(a=this._getTranslationComponent(f,e,0,h),this._translate(a,f,h));break;case d.HandleType.Plane:null!==e&&(a=this._getTranslationComponent(f,e,1,h),this._translate(a,f,h));break;case d.HandleType.ViewPlane:e=a.getTarget();a=a.getPosition();a=d.Point3.subtract(a,e).normalize();a=this._getTranslationComponent(f,a,2,h);this._translate(a,f,h);break;case d.HandleType.Rotate:null!==
e&&(this._handleMarkup.getGroupIdRotationMatrix(h).copy().setTranslationComponent(0,0,0).transform(e,e),a=this._getRotationAngle(f,e),this._rotate(e,a,f,h));break;default:d.Util.TypeAssertNever(b)}}}};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);this._draggingHandle&&null!==this._activeHandleNodeId?this._onHandleDrag():this._highlightHandle(c._getPickResult(this._selectionMask(d.EventType.MouseMove)))};e.prototype.onMouseUp=function(c){this._draggingHandle||!(3>this._dragCount)||
c.getButton()===d.Button.Right||this._previousContextClick||this._viewer.getContextMenuStatus()||0!==this._overlayIndex&&null!==this._overlayIndex||this.removeHandles();this._previousContextClick=c.getButton()===d.Button.Right||this._viewer.getContextMenuStatus();this._draggingHandle&&this._stopDragging();a.prototype.onMouseUp.call(this,c)};e.prototype.needsSelection=function(a){return this._handleMarkup.isEmpty()?!1:a===d.EventType.MouseDown||a===d.EventType.TouchStart||!this._dragging&&a===d.EventType.MouseMove};
e.prototype._selectionMask=function(a){return d.SelectionMask.Face};e.prototype._onlySelectOverlays=function(){return!0};e.prototype.setHandled=function(){return this._draggingHandle};e.prototype._getClosestPoint=function(a,b,e){var c=a.copy();a=a.copy().add(b);b=this._viewer.view.unprojectPoint(e,0);e=this._viewer.view.unprojectPoint(e,.5);return null!==b&&null!==e?d.Util.lineLineIntersect(c,a,b,e):null};e.prototype._getTranslationComponent=function(a,b,e,f){2!==e&&this._handleMarkup.getGroupIdRotationMatrix(f).copy().setTranslationComponent(0,
0,0).transform(b,b);var c=f=null;1===e||2===e?(f=this._getPlaneIntersectionPoint(a,b,this._ptFirst),null!==f&&(c=this._getPlaneIntersectionPoint(f,b,this._ptCurrent))):0===e&&(f=this._getClosestPoint(a,b,this._ptFirst),null!==f&&(c=this._getClosestPoint(f,b,this._ptCurrent)));return null!==c&&null!==f?d.Point3.subtract(c,f):d.Point3.zero()};e.prototype._clearHighlightedHandle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return null===
this._highlightedHandleId?[3,2]:[4,this._viewer.model.unsetNodesFaceColor([this._highlightedHandleId])];case 1:a.sent(),this._highlightedHandleId=null,a.label=2;case 2:return[2]}})})};e.prototype._highlightHandle=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e;return __generator(this,function(f){switch(f.label){case 0:if(null===a||!a.isNodeEntitySelection()||a.overlayIndex()!==d.BuiltinOverlayIndex.Handles)return[3,2];b=this._viewer.model;c=b.getNodeName(a.getNodeId());if(null===
c||"handle-"!==c.slice(0,7))return[3,2];e=a.getNodeId();return this._highlightedHandleId===e?[2]:[4,this._clearHighlightedHandle()];case 1:return f.sent(),this._highlightedHandleId=e,b.setNodesFaceColor([this._highlightedHandleId],d.Color.green()),[2];case 2:return[2,this._clearHighlightedHandle()]}})})};e.prototype._getPlaneIntersectionPoint=function(a,b,e){var c=this._viewer.view.unprojectPoint(e,0);e=this._viewer.view.unprojectPoint(e,.5);if(null===c||null===e)return null;c=new d.Ray(c,e.copy().subtract(c));
a=d.Plane.createFromPointAndNormal(a,b);b=d.Point3.zero();return a.intersectsRay(c,b)?b:null};e.prototype._getRotationAngle=function(a,b){console.assert(null!==a);var c=this._getPlaneIntersectionPoint(a,b,this._ptFirst),e=this._getPlaneIntersectionPoint(a,b,this._ptCurrent);if(null===c||null===e)return 0;c=d.Point3.subtract(c,a).normalize();a=d.Point3.subtract(e,a).normalize();e=d.Point3.dot(c,a);e=180*Math.acos(e)/Math.PI;0>d.Point3.dot(d.Point3.cross(c,a),b)&&(e=-e);return e};e.prototype._getRotationMatrix=
function(a,b,e){var c=(new d.Matrix).setTranslationComponent(-b.x,-b.y,-b.z);a=d.Matrix.createFromOffAxisRotation(a,e);b=(new d.Matrix).setTranslationComponent(b.x,b.y,b.z);return d.Matrix.multiply(d.Matrix.multiply(c,a),b)};return e}(h.OperatorBase);h.HandleOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c){var b=a.call(this,c)||this;b._navCube=c.view.getNavCube();return b}__extends(e,a);e.prototype.needsSelection=function(a,b,e){return!d.Event._isMouseEventType(a)&&a!==d.EventType.TouchEnd||this._dragging&&1<this._dragCount||!this._navCube.getEnabled()||!this._navCube._insideOverlay(e)?!1:!0};e.prototype._selectionMask=function(a){return d.SelectionMask.Face};e.prototype._onlySelectOverlays=function(){return!0};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,
c);this._navCube.getEnabled()&&(c=c._getPickResult(this._selectionMask(d.EventType.MouseMove)),this._navCube._onMoveSelection(c))};e.prototype.onMouseUp=function(c){if(this._navCube.getEnabled()&&25>d.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()){var b=c._getPickResult(this._selectionMask(d.EventType.MouseUp));this._navCube._onClickSelection(b)}a.prototype.onMouseUp.call(this,c)};return e}(h.OperatorBase);h.NavCubeOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){var f=function(a){function e(c,b){c=a.call(this,c)||this;c._insertNoteButton=d.Button.Left;c._callbackFlag=!1;c._noteTextManager=b;return c}__extends(e,a);e.prototype.onMouseDown=function(c){var b=this;a.prototype.onMouseDown.call(this,c);this.isActive()&&(this._callbackFlag||(this._viewer.setCallbacks({explode:function(a){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._noteTextManager.explode(a)];case 1:return b.sent(),
[2]}})})},addCuttingSection:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._noteTextManager.checkCuttingActive()];case 1:return a.sent(),[2]}})})},removeCuttingSection:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._noteTextManager.checkCuttingActive()];case 1:return a.sent(),[2]}})})}}),this._callbackFlag=!0),this._dragging=!1)};e.prototype.onMouseUp=
function(c){var b=this;if(this.isActive()){var e=new d.PickConfig(d.SelectionMask.Face);if(this._ptFirst.equals(this._ptCurrent)&&c.getButton()===this._insertNoteButton||null!==this._primaryTouchId)e=this._viewer.view.pickFromPoint(c.getPosition(),e).then(function(a){b._noteTextManager.selectPin(a)||b._noteTextManager.getExplodeActive()||b._noteTextManager.getIsolateActive()||0!==a.overlayIndex()||(a.isFaceSelection()&&new d.Markup.Note.NoteText(b._viewer,b._noteTextManager,a.getPosition(),a.getFaceEntity().getNormal(),
a.getNodeId()),c.setHandled(!0))}),e}a.prototype.onMouseUp.call(this,c)};e.prototype.getNoteTextElement=function(){return this._noteTextManager.getNoteTextElement()};e.prototype.setNoteTextElement=function(a){this._noteTextManager.setNoteTextElement(a)};e.prototype.checkPinInstance=function(a){return null!==this._noteTextManager.checkPinInstance(a)};return e}(h.OperatorBase);h.NoteOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c){var b=a.call(this,c)||this;b._selectionButton=d.Button.Left;b._ignoreTransparency=!1;b._forceEffectiveSceneVisibilityMask=d.SelectionMask.None;b._incrementalSelection=d.Util.IncrementalSelection.create("SelectionManager",c);c.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.clearSelection()];case 1:return a.sent(),[2,this.waitForIdle()]}})})},
selectionArray:function(a){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return 0!==a.length?[3,2]:[4,this._incrementalSelection.stopSelection()];case 1:b.sent(),b.label=2;case 2:return[2]}})})}});return b}__extends(e,a);e.prototype.getForceEffectiveSceneVisibilityMask=function(){return this._forceEffectiveSceneVisibilityMask};e.prototype.setForceEffectiveSceneVisibilityMask=function(a){this._forceEffectiveSceneVisibilityMask=a};e.prototype.setIgnoreTransparency=
function(a){this._ignoreTransparency=a};e.prototype.getIgnoreTransparency=function(){return this._ignoreTransparency};e.prototype.hasActiveSelection=function(){return!this._incrementalSelection.isIdle()};e.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._incrementalSelection.waitForIdle()]})})};e.prototype.clearSelection=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,
this._incrementalSelection.clearSelection()]})})};e.prototype._createBeginConfig=function(a){var b=new d.IncrementalPickConfig;b.forceEffectiveSceneVisibilityMask=this._forceEffectiveSceneVisibilityMask;b.ignoreUnrequestedInstances=!0;return{pickConfig:b,rayCssOrigin:a,rayCssBoxRadius:10}};e.prototype._selectionPredicate=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,d;return __generator(this,function(e){switch(e.label){case 0:return b=this._viewer.model,c=a.getNodeId(),null===
c?[2,!1]:[4,b.getNodesHaveTransparency([c])];case 1:return d=e.sent()[0],[2,!d]}})})};e.prototype._performSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,d=this;return __generator(this,function(e){b=this._createBeginConfig(a);c=this._ignoreTransparency?function(a){return d._selectionPredicate(a)}:null;return[2,this._incrementalSelection.performSelection(b,c)]})})};e.prototype.setHandled=function(){return!0};e.prototype.onKeyUp=function(c){c.getKeyCode()===d.KeyCode.Escape&&
this.clearSelection();a.prototype.onKeyUp.call(this,c)};e.prototype.onMouseUp=function(c){var b=this;this.isActive()&&function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return(c.getButton()===this._selectionButton||null!==this._primaryTouchId)&&25>d.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()?c.controlDown()?[3,2]:[4,this.clearSelection()]:[3,4];case 1:a.sent(),a.label=2;case 2:return[4,this._performSelection(c.getPosition())];
case 3:a.sent(),a.label=4;case 4:return[2]}})})}();a.prototype.onMouseUp.call(this,c)};return e}(h.OperatorBase);h.RayDrillSelectionOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c,b){c=a.call(this,c)||this;c._selectionButton=d.Button.Left;c._forceEffectiveSceneVisibilityMask=d.SelectionMask.None;c._noteTextManager=b;return c}__extends(e,a);e.prototype.getForceEffectiveSceneVisibilityMask=function(){return this._forceEffectiveSceneVisibilityMask};e.prototype.setForceEffectiveSceneVisibilityMask=function(a){this._forceEffectiveSceneVisibilityMask=a};e.prototype.getSelectionButton=function(){return this._selectionButton};
e.prototype.setSelectionButton=function(a){this._selectionButton=a};e.prototype.onKeyUp=function(c){c.getKeyCode()===d.KeyCode.Escape&&this._viewer.selectionManager.clear();a.prototype.onKeyUp.call(this,c)};e.prototype.onMouseUp=function(c){var b=this;if(this.isActive()&&5>d.Point2.subtract(this._ptFirst,this._ptCurrent).length()&&(c.getButton()===this._selectionButton||null!==this._primaryTouchId)){var e=this._viewer.view,f=new d.PickConfig(d.SelectionMask.Face|d.SelectionMask.Line);f.forceEffectiveSceneVisibilityMask=
this._forceEffectiveSceneVisibilityMask;e=e.pickFromPoint(this._ptCurrent,f).then(function(a){var e=null!==b._viewer.cuttingManager.getCuttingSectionFromNodeId(a.getNodeId()),f=b._noteTextManager.selectPin(a),g=b._viewer.markupManager.pickMarkupItem(b._ptCurrent);if(g instanceof d.Markup.Redline.RedlineText)g.onSelect();f||e||null!==g||(a.isNodeSelection()?b._processSelectionClick(c,a):b._isDoubleClick||b._viewer.selectionManager.clear())});e}a.prototype.onMouseUp.call(this,c)};e.prototype.onDoubleClick=
function(a){return this._viewer.view.fitWorld()};e.prototype._getSelectionOrParentIfSelected=function(a){var b=this._viewer.model,c=a.getNodeId();if(!b.isNodeLoaded(c)||b.getNodeType(c)===d.NodeType.PmiBody)return a;var e=this._viewer.selectionManager,f=null;e.getSelectParentIfSelected()&&(f=e.containsParent(a));return null!==f?(b=d.Selection.SelectionItem.create(b.getNodeParent(f.getNodeId())),b.isNodeSelection()?b:a):e.contains(a)?(b=d.Selection.SelectionItem.create(b.getNodeParent(c)),b.isNodeSelection()?
b:a):a};e.prototype._processSelectionClick=function(a,b){var c=b.overlayIndex();if(0===c||null===c)c=this._viewer.selectionManager,a.controlDown()||a.commandDown()?c.toggle(b):(a=this._getSelectionOrParentIfSelected(b),c.set(a))};return e}(h.OperatorBase);h.SelectionOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function f(a,b,c){a.has(b)&&a.has(c)&&(a.delete(b),a.delete(c))}function a(a){f(a,d.WalkDirection.Forward,d.WalkDirection.Backward);f(a,d.WalkDirection.Left,d.WalkDirection.Right);f(a,d.WalkDirection.Up,d.WalkDirection.Down);f(a,d.WalkDirection.RotateLeft,d.WalkDirection.RotateRight);f(a,d.WalkDirection.TiltUp,d.WalkDirection.TiltDown)}function e(a,b){var c=new d.PickConfig(d.SelectionMask.Face);c.bimMask=a;c.ignoreOverlays=!0;null!==b&&(c.maxWorldDistance=b);return c}function c(a,
b,c,f){return __awaiter(this,void 0,void 0,function(){var g,h,k;return __generator(this,function(l){switch(l.label){case 0:return g=new d.Ray(b,c),h=e(d.BimMask.Floor,f),[4,a.pickFromRay(g,h)];case 1:return k=l.sent(),k.isFaceSelection()?[2,k.getPosition()]:[2,null]}})})}function b(a,b,c,f){return __awaiter(this,void 0,void 0,function(){var g,h,k;return __generator(this,function(l){switch(l.label){case 0:return g=new d.Ray(b,c),h=e(d.BimMask.Wall,f),[4,a.pickFromRay(g,h)];case 1:return k=l.sent(),
k.isFaceSelection()?[2,k]:[2,null]}})})}var g=function(){function a(a){this._nearbyDoors=new Set;this._viewer=a}a.prototype._performSphereSelection=function(a,b,c){var e=d.Util.IncrementalSelection.create("View",this._viewer),f=new d.IncrementalPickConfig(d.SelectionMask.Face);f.bimMask=c;f.onlyStreamedInstances=!0;f.ignoreUnrequestedInstances=!0;return e.performSelection({pickConfig:f,sphereCenter:a,sphereRadius:b})};a.prototype.updateNearbyDoors=function(a,b,c){return __awaiter(this,void 0,void 0,
function(){var e,f,g,h,k,l,m,n,p,A,B;return __generator(this,function(q){switch(q.label){case 0:return[4,this._performSphereSelection(a,b,d.BimMask.Door)];case 1:e=q.sent();f=new Set;g=0;for(h=e;g<h.length;g++)k=h[g],l=k.getNodeId(),f.add(l);m=d.Util.setSubtraction(f,this._nearbyDoors);n=d.Util.setSubtraction(this._nearbyDoors,f);p=d.Util.setToArray(m);A=d.Util.setToArray(n);B=this._viewer.model;B.setNodesOpacity(p,c);B.resetNodesOpacity(A);this._nearbyDoors=f;return[2]}})})};a.prototype.forgetNearbyDoors=
function(){var a=d.Util.setToArray(this._nearbyDoors);this._nearbyDoors.clear();this._viewer.model.resetNodesOpacity(a)};return a}(),k=function(e){function f(a){var b=e.call(this,a)||this;b._walkDistance=0;b._elevationSpeed=0;b._rotationSpeed=0;b._mouseLookSpeed=0;b._viewAngle=90;b._zoomDistance=0;b._tilt=0;b._majorAxis=d.Axis.X;b._previousWalkTime=0;b._maxExtents=0;b._walkActive=!1;b._activeWalk=new d.Util.CurrentAction(!0);b._keyUpMap=new Map;b._keyDownMap=new Map;b._tickTimerId=null;b._keyWalkMapping=
new Map;b._mouseLookEnabled=!0;b._bimModeEnabled=!1;b._syncronizedToggleBimMode=new d.Internal.CurrentActionSync;b._logical={floor:__assign({},f.Bim.Default.FloorConfig),wall:__assign({},f.Bim.Default.WallConfig),door:__assign({},f.Bim.Default.DoorConfig)};b._effective={floor:__assign({},f.Bim.Default.FloorConfig),wall:__assign({},f.Bim.Default.WallConfig),door:__assign({},f.Bim.Default.DoorConfig)};b._doorCache=new g(a);b._downAxis=new d.Point3(0,-1,0);b.addKeyMapping(d.KeyCode.a,d.WalkDirection.Left);
b.addKeyMapping(d.KeyCode.d,d.WalkDirection.Right);b.addKeyMapping(d.KeyCode.w,d.WalkDirection.Forward);b.addKeyMapping(d.KeyCode.s,d.WalkDirection.Backward);b.addKeyMapping(d.KeyCode.q,d.WalkDirection.RotateLeft);b.addKeyMapping(d.KeyCode.e,d.WalkDirection.RotateRight);b.addKeyMapping(d.KeyCode.r,d.WalkDirection.TiltUp);b.addKeyMapping(d.KeyCode.f,d.WalkDirection.TiltDown);b.addKeyMapping(d.KeyCode.x,d.WalkDirection.Up);b.addKeyMapping(d.KeyCode.c,d.WalkDirection.Down);b.addKeyMapping(d.KeyCode.LeftArrow,
d.WalkDirection.Left);b.addKeyMapping(d.KeyCode.RightArrow,d.WalkDirection.Right);b.addKeyMapping(d.KeyCode.UpArrow,d.WalkDirection.Forward);b.addKeyMapping(d.KeyCode.DownArrow,d.WalkDirection.Backward);a.setCallbacks({camera:function(a){a.getProjection()!==d.Projection.Perspective&&b._keyDownMap.clear()},subtreeLoaded:function(a,c){c===d.NodeSource.LoadModel&&b._updateSceneFloor()}});return b}__extends(f,e);f.prototype._updateSceneFloor=function(){var a=this._viewer.model.getViewAxes().upVector;
console.assert(a.isAxis());this._downAxis=d.Point3.scale(a,-1)};f.prototype.isBimModeEnabled=function(){return this._bimModeEnabled};f.prototype._enableBimMode=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._bimModeEnabled=!0,this._effective.floor=this._scaleAgainstModelUnit(this._logical.floor),this._effective.wall=this._scaleAgainstModelUnit(this._logical.wall),this._effective.door=this._scaleAgainstModelUnit(this._logical.door),
this._updateSceneFloor(),[4,this._applyGravity()];case 1:return a.sent(),[4,this._updateNearbyDoors()];case 2:return a.sent(),[2]}})})};f.prototype._disableBimMode=function(){this._bimModeEnabled=!1;this._doorCache.forgetNearbyDoors()};f.prototype.enableBimMode=function(){var a=this;return this._syncronizedToggleBimMode.set(function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._enableBimMode()];case 1:return a.sent(),[2]}})})})};
f.prototype.disableBimMode=function(){var a=this;return this._syncronizedToggleBimMode.set(function(){a._disableBimMode()})};f.prototype._toggleBimMode=function(){var a=this;return this._syncronizedToggleBimMode.set(function(){return a._bimModeEnabled?a._disableBimMode():a._enableBimMode()})};f.prototype.addKeyMapping=function(a,b){this._keyWalkMapping.set(a,b)};f.prototype.getKeyMapping=function(){return d.Internal.copyMap(this._keyWalkMapping)};f.prototype.clearKeyMappings=function(){this._keyWalkMapping.clear()};
f.prototype.onActivate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._viewer.view.setProjectionMode(d.Projection.Perspective),this._calculateInitialPosition(),0!==this._maxExtents?[3,2]:[4,this.resetDefaultWalkSpeeds()];case 1:a.sent(),a.label=2;case 2:return this._bimModeEnabled?[4,this._updateNearbyDoors()]:[3,4];case 3:a.sent(),a.label=4;case 4:return[2]}})})};f.prototype.resetDefaultWalkSpeeds=function(){return __awaiter(this,
void 0,void 0,function(){var a,b;return __generator(this,function(c){switch(c.label){case 0:return this._rotationSpeed=40,this._mouseLookSpeed=300,this._viewAngle=90,[4,this._viewer.model.getModelBounding(!0,!1)];case 1:return a=c.sent(),b=a.extents(),this._maxExtents=Math.max(b.x,b.y,b.z),this._walkDistance=this._maxExtents/10,this._elevationSpeed=this._maxExtents/10,this._zoomDistance=this._maxExtents/30,[2]}})})};f.prototype.getBimFloorConfig=function(){return __assign({},this._logical.floor)};
f.prototype.setBimFloorConfig=function(a){this._logical.floor=__assign({},a);this._effective.floor=this._scaleAgainstModelUnit(this._logical.floor)};f.prototype.getBimWallConfig=function(){return __assign({},this._logical.wall)};f.prototype.setBimWallConfig=function(a){this._logical.wall=__assign({},a);this._effective.wall=this._scaleAgainstModelUnit(this._logical.wall)};f.prototype.getBimDoorConfig=function(){return __assign({},this._logical.door)};f.prototype.setBimDoorConfig=function(a){this._logical.door=
__assign({},a);this._effective.door=this._scaleAgainstModelUnit(this._logical.door)};f.prototype._scaleAgainstModelUnit=function(a){var b=this._viewer.model;b=1/b.getNodeUnitMultiplier(b.getAbsoluteRootNode());a=__assign({},a);for(var c=0,d=Object.keys(a);c<d.length;c++){var e=d[c];"number"===typeof a[e]&&(a[e]*=b)}return a};f.prototype.onMouseDown=function(a){e.prototype.onMouseDown.call(this,a);this._viewer.focusInput(!0)};f.prototype.onMouseMove=function(a){e.prototype.onMouseMove.call(this,a);
if(this._dragging&&this._mouseLookEnabled){this._viewer.view.setProjectionMode(d.Projection.Perspective);var b=window.screen.width,c=window.screen.height;a.setHandled(!0);a=d.Point2.subtract(this._ptPrevious,this._ptCurrent);this.rotateLeft(a.x/b*this._mouseLookSpeed);this.tiltUp(a.y/c*this._mouseLookSpeed)}};f.prototype.onMouseUp=function(a){5<this._dragCount&&a.setHandled(!0);e.prototype.onMouseUp.call(this,a)};f.prototype.onMousewheel=function(a){var b=this;this._viewer.view.setProjectionMode(d.Projection.Perspective);
var c=this._viewer.view,e=c.getCamera(),f=a.getPosition(),g=a.getWheelDelta();a=c.pickFromPoint(f,new d.PickConfig(d.SelectionMask.Face)).then(function(a){var c=a.getPosition();null!==a&&null!==c?(a=d.Point3.subtract(e.getPosition(),c).normalize().scale(b._zoomDistance*g),b._applyWalkDelta(e,a)):b.walkForward(g*b._walkDistance)});a};f.prototype.onKeyDown=function(a){this._viewer.view.setProjectionMode(d.Projection.Perspective);var b=a.getKeyCode();b===d.KeyCode.v&&this._toggleBimMode();this._keyCodeActive(b)||
(this._keyDownMap.set(b,a.getDate().getTime()),this._onKeyChange(b))};f.prototype.onKeyUp=function(a){var b=a.getKeyCode();this._keyUpMap.set(b,a.getDate().getTime());this._onKeyChange(b)};f.prototype._keyCodeActive=function(a){var b=this._keyDownMap.get(a);return void 0!==b&&(a=this._keyUpMap.get(a),void 0===a||b>a)?!0:!1};f.prototype._onKeyChange=function(a){this._keyCodeActive(a)&&this._keyWalkMapping.has(a)&&(this._walkActive||(this._previousWalkTime=Date.now()),this._onTick())};f.prototype._execWalkDirection=
function(a,b,c){switch(a){case d.WalkDirection.Forward:return this._walkForward(this._walkDistance*b,c);case d.WalkDirection.Backward:return this._walkBackward(this._walkDistance*b,c);case d.WalkDirection.Left:return this._walkLeft(this._walkDistance*b,c);case d.WalkDirection.Right:return this._walkRight(this._walkDistance*b,c);case d.WalkDirection.Up:return this.walkUp(this._elevationSpeed*b);case d.WalkDirection.Down:return this.walkDown(this._elevationSpeed*b);case d.WalkDirection.RotateLeft:return this.rotateLeft(this._rotationSpeed*
b);case d.WalkDirection.RotateRight:return this.rotateRight(this._rotationSpeed*b);case d.WalkDirection.TiltUp:return this.tiltUp(this._rotationSpeed*b);case d.WalkDirection.TiltDown:return this.tiltDown(this._rotationSpeed*b);default:d.Util.TypeAssertNever(a)}};f.prototype._queueWalkDirections=function(b){var c=this,e=new Set;this._keyWalkMapping.forEach(function(a,b){c._keyCodeActive(b)&&e.add(a)});a(e);var f=d.Util.setToArray(e);f.sort();if(0<f.length){this._walkActive=!0;var g=this._bimModeEnabled;
this._activeWalk.set(function(){return __awaiter(c,void 0,void 0,function(){var a,c,h,k,l,m=this;return __generator(this,function(n){a=new d.Internal.ActionQueue(1,!0);if(0<b)for(c=function(c){a.push(function(){return m._execWalkDirection(c,b,g)})},h=0,k=f;h<k.length;h++)l=k[h],c(l);g&&(e.has(d.WalkDirection.Up)||e.has(d.WalkDirection.Down)||a.push(function(){return __awaiter(m,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._applyGravity()];case 1:return a.sent(),
[2]}})})}),a.push(function(){return __awaiter(m,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._updateNearbyDoors()];case 1:return a.sent(),[2]}})})}));return a.isIdle()?[2]:[2,a.waitForIdle()]})})})}};f.prototype._applyGravity=function(){return __awaiter(this,void 0,void 0,function(){var a,b,e,f,g,h,k,l,n,y;return __generator(this,function(m){switch(m.label){case 0:return a=this._viewer.view,b=a.getCamera(),e=b.getPosition(),[4,c(a,e,this._downAxis,
this._effective.floor.maxFallDistance)];case 1:f=m.sent();if(null!==f)return[3,3];e=d.Point3.subtract(e,d.Point3.scale(this._downAxis,this._effective.floor.avatarOffset));return[4,c(a,e,this._downAxis,this._effective.floor.maxFallDistance)];case 2:f=m.sent();if(null===f)return[2];m.label=3;case 3:g=new d.Point3(0,0,this._effective.floor.avatarOffset);h=d.Point3.add(f,g);k=d.Point3.subtract(h,e);l=k.length();if(l>this._effective.floor.negligibleClimbHeight&&(n=d.Util.computeAngleBetweenVector(k,this._downAxis),
(y=90<n)&&l>this._effective.floor.maxClimbHeight))return[2];this._applyWalkDelta(b,k);return[2]}})})};f.prototype._updateNearbyDoors=function(){var a=this._viewer.view.getCamera().getPosition();return this._doorCache.updateNearbyDoors(a,this._effective.door.transparencyRange,.5)};f.prototype._onTick=function(){var a=this,b=Date.now(),c=(b-this._previousWalkTime)/1E3;this._previousWalkTime=b;this._walkActive=!this._activeWalk.isIdle();this._queueWalkDirections(c);null!==this._tickTimerId&&(cancelAnimationFrame(this._tickTimerId),
this._tickTimerId=null);this._walkActive&&(this._tickTimerId=requestAnimationFrame(function(){a._onTick()}))};f.prototype._updateCamera=function(a){this._resetPosition(a);this._updateCameraTilt(a);this._updateCameraViewAngle(a);this._viewer.view.setCamera(a)};f.prototype._applyWalkDelta=function(a,b){a.dolly(d.Point3.scale(b,-1));this._updateCamera(a)};f.prototype._applyWalkDeltaWithCollisionCheck=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var e,f,g,h,k,l,m,n,p,r,D,C,E,F,G,I,J,
K;return __generator(this,function(q){switch(q.label){case 0:return e=a.getPosition(),f=d.Matrix.createFromOffAxisRotation(c,90),g=f.transform(b),h=d.Matrix.createFromOffAxisRotation(c,-90),k=h.transform(b),l=this._testWallCollision(e,g,this._effective.wall.avatarOffset),m=this._testWallCollision(e,k,this._effective.wall.avatarOffset),n=this._testWallCollision(e,b,b.length()+this._effective.wall.avatarOffset),[4,Promise.all([l,m])];case 1:p=q.sent();r=p[0];D=p[1];if(null!==r||null!==D)if(C=function(a){return null!==
a?(a=a.getFaceEntity().getNormal(),90<d.Util.computeAngleBetweenVector(a,b)):!1},C(r)||C(D))return[2];return[4,n];case 2:return E=q.sent(),null!==E&&(F=b.length(),G=d.Point3.scale(b,1/F),I=d.Point3.subtract(E.getPosition(),e).length(),J=I-this._effective.wall.avatarOffset,K=Math.min(F,J),b=d.Point3.scale(G,K)),this._applyWalkDelta(a,b),[2]}})})};f.prototype._testWallCollision=function(a,c,d){return b(this._viewer.view,a,c,d)};f.prototype._walkBackward=function(a,b){var c=this._viewer.view.getCamera();
this._resetPosition(c);var e=c.getTarget(),f=c.getPosition(),g=c.getUp();a=d.Point3.subtract(f,e).normalize().copy().scale(a);return b?this._applyWalkDeltaWithCollisionCheck(c,a,g):this._applyWalkDelta(c,a)};f.prototype._walkForward=function(a,b){return this._walkBackward(-a,b)};f.prototype._walkLeft=function(a,b){var c=this._viewer.view.getCamera();this._resetPosition(c);var e=c.getTarget(),f=c.getPosition(),g=c.getUp();e=d.Point3.subtract(e,f).normalize();a=d.Point3.cross(g,e).normalize().copy().scale(a);
return b?this._applyWalkDeltaWithCollisionCheck(c,a,g):this._applyWalkDelta(c,a)};f.prototype._walkRight=function(a,b){return this._walkLeft(-a,b)};f.prototype.walkBackward=function(a){return this._walkBackward(a,!1)};f.prototype.walkForward=function(a){return this._walkForward(a,!1)};f.prototype.walkLeft=function(a){return this._walkLeft(a,!1)};f.prototype.walkRight=function(a){return this._walkRight(a,!1)};f.prototype.walkDown=function(a){var b=this._viewer.view.getCamera();this._resetPosition(b);
a=b.getUp().normalize().scale(a);this._applyWalkDelta(b,a)};f.prototype.walkUp=function(a){this.walkDown(-a)};f.prototype.rotateRight=function(a){var b=this._viewer.view.getCamera();this._resetPosition(b);var c=b.getTarget(),e=b.getPosition(),f=d.Point3.subtract(e,c).length(),g=d.Point3.subtract(c,e).normalize();a=d.Util.degreesToRadians(a);a=Math.tan(a);a*=d.Point3.subtract(b.getTarget(),b.getPosition()).length();g=d.Point3.cross(g,b.getUp()).scale(a);c=c.copy().add(g);f=d.Point3.subtract(c,e).normalize().scale(f);
c=d.Point3.add(e,f);b.setTarget(c);this._updateCamera(b)};f.prototype.rotateLeft=function(a){this.rotateRight(-a)};f.prototype.tiltDown=function(a){this.setTilt(this._tilt+a);a=this._viewer.view.getCamera();this._resetPosition(a);this._updateCamera(a)};f.prototype.tiltUp=function(a){this.tiltDown(-a)};f.prototype._calculateInitialPosition=function(){var a=this._viewer.view.getCamera();this._majorAxis=this._calculateMajorAxis(a);this.setTilt(this._calculateInitialTilt(a));this._resetPosition(a);this._updateCamera(a)};
f.prototype._updateCameraViewAngle=function(a){var b=d.Util.degreesToRadians(this._viewAngle);b=Math.tan(b/2);b*=d.Point3.subtract(a.getTarget(),a.getPosition()).length();a.setWidth(b);a.setHeight(b)};f.prototype._updateCameraTilt=function(a){var b=a.getPosition(),c=a.getTarget(),e=a.getUp().normalize(),f=d.Point3.subtract(c,b).normalize();e=d.Point3.cross(e,f).normalize();c=d.Point3.distance(c,b);d.Matrix.createFromOffAxisRotation(e,this._tilt).transform(f,f);a.setTarget(d.Point3.add(b,f.scale(c)))};
f.prototype._calculateInitialTilt=function(a){var b=a.getTarget();a=a.getPosition();a=d.Point3.subtract(b,a);b=a.length();this._majorAxis===d.Axis.X?a.x=0:this._majorAxis===d.Axis.Y?a.y=0:this._majorAxis===d.Axis.Z&&(a.z=0);a=a.length();return 180/Math.PI*Math.acos(a/b)};f.prototype._resetPosition=function(a){this._majorAxis=this._calculateMajorAxis(a);var b=a.getPosition(),c=a.getTarget();c=d.Point3.subtract(c,b);var e=c.length();0<this._walkDistance&&(e=this._walkDistance);switch(this._majorAxis){case d.Axis.X:c.set(0,
c.y,c.z);a.setUp(new d.Point3(1,0,0));break;case d.Axis.Y:c.set(c.x,0,c.z);a.setUp(new d.Point3(0,1,0));break;case d.Axis.Z:c.set(c.x,c.y,0),a.setUp(new d.Point3(0,0,1))}c.normalize().scale(e);a.setTarget(d.Point3.add(b,c))};f.prototype._calculateMajorAxis=function(a){var b=a.getUp();a=Math.abs(b.x);var c=Math.abs(b.y);b=Math.abs(b.z);return b>=a&&b>=c?d.Axis.Z:c>=a&&c>=b?d.Axis.Y:d.Axis.X};f.prototype.setZoomSpeed=function(a){this._zoomDistance=a};f.prototype.getZoomSpeed=function(){return this._zoomDistance};
f.prototype.setTilt=function(a){this._tilt=Math.max(Math.min(a,45),-45);a=this._viewer.view.getCamera();this._updateCamera(a)};f.prototype.getTilt=function(){return this._tilt};f.prototype.setViewAngle=function(a){a=Math.max(Math.min(a,150),30);this._viewAngle!==a&&(this._viewAngle=a,this._updateCamera(this._viewer.view.getCamera()))};f.prototype.getViewAngle=function(){return this._viewAngle};f.prototype.setWalkSpeed=function(a){this._walkDistance=a};f.prototype.getWalkSpeed=function(){return this._walkDistance};
f.prototype.setElevationSpeed=function(a){this._elevationSpeed=a};f.prototype.getElevationSpeed=function(){return this._elevationSpeed};f.prototype.setRotationSpeed=function(a){this._rotationSpeed=a};f.prototype.getRotationSpeed=function(){return this._rotationSpeed};f.prototype.setMouseLookSpeed=function(a){this._mouseLookSpeed=a};f.prototype.getMouseLookSpeed=function(){return this._mouseLookSpeed};f.prototype.setMouseLookEnabled=function(a){this._mouseLookEnabled=a};f.prototype.getMouseLookEnabled=
function(){return this._mouseLookEnabled};return f}(h.OperatorBase);h.CameraKeyboardWalkOperator=k;(function(a){(function(a){(function(a){(function(a){a[a.avatarOffset=1500]="avatarOffset";a[a.maxClimbHeight=600]="maxClimbHeight";a[a.negligibleClimbHeight=20]="negligibleClimbHeight";a[a.maxFallDistance=5E3]="maxFallDistance"})(a.FloorConfig||(a.FloorConfig={}));(function(a){a[a.avatarOffset=150]="avatarOffset"})(a.WallConfig||(a.WallConfig={}));(function(a){a[a.transparencyRange=4E3]="transparencyRange"})(a.DoorConfig||
(a.DoorConfig={}))})(a.Default||(a.Default={}))})(a.Bim||(a.Bim={}))})(k=h.CameraKeyboardWalkOperator||(h.CameraKeyboardWalkOperator={}))})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(e){function c(b,c){b=e.call(this,b)||this;b._cameraRotationMomentumEnabled=!1;b._isDown=!1;b._mouseDragged=!1;b._averagedMousePoints=new a;b._averageTimeIntervalMilliseconds=150;b._previousMouseMovePoint=d.Point2.zero();b._mouseMovePoint=d.Point2.zero();b._mouseMoveOffset=d.Point2.zero();b._previousMouseMoveTime=null;b._mouseMoveTime=null;b._mouseMoveElapsedTimeSeconds=0;b._rotationDegreesPerSecond=[0,0];b._animationLastTickTime=0;b._animationElapsedTimeSeconds=
0;b._animationIntervalResult=null;b._preferredAnimationIntervalMilliseconds=16;b._momentum=0;b._momentumLossPerSecond=0;b._degreesPerPixel=.5;b._maxRotationMagnitudeScale=8;b._initialSelectionPosition=null;b._cameraRotateFunction=c;return b}__extends(c,e);c.prototype.getCameraRotationMomentumEnabled=function(){return this._cameraRotationMomentumEnabled};c.prototype.setCameraRotationMomentumEnabled=function(a){a!==this._cameraRotationMomentumEnabled&&((this._cameraRotationMomentumEnabled=a)||this.stopAnimation())};
c.prototype.isCurrentlyAnimating=function(){return this._cameraRotationMomentumEnabled&&0<this.getMomentum()};c.prototype.onDeactivate=function(){var a=e.prototype.onDeactivate.call(this);this.stopAnimation();return a};c.prototype.onViewOrientationChange=function(){e.prototype.onViewOrientationChange.call(this);this.stopAnimation()};c.prototype.supportsAnimation=function(){return!0};c.prototype.onMouseDown=function(a){e.prototype.onMouseDown.call(this,a);this.isActive()&&(this._initialSelectionPosition=
a.getPosition(),this._isDown=!0,this.stopAnimation(),this._mouseDragged=!1,this._mouseMoveTime=this._previousMouseMoveTime=Date.now(),this._mouseMovePoint.assign(this._initialSelectionPosition),this._previousMouseMovePoint.assign(this._mouseMovePoint),this._averagedMousePoints.clear(),this._averagedMousePoints.add(this._mouseMovePoint,this._mouseMoveTime))};c.prototype.onMouseMove=function(a){e.prototype.onMouseMove.call(this,a);this.isActive()&&this._isDown&&(this._mouseDragged=!0,this._previousMouseMovePoint.assign(this._mouseMovePoint),
this._mouseMovePoint.assign(a.getPosition()),this._mouseMoveOffset=d.Point2.subtract(this._mouseMovePoint,this._previousMouseMovePoint),this._previousMouseMoveTime=this._mouseMoveTime,this._mouseMoveTime=Date.now(),this._mouseMoveElapsedTimeSeconds=null===this._previousMouseMoveTime?0:(this._mouseMoveTime-this._previousMouseMoveTime)/1E3,this._averagedMousePoints.add(this._mouseMovePoint,this._mouseMoveTime),a=this._getMouseMoveOffsetForRotation(),this._rotateCamera(a))};c.prototype.onMouseUp=function(a){if(this.isActive()&&
(this._isDown=!1,this._mouseDragged&&this.getCameraRotationMomentumEnabled())){this._mouseMoveOffset=this._averagedMousePoints.getAverageOffsetWithinMilliseconds(this._averageTimeIntervalMilliseconds);var b=this._getMouseMoveOffsetForRotation();if(0!==b[0]||0!==b[1]){for(var c=0;2>c;c++){var d=Math.abs(b[c])*this._maxRotationMagnitudeScale;this._rotationDegreesPerSecond[c]=b[c]/this._mouseMoveElapsedTimeSeconds;this._rotationDegreesPerSecond[c]<-d?this._rotationDegreesPerSecond[c]=-d:this._rotationDegreesPerSecond[c]>
d&&(this._rotationDegreesPerSecond[c]=d)}this._momentum=1;this._momentumLossPerSecond=0;this._startAnimation()}else this._momentum=0}e.prototype.onMouseUp.call(this,a)};c.prototype._rotateCamera=function(a){this._cameraRotateFunction(a)};c.prototype.stopAnimation=function(){null!==this._animationIntervalResult&&(clearInterval(this._animationIntervalResult),this._animationIntervalResult=null)};c.prototype.getMomentum=function(){return this._momentum};c.prototype.isAnimating=function(){return null!==
this._animationIntervalResult};c.prototype._startAnimation=function(){var a=this;null===this._animationIntervalResult&&(this._animationLastTickTime=Date.now(),this._animationIntervalResult=window.setInterval(function(){a._onTick()},this._preferredAnimationIntervalMilliseconds))};c.prototype._getMouseMoveOffsetForRotation=function(){return[-this._mouseMoveOffset.x*this._degreesPerPixel,this._mouseMoveOffset.y*this._degreesPerPixel]};c.prototype._onTick=function(){var a=Date.now();this._animationElapsedTimeSeconds=
(a-this._animationLastTickTime)/1E3;this._animationLastTickTime=a;this._rotateCamera([this._animationElapsedTimeSeconds*this._rotationDegreesPerSecond[0],this._animationElapsedTimeSeconds*this._rotationDegreesPerSecond[1]]);if(0<this._momentumLossPerSecond)if(this._momentum=Math.max(0,this._momentum-this._animationElapsedTimeSeconds*this._momentumLossPerSecond),0<this._momentum)for(a=0;a<this._rotationDegreesPerSecond.length;a++)this._rotationDegreesPerSecond[a]*=this._momentum;else{for(a=0;a<this._rotationDegreesPerSecond.length;a++)this._rotationDegreesPerSecond[a]=
0;this._rotateCamera(this._rotationDegreesPerSecond);this.stopAnimation()}};return c}(h.OperatorBase);h.CameraOrbitBaseOperator=f;var a=function(){function a(a){void 0===a&&(a=10);this._count=0;this._points=Array(a);this._times=Array(a)}a.prototype.clear=function(){this._count=0};a.prototype.add=function(a,b){void 0===b&&(b=Date.now());var c=this._count%this._points.length;void 0===this._points[c]?this._points[c]=a.copy():this._points[c].assign(a);this._times[c]=b;this._count++};a.prototype.getAverageOffsetWithinMilliseconds=
function(a,b){void 0===b&&(b=Date.now());var c=-1,e=d.Point2.zero(),f=Math.min(this._points.length,this._count);if(0<f){for(var h=0,m=0;m<f;m++){var p=(this._count-1-m)%this._points.length;if(b-this._times[p]>a)break;c=p;e.add(this._points[p]);h++}1<h?(e.subtract(this._points[c]),h--,e.scale(1/h)):(c=-1,e.set(0,0))}return 0<=c?d.Point2.subtract(e,this._points[c]):e};return a}()})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function c(b,c,e){var f=a.call(this)||this;f._circle=new d.Markup.Shape.Circle;f._viewer=b;f._position=c;f._circle.setRadius(e);return f}__extends(c,a);c.prototype.draw=function(){if(this._circle){var a=this._viewer.view.projectPoint(this._position);this._circle.setCenter(d.Point2.fromPoint3(a));this._viewer.markupManager.getRenderer().drawCircle(this._circle)}};return c}(d.Markup.MarkupItem);h.OrbitMarkup=f;var a=function(a){function c(b){var c=a.call(this,
b,function(a){if(!c._viewer.isDrawingSheetActive())if(null!==c._pickPosition){if(null===c._circleMarkupHandler){var b=new f(c._viewer,c._pickPosition,c._circleRadius);c._circleMarkupHandler=c._viewer.markupManager.registerMarkup(b)}c._orbitByTurnTiltWithTarget(a,c._pickPosition)}else switch(b=c._viewer.view.getCamera(),c._orbitFallbackMode){default:case d.OrbitFallbackMode.CameraTarget:c._orbitByTurnTiltWithTarget(a,b.getTarget());break;case d.OrbitFallbackMode.ModelCenter:c._modelCenter&&c._orbitByTurnTiltWithTarget(a,
c._modelCenter);break;case d.OrbitFallbackMode.OrbitTarget:c._orbitByTurnTiltWithTarget(a,c._orbitTarget)}})||this;c._orbitTarget=d.Point3.zero();c._orbitFallbackMode=d.OrbitFallbackMode.ModelCenter;c._modelCenter=null;c._circleMarkupHandler=null;c._circleRadius=3;c._updateCameraCenterAction=new d.Util.CurrentAction(!1);c._updateCameraCenterTimer=new d.Internal.Timer;c._primaryButton=d.Button.Middle;c._pickPosition=null;c._viewer.setCallbacks({sceneReady:function(){c._updateModelCenter()},modelSwitched:function(){c._updateModelCenter()},
visibilityChanged:function(){c._updateModelCenter()},_updateTransform:function(a){a||c._updateModelCenter()},_geometryCreated:function(){c._updateModelCenter()},hwfParseComplete:function(){c._updateModelCenter()}});return c}__extends(c,a);c.prototype._updateModelCenter=function(a){var b=this;void 0===a&&(a=50);this._updateCameraCenterTimer.clear();this._updateCameraCenterAction.set(function(){return __awaiter(b,void 0,void 0,function(){var b,c,e,f,g=this;return __generator(this,function(h){switch(h.label){case 0:b=
new d.Box,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._viewer.model.getModelBounding(!0,!1)];case 2:return b=h.sent(),b.isDegenerate()&&0<a?(this._updateCameraCenterTimer.set(500,function(){g._updateModelCenter(a-1)}),[2]):[3,4];case 3:return c=h.sent(),e=!1,SC.isError(c)&&(f=SC.getStateFailure(c),1===f&&(e=!0)),console.assert(e),[3,4];case 4:return this._modelCenter=b.center(),[2]}})})})};c.prototype.onMouseDown=function(b){a.prototype.onMouseDown.call(this,b);this.isActive()&&b.getButton()===
this._primaryButton&&(b=b._getPickResult(d.SelectionMask.Face),null!==b&&0===b.overlayIndex()?this._pickPosition=b.getPosition():this._pickPosition=null)};c.prototype.onMouseUp=function(b){a.prototype.onMouseUp.call(this,b);b.getButton()===this._primaryButton&&(this._pickPosition=null);this._removeMarkup()};c.prototype._removeMarkup=function(){null!==this._circleMarkupHandler&&(this._viewer.markupManager.unregisterMarkup(this._circleMarkupHandler),this._circleMarkupHandler=null)};c.prototype._orbitByTurnTiltWithTarget=
function(a,c){var b=this._viewer.view,e=b.getCamera(),f=e.getPosition().subtract(c),g=e.getTarget().subtract(c),h=e.getUp().normalize(),r=d.Point3.subtract(g,f).normalize();r=d.Point3.cross(h,r).normalize();r=d.Matrix.createFromOffAxisRotation(r,a[1]);a=d.Matrix.createFromOffAxisRotation(h,a[0]);r=d.Matrix.multiply(a,r);a=r.transform(f);g=r.transform(g);h=r.transform(d.Point3.add(f,h));h.subtract(a);f=a;f.add(c);g.add(c);e.setPosition(f);e.setTarget(g);e.setUp(h);b.setCamera(e)};c.prototype.setOrbitFallbackMode=
function(a){this._orbitFallbackMode=a};c.prototype.getOrbitFallbackMode=function(){return this._orbitFallbackMode};c.prototype.setOrbitTarget=function(a){this._orbitTarget=a};c.prototype.getOrbitTarget=function(){return this._orbitTarget};c.prototype.setPrimaryButton=function(a){this._primaryButton=a};c.prototype.getPrimaryButton=function(){return this._primaryButton};c.prototype.needsSelection=function(a,c){return a===d.EventType.MouseDown&&c===this._primaryButton};c.prototype._selectionMask=function(a){return d.SelectionMask.Face};
return c}(h.CameraOrbitBaseOperator);h.CameraOrbitOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c){c=a.call(this,c)||this;c._cameraPtPrevious=d.Point3.zero();return c}__extends(e,a);e.prototype.onMouseDown=function(c){a.prototype.onMouseDown.call(this,c);if(this.isActive()||this._viewer.isDrawingSheetActive()){var b=this._viewer.view;(c=b.getCamera().getCameraPlaneIntersectionPoint(c.getPosition(),b))&&this._cameraPtPrevious.assign(c)}};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);if(this.isActive()||this._viewer.isDrawingSheetActive()){var b=
this._viewer.view,e=b.getCamera();if(c=e.getCameraPlaneIntersectionPoint(c.getPosition(),b))c=d.Point3.subtract(c,this._cameraPtPrevious),e.dolly(c),b.setCamera(e)}};return e}(h.OperatorBase);h.CameraPanOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c){c=a.call(this,c)||this;c._mouseMoveZoomDelta=3;c._mouseWheelZoomDelta=.25;c._pinchZoomModifier=2.5;c._zoomToMousePosition=!0;c._mouseMoveZoomFactor=1;c._mouseWheelZoomFactor=-1;c._mouseWheelAdjustCameraTarget=!1;c._secondaryTouchId=null;c._lastTouch1=d.Point2.zero();c._lastTouch2=d.Point2.zero();c._prevLen=0;return c}__extends(e,a);e.prototype.setMouseWheelZoomInverted=function(a){this._mouseWheelZoomFactor=a?-1:1};e.prototype.getMouseWheelZoomInverted=
function(){return 1===this._mouseWheelZoomFactor};e.prototype.setMouseMoveZoomInverted=function(a){this._mouseMoveZoomFactor=a?-1:1};e.prototype.getMouseMoveZoomInverted=function(){return 1===this._mouseMoveZoomFactor};e.prototype.setMouseMoveZoomDelta=function(a){this._mouseMoveZoomDelta=a};e.prototype.getMouseMoveZoomDelta=function(){return this._mouseMoveZoomDelta};e.prototype.setMouseWheelZoomDelta=function(a){this._mouseWheelZoomDelta=a};e.prototype.getMouseWheelZoomDelta=function(){return this._mouseWheelZoomDelta};
e.prototype.setZoomToMousePosition=function(a){this._zoomToMousePosition=a};e.prototype.getZoomToMousePosition=function(){return this._zoomToMousePosition};e.prototype.setMouseWheelAdjustCameraTarget=function(a){this._mouseWheelAdjustCameraTarget=a};e.prototype.getMouseWheelAdjustCameraTarget=function(){return this._mouseWheelAdjustCameraTarget};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);if(this.isDragging()&&this.isActive()){var b=this._viewer.view;c=b.pointToWindowPosition(this._ptCurrent);
b=b.pointToWindowPosition(this._ptPrevious);this._doZoom(1-this._mouseMoveZoomDelta*this._mouseMoveZoomFactor*(c.y-b.y))}};e.prototype.onMousewheel=function(a){var b=1-this._mouseWheelZoomDelta*this._mouseWheelZoomFactor*a.getWheelDelta();this._doZoom(b,void 0,a.getPosition())};e.prototype.onTouchStart=function(a){var b=this._viewer.view;null===this._primaryTouchId?(this._primaryTouchId=a.getId(),this._lastTouch1.assign(b.pointToWindowPosition(a.getPosition()))):null===this._secondaryTouchId&&(this._secondaryTouchId=
a.getId(),this._lastTouch2.assign(b.pointToWindowPosition(a.getPosition())));null!==this._primaryTouchId&&null!==this._secondaryTouchId&&(this._prevLen=d.Point2.subtract(this._lastTouch2,this._lastTouch1).length(),this._dragging=!0)};e.prototype.onTouchMove=function(a){var b=this._viewer.view,c=a.getId();a=a.getPosition();c===this._primaryTouchId?this._lastTouch1.assign(b.pointToWindowPosition(a)):c===this._secondaryTouchId&&this._lastTouch2.assign(b.pointToWindowPosition(a));this._dragging&&c===
this._secondaryTouchId&&(b=d.Point2.subtract(this._lastTouch2,this._lastTouch1).length(),this._doZoom(1-(this._prevLen-b)*this._pinchZoomModifier),this._prevLen=b)};e.prototype.onTouchEnd=function(a){a=a.getId();this._primaryTouchId===a?this._primaryTouchId=null:this._secondaryTouchId===a&&(this._secondaryTouchId=null);this._dragging=!1};e.prototype.onDeactivate=function(){this._secondaryTouchId=this._primaryTouchId=null};e.prototype._doZoom=function(a,b,e){void 0===b&&(b=this._viewer.view.getCamera());
return __awaiter(this,void 0,void 0,function(){var c,f,g,h,p,r,q,u,t;return __generator(this,function(k){switch(k.label){case 0:c=this._viewer.view;f=1/a;if(!e||!this._zoomToMousePosition)return[3,3];g=void 0;return this._mouseWheelAdjustCameraTarget?[4,this._viewer.view.pickFromPoint(e,new d.PickConfig)]:[3,2];case 1:g=k.sent(),k.label=2;case 2:return void 0!==g&&g.isEntitySelection()&&(h=b.getPosition().subtract(b.getTarget()),p=d.Point3.subtract(b.getTarget(),b.getPosition()),r=d.Point3.subtract(g.getPosition(),
b.getPosition()),q=b.getPosition().add(p.scale(d.Point3.dot(p,r)/d.Point3.dot(p,p))),b.setTarget(q),b.setPosition(d.Point3.add(q,h))),u=b.getCameraPlaneIntersectionPoint(e,this._viewer.view),this._zoomHelper(f,b),t=b.getCameraPlaneIntersectionPoint(e,this._viewer.view),null!==u&&null!==t&&b.dolly(d.Point3.subtract(t,u)),c.setCamera(b),[3,4];case 3:this._zoomHelper(f,b),k.label=4;case 4:return[2]}})})};e.prototype._zoomHelper=function(a,b){var c=this._viewer.view;b.setWidth(b.getWidth()*a);b.setHeight(b.getHeight()*
a);var e=b.getPosition(),f=b.getTarget();a=d.Point3.subtract(f,e).scale(a);b.setPosition(d.Point3.subtract(f,a));c.setCamera(b)};return e}(h.OperatorBase);h.CameraZoomOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c,b,d,e){c=a.call(this,c)||this;c._activeOperator=null;c._activeTouchCount=0;c._touchMoveCount=0;c._returnToOrbit=!1;c._orbitOperator=b;c._panOperator=d;c._zoomOperator=e;return c}__extends(e,a);e.prototype.needsSelection=function(a,b,d){return this._orbitOperator.needsSelection(a,b)||this._panOperator.needsSelection(a,b,d)||this._zoomOperator.needsSelection(a,b,d)};e.prototype.selectionRequirements=function(a){return this._orbitOperator.selectionRequirements(a)|
this._panOperator.selectionRequirements(a)|this._zoomOperator.selectionRequirements(a)};e.prototype.onViewOrientationChange=function(){this._activeTouchCount=0;this._returnToOrbit=!1};e.prototype.onMouseDown=function(c){a.prototype.onMouseDown.call(this,c);this._setActiveOperatorForMouseInput(c);if(this._activeOperator)this._activeOperator.onMouseDown(c)};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);if(this._activeOperator&&this._dragging&&3<this._dragCount)this._activeOperator.onMouseMove(c)};
e.prototype.onMouseUp=function(c){if(this._activeOperator)this._activeOperator.onMouseUp(c);this._activeOperator instanceof h.CameraOrbitOperator||this._orbitOperator._removeMarkup();a.prototype.onMouseUp.call(this,c)};e.prototype.onMousewheel=function(a){this._zoomOperator.onMousewheel(a)};e.prototype.onTouchStart=function(a){++this._activeTouchCount;this._orbitOperator.onTouchStart(a);this._zoomOperator.onTouchStart(a);this._viewer.isDrawingSheetActive()&&(this._panOperator.onTouchStart(a),this._orbitOperator.onDeactivate());
1===this._activeTouchCount&&(this._primaryTouchId=a.getId());2===this._activeTouchCount&&(this._orbitOperator.onDeactivate(),this._panOperator.onTouchStart(a),this._zoomOperator.onTouchStart(a))};e.prototype.onTouchMove=function(a){++this._touchMoveCount;5<this._touchMoveCount&&(this._returnToOrbit?(this._orbitOperator.onTouchStart(a),this._returnToOrbit=!1):1===this._activeTouchCount?(this._orbitOperator.onTouchMove(a),this._zoomOperator.onTouchMove(a),this._panOperator.onTouchMove(a)):2===this._activeTouchCount&&
(this._zoomOperator.onTouchMove(a),this._panOperator.onTouchMove(a)))};e.prototype.onTouchEnd=function(a){2===this._activeTouchCount&&(this._returnToOrbit=!0);this._zoomOperator.onTouchEnd(a);this._panOperator.onTouchEnd(a);this._orbitOperator.onTouchEnd(a);0<this._activeTouchCount&&--this._activeTouchCount;0===this._activeTouchCount&&(this._touchMoveCount=0)};e.prototype.stopInteraction=function(){var c=[];var b=a.prototype.stopInteraction.call(this);void 0!==b&&c.push(b);this._touchMoveCount=this._activeTouchCount=
0;b=this._zoomOperator.onDeactivate();void 0!==b&&c.push(b);b=this._panOperator.onDeactivate();void 0!==b&&c.push(b);b=this._orbitOperator.onDeactivate();void 0!==b&&c.push(b);return d.Util.waitForAll(c)};e.prototype._setActiveOperatorForMouseInput=function(a){var b=this._viewer.operatorManager,c=b.getOperator(d.OperatorId.Orbit),e=b.getOperator(d.OperatorId.Pan);b=b.getOperator(d.OperatorId.Zoom);var f=this._viewer.isDrawingSheetActive();!f&&c.checkMapping(a)?this._activeOperator=this._orbitOperator:
f||e.checkMapping(a)?this._activeOperator=this._panOperator:b.checkMapping(a)?this._activeOperator=this._zoomOperator:this._activeOperator=null};e.prototype.onDeactivate=function(){a.prototype.onDeactivate.call(this);this._orbitOperator.onDeactivate();this._panOperator.onDeactivate();this._zoomOperator.onDeactivate()};return e}(h.OperatorBase);h.CameraNavigationOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c){var b=a.call(this,c,function(a){b._rotateAroundAxis(b._rotationAxis,a[0])})||this;b._rotationAxis=new d.Point3(0,0,1);b._tiltAmount=12;return b}__extends(e,a);e.prototype._rotateAroundAxis=function(a,b){var c=this._viewer.view,e=c.getCamera(),f=e.getPosition(),h=e.getUp().normalize(),m=e.getTarget();a=d.Matrix.createFromOffAxisRotation(a,b);b=(new d.Matrix).setTranslationComponent(-m.x,-m.y,-m.z);b=d.Matrix.multiply(b,a);m=(new d.Matrix).setTranslationComponent(m.x,
m.y,m.z);d.Matrix.multiply(b,m).transform(f,f);a.transform(h,h);h.normalize();e.setPosition(f);e.setUp(h);c.setCamera(e)};e.prototype.onMousewheel=function(a){a=a.getWheelDelta();var b=this._viewer.view.getCamera(),c=b.getUp().normalize();b=d.Point3.subtract(b.getTarget(),b.getPosition()).normalize();c=d.Point3.cross(c,b).normalize();0<a?this._rotateAroundAxis(c,this._tiltAmount):this._rotateAroundAxis(c,-this._tiltAmount)};e.prototype.setRotationAxis=function(a){var b=!0;switch(a){case d.Axis.X:this._rotationAxis.set(1,
0,0);break;case d.Axis.Y:this._rotationAxis.set(0,1,0);break;case d.Axis.Z:this._rotationAxis.set(0,0,1);break;default:b=!1}return b};return e}(h.CameraOrbitBaseOperator);h.CameraTurntableOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c,b,e){c=a.call(this)||this;c._keyboardWalkOperator=e;c._walkOperator=b;c._activeOperator=b;c._walkMode=d.WalkMode.Mouse;c._active=!1;return c}__extends(e,a);e.prototype.setWalkMode=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:if(this._walkMode===a)return[3,7];this._walkMode=a;if(a!==d.WalkMode.Keyboard)return[3,4];this._activeOperator=this._keyboardWalkOperator;return this._active?
[4,this._walkOperator.onDeactivate()]:[3,3];case 1:return b.sent(),[4,this._keyboardWalkOperator.onActivate()];case 2:b.sent(),b.label=3;case 3:return[3,7];case 4:return this._activeOperator=this._walkOperator,this._active?[4,this._keyboardWalkOperator.onDeactivate()]:[3,7];case 5:return b.sent(),[4,this._walkOperator.onActivate()];case 6:b.sent(),b.label=7;case 7:return[2]}})})};e.prototype.getWalkMode=function(){return this._activeOperator instanceof h.CameraKeyboardWalkOperator?d.WalkMode.Keyboard:
d.WalkMode.Mouse};e.prototype.onMouseDown=function(a){this._activeOperator.onMouseDown(a)};e.prototype.onMouseMove=function(a){this._activeOperator.onMouseMove(a)};e.prototype.onMouseUp=function(a){this._activeOperator.onMouseUp(a)};e.prototype.onMousewheel=function(a){this._activeOperator.onMousewheel(a)};e.prototype.onTouchStart=function(a){this._activeOperator.onTouchStart(a)};e.prototype.onTouchMove=function(a){this._activeOperator.onTouchMove(a)};e.prototype.onTouchEnd=function(a){this._activeOperator.onTouchEnd(a)};
e.prototype.onKeyDown=function(a){this._activeOperator.onKeyDown(a)};e.prototype.onKeyUp=function(a){this._activeOperator.onKeyUp(a)};e.prototype.onDeactivate=function(){return this._activeOperator.onDeactivate()};e.prototype.onActivate=function(){this._active=!0;return this._activeOperator.onActivate()};e.prototype.onViewOrientationChange=function(){this._active=!1;this._activeOperator.onViewOrientationChange()};e.prototype.selectionRequirements=function(a){return this._activeOperator.selectionRequirements(a)};
e.prototype.needsSelection=function(a,b,d){return this._activeOperator.needsSelection(a,b,d)};e.prototype.stopInteraction=function(){return this._activeOperator.stopInteraction()};return e}(h.Operator);h.CameraWalkModeOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c){c=a.call(this,c)||this;c._tilt=0;c._isWalking=!1;c._majorAxis=d.Axis.X;c._timerId=null;c._walkButton=d.Button.None;c._previousTimestamp=0;c._activeTouchCount=0;c._maxDistance=200;c._walkSpeed=0;c._minTargetDistance=0;c._rotationSpeed=120;return c}__extends(e,a);e.prototype.onActivate=function(){return __awaiter(this,void 0,void 0,function(){var a,b,e,f,h,n;return __generator(this,function(c){switch(c.label){case 0:return a=this._viewer.view,
b=this._viewer.model,[4,b.getModelBounding(!0,!1)];case 1:return e=c.sent(),f=e.extents(),h=Math.max(f.x,f.y,f.z),this._walkSpeed=h/5,this._minTargetDistance=h/20,a.getProjectionMode()!==d.Projection.Perspective&&a.setProjectionMode(d.Projection.Perspective),this._calculateInitialPosition(),n=this._viewer._getCallbackManager(),n.trigger("walkOperatorActivated"),[2]}})})};e.prototype.onKeyDown=function(a){a=a.getKeyCode();a===d.KeyCode.PgUp&&(this._walkSpeed*=1.2);a===d.KeyCode.PgDown&&(this._walkSpeed*=
.8)};e.prototype.onDeactivate=function(){var a=this._resetCameraTarget();this.stopWalking();return a};e.prototype.onMouseDown=function(c){a.prototype.onMouseDown.call(this,c);var b=this._viewer.view;b.getProjectionMode()!==d.Projection.Perspective&&(b.setProjectionMode(d.Projection.Perspective),this._calculateInitialPosition());this.isActive()&&(this.stopWalking(),this._isWalking=!0,this._walkButton=c.getButton())};e.prototype.onMouseMove=function(c){a.prototype.onMouseMove.call(this,c);this._isWalking&&
null===this._timerId&&this.isActive()&&(this._previousTimestamp=Date.now(),this._onTick())};e.prototype.onMouseUp=function(c){this.isActive()&&this.stopWalking();a.prototype.onMouseUp.call(this,c)};e.prototype.onTouchStart=function(c){a.prototype.onTouchStart.call(this,c);++this._activeTouchCount;1===this._activeTouchCount?this._walkButton=d.Button.Left:2===this._activeTouchCount?this._walkButton=d.Button.Right:3===this._activeTouchCount&&(this._walkButton=d.Button.None)};e.prototype.onTouchMove=
function(c){3===this._activeTouchCount&&this._primaryTouchId===c.getId()?(this._ptCurrent.assign(c.getPosition()),c=d.Point2.subtract(this._ptCurrent,this._ptPrevious),this._adjustTilt(c.y/100*1.5)):3>this._activeTouchCount&&a.prototype.onTouchMove.call(this,c)};e.prototype.onTouchEnd=function(c){a.prototype.onTouchEnd.call(this,c);0<this._activeTouchCount&&--this._activeTouchCount};e.prototype.onMousewheel=function(a){0<a.getWheelDelta()?this._adjustTilt(3):this._adjustTilt(-3)};e.prototype.stopWalking=
function(){null!==this._timerId&&(cancelAnimationFrame(this._timerId),this._timerId=null);this._isWalking=!1};e.prototype._majorAxisRotate=function(a,b){var c=Math.PI/180*b;b=Math.sin(c);c=Math.cos(c);return this._majorAxis===d.Axis.X?new d.Point3(a.x,a.y*c-a.z*b,a.y*b+a.z*c):this._majorAxis===d.Axis.Y?new d.Point3(a.z*b+a.x*c,a.y,a.z*c-a.x*b):new d.Point3(a.x*c-a.y*b,a.x*b+a.y*c,a.z)};e.prototype._testWalk=function(a,b,e){return __awaiter(this,void 0,void 0,function(){var c,f,g;return __generator(this,
function(h){switch(h.label){case 0:return c=new d.Event.MouseInputEvent(0,0,e,d.Buttons.None,d.KeyModifiers.None,d.MouseInputType.Down),f=new d.Event.MouseInputEvent(0,a,e,d.Buttons.None,d.KeyModifiers.None,d.MouseInputType.Move),g=new d.Event.MouseInputEvent(0,a,e,d.Buttons.None,d.KeyModifiers.None,d.MouseInputType.Up),this.onMouseDown(c),this.onMouseMove(f),[4,d.Internal.sleep(b)];case 1:return h.sent(),this.onMouseUp(g),[2]}})})};e.prototype._onTick=function(){var a=this,b=Date.now(),e=(b-this._previousTimestamp)/
1E3;this._previousTimestamp=b;b=this._viewer.view;var f=b.getCamera();this._resetPosition(f);var h=f.getUp().normalize(),n=f.getTarget(),m=f.getPosition(),p=d.Point3.subtract(n,m).normalize(),r=d.Point3.cross(h,p).normalize(),q=d.Point3.distance(n,m),u=d.Point2.subtract(this._ptCurrent,this._ptFirst),t=new d.Point2(Math.abs(u.x)/this._maxDistance,Math.abs(u.y)/this._maxDistance),v=this._rotationSpeed*e*t.x,w=this._walkSpeed*e*t.x;e=this._walkSpeed*e*t.y;this._walkButton===d.Button.Left?(0!==u.x&&
(0<u.x?p.assign(this._majorAxisRotate(p,-v)):0>u.x&&p.assign(this._majorAxisRotate(p,v))),0!==u.y&&(0>u.y?m.add(p.copy().scale(e)):0<u.y&&m.add(p.copy().scale(-e)))):this._walkButton===d.Button.Right&&(0<Math.abs(u.y)&&(h.scale(e),0<u.y&&h.negate(),m.add(h)),0<Math.abs(u.x)&&(e=r.copy().scale(w),0<u.x&&e.negate(),m.add(e)));u=Math.max(this._walkSpeed*t.y,this._minTargetDistance);d.Matrix.createFromOffAxisRotation(r,this._tilt).transform(p,p);n.assign(d.Point3.add(m,p.scale(u)));p=u*f.getWidth()/q;
q=u*f.getHeight()/q;f.setWidth(p);f.setHeight(q);f.setPosition(m);f.setTarget(n);b.setCamera(f);this._timerId=requestAnimationFrame(function(){a._onTick()})};e.prototype._calculateInitialPosition=function(){var a=this._viewer.view,b=a.getCamera();this._majorAxis=this._calculateMajorAxis(b);this._setClampedTiltValue(this._calculateInitialTilt(b));this._resetPosition(b);var e=b.getPosition(),f=b.getTarget(),h=b.getUp().normalize(),n=d.Point3.subtract(f,e).normalize();h=d.Point3.cross(h,n).normalize();
f=d.Point3.distance(f,e);d.Matrix.createFromOffAxisRotation(h,this._tilt).transform(n,n);b.setTarget(d.Point3.add(e,n.scale(f)));a.setCamera(b)};e.prototype._calculateInitialTilt=function(a){void 0===a&&(a=this._viewer.view.getCamera());var b=a.getPosition();a=a.getTarget();a=d.Point3.subtract(a,b);b=a.length();this._majorAxis===d.Axis.X?a.x=0:this._majorAxis===d.Axis.Y?a.y=0:this._majorAxis===d.Axis.Z&&(a.z=0);a=a.length();return 180/Math.PI*Math.acos(a/b)};e.prototype._resetPosition=function(a){void 0===
a&&(a=this._viewer.view.getCamera());this._majorAxis=this._calculateMajorAxis(a);var b=a.getPosition(),c=a.getTarget();c=d.Point3.subtract(c,b);var e=c.length();switch(this._majorAxis){case d.Axis.X:c.set(0,c.y,c.z);a.setUp(new d.Point3(1,0,0));break;case d.Axis.Y:c.set(c.x,0,c.z);a.setUp(new d.Point3(0,1,0));break;case d.Axis.Z:c.set(c.x,c.y,0),a.setUp(new d.Point3(0,0,1))}c.normalize().scale(e);a.setTarget(d.Point3.add(b,c))};e.prototype._calculateMajorAxis=function(a){void 0===a&&(a=this._viewer.view.getCamera());
var b=a.getUp();a=Math.abs(b.x);var c=Math.abs(b.y);b=Math.abs(b.z);return b>=a&&b>=c?d.Axis.Z:c>=a&&c>=b?d.Axis.Y:d.Axis.X};e.prototype._adjustTilt=function(a){var b=this._viewer.view;this._setClampedTiltValue(this._tilt+=a);a=b.getCamera();this._resetPosition(a);var c=a.getTarget(),e=a.getPosition(),f=d.Point3.distance(c,e),h=a.getUp().normalize();c=d.Point3.subtract(c,e).normalize();h=d.Point3.cross(h,c).normalize();d.Matrix.createFromOffAxisRotation(h,this._tilt).transform(c,c);c.normalize().scale(f);
a.setTarget(d.Point3.add(e,c));b.setCamera(a)};e.prototype._resetCameraTarget=function(){return __awaiter(this,void 0,void 0,function(){var a,b,e,f,h,n;return __generator(this,function(c){switch(c.label){case 0:return a=this._viewer.view,b=a.getCanvasSize(),e=new d.Point2(Math.round(b.x/2),Math.round(b.y/2)),f=new d.PickConfig,[4,a.pickFromPoint(e,f)];case 1:return h=c.sent(),h.isEntitySelection()&&(n=a.getCamera(),n.setTarget(h.getPosition()),a.updateCamera(n)),[2]}})})};e.prototype._setClampedTiltValue=
function(a){this._tilt=Math.max(Math.min(a,e.MAX_TILT),e.MIN_TILT)};e.MAX_TILT=45;e.MIN_TILT=-45;return e}(h.OperatorBase);h.CameraWalkOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c,b){c=a.call(this,c)||this;c._pickConfig=new d.PickConfig(d.SelectionMask.Line);c._moveSelectionAction=new d.Util.CurrentAction(!0);c._lengthMarkup=null;c._edgeMarkup=null;c._measureManager=b;c._pickConfig.restrictLinesAndPointsToSelectedFaceInstances=!1;return c}__extends(e,a);e.prototype.onActivate=function(){null===this._edgeMarkup&&(this._edgeMarkup=new d.Markup.Measure.MeasureStraightEdgeLengthMarkup(this._viewer,null,new d.Matrix,1))};
e.prototype._unregisterEdgeMarkup=function(){if(null!==this._edgeMarkup){var a=this._edgeMarkup._getId();""!==a&&(this._viewer.markupManager.unregisterMarkup(a),this._edgeMarkup._setId(""))}};e.prototype._registerEdgeMarkup=function(){null!==this._edgeMarkup&&(this._unregisterEdgeMarkup(),this._edgeMarkup._setId(this._viewer.markupManager.registerMarkup(this._edgeMarkup)))};e.prototype._resetEdgeMarkup=function(){null!==this._edgeMarkup&&(this._unregisterEdgeMarkup(),this._edgeMarkup.reset())};e.prototype._performMoveSelection=
function(a,b){return __awaiter(this,void 0,void 0,function(){var c,d,e;return __generator(this,function(f){switch(f.label){case 0:return c=this._viewer.view,[4,c.pickFromPoint(a,this._pickConfig)];case 1:return d=f.sent(),(e=d.getLineEntity())&&0===d.overlayIndex()&&0!==(e.getLineBits()&4)?(b.setLineGeometry(e.getPoints()),this._registerEdgeMarkup()):this._resetEdgeMarkup(),[2]}})})};e.prototype._performUpSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,f,h,m,p,r,q;return __generator(this,
function(g){switch(g.label){case 0:return b=this._viewer.view,c=this._viewer.model,e=this._viewer._getCallbackManager(),[4,b.pickFromPoint(a,this._pickConfig)];case 1:f=g.sent();if(f.overlayIndex())return[2];if(this._lengthMarkup&&2===this._lengthMarkup._getStage())return this._lengthMarkup._nextStage(),this._measureManager.finalizeMeasurement(this._lengthMarkup),this._lengthMarkup=null,[2];if(this._lengthMarkup||!f.isLineSelection())return[2];h=f.getLineEntity();if(0===(h.getLineBits()&4))return[2];
m=f.getNodeId();p=c.getNodeUnitMultiplier(m);return[4,c.getEdgeProperty(m,h.getLineId())];case 2:r=g.sent();e.trigger("measurementBegin");if(!r)return[2];r instanceof d.SubentityProperties.LineElement||r instanceof d.SubentityProperties.OtherEdgeElement?(q=c.getNodeNetMatrix(m),this._lengthMarkup=new d.Markup.Measure.MeasureStraightEdgeLengthMarkup(this._viewer,r,q,p),this._measureManager.addMeasurement(this._lengthMarkup),this._lengthMarkup.setLineGeometry(h.getPoints()),this._lengthMarkup._nextStage(),
this._lengthMarkup.adjust(a)):r instanceof d.SubentityProperties.CircleElement&&(q=c.getNodeNetMatrix(m),this._lengthMarkup=new d.Markup.Measure.MeasureCircleEdgeLengthMarkup(this._viewer,r,q,p),this._measureManager.addMeasurement(this._lengthMarkup),this._lengthMarkup.setLineGeometry(h.getPoints()),this._lengthMarkup._nextStage(),this._lengthMarkup.adjust(a));2===this._lengthMarkup._getStage()&&e.trigger("measurementValueSet",this._lengthMarkup);return[2]}})})};e.prototype.onMouseMove=function(c){var b=
this;a.prototype.onMouseMove.call(this,c);var d=this._edgeMarkup;if(null!==d){var e=c.getPosition();this.isDragging()&&null===this._primaryTouchId?this._resetEdgeMarkup():(null===this._lengthMarkup&&this._moveSelectionAction.set(function(){return b._performMoveSelection(e,d)}),this._viewer.markupManager.refreshMarkup(),null!==this._lengthMarkup&&0<this._lengthMarkup._getStage()&&this._lengthMarkup.adjust(e))}};e.prototype._onMouseUpImpl=function(a){return __awaiter(this,void 0,void 0,function(){var b,
c;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];b=null!==this._primaryTouchId&&null!==this._lengthMarkup;if(!(3>this._dragCount||b))return[2];c=a.getPosition();return[4,this._performUpSelection(c)];case 1:return d.sent(),[2]}})})};e.prototype.onMouseUp=function(c){this._onMouseUpImpl(c);a.prototype.onMouseUp.call(this,c)};e.prototype.setDraggingEnabled=function(a){this._dragging=a};e.prototype.onKeyUp=function(a){};e.prototype.onKeyDown=function(a){a.getKeyCode()===
d.KeyCode.Escape&&(null!==this._lengthMarkup?(this._measureManager.removeMeasurement(this._lengthMarkup),this._lengthMarkup=null):this._measureManager.removeLastMeasurement(),null!==this._edgeMarkup&&this._resetEdgeMarkup())};e.prototype.setHandled=function(){return null!==this._lengthMarkup};e.prototype.onDeactivate=function(){null!==this._lengthMarkup&&(this._measureManager.removeMeasurement(this._lengthMarkup),this._lengthMarkup=null);null!==this._edgeMarkup&&this._resetEdgeMarkup()};return e}(h.OperatorBase);
h.MeasureEdgeLengthOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function f(a){return a.getSelectionType()!==d.SelectionType.None?(a=a.getFaceEntity().getCadFaceBits(),0!==(a&2)&&0!==(a&1)):!1}var a=function(a){function c(b,c){b=a.call(this,b)||this;b._moveSelectionAction=new d.Util.CurrentAction(!0);b._currentHighlight=null;b._markup=null;b._measureManager=c;return b}__extends(c,a);c.prototype._unsetCurrentHighlight=function(){null!==this._currentHighlight&&(this._viewer.model.unsetNodeFaceColor(this._currentHighlight.getNodeId(),this._currentHighlight.getFaceEntity().getCadFaceIndex()),
this._currentHighlight=null)};c.prototype._performMoveSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,h,m,p,r,q;return __generator(this,function(g){switch(g.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=g.sent();if(0!==e.overlayIndex()||!e.isFaceSelection())return[2];h=e.getNodeId();m=e.getFaceEntity();if(c.getNodeType(e.getNodeId())!==d.NodeType.BodyInstance||this._markup&&(p=this._markup.getFirstSelection(),
h===p.getNodeId()&&(r=p.getFaceEntity().getCadFaceIndex(),q=m.getCadFaceIndex(),r===q)))return[2];null!==this._currentHighlight?e.equals(this._currentHighlight)?e.getSelectionType()===d.SelectionType.None&&this._unsetCurrentHighlight():(this._unsetCurrentHighlight(),f(e)&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow()))):null===this._currentHighlight&&f(e)&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow()));return[2]}})})};c.prototype._performUpSelection=
function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,h,m,p;return __generator(this,function(g){switch(g.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=g.sent();if(e.overlayIndex())return[2];if(this._markup&&1<this._markup._getStage())return this._viewer.trigger("measurementBegin"),this._markup._nextStage(),this._markup._isFinalized()&&(this._measureManager.finalizeMeasurement(this._markup),this._markup=null),[2];if(!e.isFaceSelection()||
c.getNodeType(e.getNodeId())!==d.NodeType.BodyInstance||this._markup&&!(1>=this._markup._getStage())||!f(e))return[2];h=e.getFaceEntity();return[4,c.getFaceProperty(e.getNodeId(),h.getCadFaceIndex())];case 2:m=g.sent();if(!(m instanceof d.SubentityProperties.PlaneElement))return[2];this._unsetCurrentHighlight();null===this._markup?(this._markup=new d.Markup.Measure.MeasureFaceFaceAngleMarkup(this._viewer),this._markup.setFirstFace(e),this._measureManager.addMeasurement(this._markup)):(p=this._markup.setSecondFace(e))&&
this._markup.adjust(a);return[2]}})})};c.prototype.onMouseMove=function(b){a.prototype.onMouseMove.call(this,b);b=b.getPosition();(!this._markup||1>=this._markup._getStage())&&this._performMoveSelection(b);this._viewer.markupManager.refreshMarkup();null!==this._markup&&0<this._markup._getStage()&&this._markup.adjust(b)};c.prototype._onMouseUpImpl=function(a){var b=this;if(this.isActive()){var c=null!==this._primaryTouchId&&null!==this._markup&&1<this._markup._getStage();if(3>this._dragCount||c){var d=
a.getPosition();this._moveSelectionAction.set(function(){return b._performUpSelection(d)})}}};c.prototype.onMouseUp=function(b){this._onMouseUpImpl(b);a.prototype.onMouseUp.call(this,b)};c.prototype.setDraggingEnabled=function(a){this._dragging=a};c.prototype.onKeyUp=function(a){};c.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&(null!==this._markup?(this._markup.cleanup(),this._measureManager.removeMeasurement(this._markup),this._markup=null):this._measureManager.removeLastMeasurement())};
c.prototype.setHandled=function(){return null!==this._markup&&1<this._markup._getStage()};c.prototype.onDeactivate=function(){this._unsetCurrentHighlight();null!==this._markup&&(this._measureManager.removeMeasurement(this._markup),this._markup.cleanup(),this._markup=null)};return c}(h.OperatorBase);h.MeasureFaceFaceAngleOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function f(a){return a.getSelectionType()!==d.SelectionType.None?0!==(a.getFaceEntity().getCadFaceBits()&1):!1}var a=function(a){function c(b,c){b=a.call(this,b)||this;b._moveSelectionAction=new d.Util.CurrentAction(!0);b._currentHighlight=null;b._markup=null;b._measureManager=c;return b}__extends(c,a);c.prototype._unsetCurrentHighlight=function(){null!==this._currentHighlight&&(this._viewer.model.unsetNodeFaceColor(this._currentHighlight.getNodeId(),this._currentHighlight.getFaceEntity().getCadFaceIndex()),
this._currentHighlight=null)};c.prototype._performMoveSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,h,m,p;return __generator(this,function(g){switch(g.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=g.sent();if(0!==e.overlayIndex()||!e.isFaceSelection())return[2];h=e.getNodeId();m=e.getFaceEntity();if(c.getNodeType(h)!==d.NodeType.BodyInstance||this._markup&&(p=this._markup.getFirstSelection(),null!==p&&
h===p.getNodeId()&&m.getCadFaceIndex()===p.getFaceEntity().getCadFaceIndex()))return[2];null!==this._currentHighlight?e.equals(this._currentHighlight)?e.getSelectionType()===d.SelectionType.None&&this._unsetCurrentHighlight():(this._unsetCurrentHighlight(),f(e)&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow()))):f(e)&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow()));return[2]}})})};c.prototype._performUpSelection=function(a){return __awaiter(this,
void 0,void 0,function(){var b,c,e,h,m,p,r,q;return __generator(this,function(g){switch(g.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=g.sent();if(e.overlayIndex())return[2];if(this._markup&&1<this._markup._getStage())return this._viewer.trigger("measurementBegin"),this._markup._nextStage(),this._markup._isFinalized()&&(this._measureManager.finalizeMeasurement(this._markup),this._markup=null),[2];if(!e.isFaceSelection())return[2];h=
e.getNodeId();m=e.getFaceEntity();return f(e)&&c.getNodeType(h)===d.NodeType.BodyInstance&&(!this._markup||1>=this._markup._getStage())?[4,c.getFaceProperty(h,m.getCadFaceIndex())]:[2];case 2:p=g.sent();if(!p)return[2];r=c.getNodeNetMatrix(h);this._unsetCurrentHighlight();return p instanceof d.SubentityProperties.PlaneElement||p instanceof d.SubentityProperties.CylinderElement?[4,c.getNodesBounding([h])]:[3,6];case 3:q=g.sent();if(this._markup)return[3,4];this._markup=new d.Markup.Measure.MeasureFaceFaceDistanceMarkup(this._viewer);
this._markup.setUnitMultiplier(c.getNodeUnitMultiplier(h));this._markup.setFirstFace(e,p,r,q);this._measureManager.addMeasurement(this._markup);return[3,6];case 4:return[4,this._markup.setSecondFace(a,e,p,r,q)];case 5:g.sent(),g.label=6;case 6:return[2]}})})};c.prototype.onMouseMove=function(b){var c=this;a.prototype.onMouseMove.call(this,b);var d=b.getPosition();(!this._markup||1>=this._markup._getStage())&&this._moveSelectionAction.set(function(){return c._performMoveSelection(d)});this._viewer.markupManager.refreshMarkup();
null!==this._markup&&0<this._markup._getStage()&&this._markup.adjust(d)};c.prototype._onMouseUpImpl=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];b=null!==this._primaryTouchId&&null!==this._markup&&1<this._markup._getStage();if(!(3>this._dragCount||b))return[2];c=a.getPosition();return[4,this._performUpSelection(c)];case 1:return d.sent(),[2]}})})};c.prototype.onMouseUp=function(b){this._onMouseUpImpl(b);
a.prototype.onMouseUp.call(this,b)};c.prototype.setDraggingEnabled=function(a){this._dragging=a};c.prototype.onKeyUp=function(a){};c.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&(null!==this._markup?(this._markup.cleanup(),this._measureManager.removeMeasurement(this._markup),this._markup=null):this._measureManager.removeLastMeasurement())};c.prototype.setHandled=function(){return null!==this._markup&&1<this._markup._getStage()};c.prototype.onDeactivate=function(){a.prototype.onDeactivate.call(this);
this._unsetCurrentHighlight();null!==this._markup&&(this._measureManager.removeMeasurement(this._markup),this._markup.cleanup(),this._markup=null)};return c}(h.OperatorBase);h.MeasureFaceFaceDistanceOperator=a})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function f(a,c){var b=new d.Point4(c.x,c.y,c.z,1);c=new d.Point4(0,0,0,0);a.view.getFullCameraMatrix().transform4(b,c);b=1/c.w;c=new d.Point2(c.x*b,c.y*b);b=a.model.getClientDimensions();a=b[0];b=b[1];c.x=.5*a*(c.x+1);c.y=.5*b*(c.y+1);c.x=Math.max(0,Math.min(c.x,a));c.y=b-Math.max(0,Math.min(c.y,b));return c}var a=function(){return function(a,c,d){this.worldPosition=a;this.screenPosition=c;this.selectionItem=d}}(),e=function(a){function b(b){var c=a.call(this,b)||this;c._cursorSprite=
new d.Markup.Shape.Circle;c._name="CursorMarkup";c._cursorSprite.setFillColor(b.measureManager.getMeasurementColor());c._markupId=b.markupManager.registerMarkup(c);return c}__extends(b,a);b.prototype.draw=function(){this._viewer.markupManager.getRenderer().drawCircle(this._cursorSprite)};b.prototype.enable=function(a){this._cursorSprite.setRadius(a?2.5:0)};b.prototype.setPosition=function(a){this._cursorSprite.setCenter(a)};b.prototype.destroy=function(){this._viewer.markupManager.unregisterMarkup(this._markupId)};
return b}(d.Markup.Measure.MeasureMarkup),c=function(b){function c(a,c){var e=b.call(this,a)||this;e._updateCursorSpriteAction=new d.Util.CurrentAction(!0);e._measureMarkup=null;e._cursorMarkup=null;e._viewer=a;e._measureManager=c;e._snappingConfig={enabled:!0,preferVertices:!0};return e}__extends(c,b);c.prototype._getStage=function(){return null===this._measureMarkup?0:this._measureMarkup._getStage()};c.prototype._draw=function(){var a=!1;2>this._getStage()&&null!==this._cursorMarkup&&(this._cursorMarkup.draw(),
a=!0);null!==this._measureMarkup&&(this._measureMarkup.draw(),a=!0);a&&this._viewer.markupManager.refreshMarkup()};c.prototype._activateCursorSprite=function(){null!==this._cursorMarkup&&this._cursorMarkup.enable(!0)};c.prototype._createConfig=function(a){return new d.PickConfig(a?d.SelectionMask.All:d.SelectionMask.Face)};c.prototype._finalizeMeasurement=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,d,e;return __generator(this,function(f){switch(f.label){case 0:c=this._measureMarkup;
if(null===c)return console.assert(!1),[2];d=this._createConfig(b);return[4,this._viewer.view.pickFromPoint(a,d)];case 1:e=f.sent();if(e.overlayIndex())return[2];this._measureMarkup.finalize();this._measureManager.finalizeMeasurement(this._measureMarkup);this._measureMarkup=null;return[2]}})})};c.prototype._getLineSnapPoint=function(a,b){console.assert(2!==this._getStage());var c=this._snappingConfig.preferVertices?a.getBestVertex():null;if(null!==c)return c;c=a.getPosition();if(!b||0===this._getStage())return c;
console.assert(null!==this._measureMarkup);b=a.getPoints();a:{for(a=0;a<b.length-1;a++)if(d.Util.isPointOnLineSegment(b[a],b[a+1],c,1E-10)){var e=a;break a}e=0}a=b[e];b=b[e+1];e=this._measureMarkup.getFirstPointPosition();a=d.Util.closestPointFromPointToSegment(a,b,e);b=f(this._viewer,a);e=f(this._viewer,c);b=d.Point2.subtract(b,e).squaredLength();e=this._viewer.selectionManager.getPickTolerance();return b<=e*e?a:c};c.prototype._getSelectionCursorPoints=function(b,c){return __awaiter(this,void 0,
void 0,function(){var d,e,g,h,k,l,t,v;return __generator(this,function(m){switch(m.label){case 0:d=this._getStage();if(2<=d)return[2,null];e=this._createConfig(c);return[4,this._viewer.view.pickFromPoint(b,e)];case 1:g=m.sent();if(0!==g.overlayIndex())return[2,null];h=g.getPosition();k=b;this._snappingConfig.enabled&&(l=g.getLineEntity(),t=g.getPointEntity(),l||t)&&(v=null,null!==l?v=this._getLineSnapPoint(l,c):null!==t&&(v=t.getPosition()),null!==v&&(h=v,k=f(this._viewer,h)));return[2,new a(h,k,
g)]}})})};c.prototype._updateMeasurementPoints=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,e;return __generator(this,function(f){switch(f.label){case 0:return c=this._getStage(),console.assert(2>c),this._viewer.trigger("measurementBegin"),[4,this._getSelectionCursorPoints(a,b)];case 1:e=f.sent();if(null===e||null===e.worldPosition)return[2];null===this._measureMarkup&&(this._measureMarkup=new d.Markup.Measure.MeasurePointPointDistanceMarkup(this._viewer),this._measureManager.addMeasurement(this._measureMarkup));
0===c?(this._measureMarkup.setFirstPointPosition(e.worldPosition),this._measureMarkup.setUnitMultiplier(e.selectionItem.isNodeSelection()?this._viewer.model.getNodeUnitMultiplier(e.selectionItem.getNodeId()):1)):1!==c||e.worldPosition.equals(this._measureMarkup.getFirstPointPosition())||(this._measureMarkup.setSecondPointPosition(e.worldPosition),this._measureMarkup.adjust(e.screenPosition));return[2]}})})};c.prototype._updateCursorSpriteImpl=function(a,b){return __awaiter(this,void 0,void 0,function(){var c;
return __generator(this,function(d){switch(d.label){case 0:return null===this._cursorMarkup?[3,3]:b?[4,this._getSelectionCursorPoints(a,b)]:[3,2];case 1:return c=d.sent(),null!==c&&this._cursorMarkup.setPosition(c.screenPosition),[3,3];case 2:this._cursorMarkup.setPosition(a),d.label=3;case 3:return this._draw(),[2]}})})};c.prototype._updateCursorSprite=function(a,b){var c=this;this._updateCursorSpriteAction.set(function(){return c._updateCursorSpriteImpl(a,b)})};c.prototype._useSnapping=function(a){return this._snappingConfig.enabled&&
!a.altDown()};c.prototype.onMouseMove=function(a){b.prototype.onMouseMove.call(this,a);this._activateCursorSprite();var c=this._getStage();2>c?(c=a.getPosition(),this._updateCursorSprite(c,this._useSnapping(a))):2===c&&(this._measureMarkup.adjust(a.getPosition()),a.setHandled(!0));this._draw()};c.prototype.onMouseUp=function(a){if(this.isActive()){this._activateCursorSprite();var c=this._getStage(),d=null!==this._primaryTouchId&&null!==this._measureMarkup&&1<c;if(3>this._dragCount||d){d=this._useSnapping(a);
var e=a.getPosition();1>=c?this._updateMeasurementPoints(e,d):this._finalizeMeasurement(e,d)}}b.prototype.onMouseUp.call(this,a)};c.prototype.onKeyUp=function(a){};c.prototype._clearMeasurement=function(){null!==this._measureMarkup?(this._measureManager.removeMeasurement(this._measureMarkup),this._measureMarkup=null):this._measureManager.removeLastMeasurement()};c.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&this._clearMeasurement()};c.prototype.setHandled=function(){return 1<
this._getStage()};c.prototype.onActivate=function(){this._cursorMarkup=new e(this._viewer);this._viewer.isDrawingSheetActive()&&this._viewer.setBackgroundSelectionEnabled(!0)};c.prototype.onDeactivate=function(){null!==this._cursorMarkup&&(this._cursorMarkup.destroy(),this._cursorMarkup=null);null!==this._measureMarkup&&(this._measureManager.removeMeasurement(this._measureMarkup),this._measureMarkup=null);this._viewer.isDrawingSheetActive()&&this._viewer.setBackgroundSelectionEnabled(!1)};return c}(h.OperatorBase);
h.MeasurePointPointDistanceOperator=c})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){var h=function(f){function a(a){var c=f.call(this,a)||this;c._activeRedlineItem=null;c._newRedlineItem=null;c._viewer=a;return c}__extends(a,f);a.prototype.createRedlineItem=function(a){a;return null};a.prototype.updateRedlineItem=function(a){a};a.prototype.finalizeRedlineItem=function(a){a;return null};a.prototype.onMouseDown=function(a){f.prototype.onMouseDown.call(this,a);this.isActive()&&(a.getButton()!==d.Button.Left&&null===this._primaryTouchId||this._redlineOperatorStart(),a.setHandled(!0))};
a.prototype.onMouseMove=function(a){f.prototype.onMouseMove.call(this,a);this.isActive()&&(this._redlineOperatorMove(),a.setHandled(!0))};a.prototype.onMouseUp=function(a){this.isActive()&&(a.getButton()!==d.Button.Left&&null===this._primaryTouchId||this._redlineOperatorEnd(),a.setHandled(!0));f.prototype.onMouseUp.call(this,a)};a.prototype.onMousewheel=function(a){a.setHandled(!0)};a.prototype.setDraggingEnabled=function(a){this._dragging=a};a.prototype.setHandled=function(){return!0};a.prototype._isRedlineItem=
function(a){return Object.getPrototypeOf(a)instanceof d.Markup.Redline.RedlineItem};a.prototype.onKeyUp=function(a){a=a.getKeyCode();if(a===d.KeyCode.Backspace||a===d.KeyCode.Delete){a=this._viewer.markupManager;var c=a.getSelectedMarkup(),b=a.getActiveMarkupView();null!==c&&this._isRedlineItem(c)&&null!==b&&(b.removeMarkup(c),a.selectMarkup(null))}};a.prototype._removeRedlineTextIfInvalid=function(a){if(!a.isValid()){var c=this._viewer.markupManager.getActiveMarkupView();null!==c&&(c.removeMarkup(a),
this._viewer.trigger("redlineDeleted",a));a.remove()}};a.prototype._redlineOperatorStart=function(){var a=this._viewer.markupManager,c=a.pickMarkupItem(this._ptFirst),b=a.getSelectedMarkup();c?(this._activeRedlineItem=c,this._dragging&&this._activeRedlineItem.onDragStart(this._ptFirst)&&a.refreshMarkup()):(a.selectMarkup(null),this._markupIsTextArea(b)?this._removeRedlineTextIfInvalid(b):this._newRedlineItem=this.createRedlineItem(this._ptFirst))};a.prototype._redlineOperatorMove=function(){this._activeRedlineItem?
this._dragging&&this._activeRedlineItem.onDragMove(this._ptCurrent)&&this._viewer.markupManager.refreshMarkup():this.updateRedlineItem(this._ptCurrent)};a.prototype._redlineOperatorEnd=function(){var a=this._viewer.markupManager;this._activeRedlineItem?this._ptFirst.equals(this._ptCurrent)?a.selectMarkup(this._activeRedlineItem):(this._viewer.trigger("redlineUpdated",this._activeRedlineItem),this._dragging&&this._activeRedlineItem.onDragEnd(this._ptCurrent)&&a.refreshMarkup()):this._newRedlineItem&&
(a=this.finalizeRedlineItem(this._ptCurrent))&&this._attachNewMarkupToView(a);this._newRedlineItem=this._activeRedlineItem=null};a.prototype._attachNewMarkupToView=function(a){return __awaiter(this,void 0,void 0,function(){var c,b,e,f,h,n,m,p,r,q;return __generator(this,function(g){switch(g.label){case 0:c=this._viewer;b=c.model;e=c.markupManager;f=e.getActiveMarkupView();h=!1;if(null!==f)return[3,3];n=b.getAbsoluteRootNode();return[4,b.getVisibilityState(n)];case 1:return m=g.sent(),[4,b.getNodeColorMap(b.getAbsoluteRootNode(),
d.ElementType.Faces)];case 2:p=g.sent(),r=e.createMarkupView(void 0,!1,m,p,null),f=e.getMarkupView(r),h=!0,g.label=3;case 3:return null!==f&&(f.addMarkupItem(a),e.selectMarkup(a)),q=this._viewer._getCallbackManager(),h&&null!==f&&q.trigger("viewCreated",f),q.trigger("redlineCreated",a),[2]}})})};a.prototype._markupIsTextArea=function(a){return a?a.getClassName()===d.Markup.Redline.RedlineText.className:!1};return a}(d.Operator.OperatorBase);d.RedlineOperator=h})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c){c=a.call(this,c)||this;c._redlineCircle=null;c._previewHandle=null;c._centerSet=!1;return c}__extends(e,a);e.prototype.createRedlineItem=function(a){var b=this._viewer.view;this._redlineCircle=new d.Markup.Redline.RedlineCircle(this._viewer);this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlineCircle);a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&(this._centerSet=!0,this._redlineCircle.setCenter(a),this._redlineCircle.setRadiusPoint(a));
return this._redlineCircle};e.prototype.updateRedlineItem=function(a){var b=this._viewer.view;this._redlineCircle&&(a=b.getCamera().getCameraPlaneIntersectionPoint(a,b),null!==a&&(this._centerSet||(this._centerSet=!0,this._redlineCircle.setCenter(a)),this._redlineCircle.setRadiusPoint(a),this._viewer.markupManager.refreshMarkup()))};e.prototype.finalizeRedlineItem=function(a){a=this._viewer.markupManager;var b=null;this._redlineCircle&&(this._redlineCircle.isValid()&&(b=this._redlineCircle),this._redlineCircle=
null,null!==this._previewHandle&&(a.unregisterMarkup(this._previewHandle),this._previewHandle=null),a.refreshMarkup());return b};return e}(d.RedlineOperator);h.RedlineCircleOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c){c=a.call(this,c)||this;c._redlinePolyline=null;c._previewHandle=null;return c}__extends(e,a);e.prototype.createRedlineItem=function(a){var b=this._viewer.view;this._redlinePolyline=new d.Markup.Redline.RedlinePolyline(this._viewer);this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlinePolyline);a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&this._redlinePolyline.addPoint(a);return this._redlinePolyline};
e.prototype.updateRedlineItem=function(a){if(this._redlinePolyline){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&(this._redlinePolyline.addPoint(a),this._viewer.markupManager.refreshMarkup())}};e.prototype.finalizeRedlineItem=function(a){a=this._viewer.markupManager;var b=null;this._redlinePolyline&&(this._redlinePolyline.isValid()&&(b=this._redlinePolyline),this._redlinePolyline=null,null!==this._previewHandle&&(a.unregisterMarkup(this._previewHandle),this._previewHandle=
null),a.refreshMarkup());return b};return e}(d.RedlineOperator);h.RedlinePolylineOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c){c=a.call(this,c)||this;c._redlineRectangle=null;c._previewHandle=null;return c}__extends(e,a);e.prototype.createRedlineItem=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);this._redlineRectangle=new d.Markup.Redline.RedlineRectangle(this._viewer);null!==a&&(this._redlineRectangle.setPoint1(a),this._redlineRectangle.setPoint2(a));this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlineRectangle);
return this._redlineRectangle};e.prototype.updateRedlineItem=function(a){if(this._redlineRectangle){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&this._redlineRectangle.setPoint2(a);this._viewer.markupManager.refreshMarkup()}};e.prototype.finalizeRedlineItem=function(a){a=null;if(this._redlineRectangle&&this._previewHandle){var b=this._viewer.markupManager;this._redlineRectangle.isValid()&&(a=this._redlineRectangle);b.unregisterMarkup(this._previewHandle);
this._redlineRectangle=this._previewHandle=null;b.refreshMarkup()}return a};return e}(d.RedlineOperator);h.RedlineRectangleOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var f=function(a){function e(c){c=a.call(this,c)||this;c._redlineText=null;return c}__extends(e,a);e.prototype.createRedlineItem=function(a){return this._redlineText=new d.Markup.Redline.RedlineText(this._viewer)};e.prototype.finalizeRedlineItem=function(a){if(null===this._redlineText)return null;var b=this._viewer.view,c=this._redlineText;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&c.setPosition(a);this._redlineText=null;return c};return e}(d.RedlineOperator);
h.RedlineTextOperator=f})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));

var _SC = {
	_deferredInstances: [],

	_loadEngine: function (enginePath, onError) {
		if (this._engineLoaded) {
			return;
		}
		this._engineLoaded = true;
		this._enginePath = enginePath;

		var hasWebAssembly = (function () {
			try {
				if (typeof WebAssembly === "object" && typeof WebAssembly.instantiate === "function") {
					var module = new WebAssembly.Module(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));
					if (module instanceof WebAssembly.Module) {
						return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;
					}
				}
			} catch (e) {
				//
			}
			return false;
		})();

		var engineJs = hasWebAssembly ? "engine-wasm.js" : "engine-asmjs.js";
		if (enginePath) {
			engineJs = enginePath + "/" + engineJs;
		}

		var engineScript = document.createElement("script");
		engineScript.type = "text/javascript";

		if (typeof onError === "function") {
			engineScript.onerror = function (e) {
				onError("failed to load " + e.target.src);
			};
		}

		document.head.appendChild(engineScript);
		engineScript.src = engineJs;
	},

	_defaultEnginePath: (function () {
		// paths are normally relative to HTML, but we want a path relative to current JS file
		var scriptElements = document.getElementsByTagName("script");
		var path = scriptElements[scriptElements.length - 1].src; // URL of current script
		path = path.split("?")[0]; // remove query string
		path = path.split("/").slice(0, -1).join("/"); // remove filename
		return path;
	})(),

	// store instance arguments and return empty base object that will
	// be populated asynchronously
	createInstance: function (instanceArgs) {
		var enginePath = instanceArgs.enginePath;
		if (typeof enginePath !== "string") { // allow empty string, which means relative to HTML
			enginePath = this._defaultEnginePath;
		}

		this._loadEngine(enginePath, instanceArgs.onError);

		var argWrapper = {
			isWrapper: true,
			base: {},
			args: instanceArgs,
			enginePath: enginePath
		};

		this._deferredInstances.push (argWrapper);
		return argWrapper.base;
	}
};
(function(m,r,R,S,E,L){function Ka(a,b,c,d,e){return ha(a,a,c,d,b,a.defaultView.pageXOffset,a.defaultView.pageYOffset).then(function(f){q("Document cloned");var g="data-html2canvas-node"+e,h="["+g+"='"+e+"']";a.querySelector(h).removeAttribute(g);var g=f.contentWindow,k=g.document.querySelector(h);return("function"===typeof b.onclone?Promise.resolve(b.onclone(g.document)):Promise.resolve(!0)).then(function(){return ia(k,f,b,c,d)})})}function ia(a,b,c,d,e){var f=b.contentWindow,g=new T(f.document),
h=new u(c,g),k=U(a);d="view"===c.type?d:La(f.document);e="view"===c.type?e:Ma(f.document);var F=new c.renderer(d,e,h,c,r);return(new n(a,F,g,h,c)).ready.then(function(){q("Finished rendering");var d;d="view"===c.type?ja(F.canvas,{width:F.canvas.width,height:F.canvas.height,top:0,left:0,x:0,y:0}):a===f.document.body||a===f.document.documentElement||null!=c.canvas?F.canvas:ja(F.canvas,{width:null!=c.width?c.width:k.width,height:null!=c.height?c.height:k.height,top:k.top,left:k.left,x:f.pageXOffset,
y:f.pageYOffset});c.removeContainer&&(b.parentNode.removeChild(b),q("Cleaned up container"));return d})}function ja(a,b){var c=r.createElement("canvas"),d=Math.min(a.width-1,Math.max(0,b.left)),e=Math.min(a.width,Math.max(1,b.left+b.width)),f=Math.min(a.height-1,Math.max(0,b.top)),g=Math.min(a.height,Math.max(1,b.top+b.height));c.width=b.width;c.height=b.height;q("Cropping canvas at:","left:",b.left,"top:",b.top,"width:",e-d,"height:",g-f);q("Resulting crop with width",b.width,"and height",b.height,
" with x",d,"and y",f);c.getContext("2d").drawImage(a,d,f,e-d,g-f,b.x,b.y,e-d,g-f);return c}function La(a){return Math.max(Math.max(a.body.scrollWidth,a.documentElement.scrollWidth),Math.max(a.body.offsetWidth,a.documentElement.offsetWidth),Math.max(a.body.clientWidth,a.documentElement.clientWidth))}function Ma(a){return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}
function ka(){return"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}function la(a,b){for(var c=3===a.nodeType?r.createTextNode(a.nodeValue):a.cloneNode(!1),d=a.firstChild;d;)!0!==b&&1===d.nodeType&&"SCRIPT"===d.nodeName||c.appendChild(la(d,b)),d=d.nextSibling;return c}function ha(a,b,c,d,e,f,g){Na(a);var h=r.documentMode&&9>=r.documentMode?la(a.documentElement,e.javascriptEnabled):a.documentElement.cloneNode(!0),k=b.createElement("iframe");k.className="html2canvas-container";
k.style.visibility="hidden";k.style.position="fixed";k.style.left="-10000px";k.style.top="0px";k.style.border="0";k.width=c;k.height=d;k.scrolling="no";b.body.appendChild(k);return new Promise(function(b){var c=k.contentWindow.document;ma(a.documentElement,h,"textarea");ma(a.documentElement,h,"select");k.contentWindow.onload=k.onload=function(){var d=setInterval(function(){0<c.body.childNodes.length&&(Oa(a,c),clearInterval(d),"view"===e.type&&k.contentWindow.scrollTo(f,g),b(k))},50)};c.open();c.write("<!DOCTYPE html><html></html>");
!a.defaultView||f===a.defaultView.pageXOffset&&g===a.defaultView.pageYOffset||a.defaultView.scrollTo(f,g);c.replaceChild(!0===e.javascriptEnabled?c.adoptNode(h):na(c.adoptNode(h)),c.documentElement);c.close()})}function ma(a,b,c){a=a.getElementsByTagName(c);b=b.getElementsByTagName(c);c=a.length;for(var d=0;d<c;d++)b[d].value=a[d].value}function oa(a,b,c,d,e,f){return(new Pa(a,b,m.document)).then(Qa(a)).then(function(a){return ha(a,c,d,e,f,0,0)})}function Qa(a){return function(b){var c=new DOMParser,
d;try{d=c.parseFromString(b,"text/html")}catch(e){q("DOMParser not supported, falling back to createHTMLDocument");d=r.implementation.createHTMLDocument("");try{d.open(),d.write(b),d.close()}catch(f){q("createHTMLDocument write not supported, falling back to document.body.innerHTML"),d.body.innerHTML=b}}b=d.querySelector("base");b&&b.href.host||(b=d.createElement("base"),b.href=a,d.head.insertBefore(b,d.head.firstChild));return d}}function Na(a){[].slice.call(a.querySelectorAll("canvas"),0).forEach(function(a){a.setAttribute("data-html2canvas-canvas-clone",
"canvas-"+Ra++)})}function Oa(a,b){[].slice.call(a.querySelectorAll("[data-html2canvas-canvas-clone]"),0).forEach(function(a){try{var d=b.querySelector('[data-html2canvas-canvas-clone="'+a.getAttribute("data-html2canvas-canvas-clone")+'"]');d&&(d.width=a.width,d.height=a.height,d.getContext("2d").putImageData(a.getContext("2d").getImageData(0,0,a.width,a.height),0,0))}catch(e){q("Unable to copy canvas content from",a,e)}a.removeAttribute("data-html2canvas-canvas-clone")})}function na(a){[].slice.call(a.childNodes,
0).filter(Sa).forEach(function(b){"SCRIPT"===b.tagName?a.removeChild(b):na(b)});return a}function Sa(a){return a.nodeType===Node.ELEMENT_NODE}function Ta(a){var b=r.createElement("a");b.href=a;b.href=b.href;return b}function t(a){this.b=this.g=this.r=0;this.a=null;this.fromArray(a)||this.namedColor(a)||this.rgb(a)||this.rgba(a)||this.hex6(a)||this.hex3(a)}function M(a){this.src=a;q("DummyImageContainer for",a);if(!this.promise||!this.image){q("Initiating DummyImageContainer");M.prototype.image=new Image;
var b=this.image;M.prototype.promise=new Promise(function(a,d){b.onload=a;b.onerror=d;b.src=ka();!0===b.complete&&a(b)})}}function Ua(a,b){var c=r.createElement("div"),d=r.createElement("img"),e=r.createElement("span"),f;c.style.visibility="hidden";c.style.fontFamily=a;c.style.fontSize=b;c.style.margin=0;c.style.padding=0;r.body.appendChild(c);d.src=ka();d.width=1;d.height=1;d.style.margin=0;d.style.padding=0;d.style.verticalAlign="baseline";e.style.fontFamily=a;e.style.fontSize=b;e.style.margin=
0;e.style.padding=0;e.appendChild(r.createTextNode("Hidden Text"));c.appendChild(e);c.appendChild(d);f=d.offsetTop-e.offsetTop+1;c.removeChild(e);c.appendChild(r.createTextNode("Hidden Text"));c.style.lineHeight="normal";d.style.verticalAlign="super";d=d.offsetTop-c.offsetTop+1;r.body.removeChild(c);this.baseline=f;this.lineWidth=1;this.middle=d}function pa(){this.data={}}function qa(a,b,c){this.image=null;this.src=a;var d=this,e=U(a);this.promise=(b?new Promise(function(b){"about:blank"===a.contentWindow.document.URL||
null==a.contentWindow.document.documentElement?a.contentWindow.onload=a.onload=function(){b(a)}:b(a)}):this.proxyLoad(c.proxy,e,c)).then(function(a){return html2canvas(a.contentWindow.document.documentElement,{type:"view",width:a.width,height:a.height,proxy:c.proxy,javascriptEnabled:c.javascriptEnabled,removeContainer:c.removeContainer,allowTaint:c.allowTaint,imageTimeout:c.imageTimeout/2})}).then(function(a){return d.image=a})}function N(a){this.src=a.value;this.colorStops=[];this.type=null;this.y1=
this.x1=this.y0=this.x0=.5;this.promise=Promise.resolve(!0)}function ba(a,b){this.src=a;this.image=new Image;var c=this;this.tainted=null;this.promise=new Promise(function(d,e){c.image.onload=d;c.image.onerror=e;b&&(c.image.crossOrigin="anonymous");c.image.src=a;!0===c.image.complete&&d(c.image)})}function u(a,b){this.link=null;this.options=a;this.support=b;this.origin=this.getOrigin(m.location.href)}function V(a){N.apply(this,arguments);this.type=this.TYPES.LINEAR;var b=null===a.args[0].match(this.stepRegExp);
b?a.args[0].split(" ").reverse().forEach(function(a){switch(a){case "left":this.x0=0;this.x1=1;break;case "top":this.y0=0;this.y1=1;break;case "right":this.x0=1;this.x1=0;break;case "bottom":this.y0=1;this.y1=0;break;case "to":a=this.y0;var b=this.x0;this.y0=this.y1;this.x0=this.x1;this.x1=b;this.y1=a}},this):(this.y0=0,this.y1=1);this.colorStops=a.args.slice(b?1:0).map(function(a){a=a.match(this.stepRegExp);return{color:new t(a[1]),stop:"%"===a[3]?a[2]/100:null}},this);null===this.colorStops[0].stop&&
(this.colorStops[0].stop=0);null===this.colorStops[this.colorStops.length-1].stop&&(this.colorStops[this.colorStops.length-1].stop=1);this.colorStops.forEach(function(a,b){null===a.stop&&this.colorStops.slice(b).some(function(e,f){return null!==e.stop?(a.stop=(e.stop-this.colorStops[b-1].stop)/(f+1)+this.colorStops[b-1].stop,!0):!1},this)},this)}function q(){m.html2canvas.logging&&m.console&&m.console.log&&Function.prototype.bind.call(m.console.log,m.console).apply(m.console,[Date.now()-m.html2canvas.start+
"ms","html2canvas:"].concat([].slice.call(arguments,0)))}function l(a,b){this.node=a;this.parent=b;this.borders=this.bounds=this.stack=null;this.clip=[];this.backgroundClip=[];this.computedStyles=this.visible=this.offsetBounds=null;this.colors={};this.styles={};this.transformMatrix=this.transformData=this.backgroundImages=null;this.isPseudoElement=!1;this.opacity=null}function Va(a){if(a&&"matrix"===a[1])return a[2].split(",").map(function(a){return parseFloat(a.trim())})}function W(a){return-1!==
a.toString().indexOf("%")}function ra(a){var b,c,d,e,f,g=[],h=0,k=0,l,m,q=function(){b&&('"'===c.substr(0,1)&&(c=c.substr(1,c.length-2)),c&&m.push(c),"-"===b.substr(0,1)&&0<(e=b.indexOf("-",1)+1)&&(d=b.substr(0,e),b=b.substr(e)),g.push({prefix:d,method:b.toLowerCase(),value:f,args:m,image:null}));m=[];b=d=c=f=""};m=[];b=d=c=f="";a.split("").forEach(function(a){if(!(0===h&&-1<" \r\n\t".indexOf(a))){switch(a){case '"':l?l===a&&(l=null):l=a;break;case "(":if(!l){if(0===h){h=1;f+=a;return}k++}break;case ")":if(!l&&
1===h){if(0===k){h=0;f+=a;q();return}k--}break;case ",":if(!l){if(0===h){q();return}if(1===h&&0===k&&!b.match(/^url$/i)){m.push(c);c="";f+=a;return}}}f+=a;0===h?b+=a:c+=a}});q();return g}function Wa(a){return a.replace("px","")}function Xa(a){return parseFloat(a)}function U(a){if(a.getBoundingClientRect){var b=a.getBoundingClientRect(),c=null==a.offsetWidth?b.width:a.offsetWidth;return{top:b.top,bottom:b.bottom||b.top+b.height,right:b.left+c,left:b.left,width:c,height:null==a.offsetHeight?b.height:
a.offsetHeight}}return{}}function ca(a){var b=a.offsetParent?ca(a.offsetParent):{top:0,left:0};return{top:a.offsetTop+b.top,bottom:a.offsetTop+a.offsetHeight+b.top,right:a.offsetLeft+b.left+a.offsetWidth,left:a.offsetLeft+b.left,width:a.offsetWidth,height:a.offsetHeight}}function n(a,b,c,d,e){q("Starting NodeParser");this.renderer=b;this.options=e;this.range=null;this.support=c;this.renderQueue=[];this.stack=new G(!0,1,a.ownerDocument,null);c=new l(a,null);e.background&&b.rectangle(0,0,b.width,b.height,
new t(e.background));if(a===a.ownerDocument.documentElement){var f=new l(c.color("backgroundColor").isTransparent()?a.ownerDocument.body:a.ownerDocument.documentElement,null);b.rectangle(0,0,b.width,b.height,f.color("backgroundColor"))}c.visibile=c.isElementVisible();this.createPseudoHideStyles(a.ownerDocument);this.disableAnimations(a.ownerDocument);this.nodes=[].concat.apply([],[c].concat(this.getChildren(c)).filter(function(a){return a.visible=a.isElementVisible()}).map(this.getPseudoElements,
this));this.fontMetrics=new pa;q("Fetched nodes, total:",this.nodes.length);q("Calculate overflow clips");this.calculateOverflowClips();q("Start fetching images");this.images=d.fetch(this.nodes.filter(O));this.ready=this.images.ready.then(X(function(){q("Images loaded, starting parsing");q("Creating stacking contexts");this.createStackingContexts();q("Sorting stacking contexts");this.sortStackingContexts(this.stack);this.parse(this.stack);q("Render queue created with "+this.renderQueue.length+" items");
return new Promise(X(function(a){e.async?"function"===typeof e.async?e.async.call(this,this.renderQueue,a):0<this.renderQueue.length?(this.renderIndex=0,this.asyncRenderer(this.renderQueue,a)):a():(this.renderQueue.forEach(this.paint,this),a())},this))},this))}function Ya(a){return a.replace(/(\-[a-z])/g,function(a){return a.toUpperCase().replace("-","")})}function sa(){}function ta(a,b,c,d){return a.map(function(e,f){if(0<e.width){var g=b.left,h=b.top,k=b.width,l=b.height-a[2].width;switch(f){case 0:l=
a[0].width;e.args=Y({c1:[g,h],c2:[g+k,h],c3:[g+k-a[1].width,h+l],c4:[g+a[3].width,h+l]},d[0],d[1],c.topLeftOuter,c.topLeftInner,c.topRightOuter,c.topRightInner);break;case 1:g=b.left+b.width-a[1].width;k=a[1].width;e.args=Y({c1:[g+k,h],c2:[g+k,h+l+a[2].width],c3:[g,h+l],c4:[g,h+a[0].width]},d[1],d[2],c.topRightOuter,c.topRightInner,c.bottomRightOuter,c.bottomRightInner);break;case 2:h=h+b.height-a[2].width;l=a[2].width;e.args=Y({c1:[g+k,h+l],c2:[g,h+l],c3:[g+a[3].width,h],c4:[g+k-a[3].width,h]},d[2],
d[3],c.bottomRightOuter,c.bottomRightInner,c.bottomLeftOuter,c.bottomLeftInner);break;case 3:k=a[3].width,e.args=Y({c1:[g,h+l+a[2].width],c2:[g,h],c3:[g+k,h+a[0].width],c4:[g+k,h+l]},d[3],d[0],c.bottomLeftOuter,c.bottomLeftInner,c.topLeftOuter,c.topLeftInner)}}return e})}function C(a,b,c,d){var e=(Math.sqrt(2)-1)/3*4,f=c*e,e=d*e;c=a+c;d=b+d;return{topLeft:H({x:a,y:d},{x:a,y:d-e},{x:c-f,y:b},{x:c,y:b}),topRight:H({x:a,y:b},{x:a+f,y:b},{x:c,y:d-e},{x:c,y:d}),bottomRight:H({x:c,y:b},{x:c,y:b+e},{x:a+
f,y:d},{x:a,y:d}),bottomLeft:H({x:c,y:d},{x:c-f,y:d},{x:a,y:b+e},{x:a,y:b})}}function ua(a,b,c){var d=a.left,e=a.top,f=a.width;a=a.height;var g=b[0][0],h=b[0][1],k=b[1][0],l=b[1][1],m=b[2][0],q=b[2][1],r=b[3][0];b=b[3][1];var n=f-k,t=a-q,p=f-m,u=a-b;return{topLeftOuter:C(d,e,g,h).topLeft.subdivide(.5),topLeftInner:C(d+c[3].width,e+c[0].width,Math.max(0,g-c[3].width),Math.max(0,h-c[0].width)).topLeft.subdivide(.5),topRightOuter:C(d+n,e,k,l).topRight.subdivide(.5),topRightInner:C(d+Math.min(n,f+c[3].width),
e+c[0].width,n>f+c[3].width?0:k-c[3].width,l-c[0].width).topRight.subdivide(.5),bottomRightOuter:C(d+p,e+t,m,q).bottomRight.subdivide(.5),bottomRightInner:C(d+Math.min(p,f-c[3].width),e+Math.min(t,a+c[0].width),Math.max(0,m-c[1].width),q-c[2].width).bottomRight.subdivide(.5),bottomLeftOuter:C(d,e+u,r,b).bottomLeft.subdivide(.5),bottomLeftInner:C(d+c[3].width,e+u,Math.max(0,r-c[3].width),b-c[2].width).bottomLeft.subdivide(.5)}}function H(a,b,c,d){var e=function(a,b,c){return{x:a.x+(b.x-a.x)*c,y:a.y+
(b.y-a.y)*c}};return{start:a,startControl:b,endControl:c,end:d,subdivide:function(f){var g=e(a,b,f),h=e(b,c,f),k=e(c,d,f),l=e(g,h,f),h=e(h,k,f);f=e(l,h,f);return[H(a,g,l,f),H(f,h,k,d)]},curveTo:function(a){a.push(["bezierCurve",b.x,b.y,c.x,c.y,d.x,d.y])},curveToReversed:function(d){d.push(["bezierCurve",c.x,c.y,b.x,b.y,a.x,a.y])}}}function Y(a,b,c,d,e,f,g){var h=[];0<b[0]||0<b[1]?(h.push(["line",d[1].start.x,d[1].start.y]),d[1].curveTo(h)):h.push(["line",a.c1[0],a.c1[1]]);0<c[0]||0<c[1]?(h.push(["line",
f[0].start.x,f[0].start.y]),f[0].curveTo(h),h.push(["line",g[0].end.x,g[0].end.y]),g[0].curveToReversed(h)):(h.push(["line",a.c2[0],a.c2[1]]),h.push(["line",a.c3[0],a.c3[1]]));0<b[0]||0<b[1]?(h.push(["line",e[1].end.x,e[1].end.y]),e[1].curveToReversed(h)):h.push(["line",a.c4[0],a.c4[1]]);return h}function D(a,b,c,d,e,f,g){0<b[0]||0<b[1]?(a.push(["line",d[0].start.x,d[0].start.y]),d[0].curveTo(a),d[1].curveTo(a)):a.push(["line",f,g]);(0<c[0]||0<c[1])&&a.push(["line",e[0].start.x,e[0].start.y])}function Za(a){return 0>
a.cssInt("zIndex")}function $a(a){return 0<a.cssInt("zIndex")}function va(a){return 0===a.cssInt("zIndex")}function wa(a){return-1!==["inline","inline-block","inline-table"].indexOf(a.css("display"))}function ab(a){return 0<a.node.data.trim().length}function bb(a){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(b){b=a.css("border"+b+"Radius").split(" ");1>=b.length&&(b[1]=b[0]);return b.map(cb)})}function db(a){return a.nodeType===Node.TEXT_NODE||a.nodeType===Node.ELEMENT_NODE}
function P(a){return"static"!==a.css("position")}function da(a){return"none"!==a.css("float")}function Q(a){var b=this;return function(){return!a.apply(b,arguments)}}function O(a){return a.node.nodeType===Node.ELEMENT_NODE}function ea(a){return a.node.nodeType===Node.TEXT_NODE}function eb(a){return function(b,c){return b.cssInt("zIndex")+a.indexOf(b)/a.length-(c.cssInt("zIndex")+a.indexOf(c)/a.length)}}function X(a,b){return function(){return a.apply(b,arguments)}}function cb(a){return parseInt(a,
10)}function fb(a){return a.width}function gb(a){return a.node.nodeType!==Node.ELEMENT_NODE||-1==="SCRIPT HEAD TITLE OBJECT BR OPTION".split(" ").indexOf(a.node.nodeName)}function hb(a){for(var b=[],c=0,d=!1,e;a.length;)-1!==[32,13,10,9,45].indexOf(a[c])===d?(e=a.splice(0,c),e.length&&b.push(m.html2canvas.punycode.ucs2.encode(e)),d=!d,c=0):c++,c>=a.length&&(e=a.splice(0,c),e.length&&b.push(m.html2canvas.punycode.ucs2.encode(e)));return b}function Pa(a,b,c){if(!b)return Promise.reject("No proxy configured");
var d=xa(ya);a=za(b,a,d);return ya?Aa(a):Ba(c,a,d).then(function(a){return Ca(a.content)})}function ib(a,b,c){var d=xa(Da);a=za(b,a,d);return Da?Promise.resolve(a):Ba(c,a,d).then(function(a){return"data:"+a.type+";base64,"+a.content})}function Ba(a,b,c){return new Promise(function(d,e){var f=a.createElement("script"),g=function(){delete m.html2canvas.proxy[c];a.body.removeChild(f)};m.html2canvas.proxy[c]=function(a){g();d(a)};f.src=b;f.onerror=function(a){g();e(a)};a.body.appendChild(f)})}function xa(a){return a?
"":"html2canvas_"+Date.now()+"_"+ ++jb+"_"+Math.round(1E5*Math.random())}function za(a,b,c){return a+"?url="+encodeURIComponent(b)+(c.length?"&callback=html2canvas.proxy."+c:"")}function kb(a,b){r.createElement("script");var c=r.createElement("a");c.href=a;this.src=a=c.href;this.image=new Image;var d=this;this.promise=new Promise(function(c,f){d.image.crossOrigin="Anonymous";d.image.onload=c;d.image.onerror=f;(new ib(a,b,r)).then(function(a){d.image.src=a})["catch"](f)})}function v(a,b,c){l.call(this,
a,b);this.isPseudoElement=!0;this.before=":before"===c}function x(a,b,c,d,e){this.width=a;this.height=b;this.images=c;this.options=d;this.document=e}function G(a,b,c,d){l.call(this,c,d);this.ownStacking=a;this.contexts=[];this.children=[];this.opacity=(this.parent?this.parent.stack.opacity:1)*b}function T(a){this.rangeBounds=this.testRangeBounds(a);this.cors=this.testCORS();this.svg=this.testSVG()}function A(a){this.src=a;this.image=null;var b=this;this.promise=this.hasFabric().then(function(){return b.isInline(a)?
Promise.resolve(b.inlineFormatting(a)):Aa(a)}).then(function(a){return new Promise(function(d){html2canvas.fabric.loadSVGFromString(a,b.createCanvas.call(b,d))})})}function Ca(a){var b=a.length,c,d,e,f,g,h,k="";for(c=0;c<b;c+=4)d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c]),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+1]),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+2]),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+
3]),d=d<<2|e>>4,e=(e&15)<<4|f>>2,h=(f&3)<<6|g,k=64===f?k+String.fromCharCode(d):64===g||-1===g?k+String.fromCharCode(d,e):k+String.fromCharCode(d,e,h);return k}function Ea(a,b){this.src=a;this.image=null;var c=this;this.promise=b?new Promise(function(b,e){c.image=new Image;c.image.onload=b;c.image.onerror=e;c.image.src="data:image/svg+xml,"+(new XMLSerializer).serializeToString(a);!0===c.image.complete&&b(c.image)}):this.hasFabric().then(function(){return new Promise(function(b){html2canvas.fabric.parseSVGDocument(a,
c.createCanvas.call(c,b))})})}function I(a,b){l.call(this,a,b)}function lb(a,b,c){if(0<a.length)return b+c.toUpperCase()}function Fa(a){N.apply(this,arguments);this.type="linear"===a.args[0]?this.TYPES.LINEAR:this.TYPES.RADIAL}function Aa(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a);d.onload=function(){200===d.status?b(d.responseText):c(Error(d.statusText))};d.onerror=function(){c(Error("Network Error"))};d.send()})}function p(a,b){x.apply(this,arguments);this.canvas=
this.options.canvas||this.document.createElement("canvas");this.options.canvas||(this.canvas.width=a,this.canvas.height=b);this.ctx=this.canvas.getContext("2d");this.taintCtx=this.document.createElement("canvas").getContext("2d");this.ctx.textBaseline="bottom";this.variables={};q("Initialized CanvasRenderer with size",a,"x",b)}function mb(a){return 0<a.length}(function(){function a(a,b){J[K]=a;J[K+1]=b;K+=2;2===K&&Ga()}function b(a){return"function"===typeof a}function c(){return function(){process.nextTick(g)}}
function d(){var a=0,b=new Ha(g),c=r.createTextNode("");b.observe(c,{characterData:!0});return function(){c.data=a=++a%2}}function e(){var a=new MessageChannel;a.port1.onmessage=g;return function(){a.port2.postMessage(0)}}function f(){return function(){setTimeout(g,1)}}function g(){for(var a=0;a<K;a+=2)(0,J[a])(J[a+1]),J[a]=void 0,J[a+1]=void 0;K=0}function h(){}function k(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function l(b,c,d){a(function(a){var b=!1,e=k(d,c,function(d){b||(b=!0,c!==d?n(a,
d):p(a,d))},function(c){b||(b=!0,w(a,c))});!b&&e&&(b=!0,w(a,e))},b)}function q(a,b){1===b.a?p(a,b.b):2===a.a?w(a,b.b):u(b,void 0,function(b){n(a,b)},function(b){w(a,b)})}function n(a,c){if(a===c)w(a,new TypeError("You cannot resolve a promise with itself"));else if("function"===typeof c||"object"===typeof c&&null!==c)if(c.constructor===a.constructor)q(a,c);else{var d;try{d=c.then}catch(e){Z.error=e,d=Z}d===Z?w(a,Z.error):void 0===d?p(a,c):b(d)?l(a,c,d):p(a,c)}else p(a,c)}function t(a){a.f&&a.f(a.b);
v(a)}function p(b,c){void 0===b.a&&(b.b=c,b.a=1,0!==b.e.length&&a(v,b))}function w(b,c){void 0===b.a&&(b.a=2,b.b=c,a(t,b))}function u(b,c,d,e){var f=b.e,g=f.length;b.f=null;f[g]=c;f[g+1]=d;f[g+2]=e;0===g&&b.a&&a(v,b)}function v(a){var b=a.e,c=a.a;if(0!==b.length){for(var d,e,f=a.b,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?z(c,d,e,f):e(f);a.e.length=0}}function x(){this.error=null}function z(a,c,d,e){var f=b(d),g,h,k,l;if(f){try{g=d(e)}catch(B){fa.error=B,g=fa}g===fa?(l=!0,h=g.error,g=null):k=!0;if(c===
g){w(c,new TypeError("A promises callback cannot return that same promise."));return}}else g=e,k=!0;void 0===c.a&&(f&&k?n(c,g):l?w(c,h):1===a?p(c,g):2===a&&w(c,g))}function A(a,b){try{b(function(b){n(a,b)},function(b){w(a,b)})}catch(c){w(a,c)}}function y(a,b,c,d){this.n=a;this.c=new a(h,d);this.i=c;this.o(b)?(this.m=b,this.d=this.length=b.length,this.l(),0===this.length?p(this.c,this.b):(this.length=this.length||0,this.k(),0===this.d&&p(this.c,this.b))):w(this.c,this.p())}function B(a){nb++;this.b=
this.a=void 0;this.e=[];if(h!==a){if(!b(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof B))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");A(this,a)}}var Ia=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},K=0,aa="undefined"!==typeof m?m:{},Ha=aa.MutationObserver||aa.WebKitMutationObserver,
aa="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,J=Array(1E3),Ga;Ga="undefined"!==typeof process&&"[object process]"==={}.toString.call(process)?c():Ha?d():aa?e():f();var Z=new x,fa=new x;y.prototype.o=function(a){return Ia(a)};y.prototype.p=function(){return Error("Array Methods must be provided an Array")};y.prototype.l=function(){this.b=Array(this.length)};y.prototype.k=function(){for(var a=this.length,b=this.c,c=this.m,d=0;void 0===
b.a&&d<a;d++)this.j(c[d],d)};y.prototype.j=function(a,b){var c=this.n;"object"===typeof a&&null!==a?a.constructor===c&&void 0!==a.a?(a.f=null,this.g(a.a,b,a.b)):this.q(c.resolve(a),b):(this.d--,this.b[b]=this.h(a))};y.prototype.g=function(a,b,c){var d=this.c;void 0===d.a&&(this.d--,this.i&&2===a?w(d,c):this.b[b]=this.h(c));0===this.d&&p(d,this.b)};y.prototype.h=function(a){return a};y.prototype.q=function(a,b){var c=this;u(a,void 0,function(a){c.g(1,b,a)},function(a){c.g(2,b,a)})};var nb=0;B.all=
function(a,b){return(new y(this,a,!0,b)).c};B.race=function(a,b){function c(a){n(e,a)}function d(a){w(e,a)}var e=new this(h,b);if(!Ia(a))return w(e,new TypeError("You must pass an array to race.")),e;for(var f=a.length,g=0;void 0===e.a&&g<f;g++)u(this.resolve(a[g]),void 0,c,d);return e};B.resolve=function(a,b){if(a&&"object"===typeof a&&a.constructor===this)return a;var c=new this(h,b);n(c,a);return c};B.reject=function(a,b){var c=new this(h,b);w(c,a);return c};B.prototype={constructor:B,then:function(b,
c){var d=this.a;if(1===d&&!b||2===d&&!c)return this;var e=new this.constructor(h),f=this.b;if(d){var g=arguments[d-1];a(function(){z(d,e,g,f)})}else u(this,e,b,c);return e},"catch":function(a){return this.then(null,a)}};var ga={Promise:B,polyfill:function(){var a;a="undefined"!==typeof S?S:"undefined"!==typeof m&&m.document?m:self;"Promise"in a&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var c;new a.Promise(function(a){c=a});return b(c)}()||(a.Promise=
B)}};"function"===typeof E&&E.amd?E(function(){return ga}):"undefined"!==typeof module&&module.exports?module.exports=ga:"undefined"!==typeof this&&(this.ES6Promise=ga)}).call(m);m&&m.ES6Promise.polyfill();if("undefined"===typeof r||"function"!==typeof Object.create||"function"!==typeof r.createElement("canvas").getContext)(m||module.exports).html2canvas=function(){return Promise.reject("No canvas support")};else{(function(a){function b(a){throw RangeError(v[a]);}function c(a,b){for(var c=a.length,
d=[];c--;)d[c]=b(a[c]);return d}function d(a,b){var d=a.split("@"),e="";1<d.length&&(e=d[0]+"@",a=d[1]);d=a.split(u);d=c(d,b).join(".");return e+d}function e(a){for(var b=[],c=0,d=a.length,e,f;c<d;)e=a.charCodeAt(c++),55296<=e&&56319>=e&&c<d?(f=a.charCodeAt(c++),56320==(f&64512)?b.push(((e&1023)<<10)+(f&1023)+65536):(b.push(e),c--)):b.push(e);return b}function f(a){return c(a,function(a){var b="";65535<a&&(a-=65536,b+=x(a>>>10&1023|55296),a=56320|a&1023);return b+=x(a)}).join("")}function g(a,b){return a+
22+75*(26>a)-((0!=b)<<5)}function h(a,b,c){var d=0;a=c?z(a/700):a>>1;for(a+=z(a/b);455<a;d+=36)a=z(a/35);return z(d+36*a/(a+38))}function k(a){var c=[],d=a.length,e,g=0,k=128,l=72,m,n,q,p,r;m=a.lastIndexOf("-");0>m&&(m=0);for(n=0;n<m;++n)128<=a.charCodeAt(n)&&b("not-basic"),c.push(a.charCodeAt(n));for(m=0<m?m+1:0;m<d;){n=g;e=1;for(q=36;;q+=36){m>=d&&b("invalid-input");p=a.charCodeAt(m++);p=10>p-48?p-22:26>p-65?p-65:26>p-97?p-97:36;(36<=p||p>z((2147483647-g)/e))&&b("overflow");g+=p*e;r=q<=l?1:q>=l+
26?26:q-l;if(p<r)break;p=36-r;e>z(2147483647/p)&&b("overflow");e*=p}e=c.length+1;l=h(g-n,e,0==n);z(g/e)>2147483647-k&&b("overflow");k+=z(g/e);g%=e;c.splice(g++,0,k)}return f(c)}function l(a){var c,d,f,k,p,m,n,q,r,t=[],u,v,w;a=e(a);u=a.length;c=128;d=0;p=72;for(m=0;m<u;++m)r=a[m],128>r&&t.push(x(r));for((f=k=t.length)&&t.push("-");f<u;){n=2147483647;for(m=0;m<u;++m)r=a[m],r>=c&&r<n&&(n=r);v=f+1;n-c>z((2147483647-d)/v)&&b("overflow");d+=(n-c)*v;c=n;for(m=0;m<u;++m)if(r=a[m],r<c&&2147483647<++d&&b("overflow"),
r==c){q=d;for(n=36;;n+=36){r=n<=p?1:n>=p+26?26:n-p;if(q<r)break;w=q-r;q=36-r;t.push(x(g(r+w%q,0)));q=z(w/q)}t.push(x(g(q,0)));p=h(d,v,f==k);d=0;++f}++d;++c}return t.join("")}var m="object"==typeof R&&R&&!R.nodeType&&R,q="object"==typeof module&&module&&!module.nodeType&&module,n="object"==typeof S&&S;if(n.global===n||n.window===n||n.self===n)a=n;var p,r=/^xn--/,t=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)",
"invalid-input":"Invalid input"},z=Math.floor,x=String.fromCharCode,y;p={version:"1.3.1",ucs2:{decode:e,encode:f},decode:k,encode:l,toASCII:function(a){return d(a,function(a){return t.test(a)?"xn--"+l(a):a})},toUnicode:function(a){return d(a,function(a){return r.test(a)?k(a.slice(4).toLowerCase()):a})}};if("function"==typeof E&&"object"==typeof E.amd&&E.amd)E("punycode",function(){return p});else if(m&&q)if(module.exports==m)q.exports=p;else for(y in p)p.hasOwnProperty(y)&&(m[y]=p[y]);else a.punycode=
p})(this);var Ra=0,ob=0;m.html2canvas=function(a,b){var c=ob++;b=b||{};b.logging&&(m.html2canvas.logging=!0,m.html2canvas.start=Date.now());b.async="undefined"===typeof b.async?!0:b.async;b.allowTaint="undefined"===typeof b.allowTaint?!1:b.allowTaint;b.removeContainer="undefined"===typeof b.removeContainer?!0:b.removeContainer;b.javascriptEnabled="undefined"===typeof b.javascriptEnabled?!1:b.javascriptEnabled;b.imageTimeout="undefined"===typeof b.imageTimeout?1E4:b.imageTimeout;b.renderer="function"===
typeof b.renderer?b.renderer:p;b.strict=!!b.strict;if("string"===typeof a){if("string"!==typeof b.proxy)return Promise.reject("Proxy must be used when rendering url");var d=null!=b.width?b.width:m.innerWidth,e=null!=b.height?b.height:m.innerHeight;return oa(Ta(a),b.proxy,r,d,e,b).then(function(a){return ia(a.contentWindow.document.documentElement,a,b,d,e)})}var f=(a===L?[r.documentElement]:a.length?a:[a])[0];f.setAttribute("data-html2canvas-node"+c,c);return Ka(f.ownerDocument,b,f.ownerDocument.defaultView.innerWidth,
f.ownerDocument.defaultView.innerHeight,c).then(function(a){"function"===typeof b.onrendered&&(q("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas"),b.onrendered(a));return a})};m.html2canvas.punycode=this.punycode;m.html2canvas.proxy={};t.prototype.darken=function(a){a=1-a;return new t([Math.round(this.r*a),Math.round(this.g*a),Math.round(this.b*a),this.a])};t.prototype.isTransparent=function(){return 0===this.a};t.prototype.isBlack=function(){return 0===this.r&&
0===this.g&&0===this.b};t.prototype.fromArray=function(a){Array.isArray(a)&&(this.r=Math.min(a[0],255),this.g=Math.min(a[1],255),this.b=Math.min(a[2],255),3<a.length&&(this.a=a[3]));return Array.isArray(a)};var pb=/^#([a-f0-9]{3})$/i;t.prototype.hex3=function(a){null!==(a=a.match(pb))&&(this.r=parseInt(a[1][0]+a[1][0],16),this.g=parseInt(a[1][1]+a[1][1],16),this.b=parseInt(a[1][2]+a[1][2],16));return null!==a};var qb=/^#([a-f0-9]{6})$/i;t.prototype.hex6=function(a){null!==(a=a.match(qb))&&(this.r=
parseInt(a[1].substring(0,2),16),this.g=parseInt(a[1].substring(2,4),16),this.b=parseInt(a[1].substring(4,6),16));return null!==a};var rb=/^rgb\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3})\)$/;t.prototype.rgb=function(a){null!==(a=a.match(rb))&&(this.r=Number(a[1]),this.g=Number(a[2]),this.b=Number(a[3]));return null!==a};var sb=/^rgba\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3}) *, *(\d+\.?\d*)\)$/;t.prototype.rgba=function(a){null!==(a=a.match(sb))&&(this.r=Number(a[1]),this.g=Number(a[2]),this.b=Number(a[3]),
this.a=Number(a[4]));return null!==a};t.prototype.toString=function(){return null!==this.a&&1!==this.a?"rgba("+[this.r,this.g,this.b,this.a].join()+")":"rgb("+[this.r,this.g,this.b].join()+")"};t.prototype.namedColor=function(a){var b=tb[a.toLowerCase()];if(b)this.r=b[0],this.g=b[1],this.b=b[2];else if("transparent"===a.toLowerCase())return this.r=this.g=this.b=this.a=0,!0;return!!b};t.prototype.isColor=!0;var tb={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,
255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],
darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],
fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,
250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,
179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,
239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,
255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};pa.prototype.getMetrics=function(a,b){this.data[a+"-"+b]===L&&(this.data[a+"-"+b]=new Ua(a,b));return this.data[a+"-"+b]};qa.prototype.proxyLoad=function(a,b,c){var d=this.src;return oa(d.src,a,d.ownerDocument,b.width,b.height,c)};N.prototype.TYPES=
{LINEAR:1,RADIAL:2};u.prototype.findImages=function(a){var b=[];a.reduce(function(a,b){switch(b.node.nodeName){case "IMG":return a.concat([{args:[b.node.src],method:"url"}]);case "svg":case "IFRAME":return a.concat([{args:[b.node],method:b.node.nodeName}])}return a},[]).forEach(this.addImage(b,this.loadImage),this);return b};u.prototype.findBackgroundImage=function(a,b){b.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(a,this.loadImage),this);return a};u.prototype.addImage=
function(a,b){return function(c){c.args.forEach(function(d){this.imageExists(a,d)||(a.splice(0,0,b.call(this,c)),q("Added image #"+a.length,"string"===typeof d?d.substring(0,100):d))},this)}};u.prototype.hasImageBackground=function(a){return"none"!==a.method};u.prototype.loadImage=function(a){return"url"===a.method?(a=a.args[0],!this.isSVG(a)||this.support.svg||this.options.allowTaint?a.match(/data:image\/.*;base64,/i)?new ba(a.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,""),!1):this.isSameOrigin(a)||!0===
this.options.allowTaint||this.isSVG(a)?new ba(a,!1):this.support.cors&&!this.options.allowTaint&&this.options.useCORS?new ba(a,!0):this.options.proxy?new kb(a,this.options.proxy):new M(a):new A(a)):"linear-gradient"===a.method?new V(a):"gradient"===a.method?new Fa(a):"svg"===a.method?new Ea(a.args[0],this.support.svg):"IFRAME"===a.method?new qa(a.args[0],this.isSameOrigin(a.args[0].src),this.options):new M(a)};u.prototype.isSVG=function(a){return"svg"===a.substring(a.length-3).toLowerCase()||A.prototype.isInline(a)};
u.prototype.imageExists=function(a,b){return a.some(function(a){return a.src===b})};u.prototype.isSameOrigin=function(a){return this.getOrigin(a)===this.origin};u.prototype.getOrigin=function(a){var b=this.link||(this.link=r.createElement("a"));b.href=a;b.href=b.href;return b.protocol+b.hostname+b.port};u.prototype.getPromise=function(a){return this.timeout(a,this.options.imageTimeout)["catch"](function(){return(new M(a.src)).promise.then(function(b){a.image=b})})};u.prototype.get=function(a){var b=
null;return this.images.some(function(c){return(b=c).src===a})?b:null};u.prototype.fetch=function(a){this.images=a.reduce(X(this.findBackgroundImage,this),this.findImages(a));this.images.forEach(function(a,c){a.promise.then(function(){q("Succesfully loaded image #"+(c+1),a)},function(d){q("Failed loading image #"+(c+1),a,d)})});this.ready=Promise.all(this.images.map(this.getPromise,this));q("Finished searching images");return this};u.prototype.timeout=function(a,b){var c,d=Promise.race([a.promise,
new Promise(function(d,f){c=setTimeout(function(){q("Timed out loading image",a);f(a)},b)})]).then(function(a){clearTimeout(c);return a});d["catch"](function(){clearTimeout(c)});return d};V.prototype=Object.create(N.prototype);V.prototype.stepRegExp=/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/;l.prototype.cloneTo=function(a){a.visible=this.visible;a.borders=this.borders;a.bounds=this.bounds;a.clip=this.clip;a.backgroundClip=this.backgroundClip;a.computedStyles=
this.computedStyles;a.styles=this.styles;a.backgroundImages=this.backgroundImages;a.opacity=this.opacity};l.prototype.getOpacity=function(){return null===this.opacity?this.opacity=this.cssFloat("opacity"):this.opacity};l.prototype.assignStack=function(a){this.stack=a;a.children.push(this)};l.prototype.isElementVisible=function(){return this.node.nodeType===Node.TEXT_NODE?this.parent.visible:"none"!==this.css("display")&&"hidden"!==this.css("visibility")&&!this.node.hasAttribute("data-html2canvas-ignore")&&
("INPUT"!==this.node.nodeName||"hidden"!==this.node.getAttribute("type"))};l.prototype.css=function(a){this.computedStyles||(this.computedStyles=this.isPseudoElement?this.parent.computedStyle(this.before?":before":":after"):this.computedStyle(null));return this.styles[a]||(this.styles[a]=this.computedStyles[a])};l.prototype.prefixedCss=function(a){var b=["webkit","moz","ms","o"],c=this.css(a);c===L&&b.some(function(b){c=this.css(b+a.substr(0,1).toUpperCase()+a.substr(1));return c!==L},this);return c===
L?null:c};l.prototype.computedStyle=function(a){return this.node.ownerDocument.defaultView.getComputedStyle(this.node,a)};l.prototype.cssInt=function(a){a=parseInt(this.css(a),10);return isNaN(a)?0:a};l.prototype.color=function(a){return this.colors[a]||(this.colors[a]=new t(this.css(a)))};l.prototype.cssFloat=function(a){a=parseFloat(this.css(a));return isNaN(a)?0:a};l.prototype.fontWeight=function(){var a=this.css("fontWeight");switch(parseInt(a,10)){case 401:a="bold";break;case 400:a="normal"}return a};
l.prototype.parseClip=function(){var a=this.css("clip").match(this.CLIP);return a?{top:parseInt(a[1],10),right:parseInt(a[2],10),bottom:parseInt(a[3],10),left:parseInt(a[4],10)}:null};l.prototype.parseBackgroundImages=function(){return this.backgroundImages||(this.backgroundImages=ra(this.css("backgroundImage")))};l.prototype.cssList=function(a,b){var c=(this.css(a)||"").split(","),c=c[b||0]||c[0]||"auto",c=c.trim().split(" ");1===c.length&&(c=[c[0],c[0]]);return c};l.prototype.parseBackgroundSize=
function(a,b,c){c=this.cssList("backgroundSize",c);var d;if(W(c[0]))d=a.width*parseFloat(c[0])/100;else{if(/contain|cover/.test(c[0]))return b=b.width/b.height,a.width/a.height<b^"contain"===c[0]?{width:a.height*b,height:a.height}:{width:a.width,height:a.width/b};d=parseInt(c[0],10)}a="auto"===c[0]&&"auto"===c[1]?b.height:"auto"===c[1]?d/b.width*b.height:W(c[1])?a.height*parseFloat(c[1])/100:parseInt(c[1],10);"auto"===c[0]&&(d=a/b.height*b.width);return{width:d,height:a}};l.prototype.parseBackgroundPosition=
function(a,b,c,d){c=this.cssList("backgroundPosition",c);var e;e=W(c[0])?(a.width-(d||b).width)*(parseFloat(c[0])/100):parseInt(c[0],10);a="auto"===c[1]?e/b.width*b.height:W(c[1])?(a.height-(d||b).height)*parseFloat(c[1])/100:parseInt(c[1],10);"auto"===c[0]&&(e=a/b.height*b.width);return{left:e,top:a}};l.prototype.parseBackgroundRepeat=function(a){return this.cssList("backgroundRepeat",a)[0]};l.prototype.parseTextShadows=function(){var a=this.css("textShadow"),b=[];if(a&&"none"!==a)for(var a=a.match(this.TEXT_SHADOW_PROPERTY),
c=0;a&&c<a.length;c++){var d=a[c].match(this.TEXT_SHADOW_VALUES);b.push({color:new t(d[0]),offsetX:d[1]?parseFloat(d[1].replace("px","")):0,offsetY:d[2]?parseFloat(d[2].replace("px","")):0,blur:d[3]?d[3].replace("px",""):0})}return b};l.prototype.parseTransform=function(){if(!this.transformData)if(this.hasTransform()){var a=this.parseBounds(),b=this.prefixedCss("transformOrigin").split(" ").map(Wa).map(Xa);b[0]+=a.left;b[1]+=a.top;this.transformData={origin:b,matrix:this.parseTransformMatrix()}}else this.transformData=
{origin:[0,0],matrix:[1,0,0,1,0,0]};return this.transformData};l.prototype.parseTransformMatrix=function(){if(!this.transformMatrix){var a=this.prefixedCss("transform");this.transformMatrix=(a=a?Va(a.match(this.MATRIX_PROPERTY)):null)?a:[1,0,0,1,0,0]}return this.transformMatrix};l.prototype.parseBounds=function(){return this.bounds||(this.bounds=this.hasTransform()?ca(this.node):U(this.node))};l.prototype.hasTransform=function(){return"1,0,0,1,0,0"!==this.parseTransformMatrix().join(",")||this.parent&&
this.parent.hasTransform()};l.prototype.getValue=function(){var a=this.node.value||"";"SELECT"===this.node.tagName?(a=this.node,a=(a=a.options[a.selectedIndex||0])?a.text||"":""):"password"===this.node.type&&(a=Array(a.length+1).join("\u2022"));return 0===a.length?this.node.placeholder||"":a};l.prototype.MATRIX_PROPERTY=/(matrix)\((.+)\)/;l.prototype.TEXT_SHADOW_PROPERTY=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g;l.prototype.TEXT_SHADOW_VALUES=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;l.prototype.CLIP=
/^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/;n.prototype.calculateOverflowClips=function(){this.nodes.forEach(function(a){if(O(a)){!0===a.isPseudoElement&&a.appendToDOM();a.borders=this.parseBorders(a);var b="hidden"===a.css("overflow")?[a.borders.clip]:[],c=a.parseClip();c&&-1!==["absolute","fixed"].indexOf(a.css("position"))&&b.push([["rect",a.bounds.left+c.left,a.bounds.top+c.top,c.right-c.left,c.bottom-c.top]]);a.clip=a.parent&&a.parent.clip.length?a.parent.clip.concat(b):b;a.backgroundClip=
"hidden"!==a.css("overflow")?a.clip.concat([a.borders.clip]):a.clip;!0===a.isPseudoElement&&a.cleanDOM()}else ea(a)&&(a.clip=a.parent&&a.parent.clip.length?a.parent.clip:[]);!0!==a.isPseudoElement&&(a.bounds=null)},this)};n.prototype.asyncRenderer=function(a,b,c){c=c||Date.now();this.paint(a[this.renderIndex++]);a.length===this.renderIndex?b():c+20>Date.now()?this.asyncRenderer(a,b,c):setTimeout(X(function(){this.asyncRenderer(a,b)},this),0)};n.prototype.createPseudoHideStyles=function(a){this.createStyles(a,
"."+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+':before { content: "" !important; display: none !important; }.'+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER+':after { content: "" !important; display: none !important; }')};n.prototype.disableAnimations=function(a){this.createStyles(a,"* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; -webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}")};
n.prototype.createStyles=function(a,b){var c=a.createElement("style");c.innerHTML=b;a.body.appendChild(c)};n.prototype.getPseudoElements=function(a){var b=[[a]];if(a.node.nodeType===Node.ELEMENT_NODE){var c=this.getPseudoElement(a,":before");a=this.getPseudoElement(a,":after");c&&b.push(c);a&&b.push(a)}return[].concat.apply([],b)};n.prototype.getPseudoElement=function(a,b){var c=a.computedStyle(b);if(!c||!c.content||"none"===c.content||"-moz-alt-content"===c.content||"none"===c.display)return null;
var d,e=c.content,f=e.substr(0,1);d=f===e.substr(e.length-1)&&f.match(/'|"/)?e.substr(1,e.length-2):e;for(var g="url"===d.substr(0,3),e=r.createElement(g?"img":"html2canvaspseudoelement"),f=new v(e,a,b),h=c.length-1;0<=h;h--){var k=Ya(c.item(h));e.style[k]=c[k]}e.className=v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+" "+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER;if(g)return e.src=ra(d)[0].args[0],[f];c=r.createTextNode(d);e.appendChild(c);return[f,new I(c,f)]};n.prototype.getChildren=function(a){return[].concat.apply([],
[].filter.call(a.node.childNodes,db).map(function(b){var c=[b.nodeType===Node.TEXT_NODE?new I(b,a):new l(b,a)].filter(gb);return b.nodeType===Node.ELEMENT_NODE&&c.length&&"TEXTAREA"!==b.tagName?c[0].isElementVisible()?c.concat(this.getChildren(c[0])):[]:c},this))};n.prototype.newStackingContext=function(a,b){var c=new G(b,a.getOpacity(),a.node,a.parent);a.cloneTo(c);(b?c.getParentStack(this):c.parent.stack).contexts.push(c);a.stack=c};n.prototype.createStackingContexts=function(){this.nodes.forEach(function(a){var b;
if(b=O(a))(b=this.isRootElement(a)||1>a.getOpacity())||(b=a.css("position"),b="auto"!==(-1!==["absolute","relative","fixed"].indexOf(b)?a.css("zIndex"):"auto")),b=b||this.isBodyWithTransparentRoot(a)||a.hasTransform();b?this.newStackingContext(a,!0):O(a)&&(P(a)&&va(a)||-1!==["inline-block","inline-table"].indexOf(a.css("display"))||da(a))?this.newStackingContext(a,!1):a.assignStack(a.parent.stack)},this)};n.prototype.isBodyWithTransparentRoot=function(a){return"BODY"===a.node.nodeName&&a.parent.color("backgroundColor").isTransparent()};
n.prototype.isRootElement=function(a){return null===a.parent};n.prototype.sortStackingContexts=function(a){a.contexts.sort(eb(a.contexts.slice(0)));a.contexts.forEach(this.sortStackingContexts,this)};n.prototype.parseTextBounds=function(a){return function(b,c,d){if("none"!==a.parent.css("textDecoration").substr(0,4)||0!==b.trim().length){if(this.support.rangeBounds&&!a.parent.hasTransform())return c=d.slice(0,c).join("").length,this.getRangeBounds(a.node,c,b.length);if(a.node&&"string"===typeof a.node.data)return b=
a.node.splitText(b.length),c=this.getWrapperBounds(a.node,a.parent.hasTransform()),a.node=b,c}else if(!this.support.rangeBounds||a.parent.hasTransform())a.node=a.node.splitText(b.length);return{}}};n.prototype.getWrapperBounds=function(a,b){var c=a.ownerDocument.createElement("html2canvaswrapper"),d=a.parentNode,e=a.cloneNode(!0);c.appendChild(a.cloneNode(!0));d.replaceChild(c,a);var f=b?ca(c):U(c);d.replaceChild(e,c);return f};n.prototype.getRangeBounds=function(a,b,c){var d=this.range||(this.range=
a.ownerDocument.createRange());d.setStart(a,b);d.setEnd(a,b+c);return d.getBoundingClientRect()};n.prototype.parse=function(a){var b=a.contexts.filter(Za),c=a.children.filter(O),d=c.filter(Q(da)),e=d.filter(Q(P)).filter(Q(wa)),c=c.filter(Q(P)).filter(da),f=d.filter(Q(P)).filter(wa),d=a.contexts.concat(d.filter(P)).filter(va),g=a.children.filter(ea).filter(ab);a=a.contexts.filter($a);b.concat(e).concat(c).concat(f).concat(d).concat(g).concat(a).forEach(function(a){this.renderQueue.push(a);a instanceof
G&&(this.parse(a),this.renderQueue.push(new sa))},this)};n.prototype.paint=function(a){try{a instanceof sa?this.renderer.ctx.restore():ea(a)?(!0===a.parent.isPseudoElement&&a.parent.appendToDOM(),this.paintText(a),!0===a.parent.isPseudoElement&&a.parent.cleanDOM()):this.paintNode(a)}catch(b){if(q(b),this.options.strict)throw b;}};n.prototype.paintNode=function(a){a instanceof G&&(this.renderer.setOpacity(a.opacity),this.renderer.ctx.save(),a.hasTransform()&&this.renderer.setTransform(a.parseTransform()));
"INPUT"===a.node.nodeName&&"checkbox"===a.node.type?this.paintCheckbox(a):"INPUT"===a.node.nodeName&&"radio"===a.node.type?this.paintRadio(a):this.paintElement(a)};n.prototype.paintElement=function(a){var b=a.parseBounds();this.renderer.clip(a.backgroundClip,function(){this.renderer.renderBackground(a,b,a.borders.borders.map(fb))},this);this.renderer.clip(a.clip,function(){this.renderer.renderBorders(a.borders.borders)},this);this.renderer.clip(a.backgroundClip,function(){switch(a.node.nodeName){case "svg":case "IFRAME":var c=
this.images.get(a.node);c?this.renderer.renderImage(a,b,a.borders,c):q("Error loading <"+a.node.nodeName+">",a.node);break;case "IMG":(c=this.images.get(a.node.src))?this.renderer.renderImage(a,b,a.borders,c):q("Error loading <img>",a.node.src);break;case "CANVAS":this.renderer.renderImage(a,b,a.borders,{image:a.node});break;case "SELECT":case "INPUT":case "TEXTAREA":this.paintFormValue(a)}},this)};n.prototype.paintCheckbox=function(a){var b=a.parseBounds(),c=Math.min(b.width,b.height),d={width:c-
1,height:c-1,top:b.top,left:b.left},b=[3,3],e=[b,b,b,b],f=[1,1,1,1].map(function(a){return{color:new t("#A5A5A5"),width:a}}),g=ua(d,e,f);this.renderer.clip(a.backgroundClip,function(){this.renderer.rectangle(d.left+1,d.top+1,d.width-2,d.height-2,new t("#DEDEDE"));this.renderer.renderBorders(ta(f,d,g,e));a.node.checked&&(this.renderer.font(new t("#424242"),"normal","normal","bold",c-3+"px","arial"),this.renderer.text("\u2714",d.left+c/6,d.top+c-1))},this)};n.prototype.paintRadio=function(a){var b=
a.parseBounds(),c=Math.min(b.width,b.height)-2;this.renderer.clip(a.backgroundClip,function(){this.renderer.circleStroke(b.left+1,b.top+1,c,new t("#DEDEDE"),1,new t("#A5A5A5"));a.node.checked&&this.renderer.circle(Math.ceil(b.left+c/4)+1,Math.ceil(b.top+c/4)+1,Math.floor(c/2),new t("#424242"))},this)};n.prototype.paintFormValue=function(a){var b=a.getValue();if(0<b.length){var c=a.node.ownerDocument,d=c.createElement("html2canvaswrapper");"lineHeight textAlign fontFamily fontWeight fontSize color paddingLeft paddingTop paddingRight paddingBottom width height borderLeftStyle borderTopStyle borderLeftWidth borderTopWidth boxSizing whiteSpace wordWrap".split(" ").forEach(function(b){try{d.style[b]=
a.css(b)}catch(c){q("html2canvas: Parse: Exception caught in renderFormValue: "+c.message)}});var e=a.parseBounds();d.style.position="fixed";d.style.left=e.left+"px";d.style.top=e.top+"px";d.textContent=b;c.body.appendChild(d);this.paintText(new I(d.firstChild,a));c.body.removeChild(d)}};n.prototype.paintText=function(a){a.applyTextTransform();var b=m.html2canvas.punycode.ucs2.decode(a.node.data),c=this.options.letterRendering&&!/^(normal|none|0px)$/.test(a.parent.css("letterSpacing"))||/[^\u0000-\u00ff]/.test(a.node.data)?
b.map(function(a){return m.html2canvas.punycode.ucs2.encode([a])}):hb(b),b=a.parent.fontWeight(),d=a.parent.css("fontSize"),e=a.parent.css("fontFamily"),f=a.parent.parseTextShadows();this.renderer.font(a.parent.color("color"),a.parent.css("fontStyle"),a.parent.css("fontVariant"),b,d,e);f.length?this.renderer.fontShadow(f[0].color,f[0].offsetX,f[0].offsetY,f[0].blur):this.renderer.clearShadow();this.renderer.clip(a.parent.clip,function(){c.map(this.parseTextBounds(a),this).forEach(function(b,f){b&&
(this.renderer.text(c[f],b.left,b.bottom),this.renderTextDecoration(a.parent,b,this.fontMetrics.getMetrics(e,d)))},this)},this)};n.prototype.renderTextDecoration=function(a,b,c){switch(a.css("textDecoration").split(" ")[0]){case "underline":this.renderer.rectangle(b.left,Math.round(b.top+c.baseline+c.lineWidth),b.width,1,a.color("color"));break;case "overline":this.renderer.rectangle(b.left,Math.round(b.top),b.width,1,a.color("color"));break;case "line-through":this.renderer.rectangle(b.left,Math.ceil(b.top+
c.middle+c.lineWidth),b.width,1,a.color("color"))}};var Ja={inset:[["darken",.6],["darken",.1],["darken",.1],["darken",.6]]};n.prototype.parseBorders=function(a){var b=a.parseBounds(),c=bb(a),d=["Top","Right","Bottom","Left"].map(function(b,c){var d=a.css("border"+b+"Style"),e=a.color("border"+b+"Color");"inset"===d&&e.isBlack()&&(e=new t([255,255,255,e.a]));d=Ja[d]?Ja[d][c]:null;return{width:a.cssInt("border"+b+"Width"),color:d?e[d[0]](d[1]):e,args:null}}),e=ua(b,c,d);return{clip:this.parseBackgroundClip(a,
e,d,c,b),borders:ta(d,b,e,c)}};n.prototype.parseBackgroundClip=function(a,b,c,d,e){var f=[];switch(a.css("backgroundClip")){case "content-box":case "padding-box":D(f,d[0],d[1],b.topLeftInner,b.topRightInner,e.left+c[3].width,e.top+c[0].width);D(f,d[1],d[2],b.topRightInner,b.bottomRightInner,e.left+e.width-c[1].width,e.top+c[0].width);D(f,d[2],d[3],b.bottomRightInner,b.bottomLeftInner,e.left+e.width-c[1].width,e.top+e.height-c[2].width);D(f,d[3],d[0],b.bottomLeftInner,b.topLeftInner,e.left+c[3].width,
e.top+e.height-c[2].width);break;default:D(f,d[0],d[1],b.topLeftOuter,b.topRightOuter,e.left,e.top),D(f,d[1],d[2],b.topRightOuter,b.bottomRightOuter,e.left+e.width,e.top),D(f,d[2],d[3],b.bottomRightOuter,b.bottomLeftOuter,e.left+e.width,e.top+e.height),D(f,d[3],d[0],b.bottomLeftOuter,b.topLeftOuter,e.left,e.top+e.height)}return f};var jb=0,ya="withCredentials"in new XMLHttpRequest,Da="crossOrigin"in new Image;v.prototype.cloneTo=function(a){v.prototype.cloneTo.call(this,a);a.isPseudoElement=!0;a.before=
this.before};v.prototype=Object.create(l.prototype);v.prototype.appendToDOM=function(){this.before?this.parent.node.insertBefore(this.node,this.parent.node.firstChild):this.parent.node.appendChild(this.node);this.parent.node.className+=" "+this.getHideClass()};v.prototype.cleanDOM=function(){this.node.parentNode.removeChild(this.node);this.parent.node.className=this.parent.node.className.replace(this.getHideClass(),"")};v.prototype.getHideClass=function(){return this["PSEUDO_HIDE_ELEMENT_CLASS_"+
(this.before?"BEFORE":"AFTER")]};v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE="___html2canvas___pseudoelement_before";v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER="___html2canvas___pseudoelement_after";x.prototype.renderImage=function(a,b,c,d){var e=a.cssInt("paddingLeft"),f=a.cssInt("paddingTop"),g=a.cssInt("paddingRight");a=a.cssInt("paddingBottom");c=c.borders;g=b.width-(c[1].width+c[3].width+e+g);a=b.height-(c[0].width+c[2].width+f+a);this.drawImage(d,0,0,d.image.width||g,d.image.height||a,b.left+
e+c[3].width,b.top+f+c[0].width,g,a)};x.prototype.renderBackground=function(a,b,c){0<b.height&&0<b.width&&(this.renderBackgroundColor(a,b),this.renderBackgroundImage(a,b,c))};x.prototype.renderBackgroundColor=function(a,b){var c=a.color("backgroundColor");c.isTransparent()||this.rectangle(b.left,b.top,b.width,b.height,c)};x.prototype.renderBorders=function(a){a.forEach(this.renderBorder,this)};x.prototype.renderBorder=function(a){a.color.isTransparent()||null===a.args||this.drawShape(a.args,a.color)};
x.prototype.renderBackgroundImage=function(a,b,c){a.parseBackgroundImages().reverse().forEach(function(d,e,f){switch(d.method){case "url":var g=this.images.get(d.args[0]);g?this.renderBackgroundRepeating(a,b,g,f.length-(e+1),c):q("Error loading background-image",d.args[0]);break;case "linear-gradient":case "gradient":(e=this.images.get(d.value))?this.renderBackgroundGradient(e,b,c):q("Error loading background-image",d.args[0]);break;case "none":break;default:q("Unknown background-image type",d.args[0])}},
this)};x.prototype.renderBackgroundRepeating=function(a,b,c,d,e){var f=a.parseBackgroundSize(b,c.image,d),g=a.parseBackgroundPosition(b,c.image,d,f);switch(a.parseBackgroundRepeat(d)){case "repeat-x":case "repeat no-repeat":this.backgroundRepeatShape(c,g,f,b,b.left+e[3],b.top+g.top+e[0],99999,f.height,e);break;case "repeat-y":case "no-repeat repeat":this.backgroundRepeatShape(c,g,f,b,b.left+g.left+e[3],b.top+e[0],f.width,99999,e);break;case "no-repeat":this.backgroundRepeatShape(c,g,f,b,b.left+g.left+
e[3],b.top+g.top+e[0],f.width,f.height,e);break;default:this.renderBackgroundRepeat(c,g,f,{top:b.top,left:b.left},e[3],e[0])}};G.prototype=Object.create(l.prototype);G.prototype.getParentStack=function(a){var b=this.parent?this.parent.stack:null;return b?b.ownStacking?b:b.getParentStack(a):a.stack};T.prototype.testRangeBounds=function(a){var b,c,d=!1;a.createRange&&(b=a.createRange(),b.getBoundingClientRect&&(c=a.createElement("boundtest"),c.style.height="123px",c.style.display="block",a.body.appendChild(c),
b.selectNode(c),b=b.getBoundingClientRect(),b=b.height,123===b&&(d=!0),a.body.removeChild(c)));return d};T.prototype.testCORS=function(){return"undefined"!==typeof(new Image).crossOrigin};T.prototype.testSVG=function(){var a=new Image,b=r.createElement("canvas"),c=b.getContext("2d");a.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{c.drawImage(a,0,0),b.toDataURL()}catch(d){return!1}return!0};A.prototype.hasFabric=function(){return html2canvas.fabric?Promise.resolve():Promise.reject(Error("html2canvas.svg.js is not loaded, cannot render svg"))};
A.prototype.inlineFormatting=function(a){return/^data:image\/svg\+xml;base64,/.test(a)?this.decode64(this.removeContentType(a)):this.removeContentType(a)};A.prototype.removeContentType=function(a){return a.replace(/^data:image\/svg\+xml(;base64)?,/,"")};A.prototype.isInline=function(a){return/^data:image\/svg\+xml/i.test(a)};A.prototype.createCanvas=function(a){var b=this;return function(c,d){var e=new html2canvas.fabric.StaticCanvas("c");b.image=e.lowerCanvasEl;e.setWidth(d.width).setHeight(d.height).add(html2canvas.fabric.util.groupSVGElements(c,
d)).renderAll();a(e.lowerCanvasEl)}};A.prototype.decode64=function(a){return"function"===typeof m.atob?m.atob(a):Ca(a)};Ea.prototype=Object.create(A.prototype);I.prototype=Object.create(l.prototype);I.prototype.applyTextTransform=function(){this.node.data=this.transform(this.parent.css("textTransform"))};I.prototype.transform=function(a){var b=this.node.data;switch(a){case "lowercase":return b.toLowerCase();case "capitalize":return b.replace(/(^|\s|:|-|\(|\))([a-z])/g,lb);case "uppercase":return b.toUpperCase();
default:return b}};Fa.prototype=Object.create(N.prototype);p.prototype=Object.create(x.prototype);p.prototype.setFillStyle=function(a){this.ctx.fillStyle="object"===typeof a&&a.isColor?a.toString():a;return this.ctx};p.prototype.rectangle=function(a,b,c,d,e){this.setFillStyle(e).fillRect(a,b,c,d)};p.prototype.circle=function(a,b,c,d){this.setFillStyle(d);this.ctx.beginPath();this.ctx.arc(a+c/2,b+c/2,c/2,0,2*Math.PI,!0);this.ctx.closePath();this.ctx.fill()};p.prototype.circleStroke=function(a,b,c,
d,e,f){this.circle(a,b,c,d);this.ctx.strokeStyle=f.toString();this.ctx.stroke()};p.prototype.drawShape=function(a,b){this.shape(a);this.setFillStyle(b).fill()};p.prototype.taints=function(a){if(null===a.tainted){this.taintCtx.drawImage(a.image,0,0);try{this.taintCtx.getImageData(0,0,1,1),a.tainted=!1}catch(b){this.taintCtx=r.createElement("canvas").getContext("2d"),a.tainted=!0}}return a.tainted};p.prototype.drawImage=function(a,b,c,d,e,f,g,h,k){this.taints(a)&&!this.options.allowTaint||this.ctx.drawImage(a.image,
b,c,d,e,f,g,h,k)};p.prototype.clip=function(a,b,c){this.ctx.save();a.filter(mb).forEach(function(a){this.shape(a).clip()},this);b.call(c);this.ctx.restore()};p.prototype.shape=function(a){this.ctx.beginPath();a.forEach(function(a,c){"rect"===a[0]?this.ctx.rect.apply(this.ctx,a.slice(1)):this.ctx[0===c?"moveTo":a[0]+"To"].apply(this.ctx,a.slice(1))},this);this.ctx.closePath();return this.ctx};p.prototype.font=function(a,b,c,d,e,f){this.setFillStyle(a).font=[b,c,d,e,f].join(" ").split(",")[0]};p.prototype.fontShadow=
function(a,b,c,d){this.setVariable("shadowColor",a.toString()).setVariable("shadowOffsetY",b).setVariable("shadowOffsetX",c).setVariable("shadowBlur",d)};p.prototype.clearShadow=function(){this.setVariable("shadowColor","rgba(0,0,0,0)")};p.prototype.setOpacity=function(a){this.ctx.globalAlpha=a};p.prototype.setTransform=function(a){this.ctx.translate(a.origin[0],a.origin[1]);this.ctx.transform.apply(this.ctx,a.matrix);this.ctx.translate(-a.origin[0],-a.origin[1])};p.prototype.setVariable=function(a,
b){this.variables[a]!==b&&(this.variables[a]=this.ctx[a]=b);return this};p.prototype.text=function(a,b,c){this.ctx.fillText(a,b,c)};p.prototype.backgroundRepeatShape=function(a,b,c,d,e,f,g,h,k){this.clip([[["line",Math.round(e),Math.round(f)],["line",Math.round(e+g),Math.round(f)],["line",Math.round(e+g),Math.round(h+f)],["line",Math.round(e),Math.round(h+f)]]],function(){this.renderBackgroundRepeat(a,b,c,d,k[3],k[0])},this)};p.prototype.renderBackgroundRepeat=function(a,b,c,d,e,f){e=Math.round(d.left+
b.left+e);b=Math.round(d.top+b.top+f);this.setFillStyle(this.ctx.createPattern(this.resizeImage(a,c),"repeat"));this.ctx.translate(e,b);this.ctx.fill();this.ctx.translate(-e,-b)};p.prototype.renderBackgroundGradient=function(a,b){if(a instanceof V){var c=this.ctx.createLinearGradient(b.left+b.width*a.x0,b.top+b.height*a.y0,b.left+b.width*a.x1,b.top+b.height*a.y1);a.colorStops.forEach(function(a){c.addColorStop(a.stop,a.color.toString())});this.rectangle(b.left,b.top,b.width,b.height,c)}};p.prototype.resizeImage=
function(a,b){var c=a.image;if(c.width===b.width&&c.height===b.height)return c;var d=r.createElement("canvas");d.width=b.width;d.height=b.height;d.getContext("2d").drawImage(c,0,0,c.width,c.height,0,0,b.width,b.height);return d}}}).call({},"undefined"!==typeof window?window:void 0,"undefined"!==typeof document?document:void 0);

/*
 Use it if you like it
*/
(function(A){function E(K){this.ok=!1;"#"==K.charAt(0)&&(K=K.substr(1,6));K=K.replace(/ /g,"");K=K.toLowerCase();var A={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",
darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",
gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",
lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",
oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",
slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},O;for(O in A)K==O&&(K=A[O]);var L=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(u){return[parseInt(u[1]),parseInt(u[2]),parseInt(u[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,
example:["#00ff00","336699"],process:function(u){return[parseInt(u[1],16),parseInt(u[2],16),parseInt(u[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(u){return[parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16),parseInt(u[3]+u[3],16)]}}];for(O=0;O<L.length;O++){var W=L[O].process,M=L[O].re.exec(K);M&&(channels=W(M),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=0>this.r||isNaN(this.r)?0:255<this.r?255:this.r;this.g=0>this.g||isNaN(this.g)?0:
255<this.g?255:this.g;this.b=0>this.b||isNaN(this.b)?0:255<this.b?255:this.b;this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var u=this.r.toString(16),B=this.g.toString(16),p=this.b.toString(16);1==u.length&&(u="0"+u);1==B.length&&(B="0"+B);1==p.length&&(p="0"+p);return"#"+u+B+p};this.getHelpXML=function(){for(var u=[],B=0;B<L.length;B++)for(var p=L[B].example,C=0;C<p.length;C++)u[u.length]=p[C];for(var w in A)u[u.length]=w;p=document.createElement("ul");
p.setAttribute("id","rgbcolor-examples");for(B=0;B<u.length;B++)try{var h=document.createElement("li"),a=new E(u[B]),l=document.createElement("div");l.style.cssText="margin: 3px; border: 1px solid black; background:"+a.toHex()+"; color:"+a.toHex();l.appendChild(document.createTextNode("test"));var c=document.createTextNode(" "+u[B]+" -> "+a.toRGB()+" -> "+a.toHex());h.appendChild(l);h.appendChild(c);p.appendChild(h)}catch(b){}return p}}"undefined"!==typeof define&&define.amd?define(function(){return E}):
"undefined"!==typeof module&&module.exports&&(module.exports=E);A.RGBColor=E})("undefined"!==typeof window?window:this);
(function(A){function E(M,u,B,p,C,w){if(!(isNaN(w)||1>w)){w|=0;M=document.getElementById(M).getContext("2d");var h;try{try{h=M.getImageData(u,B,p,C)}catch(A){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),h=M.getImageData(u,B,p,C)}catch(K){throw alert("Cannot access local image"),Error("unable to access local image data: "+K);}}}catch(A){throw alert("Cannot access image"),Error("unable to access image data: "+A);}for(var a=h.data,l=h.width*h.height*4,c=0;c<l;c+=4){var b=
a[c+3]/255;a[c]*=b;a[c+1]*=b;a[c+2]*=b}var a=h.data,e,d,k,f,g,n,m,v,z,H,q,F,r,G,D,N,P,S,y,I,J,t,E;e=w+w+1;var R=p-1,l=C-1,c=w+1,b=c*(c+1)/2,Q=new X,x=Q;for(k=1;k<e;k++)if(x=x.next=new X,k==c)var T=x;x.next=Q;n=g=0;var U=O[w],V=L[w];for(d=0;d<C;d++){D=N=P=S=m=v=z=H=0;q=c*(y=a[g]);F=c*(I=a[g+1]);r=c*(J=a[g+2]);G=c*(t=a[g+3]);m+=b*y;v+=b*I;z+=b*J;H+=b*t;x=Q;for(k=0;k<c;k++)x.r=y,x.g=I,x.b=J,x.a=t,x=x.next;for(k=1;k<c;k++)f=g+((R<k?R:k)<<2),m+=(x.r=y=a[f])*(E=c-k),v+=(x.g=I=a[f+1])*E,z+=(x.b=J=a[f+2])*
E,H+=(x.a=t=a[f+3])*E,D+=y,N+=I,P+=J,S+=t,x=x.next;k=Q;x=T;for(e=0;e<p;e++)a[g]=m*U>>V,a[g+1]=v*U>>V,a[g+2]=z*U>>V,a[g+3]=H*U>>V,m-=q,v-=F,z-=r,H-=G,q-=k.r,F-=k.g,r-=k.b,G-=k.a,f=n+((f=e+w+1)<R?f:R)<<2,D+=k.r=a[f],N+=k.g=a[f+1],P+=k.b=a[f+2],S+=k.a=a[f+3],m+=D,v+=N,z+=P,H+=S,k=k.next,q+=y=x.r,F+=I=x.g,r+=J=x.b,G+=t=x.a,D-=y,N-=I,P-=J,S-=t,x=x.next,g+=4;n+=p}for(e=0;e<p;e++){N=P=S=D=v=z=H=m=0;g=e<<2;q=c*(y=a[g]);F=c*(I=a[g+1]);r=c*(J=a[g+2]);G=c*(t=a[g+3]);m+=b*y;v+=b*I;z+=b*J;H+=b*t;x=Q;for(k=0;k<
c;k++)x.r=y,x.g=I,x.b=J,x.a=t,x=x.next;f=p;for(k=1;k<=w;k++)g=f+e<<2,m+=(x.r=y=a[g])*(E=c-k),v+=(x.g=I=a[g+1])*E,z+=(x.b=J=a[g+2])*E,H+=(x.a=t=a[g+3])*E,D+=y,N+=I,P+=J,S+=t,x=x.next,k<l&&(f+=p);g=e;k=Q;x=T;for(d=0;d<C;d++)f=g<<2,a[f]=m*U>>V,a[f+1]=v*U>>V,a[f+2]=z*U>>V,a[f+3]=H*U>>V,m-=q,v-=F,z-=r,H-=G,q-=k.r,F-=k.g,r-=k.b,G-=k.a,f=e+((f=d+c)<l?f:l)*p<<2,m+=D+=k.r=a[f],v+=N+=k.g=a[f+1],z+=P+=k.b=a[f+2],H+=S+=k.a=a[f+3],k=k.next,q+=y=x.r,F+=I=x.g,r+=J=x.b,G+=t=x.a,D-=y,N-=I,P-=J,S-=t,x=x.next,g+=p}p=
h.data;C=h.width*h.height*4;for(w=0;w<C;w+=4)T=p[w+3],0!=T&&(T=255/T,p[w]*=T,p[w+1]*=T,p[w+2]*=T);M.putImageData(h,u,B)}}function K(M,u,B,p,C,w){if(!(isNaN(w)||1>w)){w|=0;M=document.getElementById(M).getContext("2d");var h;try{try{h=M.getImageData(u,B,p,C)}catch(x){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),h=M.getImageData(u,B,p,C)}catch(E){throw alert("Cannot access local image"),Error("unable to access local image data: "+E);}}}catch(x){throw alert("Cannot access image"),
Error("unable to access image data: "+x);}var a=h.data,l,c,b,e,d,k,f,g,n,m,v,z,H,q,F,r,G,D,N;l=w+w+1;var P=p-1,A=C-1,y=w+1,I=y*(y+1)/2,J=new X,t=J;for(b=1;b<l;b++)if(t=t.next=new X,b==y)var K=t;t.next=J;k=d=0;var R=O[w],Q=L[w];for(c=0;c<C;c++){H=q=F=f=g=n=0;m=y*(r=a[d]);v=y*(G=a[d+1]);z=y*(D=a[d+2]);f+=I*r;g+=I*G;n+=I*D;t=J;for(b=0;b<y;b++)t.r=r,t.g=G,t.b=D,t=t.next;for(b=1;b<y;b++)e=d+((P<b?P:b)<<2),f+=(t.r=r=a[e])*(N=y-b),g+=(t.g=G=a[e+1])*N,n+=(t.b=D=a[e+2])*N,H+=r,q+=G,F+=D,t=t.next;b=J;t=K;for(l=
0;l<p;l++)a[d]=f*R>>Q,a[d+1]=g*R>>Q,a[d+2]=n*R>>Q,f-=m,g-=v,n-=z,m-=b.r,v-=b.g,z-=b.b,e=k+((e=l+w+1)<P?e:P)<<2,H+=b.r=a[e],q+=b.g=a[e+1],F+=b.b=a[e+2],f+=H,g+=q,n+=F,b=b.next,m+=r=t.r,v+=G=t.g,z+=D=t.b,H-=r,q-=G,F-=D,t=t.next,d+=4;k+=p}for(l=0;l<p;l++){q=F=H=g=n=f=0;d=l<<2;m=y*(r=a[d]);v=y*(G=a[d+1]);z=y*(D=a[d+2]);f+=I*r;g+=I*G;n+=I*D;t=J;for(b=0;b<y;b++)t.r=r,t.g=G,t.b=D,t=t.next;e=p;for(b=1;b<=w;b++)d=e+l<<2,f+=(t.r=r=a[d])*(N=y-b),g+=(t.g=G=a[d+1])*N,n+=(t.b=D=a[d+2])*N,H+=r,q+=G,F+=D,t=t.next,
b<A&&(e+=p);d=l;b=J;t=K;for(c=0;c<C;c++)e=d<<2,a[e]=f*R>>Q,a[e+1]=g*R>>Q,a[e+2]=n*R>>Q,f-=m,g-=v,n-=z,m-=b.r,v-=b.g,z-=b.b,e=l+((e=c+y)<A?e:A)*p<<2,f+=H+=b.r=a[e],g+=q+=b.g=a[e+1],n+=F+=b.b=a[e+2],b=b.next,m+=r=t.r,v+=G=t.g,z+=D=t.b,H-=r,q-=G,F-=D,t=t.next,d+=p}M.putImageData(h,u,B)}}function X(){this.a=this.b=this.g=this.r=0;this.next=null}var O=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,
345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,
309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],L=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,
20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,
24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],W={image:function(A,u,B,p){A=document.getElementById(A);var C=A.naturalWidth,w=A.naturalHeight,h=document.getElementById(u);h.style.width=C+"px";h.style.height=w+"px";h.width=C;h.height=w;h=h.getContext("2d");h.clearRect(0,0,C,w);h.drawImage(A,0,0);isNaN(B)||1>B||(p?E(u,0,0,C,w,B):K(u,0,0,C,w,B))},canvasRGBA:E,canvasRGB:K};"undefined"!==typeof define&&define.amd?define(function(){return W}):
"undefined"!==typeof module&&module.exports&&(module.exports=W);A.stackBlur=W})("undefined"!==typeof window?window:this);
(function(A,E){A.canvg=E(A.RGBColor,A.stackBlur)})("undefined"!==typeof window?window:this,function(A,E){function K(h){var a=[0,0,0],l=function(c,b){var e=h.match(c);null!=e&&(a[b]+=e.length,h=h.replace(c," "))};h=h.replace(/:not\(([^\)]*)\)/g,"     $1 ");h=h.replace(/{[\s\S]*/gm," ");l(W,1);l(M,0);l(u,1);l(B,2);l(p,1);l(C,1);h=h.replace(/[\*\s\+>~]/g," ");h=h.replace(/[#\.]/g," ");l(w,2);return a.join("")}function X(h){var a={opts:h,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3E4,log:function(a){}};1==a.opts.log&&
"undefined"!=typeof console&&(a.log=function(a){console.log(a)});a.init=function(c){var b=0;a.UniqueId=function(){b++;return"canvg"+b};a.Definitions={};a.Styles={};a.StylesSpecificity={};a.Animations=[];a.Images=[];a.ctx=c;a.ViewPort=new function(){this.viewPorts=[];this.Clear=function(){this.viewPorts=[]};this.SetCurrent=function(a,b){this.viewPorts.push({width:a,height:b})};this.RemoveCurrent=function(){this.viewPorts.pop()};this.Current=function(){return this.viewPorts[this.viewPorts.length-1]};
this.width=function(){return this.Current().width};this.height=function(){return this.Current().height};this.ComputeSize=function(a){return null!=a&&"number"==typeof a?a:"x"==a?this.width():"y"==a?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}};a.init();a.ImagesLoaded=function(){for(var c=0;c<a.Images.length;c++)if(!a.Images[c].loaded)return!1;return!0};a.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};a.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm,
" ")};a.ajax=function(a){var b;b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("GET",a,!1);b.send(null);return b.responseText};a.parseXml=function(a){if("undefined"!=typeof Windows&&"undefined"!=typeof Windows.Data&&"undefined"!=typeof Windows.Data.Xml){var b=new Windows.Data.Xml.Dom.XmlDocument,e=new Windows.Data.Xml.Dom.XmlLoadSettings;e.prohibitDtd=!1;b.loadXml(a,e);return b}if(window.DOMParser)return(new DOMParser).parseFromString(a,"text/xml");a=a.replace(/<!DOCTYPE svg[^>]*>/,
"");b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);return b};a.Property=function(a,b){this.name=a;this.value=b};a.Property.prototype.getValue=function(){return this.value};a.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value};a.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var a=parseFloat(this.value);(this.value+"").match(/%$/)&&(a/=100);return a};a.Property.prototype.valueOrDefault=function(a){return this.hasValue()?this.value:
a};a.Property.prototype.numValueOrDefault=function(a){return this.hasValue()?this.numValue():a};a.Property.prototype.addOpacity=function(c){var b=this.value;if(null!=c.value&&""!=c.value&&"string"==typeof this.value){var e=new A(this.value);e.ok&&(b="rgba("+e.r+", "+e.g+", "+e.b+", "+c.numValue()+")")}return new a.Property(this.name,b)};a.Property.prototype.getDefinition=function(){var c=this.value.match(/#([^\)'"]+)/);c&&(c=c[1]);c||(c=this.value);return a.Definitions[c]};a.Property.prototype.isUrlDefinition=
function(){return 0==this.value.indexOf("url(")};a.Property.prototype.getFillStyleDefinition=function(c,b){var e=this.getDefinition();if(null!=e&&e.createGradient)return e.createGradient(a.ctx,c,b);if(null!=e&&e.createPattern){if(e.getHrefAttribute().hasValue()){var d=e.attribute("patternTransform"),e=e.getHrefAttribute().getDefinition();d.hasValue()&&(e.attribute("patternTransform",!0).value=d.value)}return e.createPattern(a.ctx,c)}return null};a.Property.prototype.getDPI=function(a){return 96};
a.Property.prototype.getEM=function(c){var b=12,e=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);e.hasValue()&&(b=e.toPixels(c));return b};a.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")};a.Property.prototype.toPixels=function(c,b){if(!this.hasValue())return 0;var e=this.value+"";if(e.match(/em$/))return this.numValue()*this.getEM(c);if(e.match(/ex$/))return this.numValue()*this.getEM(c)/2;if(e.match(/px$/))return this.numValue();if(e.match(/pt$/))return this.numValue()*
this.getDPI(c)*(1/72);if(e.match(/pc$/))return 15*this.numValue();if(e.match(/cm$/))return this.numValue()*this.getDPI(c)/2.54;if(e.match(/mm$/))return this.numValue()*this.getDPI(c)/25.4;if(e.match(/in$/))return this.numValue()*this.getDPI(c);if(e.match(/%$/))return this.numValue()*a.ViewPort.ComputeSize(c);e=this.numValue();return b&&1>e?e*a.ViewPort.ComputeSize(c):e};a.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var a=this.value+"";if(a.match(/s$/))return 1E3*this.numValue();
a.match(/ms$/);return this.numValue()};a.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/deg$/)?this.numValue()*(Math.PI/180):a.match(/grad$/)?this.numValue()*(Math.PI/200):a.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var l={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",
mathematical:"alphabetic"};a.Property.prototype.toTextBaseline=function(){return this.hasValue()?l[this.value]:null};a.Font=new function(){this.Styles="normal|italic|oblique|inherit";this.Variants="normal|small-caps|inherit";this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";this.CreateFont=function(b,e,d,c,f,g){g=null!=g?this.Parse(g):this.CreateFont("","","","","",a.ctx.font);return{fontFamily:f||g.fontFamily,fontSize:c||g.fontSize,fontStyle:b||g.fontStyle,fontWeight:d||
g.fontWeight,fontVariant:e||g.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var c=this;this.Parse=function(b){var e={};b=a.trim(a.compressSpaces(b||"")).split(" ");for(var d=!1,k=!1,f=!1,g=!1,n="",m=0;m<b.length;m++)k||-1==c.Styles.indexOf(b[m])?g||-1==c.Variants.indexOf(b[m])?f||-1==c.Weights.indexOf(b[m])?d?"inherit"!=b[m]&&(n+=b[m]):("inherit"!=b[m]&&(e.fontSize=b[m].split("/")[0]),k=g=f=d=!0):("inherit"!=b[m]&&
(e.fontWeight=b[m]),k=g=f=!0):("inherit"!=b[m]&&(e.fontVariant=b[m]),k=g=!0):("inherit"!=b[m]&&(e.fontStyle=b[m]),k=!0);""!=n&&(e.fontFamily=n);return e}};a.ToNumberArray=function(c){c=a.trim(a.compressSpaces((c||"").replace(/,/g," "))).split(" ");for(var b=0;b<c.length;b++)c[b]=parseFloat(c[b]);return c};a.Point=function(a,b){this.x=a;this.y=b};a.Point.prototype.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)};a.Point.prototype.applyTransform=function(a){var b=this.x*a[1]+this.y*a[3]+
a[5];this.x=this.x*a[0]+this.y*a[2]+a[4];this.y=b};a.CreatePoint=function(c){c=a.ToNumberArray(c);return new a.Point(c[0],c[1])};a.CreatePath=function(c){c=a.ToNumberArray(c);for(var b=[],e=0;e<c.length;e+=2)b.push(new a.Point(c[e],c[e+1]));return b};a.BoundingBox=function(a,b,e,d){this.y2=this.x2=this.y1=this.x1=Number.NaN;this.x=function(){return this.x1};this.y=function(){return this.y1};this.width=function(){return this.x2-this.x1};this.height=function(){return this.y2-this.y1};this.addPoint=
function(a,b){if(null!=a){if(isNaN(this.x1)||isNaN(this.x2))this.x2=this.x1=a;a<this.x1&&(this.x1=a);a>this.x2&&(this.x2=a)}if(null!=b){if(isNaN(this.y1)||isNaN(this.y2))this.y2=this.y1=b;b<this.y1&&(this.y1=b);b>this.y2&&(this.y2=b)}};this.addX=function(a){this.addPoint(a,null)};this.addY=function(a){this.addPoint(null,a)};this.addBoundingBox=function(a){this.addPoint(a.x1,a.y1);this.addPoint(a.x2,a.y2)};this.addQuadraticCurve=function(a,b,e,d,c,v){e=a+2/3*(e-a);d=b+2/3*(d-b);this.addBezierCurve(a,
b,e,e+1/3*(c-a),d,d+1/3*(v-b),c,v)};this.addBezierCurve=function(a,b,e,d,c,v,z,h){var q=[a,b],F=[e,d],r=[c,v],l=[z,h];this.addPoint(q[0],q[1]);this.addPoint(l[0],l[1]);for(i=0;1>=i;i++)a=function(a){return Math.pow(1-a,3)*q[i]+3*Math.pow(1-a,2)*a*F[i]+3*(1-a)*Math.pow(a,2)*r[i]+Math.pow(a,3)*l[i]},b=6*q[i]-12*F[i]+6*r[i],e=-3*q[i]+9*F[i]-9*r[i]+3*l[i],d=3*F[i]-3*q[i],0==e?0!=b&&(b=-d/b,0<b&&1>b&&(0==i&&this.addX(a(b)),1==i&&this.addY(a(b)))):(d=Math.pow(b,2)-4*d*e,0>d||(c=(-b+Math.sqrt(d))/(2*e),
0<c&&1>c&&(0==i&&this.addX(a(c)),1==i&&this.addY(a(c))),b=(-b-Math.sqrt(d))/(2*e),0<b&&1>b&&(0==i&&this.addX(a(b)),1==i&&this.addY(a(b)))))};this.isPointInBox=function(a,b){return this.x1<=a&&a<=this.x2&&this.y1<=b&&b<=this.y2};this.addPoint(a,b);this.addPoint(e,d)};a.Transform=function(c){var b=this;this.Type={};this.Type.translate=function(b){this.p=a.CreatePoint(b);this.apply=function(a){a.translate(this.p.x||0,this.p.y||0)};this.unapply=function(a){a.translate(-1*this.p.x||0,-1*this.p.y||0)};
this.applyToPoint=function(a){a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}};this.Type.rotate=function(b){b=a.ToNumberArray(b);this.angle=new a.Property("angle",b[0]);this.cx=b[1]||0;this.cy=b[2]||0;this.apply=function(a){a.translate(this.cx,this.cy);a.rotate(this.angle.toRadians());a.translate(-this.cx,-this.cy)};this.unapply=function(a){a.translate(this.cx,this.cy);a.rotate(-1*this.angle.toRadians());a.translate(-this.cx,-this.cy)};this.applyToPoint=function(a){var b=this.angle.toRadians();
a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]);a.applyTransform([Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0]);a.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}};this.Type.scale=function(b){this.p=a.CreatePoint(b);this.apply=function(a){a.scale(this.p.x||1,this.p.y||this.p.x||1)};this.unapply=function(a){a.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)};this.applyToPoint=function(a){a.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}};this.Type.matrix=function(b){this.m=a.ToNumberArray(b);
this.apply=function(a){a.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])};this.unapply=function(a){var b=this.m[0],e=this.m[2],d=this.m[4],c=this.m[1],f=this.m[3],g=this.m[5],k=1/(b*(1*f-0*g)-e*(1*c-0*g)+d*(0*c-0*f));a.transform(k*(1*f-0*g),k*(0*g-1*c),k*(0*d-1*e),k*(1*b-0*d),k*(e*g-d*f),k*(d*c-b*g))};this.applyToPoint=function(a){a.applyTransform(this.m)}};this.Type.SkewBase=function(e){this.base=b.Type.matrix;this.base(e);this.angle=new a.Property("angle",e)};this.Type.SkewBase.prototype=
new this.Type.matrix;this.Type.skewX=function(a){this.base=b.Type.SkewBase;this.base(a);this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]};this.Type.skewX.prototype=new this.Type.SkewBase;this.Type.skewY=function(a){this.base=b.Type.SkewBase;this.base(a);this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]};this.Type.skewY.prototype=new this.Type.SkewBase;this.transforms=[];this.apply=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].apply(a)};this.unapply=function(a){for(var b=
this.transforms.length-1;0<=b;b--)this.transforms[b].unapply(a)};this.applyToPoint=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].applyToPoint(a)};c=a.trim(a.compressSpaces(c)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/);for(var e=0;e<c.length;e++){var d=a.trim(c[e].split("(")[0]),k=c[e].split("(")[1].replace(")",""),f=this.Type[d];"undefined"!=typeof f&&(k=new f(k),k.type=d,this.transforms.push(k))}};a.AspectRatio=function(c,b,e,d,k,
f,g,n,m,v){b=a.compressSpaces(b);b=b.replace(/^defer\s/,"");var z=b.split(" ")[0]||"xMidYMid";b=b.split(" ")[1]||"meet";var h=e/d,q=k/f,l=Math.min(h,q),r=Math.max(h,q);"meet"==b&&(d*=l,f*=l);"slice"==b&&(d*=r,f*=r);m=new a.Property("refX",m);v=new a.Property("refY",v);m.hasValue()&&v.hasValue()?c.translate(-l*m.toPixels("x"),-l*v.toPixels("y")):(z.match(/^xMid/)&&("meet"==b&&l==q||"slice"==b&&r==q)&&c.translate(e/2-d/2,0),z.match(/YMid$/)&&("meet"==b&&l==h||"slice"==b&&r==h)&&c.translate(0,k/2-f/
2),z.match(/^xMax/)&&("meet"==b&&l==q||"slice"==b&&r==q)&&c.translate(e-d,0),z.match(/YMax$/)&&("meet"==b&&l==h||"slice"==b&&r==h)&&c.translate(0,k-f));"none"==z?c.scale(h,q):"meet"==b?c.scale(l,l):"slice"==b&&c.scale(r,r);c.translate(null==g?0:-g,null==n?0:-n)};a.Element={};a.EmptyProperty=new a.Property("EMPTY","");a.Element.ElementBase=function(c){this.attributes={};this.styles={};this.stylesSpecificity={};this.children=[];this.attribute=function(b,e){var d=this.attributes[b];if(null!=d)return d;
1==e&&(d=new a.Property(b,""),this.attributes[b]=d);return d||a.EmptyProperty};this.getHrefAttribute=function(){for(var b in this.attributes)if("href"==b||b.match(/:href$/))return this.attributes[b];return a.EmptyProperty};this.style=function(b,e,d){var c=this.styles[b];if(null!=c)return c;var f=this.attribute(b);if(null!=f&&f.hasValue())return this.styles[b]=f;if(1!=d&&(d=this.parent,null!=d&&(d=d.style(b),null!=d&&d.hasValue())))return d;1==e&&(c=new a.Property(b,""),this.styles[b]=c);return c||
a.EmptyProperty};this.render=function(a){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){a.save();if(this.style("mask").hasValue()){var b=this.style("mask").getDefinition();null!=b&&b.apply(a,this)}else this.style("filter").hasValue()?(b=this.style("filter").getDefinition(),null!=b&&b.apply(a,this)):(this.setContext(a),this.renderChildren(a),this.clearContext(a));a.restore()}};this.setContext=function(a){};this.clearContext=function(a){};this.renderChildren=function(a){for(var b=
0;b<this.children.length;b++)this.children[b].render(a)};this.addChild=function(b,e){var d=b;e&&(d=a.CreateElement(b));d.parent=this;"title"!=d.type&&this.children.push(d)};this.addStylesFromStyleDefinition=function(){for(var b in a.Styles)if("@"!=b[0]&&L(c,b)){var e=a.Styles[b],d=a.StylesSpecificity[b];if(null!=e)for(var f in e){var k=this.stylesSpecificity[f];"undefined"==typeof k&&(k="000");d>k&&(this.styles[f]=e[f],this.stylesSpecificity[f]=d)}}};var b=/^[A-Z-]+$/,e=function(a){return b.test(a)?
a.toLowerCase():a};if(null!=c&&1==c.nodeType){for(var d=0;d<c.attributes.length;d++){var k=c.attributes[d],f=e(k.nodeName);this.attributes[f]=new a.Property(f,k.value)}this.addStylesFromStyleDefinition();if(this.attribute("style").hasValue())for(e=this.attribute("style").value.split(";"),d=0;d<e.length;d++)""!=a.trim(e[d])&&(f=e[d].split(":"),k=a.trim(f[0]),f=a.trim(f[1]),this.styles[k]=new a.Property(k,f));this.attribute("id").hasValue()&&null==a.Definitions[this.attribute("id").value]&&(a.Definitions[this.attribute("id").value]=
this);for(d=0;d<c.childNodes.length;d++)e=c.childNodes[d],1==e.nodeType&&this.addChild(e,!0),!this.captureTextNodes||3!=e.nodeType&&4!=e.nodeType||""!=a.compressSpaces(e.value||e.text||e.textContent||"")&&this.addChild(new a.Element.tspan(e),!1)}};a.Element.RenderedElementBase=function(c){this.base=a.Element.ElementBase;this.base(c);this.setContext=function(b){if(this.style("fill").isUrlDefinition()){var e=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=e&&(b.fillStyle=
e)}else this.style("fill").hasValue()&&(e=this.style("fill"),"currentColor"==e.value&&(e.value=this.style("color").value),"inherit"!=e.value&&(b.fillStyle="none"==e.value?"rgba(0,0,0,0)":e.value));this.style("fill-opacity").hasValue()&&(e=new a.Property("fill",b.fillStyle),e=e.addOpacity(this.style("fill-opacity")),b.fillStyle=e.value);this.style("stroke").isUrlDefinition()?(e=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")),null!=e&&(b.strokeStyle=e)):this.style("stroke").hasValue()&&
(e=this.style("stroke"),"currentColor"==e.value&&(e.value=this.style("color").value),"inherit"!=e.value&&(b.strokeStyle="none"==e.value?"rgba(0,0,0,0)":e.value));this.style("stroke-opacity").hasValue()&&(e=new a.Property("stroke",b.strokeStyle),e=e.addOpacity(this.style("stroke-opacity")),b.strokeStyle=e.value);this.style("stroke-width").hasValue()&&(e=this.style("stroke-width").toPixels(),b.lineWidth=0==e?.001:e);this.style("stroke-linecap").hasValue()&&(b.lineCap=this.style("stroke-linecap").value);
this.style("stroke-linejoin").hasValue()&&(b.lineJoin=this.style("stroke-linejoin").value);this.style("stroke-miterlimit").hasValue()&&(b.miterLimit=this.style("stroke-miterlimit").value);this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value&&(e=a.ToNumberArray(this.style("stroke-dasharray").value),"undefined"!=typeof b.setLineDash?b.setLineDash(e):"undefined"!=typeof b.webkitLineDash?b.webkitLineDash=e:"undefined"==typeof b.mozDash||1==e.length&&0==e[0]||(b.mozDash=
e),e=this.style("stroke-dashoffset").numValueOrDefault(1),"undefined"!=typeof b.lineDashOffset?b.lineDashOffset=e:"undefined"!=typeof b.webkitLineDashOffset?b.webkitLineDashOffset=e:"undefined"!=typeof b.mozDashOffset&&(b.mozDashOffset=e));"undefined"!=typeof b.font&&(b.font=a.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString());
this.style("transform",!1,!0).hasValue()&&(new a.Transform(this.style("transform",!1,!0).value)).apply(b);this.style("clip-path",!1,!0).hasValue()&&(e=this.style("clip-path",!1,!0).getDefinition(),null!=e&&e.apply(b));this.style("opacity").hasValue()&&(b.globalAlpha=this.style("opacity").numValue())}};a.Element.RenderedElementBase.prototype=new a.Element.ElementBase;a.Element.PathElementBase=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.path=function(b){null!=b&&b.beginPath();
return new a.BoundingBox};this.renderChildren=function(b){this.path(b);a.Mouse.checkPath(this,b);""!=b.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?b.fill(this.style("fill-rule").value):b.fill());""!=b.strokeStyle&&b.stroke();var e=this.getMarkers();if(null!=e){if(this.style("marker-start").isUrlDefinition()){var d=this.style("marker-start").getDefinition();d.render(b,e[0][0],e[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var d=this.style("marker-mid").getDefinition(),
c=1;c<e.length-1;c++)d.render(b,e[c][0],e[c][1]);this.style("marker-end").isUrlDefinition()&&(d=this.style("marker-end").getDefinition(),d.render(b,e[e.length-1][0],e[e.length-1][1]))}};this.getBoundingBox=function(){return this.path()};this.getMarkers=function(){return null}};a.Element.PathElementBase.prototype=new a.Element.RenderedElementBase;a.Element.svg=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.baseClearContext=this.clearContext;this.clearContext=function(b){this.baseClearContext(b);
a.ViewPort.RemoveCurrent()};this.baseSetContext=this.setContext;this.setContext=function(b){b.strokeStyle="rgba(0,0,0,0)";b.lineCap="butt";b.lineJoin="miter";b.miterLimit=4;"undefined"!=typeof b.font&&"undefined"!=typeof window.getComputedStyle&&(b.font=window.getComputedStyle(b.canvas).getPropertyValue("font"));this.baseSetContext(b);this.attribute("x").hasValue()||(this.attribute("x",!0).value=0);this.attribute("y").hasValue()||(this.attribute("y",!0).value=0);b.translate(this.attribute("x").toPixels("x"),
this.attribute("y").toPixels("y"));var e=a.ViewPort.width(),d=a.ViewPort.height();this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%");this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%");if("undefined"==typeof this.root){var e=this.attribute("width").toPixels("x"),d=this.attribute("height").toPixels("y"),c=0,f=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(c=-this.attribute("refX").toPixels("x"),f=-this.attribute("refY").toPixels("y"));
"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(b.beginPath(),b.moveTo(c,f),b.lineTo(e,f),b.lineTo(e,d),b.lineTo(c,d),b.closePath(),b.clip())}a.ViewPort.SetCurrent(e,d);if(this.attribute("viewBox").hasValue()){var c=a.ToNumberArray(this.attribute("viewBox").value),f=c[0],g=c[1],e=c[2],d=c[3];a.AspectRatio(b,this.attribute("preserveAspectRatio").value,a.ViewPort.width(),e,a.ViewPort.height(),d,f,g,this.attribute("refX").value,this.attribute("refY").value);a.ViewPort.RemoveCurrent();
a.ViewPort.SetCurrent(c[2],c[3])}}};a.Element.svg.prototype=new a.Element.RenderedElementBase;a.Element.rect=function(c){this.base=a.Element.PathElementBase;this.base(c);this.path=function(b){var e=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),c=this.attribute("width").toPixels("x"),f=this.attribute("height").toPixels("y"),g=this.attribute("rx").toPixels("x"),n=this.attribute("ry").toPixels("y");this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(n=g);this.attribute("ry").hasValue()&&
!this.attribute("rx").hasValue()&&(g=n);g=Math.min(g,c/2);n=Math.min(n,f/2);null!=b&&(b.beginPath(),b.moveTo(e+g,d),b.lineTo(e+c-g,d),b.quadraticCurveTo(e+c,d,e+c,d+n),b.lineTo(e+c,d+f-n),b.quadraticCurveTo(e+c,d+f,e+c-g,d+f),b.lineTo(e+g,d+f),b.quadraticCurveTo(e,d+f,e,d+f-n),b.lineTo(e,d+n),b.quadraticCurveTo(e,d,e+g,d),b.closePath());return new a.BoundingBox(e,d,e+c,d+f)}};a.Element.rect.prototype=new a.Element.PathElementBase;a.Element.circle=function(c){this.base=a.Element.PathElementBase;this.base(c);
this.path=function(b){var e=this.attribute("cx").toPixels("x"),d=this.attribute("cy").toPixels("y"),c=this.attribute("r").toPixels();null!=b&&(b.beginPath(),b.arc(e,d,c,0,2*Math.PI,!0),b.closePath());return new a.BoundingBox(e-c,d-c,e+c,d+c)}};a.Element.circle.prototype=new a.Element.PathElementBase;a.Element.ellipse=function(c){this.base=a.Element.PathElementBase;this.base(c);this.path=function(b){var e=(Math.sqrt(2)-1)/3*4,d=this.attribute("rx").toPixels("x"),c=this.attribute("ry").toPixels("y"),
f=this.attribute("cx").toPixels("x"),g=this.attribute("cy").toPixels("y");null!=b&&(b.beginPath(),b.moveTo(f,g-c),b.bezierCurveTo(f+e*d,g-c,f+d,g-e*c,f+d,g),b.bezierCurveTo(f+d,g+e*c,f+e*d,g+c,f,g+c),b.bezierCurveTo(f-e*d,g+c,f-d,g+e*c,f-d,g),b.bezierCurveTo(f-d,g-e*c,f-e*d,g-c,f,g-c),b.closePath());return new a.BoundingBox(f-d,g-c,f+d,g+c)}};a.Element.ellipse.prototype=new a.Element.PathElementBase;a.Element.line=function(c){this.base=a.Element.PathElementBase;this.base(c);this.getPoints=function(){return[new a.Point(this.attribute("x1").toPixels("x"),
this.attribute("y1").toPixels("y")),new a.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]};this.path=function(b){var e=this.getPoints();null!=b&&(b.beginPath(),b.moveTo(e[0].x,e[0].y),b.lineTo(e[1].x,e[1].y));return new a.BoundingBox(e[0].x,e[0].y,e[1].x,e[1].y)};this.getMarkers=function(){var a=this.getPoints(),e=a[0].angleTo(a[1]);return[[a[0],e],[a[1],e]]}};a.Element.line.prototype=new a.Element.PathElementBase;a.Element.polyline=function(c){this.base=a.Element.PathElementBase;
this.base(c);this.points=a.CreatePath(this.attribute("points").value);this.path=function(b){var e=new a.BoundingBox(this.points[0].x,this.points[0].y);null!=b&&(b.beginPath(),b.moveTo(this.points[0].x,this.points[0].y));for(var d=1;d<this.points.length;d++)e.addPoint(this.points[d].x,this.points[d].y),null!=b&&b.lineTo(this.points[d].x,this.points[d].y);return e};this.getMarkers=function(){for(var a=[],e=0;e<this.points.length-1;e++)a.push([this.points[e],this.points[e].angleTo(this.points[e+1])]);
0<a.length&&a.push([this.points[this.points.length-1],a[a.length-1][1]]);return a}};a.Element.polyline.prototype=new a.Element.PathElementBase;a.Element.polygon=function(c){this.base=a.Element.polyline;this.base(c);this.basePath=this.path;this.path=function(a){var e=this.basePath(a);null!=a&&(a.lineTo(this.points[0].x,this.points[0].y),a.closePath());return e}};a.Element.polygon.prototype=new a.Element.polyline;a.Element.path=function(c){this.base=a.Element.PathElementBase;this.base(c);c=this.attribute("d").value;
c=c.replace(/,/gm," ");for(var b=0;2>b;b++)c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");c=c.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");c=c.replace(/([0-9])([+\-])/gm,"$1 $2");for(b=0;2>b;b++)c=c.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");c=c.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");c=a.compressSpaces(c);c=a.trim(c);this.PathParser=new function(b){this.tokens=b.split(" ");this.reset=function(){this.i=-1;this.previousCommand=this.command="";this.start=new a.Point(0,
0);this.control=new a.Point(0,0);this.current=new a.Point(0,0);this.points=[];this.angles=[]};this.isEnd=function(){return this.i>=this.tokens.length-1};this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)};this.isRelativeCommand=function(){switch(this.command){case "m":case "l":case "h":case "v":case "c":case "s":case "q":case "t":case "a":case "z":return!0}return!1};this.getToken=function(){this.i++;return this.tokens[this.i]};this.getScalar=function(){return parseFloat(this.getToken())};
this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};this.getPoint=function(){var b=new a.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(b)};this.getAsControlPoint=function(){var a=this.getPoint();return this.control=a};this.getAsCurrentPoint=function(){var a=this.getPoint();return this.current=a};this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&
"t"!=this.previousCommand.toLowerCase()?this.current:new a.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)};this.makeAbsolute=function(a){this.isRelativeCommand()&&(a.x+=this.current.x,a.y+=this.current.y);return a};this.addMarker=function(a,b,e){null!=e&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(e));this.addMarkerAngle(a,null==b?null:b.angleTo(a))};this.addMarkerAngle=function(a,
b){this.points.push(a);this.angles.push(b)};this.getMarkerPoints=function(){return this.points};this.getMarkerAngles=function(){for(var a=0;a<this.angles.length;a++)if(null==this.angles[a])for(var b=a+1;b<this.angles.length;b++)if(null!=this.angles[b]){this.angles[a]=this.angles[b];break}return this.angles}}(c);this.path=function(b){var d=this.PathParser;d.reset();var c=new a.BoundingBox;for(null!=b&&b.beginPath();!d.isEnd();)switch(d.nextCommand(),d.command){case "M":case "m":var f=d.getAsCurrentPoint();
d.addMarker(f);c.addPoint(f.x,f.y);null!=b&&b.moveTo(f.x,f.y);for(d.start=d.current;!d.isCommandOrEnd();)f=d.getAsCurrentPoint(),d.addMarker(f,d.start),c.addPoint(f.x,f.y),null!=b&&b.lineTo(f.x,f.y);break;case "L":case "l":for(;!d.isCommandOrEnd();){var g=d.current,f=d.getAsCurrentPoint();d.addMarker(f,g);c.addPoint(f.x,f.y);null!=b&&b.lineTo(f.x,f.y)}break;case "H":case "h":for(;!d.isCommandOrEnd();)f=new a.Point((d.isRelativeCommand()?d.current.x:0)+d.getScalar(),d.current.y),d.addMarker(f,d.current),
d.current=f,c.addPoint(d.current.x,d.current.y),null!=b&&b.lineTo(d.current.x,d.current.y);break;case "V":case "v":for(;!d.isCommandOrEnd();)f=new a.Point(d.current.x,(d.isRelativeCommand()?d.current.y:0)+d.getScalar()),d.addMarker(f,d.current),d.current=f,c.addPoint(d.current.x,d.current.y),null!=b&&b.lineTo(d.current.x,d.current.y);break;case "C":case "c":for(;!d.isCommandOrEnd();){var n=d.current,g=d.getPoint(),m=d.getAsControlPoint(),f=d.getAsCurrentPoint();d.addMarker(f,m,g);c.addBezierCurve(n.x,
n.y,g.x,g.y,m.x,m.y,f.x,f.y);null!=b&&b.bezierCurveTo(g.x,g.y,m.x,m.y,f.x,f.y)}break;case "S":case "s":for(;!d.isCommandOrEnd();)n=d.current,g=d.getReflectedControlPoint(),m=d.getAsControlPoint(),f=d.getAsCurrentPoint(),d.addMarker(f,m,g),c.addBezierCurve(n.x,n.y,g.x,g.y,m.x,m.y,f.x,f.y),null!=b&&b.bezierCurveTo(g.x,g.y,m.x,m.y,f.x,f.y);break;case "Q":case "q":for(;!d.isCommandOrEnd();)n=d.current,m=d.getAsControlPoint(),f=d.getAsCurrentPoint(),d.addMarker(f,m,m),c.addQuadraticCurve(n.x,n.y,m.x,m.y,
f.x,f.y),null!=b&&b.quadraticCurveTo(m.x,m.y,f.x,f.y);break;case "T":case "t":for(;!d.isCommandOrEnd();)n=d.current,m=d.getReflectedControlPoint(),d.control=m,f=d.getAsCurrentPoint(),d.addMarker(f,m,m),c.addQuadraticCurve(n.x,n.y,m.x,m.y,f.x,f.y),null!=b&&b.quadraticCurveTo(m.x,m.y,f.x,f.y);break;case "A":case "a":for(;!d.isCommandOrEnd();){var n=d.current,v=d.getScalar(),h=d.getScalar(),g=d.getScalar()*(Math.PI/180),l=d.getScalar(),m=d.getScalar(),f=d.getAsCurrentPoint(),q=new a.Point(Math.cos(g)*
(n.x-f.x)/2+Math.sin(g)*(n.y-f.y)/2,-Math.sin(g)*(n.x-f.x)/2+Math.cos(g)*(n.y-f.y)/2),p=Math.pow(q.x,2)/Math.pow(v,2)+Math.pow(q.y,2)/Math.pow(h,2);1<p&&(v*=Math.sqrt(p),h*=Math.sqrt(p));l=(l==m?-1:1)*Math.sqrt((Math.pow(v,2)*Math.pow(h,2)-Math.pow(v,2)*Math.pow(q.y,2)-Math.pow(h,2)*Math.pow(q.x,2))/(Math.pow(v,2)*Math.pow(q.y,2)+Math.pow(h,2)*Math.pow(q.x,2)));isNaN(l)&&(l=0);var r=new a.Point(l*v*q.y/h,l*-h*q.x/v),n=new a.Point((n.x+f.x)/2+Math.cos(g)*r.x-Math.sin(g)*r.y,(n.y+f.y)/2+Math.sin(g)*
r.x+Math.cos(g)*r.y),u=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))*Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)))},w=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(u(a,b))},l=w([1,0],[(q.x-r.x)/v,(q.y-r.y)/h]),p=[(q.x-r.x)/v,(q.y-r.y)/h],r=[(-q.x-r.x)/v,(-q.y-r.y)/h],q=w(p,r);-1>=u(p,r)&&(q=Math.PI);1<=u(p,r)&&(q=0);p=1-m?1:-1;r=l+q/2*p;w=new a.Point(n.x+v*Math.cos(r),n.y+h*Math.sin(r));d.addMarkerAngle(w,r-p*Math.PI/2);d.addMarkerAngle(f,r-p*Math.PI);
c.addPoint(f.x,f.y);null!=b&&(u=v>h?v:h,f=v>h?1:v/h,v=v>h?h/v:1,b.translate(n.x,n.y),b.rotate(g),b.scale(f,v),b.arc(0,0,u,l,l+q,1-m),b.scale(1/f,1/v),b.rotate(-g),b.translate(-n.x,-n.y))}break;case "Z":case "z":null!=b&&b.closePath(),d.current=d.start}return c};this.getMarkers=function(){for(var a=this.PathParser.getMarkerPoints(),b=this.PathParser.getMarkerAngles(),c=[],f=0;f<a.length;f++)c.push([a[f],b[f]]);return c}};a.Element.path.prototype=new a.Element.PathElementBase;a.Element.pattern=function(c){this.base=
a.Element.ElementBase;this.base(c);this.createPattern=function(b,e){var d=this.attribute("width").toPixels("x",!0),c=this.attribute("height").toPixels("y",!0),f=new a.Element.svg;f.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value);f.attributes.width=new a.Property("width",d+"px");f.attributes.height=new a.Property("height",c+"px");f.attributes.transform=new a.Property("transform",this.attribute("patternTransform").value);f.children=this.children;var g=document.createElement("canvas");
g.width=d;g.height=c;d=g.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&d.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(c=-1;1>=c;c++)for(var n=-1;1>=n;n++)d.save(),f.attributes.x=new a.Property("x",c*g.width),f.attributes.y=new a.Property("y",n*g.height),f.render(d),d.restore();return b.createPattern(g,"repeat")}};a.Element.pattern.prototype=new a.Element.ElementBase;a.Element.marker=function(c){this.base=a.Element.ElementBase;
this.base(c);this.baseRender=this.render;this.render=function(b,e,d){b.translate(e.x,e.y);"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(d);"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(b.lineWidth,b.lineWidth);b.save();var c=new a.Element.svg;c.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value);c.attributes.refX=new a.Property("refX",this.attribute("refX").value);c.attributes.refY=new a.Property("refY",this.attribute("refY").value);
c.attributes.width=new a.Property("width",this.attribute("markerWidth").value);c.attributes.height=new a.Property("height",this.attribute("markerHeight").value);c.attributes.fill=new a.Property("fill",this.attribute("fill").valueOrDefault("black"));c.attributes.stroke=new a.Property("stroke",this.attribute("stroke").valueOrDefault("none"));c.children=this.children;var f=0,g=0;this.attribute("refX").hasValue()&&(f=-parseFloat(this.attribute("refX").value));this.attribute("refY").hasValue()&&(g=-parseFloat(this.attribute("refY").value));
b.translate(f,g);c.render(b);b.restore();"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(1/b.lineWidth,1/b.lineWidth);"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(-d);b.translate(-e.x,-e.y)}};a.Element.marker.prototype=new a.Element.ElementBase;a.Element.defs=function(c){this.base=a.Element.ElementBase;this.base(c);this.render=function(a){}};a.Element.defs.prototype=new a.Element.ElementBase;a.Element.GradientBase=function(c){this.base=a.Element.ElementBase;
this.base(c);this.stops=[];for(c=0;c<this.children.length;c++){var b=this.children[c];"stop"==b.type&&this.stops.push(b)}this.getGradient=function(){};this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")};this.attributesToInherit=["gradientUnits"];this.inheritStopContainer=function(a){for(var b=0;b<this.attributesToInherit.length;b++){var c=this.attributesToInherit[b];!this.attribute(c).hasValue()&&a.attribute(c).hasValue()&&(this.attribute(c,!0).value=
a.attribute(c).value)}};this.createGradient=function(b,d,c){var f=this;this.getHrefAttribute().hasValue()&&(f=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(f));var g=function(b){return c.hasValue()?(new a.Property("color",b)).addOpacity(c).value:b};b=this.getGradient(b,d);if(null==b)return g(f.stops[f.stops.length-1].color);for(d=0;d<f.stops.length;d++)b.addColorStop(f.stops[d].offset,g(f.stops[d].color));return this.attribute("gradientTransform").hasValue()?(f=a.ViewPort.viewPorts[0],
g=new a.Element.rect,g.attributes.x=new a.Property("x",-a.MAX_VIRTUAL_PIXELS/3),g.attributes.y=new a.Property("y",-a.MAX_VIRTUAL_PIXELS/3),g.attributes.width=new a.Property("width",a.MAX_VIRTUAL_PIXELS),g.attributes.height=new a.Property("height",a.MAX_VIRTUAL_PIXELS),d=new a.Element.g,d.attributes.transform=new a.Property("transform",this.attribute("gradientTransform").value),d.children=[g],g=new a.Element.svg,g.attributes.x=new a.Property("x",0),g.attributes.y=new a.Property("y",0),g.attributes.width=
new a.Property("width",f.width),g.attributes.height=new a.Property("height",f.height),g.children=[d],d=document.createElement("canvas"),d.width=f.width,d.height=f.height,f=d.getContext("2d"),f.fillStyle=b,g.render(f),f.createPattern(d,"no-repeat")):b}};a.Element.GradientBase.prototype=new a.Element.ElementBase;a.Element.linearGradient=function(c){this.base=a.Element.GradientBase;this.base(c);this.attributesToInherit.push("x1");this.attributesToInherit.push("y1");this.attributesToInherit.push("x2");
this.attributesToInherit.push("y2");this.getGradient=function(a,e){var c="objectBoundingBox"==this.gradientUnits()?e.getBoundingBox():null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var k="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),
f="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),g="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),c="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return k==g&&f==c?null:a.createLinearGradient(k,f,g,c)}};a.Element.linearGradient.prototype=new a.Element.GradientBase;
a.Element.radialGradient=function(c){this.base=a.Element.GradientBase;this.base(c);this.attributesToInherit.push("cx");this.attributesToInherit.push("cy");this.attributesToInherit.push("r");this.attributesToInherit.push("fx");this.attributesToInherit.push("fy");this.getGradient=function(a,c){var d=c.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%");this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%");this.attribute("r").hasValue()||(this.attribute("r",
!0).value="50%");var k="objectBoundingBox"==this.gradientUnits()?d.x()+d.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),f="objectBoundingBox"==this.gradientUnits()?d.y()+d.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),g=k,n=f;this.attribute("fx").hasValue()&&(g="objectBoundingBox"==this.gradientUnits()?d.x()+d.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x"));this.attribute("fy").hasValue()&&(n="objectBoundingBox"==
this.gradientUnits()?d.y()+d.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));d="objectBoundingBox"==this.gradientUnits()?(d.width()+d.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return a.createRadialGradient(g,n,0,k,f,d)}};a.Element.radialGradient.prototype=new a.Element.GradientBase;a.Element.stop=function(c){this.base=a.Element.ElementBase;this.base(c);this.offset=this.attribute("offset").numValue();0>this.offset&&(this.offset=0);1<this.offset&&
(this.offset=1);c=this.style("stop-color",!0);""===c.value&&(c.value="#000");this.style("stop-opacity").hasValue()&&(c=c.addOpacity(this.style("stop-opacity")));this.color=c.value};a.Element.stop.prototype=new a.Element.ElementBase;a.Element.AnimateBase=function(c){this.base=a.Element.ElementBase;this.base(c);a.Animations.push(this);this.duration=0;this.begin=this.attribute("begin").toMilliseconds();this.maxDuration=this.begin+this.attribute("dur").toMilliseconds();this.getProperty=function(){var a=
this.attribute("attributeType").value,c=this.attribute("attributeName").value;return"CSS"==a?this.parent.style(c,!0):this.parent.attribute(c,!0)};this.initialValue=null;this.initialUnits="";this.removed=!1;this.calcValue=function(){return""};this.update=function(a){null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits());if(this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=
0;else if("freeze"==this.attribute("fill").valueOrDefault("remove")&&!this.frozen)this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;else if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0;return!1}this.duration+=a;a=!1;this.begin<this.duration&&(a=this.calcValue(),this.attribute("type").hasValue()&&
(a=this.attribute("type").value+"("+a+")"),this.getProperty().value=a,a=!0);return a};this.from=this.attribute("from");this.to=this.attribute("to");this.values=this.attribute("values");this.values.hasValue()&&(this.values.value=this.values.value.split(";"));this.progress=function(){var b={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var c=b.progress*(this.values.value.length-1),d=Math.floor(c),k=Math.ceil(c);b.from=new a.Property("from",parseFloat(this.values.value[d]));
b.to=new a.Property("to",parseFloat(this.values.value[k]));b.progress=(c-d)/(k-d)}else b.from=this.from,b.to=this.to;return b}};a.Element.AnimateBase.prototype=new a.Element.ElementBase;a.Element.animate=function(c){this.base=a.Element.AnimateBase;this.base(c);this.calcValue=function(){var a=this.progress();return a.from.numValue()+(a.to.numValue()-a.from.numValue())*a.progress+this.initialUnits}};a.Element.animate.prototype=new a.Element.AnimateBase;a.Element.animateColor=function(c){this.base=a.Element.AnimateBase;
this.base(c);this.calcValue=function(){var a=this.progress(),c=new A(a.from.value),d=new A(a.to.value);if(c.ok&&d.ok){var k=c.g+(d.g-c.g)*a.progress,f=c.b+(d.b-c.b)*a.progress;return"rgb("+parseInt(c.r+(d.r-c.r)*a.progress,10)+","+parseInt(k,10)+","+parseInt(f,10)+")"}return this.attribute("from").value}};a.Element.animateColor.prototype=new a.Element.AnimateBase;a.Element.animateTransform=function(c){this.base=a.Element.AnimateBase;this.base(c);this.calcValue=function(){for(var b=this.progress(),
c=a.ToNumberArray(b.from.value),d=a.ToNumberArray(b.to.value),k="",f=0;f<c.length;f++)k+=c[f]+(d[f]-c[f])*b.progress+" ";return k}};a.Element.animateTransform.prototype=new a.Element.animate;a.Element.font=function(c){this.base=a.Element.ElementBase;this.base(c);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.isArabic=this.isRTL=!1;this.missingGlyph=this.fontFace=null;this.glyphs=[];for(c=0;c<this.children.length;c++){var b=this.children[c];"font-face"==b.type?(this.fontFace=b,b.style("font-family").hasValue()&&
(a.Definitions[b.style("font-family").value]=this)):"missing-glyph"==b.type?this.missingGlyph=b:"glyph"==b.type&&(""!=b.arabicForm?(this.isArabic=this.isRTL=!0,"undefined"==typeof this.glyphs[b.unicode]&&(this.glyphs[b.unicode]=[]),this.glyphs[b.unicode][b.arabicForm]=b):this.glyphs[b.unicode]=b)}};a.Element.font.prototype=new a.Element.ElementBase;a.Element.fontface=function(c){this.base=a.Element.ElementBase;this.base(c);this.ascent=this.attribute("ascent").value;this.descent=this.attribute("descent").value;
this.unitsPerEm=this.attribute("units-per-em").numValue()};a.Element.fontface.prototype=new a.Element.ElementBase;a.Element.missingglyph=function(c){this.base=a.Element.path;this.base(c);this.horizAdvX=0};a.Element.missingglyph.prototype=new a.Element.path;a.Element.glyph=function(c){this.base=a.Element.path;this.base(c);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.unicode=this.attribute("unicode").value;this.arabicForm=this.attribute("arabic-form").value};a.Element.glyph.prototype=
new a.Element.path;a.Element.text=function(c){this.captureTextNodes=!0;this.base=a.Element.RenderedElementBase;this.base(c);this.baseSetContext=this.setContext;this.setContext=function(a){this.baseSetContext(a);var c=this.style("dominant-baseline").toTextBaseline();null==c&&(c=this.style("alignment-baseline").toTextBaseline());null!=c&&(a.textBaseline=c)};this.getBoundingBox=function(){var b=this.attribute("x").toPixels("x"),c=this.attribute("y").toPixels("y"),d=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize);
return new a.BoundingBox(b,c-d,b+Math.floor(2*d/3)*this.children[0].getText().length,c)};this.renderChildren=function(a){this.x=this.attribute("x").toPixels("x");this.y=this.attribute("y").toPixels("y");this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x"));this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y"));this.x+=this.getAnchorDelta(a,this,0);for(var c=0;c<this.children.length;c++)this.renderChild(a,this,this,c)};this.getAnchorDelta=function(a,c,
d){var k=this.style("text-anchor").valueOrDefault("start");if("start"!=k){for(var f=0,g=d;g<c.children.length;g++){var n=c.children[g];if(g>d&&n.attribute("x").hasValue())break;f+=n.measureTextRecursive(a)}return-1*("end"==k?f:f/2)}return 0};this.renderChild=function(a,c,d,k){var f=d.children[k];f.attribute("x").hasValue()?(f.x=f.attribute("x").toPixels("x")+c.getAnchorDelta(a,d,k),f.attribute("dx").hasValue()&&(f.x+=f.attribute("dx").toPixels("x"))):(f.attribute("dx").hasValue()&&(c.x+=f.attribute("dx").toPixels("x")),
f.x=c.x);c.x=f.x+f.measureText(a);f.attribute("y").hasValue()?(f.y=f.attribute("y").toPixels("y"),f.attribute("dy").hasValue()&&(f.y+=f.attribute("dy").toPixels("y"))):(f.attribute("dy").hasValue()&&(c.y+=f.attribute("dy").toPixels("y")),f.y=c.y);c.y=f.y;f.render(a);for(k=0;k<f.children.length;k++)c.renderChild(a,c,f,k)}};a.Element.text.prototype=new a.Element.RenderedElementBase;a.Element.TextElementBase=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.getGlyph=function(a,c,
d){var k=c[d],f=null;if(a.isArabic){var g="isolated";(0==d||" "==c[d-1])&&d<c.length-2&&" "!=c[d+1]&&(g="terminal");0<d&&" "!=c[d-1]&&d<c.length-2&&" "!=c[d+1]&&(g="medial");0<d&&" "!=c[d-1]&&(d==c.length-1||" "==c[d+1])&&(g="initial");"undefined"!=typeof a.glyphs[k]&&(f=a.glyphs[k][g],null==f&&"glyph"==a.glyphs[k].type&&(f=a.glyphs[k]))}else f=a.glyphs[k];null==f&&(f=a.missingGlyph);return f};this.renderChildren=function(b){var c=this.parent.style("font-family").getDefinition();if(null!=c){var d=
this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize),k=this.parent.style("font-style").valueOrDefault(a.Font.Parse(a.ctx.font).fontStyle),f=this.getText();c.isRTL&&(f=f.split("").reverse().join(""));for(var g=a.ToNumberArray(this.parent.attribute("dx").value),n=0;n<f.length;n++){var m=this.getGlyph(c,f,n),h=d/c.fontFace.unitsPerEm;b.translate(this.x,this.y);b.scale(h,-h);var l=b.lineWidth;b.lineWidth=b.lineWidth*c.fontFace.unitsPerEm/d;"italic"==k&&b.transform(1,0,.4,
1,0,0);m.render(b);"italic"==k&&b.transform(1,0,-.4,1,0,0);b.lineWidth=l;b.scale(1/h,-1/h);b.translate(-this.x,-this.y);this.x+=d*(m.horizAdvX||c.horizAdvX)/c.fontFace.unitsPerEm;"undefined"==typeof g[n]||isNaN(g[n])||(this.x+=g[n])}}else""!=b.fillStyle&&b.fillText(a.compressSpaces(this.getText()),this.x,this.y),""!=b.strokeStyle&&b.strokeText(a.compressSpaces(this.getText()),this.x,this.y)};this.getText=function(){};this.measureTextRecursive=function(a){for(var c=this.measureText(a),d=0;d<this.children.length;d++)c+=
this.children[d].measureTextRecursive(a);return c};this.measureText=function(b){var c=this.parent.style("font-family").getDefinition();if(null!=c){b=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize);var d=0,k=this.getText();c.isRTL&&(k=k.split("").reverse().join(""));for(var f=a.ToNumberArray(this.parent.attribute("dx").value),g=0;g<k.length;g++){var n=this.getGlyph(c,k,g),d=d+(n.horizAdvX||c.horizAdvX)*b/c.fontFace.unitsPerEm;"undefined"==typeof f[g]||isNaN(f[g])||
(d+=f[g])}return d}c=a.compressSpaces(this.getText());if(!b.measureText)return 10*c.length;b.save();this.setContext(b);c=b.measureText(c).width;b.restore();return c}};a.Element.TextElementBase.prototype=new a.Element.RenderedElementBase;a.Element.tspan=function(c){this.captureTextNodes=!0;this.base=a.Element.TextElementBase;this.base(c);this.text=a.compressSpaces(c.value||c.text||c.textContent||"");this.getText=function(){return 0<this.children.length?"":this.text}};a.Element.tspan.prototype=new a.Element.TextElementBase;
a.Element.tref=function(c){this.base=a.Element.TextElementBase;this.base(c);this.getText=function(){var a=this.getHrefAttribute().getDefinition();if(null!=a)return a.children[0].getText()}};a.Element.tref.prototype=new a.Element.TextElementBase;a.Element.a=function(c){this.base=a.Element.TextElementBase;this.base(c);this.hasText=0<c.childNodes.length;for(var b=0;b<c.childNodes.length;b++)3!=c.childNodes[b].nodeType&&(this.hasText=!1);this.text=this.hasText?c.childNodes[0].value:"";this.getText=function(){return this.text};
this.baseRenderChildren=this.renderChildren;this.renderChildren=function(b){if(this.hasText){this.baseRenderChildren(b);var c=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);a.Mouse.checkBoundingBox(this,new a.BoundingBox(this.x,this.y-c.toPixels("y"),this.x+this.measureText(b),this.y))}else 0<this.children.length&&(c=new a.Element.g,c.children=this.children,c.parent=this,c.render(b))};this.onclick=function(){window.open(this.getHrefAttribute().value)};this.onmousemove=function(){a.ctx.canvas.style.cursor=
"pointer"}};a.Element.a.prototype=new a.Element.TextElementBase;a.Element.image=function(c){this.base=a.Element.RenderedElementBase;this.base(c);var b=this.getHrefAttribute().value;if(""!=b){var e=b.match(/\.svg$/);a.Images.push(this);this.loaded=!1;if(e)this.img=a.ajax(b),this.loaded=!0;else{this.img=document.createElement("img");1==a.opts.useCORS&&(this.img.crossOrigin="Anonymous");var d=this;this.img.onload=function(){d.loaded=!0};this.img.onerror=function(){a.log('ERROR: image "'+b+'" not found');
d.loaded=!0};this.img.src=b}this.renderChildren=function(b){var c=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),m=this.attribute("height").toPixels("y");0!=n&&0!=m&&(b.save(),e?b.drawSvg(this.img,c,d,n,m):(b.translate(c,d),a.AspectRatio(b,this.attribute("preserveAspectRatio").value,n,this.img.width,m,this.img.height,0,0),b.drawImage(this.img,0,0)),b.restore())};this.getBoundingBox=function(){var b=this.attribute("x").toPixels("x"),c=
this.attribute("y").toPixels("y"),d=this.attribute("width").toPixels("x"),e=this.attribute("height").toPixels("y");return new a.BoundingBox(b,c,b+d,c+e)}}};a.Element.image.prototype=new a.Element.RenderedElementBase;a.Element.g=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.getBoundingBox=function(){for(var b=new a.BoundingBox,c=0;c<this.children.length;c++)b.addBoundingBox(this.children[c].getBoundingBox());return b}};a.Element.g.prototype=new a.Element.RenderedElementBase;
a.Element.symbol=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.render=function(a){}};a.Element.symbol.prototype=new a.Element.RenderedElementBase;a.Element.style=function(c){this.base=a.Element.ElementBase;this.base(c);for(var b="",e=0;e<c.childNodes.length;e++)b+=c.childNodes[e].data;b=b.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");b=a.compressSpaces(b);c=b.split("}");for(e=0;e<c.length;e++)if(""!=a.trim(c[e]))for(var d=c[e].split("{"),b=d[0].split(","),
d=d[1].split(";"),k=0;k<b.length;k++){var f=a.trim(b[k]);if(""!=f){for(var g=a.Styles[f]||{},n=0;n<d.length;n++){var m=d[n].indexOf(":"),h=d[n].substr(0,m),m=d[n].substr(m+1,d[n].length-m);null!=h&&null!=m&&(g[a.trim(h)]=new a.Property(a.trim(h),a.trim(m)))}a.Styles[f]=g;a.StylesSpecificity[f]=K(f);if("@font-face"==f)for(f=g["font-family"].value.replace(/"/g,""),g=g.src.value.split(","),n=0;n<g.length;n++)if(0<g[n].indexOf('format("svg")'))for(h=g[n].indexOf("url"),m=g[n].indexOf(")",h),h=g[n].substr(h+
5,m-h-6),h=a.parseXml(a.ajax(h)).getElementsByTagName("font"),m=0;m<h.length;m++){var l=a.CreateElement(h[m]);a.Definitions[f]=l}}}};a.Element.style.prototype=new a.Element.ElementBase;a.Element.use=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.baseSetContext=this.setContext;this.setContext=function(a){this.baseSetContext(a);this.attribute("x").hasValue()&&a.translate(this.attribute("x").toPixels("x"),0);this.attribute("y").hasValue()&&a.translate(0,this.attribute("y").toPixels("y"))};
var b=this.getHrefAttribute().getDefinition();this.path=function(a){null!=b&&b.path(a)};this.getBoundingBox=function(){if(null!=b)return b.getBoundingBox()};this.renderChildren=function(c){if(null!=b){var d=b;"symbol"==b.type&&(d=new a.Element.svg,d.type="svg",d.attributes.viewBox=new a.Property("viewBox",b.attribute("viewBox").value),d.attributes.preserveAspectRatio=new a.Property("preserveAspectRatio",b.attribute("preserveAspectRatio").value),d.attributes.overflow=new a.Property("overflow",b.attribute("overflow").value),
d.children=b.children);"svg"==d.type&&(this.attribute("width").hasValue()&&(d.attributes.width=new a.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(d.attributes.height=new a.Property("height",this.attribute("height").value)));var k=d.parent;d.parent=null;d.render(c);d.parent=k}}};a.Element.use.prototype=new a.Element.RenderedElementBase;a.Element.mask=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(b,c){var d=this.attribute("x").toPixels("x"),
k=this.attribute("y").toPixels("y"),f=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");if(0==f&&0==g){g=new a.BoundingBox;for(d=0;d<this.children.length;d++)g.addBoundingBox(this.children[d].getBoundingBox());d=Math.floor(g.x1);k=Math.floor(g.y1);f=Math.floor(g.width());g=Math.floor(g.height())}var n=c.attribute("mask").value;c.attribute("mask").value="";var m=document.createElement("canvas");m.width=d+f;m.height=k+g;var h=m.getContext("2d");this.renderChildren(h);var l=
document.createElement("canvas");l.width=d+f;l.height=k+g;var p=l.getContext("2d");c.render(p);p.globalCompositeOperation="destination-in";p.fillStyle=h.createPattern(m,"no-repeat");p.fillRect(0,0,d+f,k+g);b.fillStyle=p.createPattern(l,"no-repeat");b.fillRect(0,0,d+f,k+g);c.attribute("mask").value=n};this.render=function(a){}};a.Element.mask.prototype=new a.Element.ElementBase;a.Element.clipPath=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(b){var c=CanvasRenderingContext2D.prototype.beginPath;
CanvasRenderingContext2D.prototype.beginPath=function(){};var d=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){};c.call(b);for(var k=0;k<this.children.length;k++){var f=this.children[k];if("undefined"!=typeof f.path){var g=null;f.style("transform",!1,!0).hasValue()&&(g=new a.Transform(f.style("transform",!1,!0).value),g.apply(b));f.path(b);CanvasRenderingContext2D.prototype.closePath=d;g&&g.unapply(b)}}d.call(b);b.clip();CanvasRenderingContext2D.prototype.beginPath=
c;CanvasRenderingContext2D.prototype.closePath=d};this.render=function(a){}};a.Element.clipPath.prototype=new a.Element.ElementBase;a.Element.filter=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(a,c){var d=c.getBoundingBox(),k=Math.floor(d.x1),f=Math.floor(d.y1),g=Math.floor(d.width()),d=Math.floor(d.height()),n=c.style("filter").value;c.style("filter").value="";for(var m=0,h=0,l=0;l<this.children.length;l++)var p=this.children[l].extraFilterDistance||0,m=Math.max(m,
p),h=Math.max(h,p);p=document.createElement("canvas");p.width=g+2*m;p.height=d+2*h;var q=p.getContext("2d");q.translate(-k+m,-f+h);c.render(q);for(l=0;l<this.children.length;l++)"function"==typeof this.children[l].apply&&this.children[l].apply(q,0,0,g+2*m,d+2*h);a.drawImage(p,0,0,g+2*m,d+2*h,k-m,f-h,g+2*m,d+2*h);c.style("filter",!0).value=n};this.render=function(a){}};a.Element.filter.prototype=new a.Element.ElementBase;a.Element.feMorphology=function(c){this.base=a.Element.ElementBase;this.base(c);
this.apply=function(a,c,d,k,f){}};a.Element.feMorphology.prototype=new a.Element.ElementBase;a.Element.feComposite=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(a,c,d,k,f){}};a.Element.feComposite.prototype=new a.Element.ElementBase;a.Element.feColorMatrix=function(c){function b(a,b){var c=e[a];return c*(0>c?b-255:b)}this.base=a.Element.ElementBase;this.base(c);var e=a.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case "saturate":c=
e[0];e=[.213+.787*c,.715-.715*c,.072-.072*c,0,0,.213-.213*c,.715+.285*c,.072-.072*c,0,0,.213-.213*c,.715-.715*c,.072+.928*c,0,0,0,0,0,1,0,0,0,0,0,1];break;case "hueRotate":var d=e[0]*Math.PI/180;c=function(a,b,c){return a+Math.cos(d)*b+Math.sin(d)*c};e=[c(.213,.787,-.213),c(.715,-.715,-.715),c(.072,-.072,.928),0,0,c(.213,-.213,.143),c(.715,.285,.14),c(.072,-.072,-.283),0,0,c(.213,-.213,-.787),c(.715,-.715,.715),c(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case "luminanceToAlpha":e=[0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}this.apply=function(a,c,d,e,h){var l=a.getImageData(0,0,e,h);for(d=0;d<h;d++)for(c=0;c<e;c++){var p=l.data[d*e*4+4*c+0],u=l.data[d*e*4+4*c+1],q=l.data[d*e*4+4*c+2],w=l.data[d*e*4+4*c+3],r=b(0,p)+b(1,u)+b(2,q)+b(3,w)+b(4,1);l.data[d*e*4+4*c+0]=r;r=b(5,p)+b(6,u)+b(7,q)+b(8,w)+b(9,1);l.data[d*e*4+4*c+1]=r;r=b(10,p)+b(11,u)+b(12,q)+b(13,w)+b(14,1);l.data[d*e*4+4*c+2]=r;p=b(15,p)+b(16,u)+b(17,q)+b(18,w)+b(19,1);l.data[d*e*4+4*c+3]=p}a.clearRect(0,0,
e,h);a.putImageData(l,0,0)}};a.Element.feColorMatrix.prototype=new a.Element.ElementBase;a.Element.feGaussianBlur=function(c){this.base=a.Element.ElementBase;this.base(c);this.extraFilterDistance=this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue());this.apply=function(b,c,d,k,f){"undefined"==typeof E.canvasRGBA?a.log("ERROR: StackBlur.js must be included for blur to work"):(b.canvas.id=a.UniqueId(),b.canvas.style.display="none",document.body.appendChild(b.canvas),E.canvasRGBA(b.canvas.id,
c,d,k,f,this.blurRadius),document.body.removeChild(b.canvas))}};a.Element.feGaussianBlur.prototype=new a.Element.ElementBase;a.Element.title=function(a){};a.Element.title.prototype=new a.Element.ElementBase;a.Element.desc=function(a){};a.Element.desc.prototype=new a.Element.ElementBase;a.Element.MISSING=function(c){a.log("ERROR: Element '"+c.nodeName+"' not yet implemented.")};a.Element.MISSING.prototype=new a.Element.ElementBase;a.CreateElement=function(c){var b=c.nodeName.replace(/^[^:]+:/,""),
b=b.replace(/\-/g,""),b="undefined"!=typeof a.Element[b]?new a.Element[b](c):new a.Element.MISSING(c);b.type=c.nodeName;return b};a.load=function(c,b){a.loadXml(c,a.ajax(b))};a.loadXml=function(c,b){a.loadXmlDoc(c,a.parseXml(b))};a.loadXmlDoc=function(c,b){a.init(c);var e=function(a){for(var b=c.canvas;b;)a.x-=b.offsetLeft,a.y-=b.offsetTop,b=b.offsetParent;window.scrollX&&(a.x+=window.scrollX);window.scrollY&&(a.y+=window.scrollY);return a};1!=a.opts.ignoreMouse&&(c.canvas.onclick=function(b){b=e(new a.Point(null!=
b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onclick(b.x,b.y)},c.canvas.onmousemove=function(b){b=e(new a.Point(null!=b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onmousemove(b.x,b.y)});var d=a.CreateElement(b.documentElement);d.root=!0;d.addStylesFromStyleDefinition();var k=!0,f=function(){a.ViewPort.Clear();c.canvas.parentNode&&a.ViewPort.SetCurrent(c.canvas.parentNode.clientWidth,c.canvas.parentNode.clientHeight);1!=a.opts.ignoreDimensions&&(d.style("width").hasValue()&&
(c.canvas.width=d.style("width").toPixels("x"),c.canvas.style.width=c.canvas.width+"px"),d.style("height").hasValue()&&(c.canvas.height=d.style("height").toPixels("y"),c.canvas.style.height=c.canvas.height+"px"));var e=c.canvas.clientWidth||c.canvas.width,f=c.canvas.clientHeight||c.canvas.height;1==a.opts.ignoreDimensions&&d.style("width").hasValue()&&d.style("height").hasValue()&&(e=d.style("width").toPixels("x"),f=d.style("height").toPixels("y"));a.ViewPort.SetCurrent(e,f);null!=a.opts.offsetX&&
(d.attribute("x",!0).value=a.opts.offsetX);null!=a.opts.offsetY&&(d.attribute("y",!0).value=a.opts.offsetY);if(null!=a.opts.scaleWidth||null!=a.opts.scaleHeight){var g=null,h=null,l=a.ToNumberArray(d.attribute("viewBox").value);null!=a.opts.scaleWidth&&(d.attribute("width").hasValue()?g=d.attribute("width").toPixels("x")/a.opts.scaleWidth:isNaN(l[2])||(g=l[2]/a.opts.scaleWidth));null!=a.opts.scaleHeight&&(d.attribute("height").hasValue()?h=d.attribute("height").toPixels("y")/a.opts.scaleHeight:isNaN(l[3])||
(h=l[3]/a.opts.scaleHeight));null==g&&(g=h);null==h&&(h=g);d.attribute("width",!0).value=a.opts.scaleWidth;d.attribute("height",!0).value=a.opts.scaleHeight;d.style("transform",!0,!0).value+=" scale("+1/g+","+1/h+")"}1!=a.opts.ignoreClear&&c.clearRect(0,0,e,f);d.render(c);k&&(k=!1,"function"==typeof a.opts.renderCallback&&a.opts.renderCallback(b))},g=!0;a.ImagesLoaded()&&(g=!1,f());a.intervalID=setInterval(function(){var b=!1;g&&a.ImagesLoaded()&&(g=!1,b=!0);1!=a.opts.ignoreMouse&&(b|=a.Mouse.hasEvents());
if(1!=a.opts.ignoreAnimation)for(var c=0;c<a.Animations.length;c++)b|=a.Animations[c].update(1E3/a.FRAMERATE);"function"==typeof a.opts.forceRedraw&&1==a.opts.forceRedraw()&&(b=!0);b&&(f(),a.Mouse.runEvents())},1E3/a.FRAMERATE)};a.stop=function(){a.intervalID&&clearInterval(a.intervalID)};a.Mouse=new function(){this.events=[];this.hasEvents=function(){return 0!=this.events.length};this.onclick=function(a,b){this.events.push({type:"onclick",x:a,y:b,run:function(a){if(a.onclick)a.onclick()}})};this.onmousemove=
function(a,b){this.events.push({type:"onmousemove",x:a,y:b,run:function(a){if(a.onmousemove)a.onmousemove()}})};this.eventElements=[];this.checkPath=function(a,b){for(var e=0;e<this.events.length;e++){var d=this.events[e];b.isPointInPath&&b.isPointInPath(d.x,d.y)&&(this.eventElements[e]=a)}};this.checkBoundingBox=function(a,b){for(var e=0;e<this.events.length;e++){var d=this.events[e];b.isPointInBox(d.x,d.y)&&(this.eventElements[e]=a)}};this.runEvents=function(){a.ctx.canvas.style.cursor="";for(var c=
0;c<this.events.length;c++)for(var b=this.events[c],e=this.eventElements[c];e;)b.run(e),e=e.parent;this.events=[];this.eventElements=[]}};return a}var O=function(h,a,l){if(null==h&&null==a&&null==l)for(a=document.querySelectorAll("svg"),h=0;h<a.length;h++){l=a[h];var c=document.createElement("canvas");c.width=l.clientWidth;c.height=l.clientHeight;l.parentNode.insertBefore(c,l);l.parentNode.removeChild(l);var b=document.createElement("div");b.appendChild(l);O(c,b.innerHTML)}else{"string"==typeof h&&
(h=document.getElementById(h));null!=h.svg&&h.svg.stop();l=X(l||{});if(1!=h.childNodes.length||"OBJECT"!=h.childNodes[0].nodeName)h.svg=l;h=h.getContext("2d");"undefined"!=typeof a.documentElement?l.loadXmlDoc(h,a):"<"==a.substr(0,1)?l.loadXml(h,a):l.load(h,a)}},L;if("undefined"!=typeof Element.prototype.matches)L=function(h,a){return h.matches(a)};else if("undefined"!=typeof Element.prototype.webkitMatchesSelector)L=function(h,a){return h.webkitMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.mozMatchesSelector)L=
function(h,a){return h.mozMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.msMatchesSelector)L=function(h,a){return h.msMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.oMatchesSelector)L=function(h,a){return h.oMatchesSelector(a)};else{if("function"===typeof jQuery||"function"===typeof Zepto)L=function(h,a){return $(h).is(a)};"undefined"===typeof L&&(L=Sizzle.matchesSelector)}var W=/(\[[^\]]+\])/g,M=/(#[^\s\+>~\.\[:]+)/g,u=/(\.[^\s\+>~\.\[:]+)/g,B=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,
p=/(:[\w-]+\([^\)]*\))/gi,C=/(:[^\s\+>~\.\[:]+)/g,w=/([^\s\+>~\.\[:]+)/g;"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(h,a,l,c,b,e){a={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:a,offsetY:l,scaleWidth:c,scaleHeight:b};for(var d in e)e.hasOwnProperty(d)&&(a[d]=e[d]);O(this.canvas,h,a)});return O});

/*!

JSZip v3.1.5 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.JSZip=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("./utils"),e=a("./support"),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.encode=function(a){for(var b,c,e,g,h,i,j,k=[],l=0,m=a.length,n=m,o="string"!==d.getTypeOf(a);l<a.length;)n=m-l,o?(b=a[l++],c=l<m?a[l++]:0,e=l<m?a[l++]:0):(b=a.charCodeAt(l++),c=l<m?a.charCodeAt(l++):0,e=l<m?a.charCodeAt(l++):0),g=b>>2,h=(3&b)<<4|c>>4,i=n>1?(15&c)<<2|e>>6:64,j=n>2?63&e:64,k.push(f.charAt(g)+f.charAt(h)+f.charAt(i)+f.charAt(j));return k.join("")},c.decode=function(a){var b,c,d,g,h,i,j,k=0,l=0,m="data:";if(a.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");var n=3*a.length/4;if(a.charAt(a.length-1)===f.charAt(64)&&n--,a.charAt(a.length-2)===f.charAt(64)&&n--,n%1!==0)throw new Error("Invalid base64 input, bad content length.");var o;for(o=e.uint8array?new Uint8Array(0|n):new Array(0|n);k<a.length;)g=f.indexOf(a.charAt(k++)),h=f.indexOf(a.charAt(k++)),i=f.indexOf(a.charAt(k++)),j=f.indexOf(a.charAt(k++)),b=g<<2|h>>4,c=(15&h)<<4|i>>2,d=(3&i)<<6|j,o[l++]=b,64!==i&&(o[l++]=c),64!==j&&(o[l++]=d);return o}},{"./support":30,"./utils":32}],2:[function(a,b,c){"use strict";function d(a,b,c,d,e){this.compressedSize=a,this.uncompressedSize=b,this.crc32=c,this.compression=d,this.compressedContent=e}var e=a("./external"),f=a("./stream/DataWorker"),g=a("./stream/DataLengthProbe"),h=a("./stream/Crc32Probe"),g=a("./stream/DataLengthProbe");d.prototype={getContentWorker:function(){var a=new f(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new g("data_length")),b=this;return a.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),a},getCompressedWorker:function(){return new f(e.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(a,b,c){return a.pipe(new h).pipe(new g("uncompressedSize")).pipe(b.compressWorker(c)).pipe(new g("compressedSize")).withStreamInfo("compression",b)},b.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(a,b,c){"use strict";var d=a("./stream/GenericWorker");c.STORE={magic:"\0\0",compressWorker:function(a){return new d("STORE compression")},uncompressWorker:function(){return new d("STORE decompression")}},c.DEFLATE=a("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b[g])];return a^-1}function f(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b.charCodeAt(g))];return a^-1}var g=a("./utils"),h=d();b.exports=function(a,b){if("undefined"==typeof a||!a.length)return 0;var c="string"!==g.getTypeOf(a);return c?e(0|b,a,a.length,0):f(0|b,a,a.length,0)}},{"./utils":32}],5:[function(a,b,c){"use strict";c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],6:[function(a,b,c){"use strict";var d=null;d="undefined"!=typeof Promise?Promise:a("lie"),b.exports={Promise:d}},{lie:58}],7:[function(a,b,c){"use strict";function d(a,b){h.call(this,"FlateWorker/"+a),this._pako=null,this._pakoAction=a,this._pakoOptions=b,this.meta={}}var e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,f=a("pako"),g=a("./utils"),h=a("./stream/GenericWorker"),i=e?"uint8array":"array";c.magic="\b\0",g.inherits(d,h),d.prototype.processChunk=function(a){this.meta=a.meta,null===this._pako&&this._createPako(),this._pako.push(g.transformTo(i,a.data),!1)},d.prototype.flush=function(){h.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},d.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},d.prototype._createPako=function(){this._pako=new f[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var a=this;this._pako.onData=function(b){a.push({data:b,meta:a.meta})}},c.compressWorker=function(a){return new d("Deflate",a)},c.uncompressWorker=function(){return new d("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(a,b,c){"use strict";function d(a,b,c,d){f.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=c,this.encodeFileName=d,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var e=a("../utils"),f=a("../stream/GenericWorker"),g=a("../utf8"),h=a("../crc32"),i=a("../signature"),j=function(a,b){var c,d="";for(c=0;c<b;c++)d+=String.fromCharCode(255&a),a>>>=8;return d},k=function(a,b){var c=a;return a||(c=b?16893:33204),(65535&c)<<16},l=function(a,b){return 63&(a||0)},m=function(a,b,c,d,f,m){var n,o,p=a.file,q=a.compression,r=m!==g.utf8encode,s=e.transformTo("string",m(p.name)),t=e.transformTo("string",g.utf8encode(p.name)),u=p.comment,v=e.transformTo("string",m(u)),w=e.transformTo("string",g.utf8encode(u)),x=t.length!==p.name.length,y=w.length!==u.length,z="",A="",B="",C=p.dir,D=p.date,E={crc32:0,compressedSize:0,uncompressedSize:0};b&&!c||(E.crc32=a.crc32,E.compressedSize=a.compressedSize,E.uncompressedSize=a.uncompressedSize);var F=0;b&&(F|=8),r||!x&&!y||(F|=2048);var G=0,H=0;C&&(G|=16),"UNIX"===f?(H=798,G|=k(p.unixPermissions,C)):(H=20,G|=l(p.dosPermissions,C)),n=D.getUTCHours(),n<<=6,n|=D.getUTCMinutes(),n<<=5,n|=D.getUTCSeconds()/2,o=D.getUTCFullYear()-1980,o<<=4,o|=D.getUTCMonth()+1,o<<=5,o|=D.getUTCDate(),x&&(A=j(1,1)+j(h(s),4)+t,z+="up"+j(A.length,2)+A),y&&(B=j(1,1)+j(h(v),4)+w,z+="uc"+j(B.length,2)+B);var I="";I+="\n\0",I+=j(F,2),I+=q.magic,I+=j(n,2),I+=j(o,2),I+=j(E.crc32,4),I+=j(E.compressedSize,4),I+=j(E.uncompressedSize,4),I+=j(s.length,2),I+=j(z.length,2);var J=i.LOCAL_FILE_HEADER+I+s+z,K=i.CENTRAL_FILE_HEADER+j(H,2)+I+j(v.length,2)+"\0\0\0\0"+j(G,4)+j(d,4)+s+z+v;return{fileRecord:J,dirRecord:K}},n=function(a,b,c,d,f){var g="",h=e.transformTo("string",f(d));return g=i.CENTRAL_DIRECTORY_END+"\0\0\0\0"+j(a,2)+j(a,2)+j(b,4)+j(c,4)+j(h.length,2)+h},o=function(a){var b="";return b=i.DATA_DESCRIPTOR+j(a.crc32,4)+j(a.compressedSize,4)+j(a.uncompressedSize,4)};e.inherits(d,f),d.prototype.push=function(a){var b=a.meta.percent||0,c=this.entriesCount,d=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,f.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:c?(b+100*(c-d-1))/c:100}}))},d.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten,this.currentFile=a.file.name;var b=this.streamFiles&&!a.file.dir;if(b){var c=m(a,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:c.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(a){this.accumulate=!1;var b=this.streamFiles&&!a.file.dir,c=m(a,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(c.dirRecord),b)this.push({data:o(a),meta:{percent:100}});else for(this.push({data:c.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var a=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var c=this.bytesWritten-a,d=n(this.dirRecords.length,c,a,this.zipComment,this.encodeFileName);this.push({data:d,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(a){this._sources.push(a);var b=this;return a.on("data",function(a){b.processChunk(a)}),a.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),a.on("error",function(a){b.error(a)}),this},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(a){var b=this._sources;if(!f.prototype.error.call(this,a))return!1;for(var c=0;c<b.length;c++)try{b[c].error(a)}catch(a){}return!0},d.prototype.lock=function(){f.prototype.lock.call(this);for(var a=this._sources,b=0;b<a.length;b++)a[b].lock()},b.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(a,b,c){"use strict";var d=a("../compressions"),e=a("./ZipFileWorker"),f=function(a,b){var c=a||b,e=d[c];if(!e)throw new Error(c+" is not a valid compression method !");return e};c.generateWorker=function(a,b,c){var d=new e(b.streamFiles,c,b.platform,b.encodeFileName),g=0;try{a.forEach(function(a,c){g++;var e=f(c.options.compression,b.compression),h=c.options.compressionOptions||b.compressionOptions||{},i=c.dir,j=c.date;c._compressWorker(e,h).withStreamInfo("file",{name:a,dir:i,date:j,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(d)}),d.entriesCount=g}catch(h){d.error(h)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(a,b,c){"use strict";function d(){if(!(this instanceof d))return new d;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var a=new d;for(var b in this)"function"!=typeof this[b]&&(a[b]=this[b]);return a}}d.prototype=a("./object"),d.prototype.loadAsync=a("./load"),d.support=a("./support"),d.defaults=a("./defaults"),d.version="3.1.5",d.loadAsync=function(a,b){return(new d).loadAsync(a,b)},d.external=a("./external"),b.exports=d},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(a,b,c){"use strict";function d(a){return new f.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new i);d.on("error",function(a){c(a)}).on("end",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}var e=a("./utils"),f=a("./external"),g=a("./utf8"),e=a("./utils"),h=a("./zipEntries"),i=a("./stream/Crc32Probe"),j=a("./nodejsUtils");b.exports=function(a,b){var c=this;return b=e.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:g.utf8decode}),j.isNode&&j.isStream(a)?f.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):e.prepareContent("the loaded zip file",a,!0,b.optimizedBinaryString,b.base64).then(function(a){var c=new h(b);return c.load(a),c}).then(function(a){var c=[f.Promise.resolve(a)],e=a.files;if(b.checkCRC32)for(var g=0;g<e.length;g++)c.push(d(e[g]));return f.Promise.all(c)}).then(function(a){for(var d=a.shift(),e=d.files,f=0;f<e.length;f++){var g=e[f];c.file(g.fileNameStr,g.decompressed,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir,comment:g.fileCommentStr.length?g.fileCommentStr:null,unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions,createFolders:b.createFolders})}return d.zipComment.length&&(c.comment=d.zipComment),c})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(a,b,c){"use strict";function d(a,b){f.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(b)}var e=a("../utils"),f=a("../stream/GenericWorker");e.inherits(d,f),d.prototype._bindStream=function(a){var b=this;this._stream=a,a.pause(),a.on("data",function(a){b.push({data:a,meta:{percent:0}})}).on("error",function(a){b.isPaused?this.generatedError=a:b.error(a)}).on("end",function(){b.isPaused?b._upstreamEnded=!0:b.end()})},d.prototype.pause=function(){return!!f.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},b.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(a,b,c){"use strict";function d(a,b,c){e.call(this,b),this._helper=a;var d=this;a.on("data",function(a,b){d.push(a)||d._helper.pause(),c&&c(b)}).on("error",function(a){d.emit("error",a)}).on("end",function(){d.push(null)})}var e=a("readable-stream").Readable,f=a("../utils");f.inherits(d,e),d.prototype._read=function(){this._helper.resume()},b.exports=d},{"../utils":32,"readable-stream":16}],14:[function(a,b,c){"use strict";b.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(a,b){return new Buffer(a,b)},allocBuffer:function(a){return Buffer.alloc?Buffer.alloc(a):new Buffer(a)},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&"function"==typeof a.on&&"function"==typeof a.pause&&"function"==typeof a.resume}}},{}],15:[function(a,b,c){"use strict";function d(a){return"[object RegExp]"===Object.prototype.toString.call(a)}var e=a("./utf8"),f=a("./utils"),g=a("./stream/GenericWorker"),h=a("./stream/StreamHelper"),i=a("./defaults"),j=a("./compressedObject"),k=a("./zipObject"),l=a("./generate"),m=a("./nodejsUtils"),n=a("./nodejs/NodejsStreamInputAdapter"),o=function(a,b,c){var d,e=f.getTypeOf(b),h=f.extend(c||{},i);h.date=h.date||new Date,null!==h.compression&&(h.compression=h.compression.toUpperCase()),"string"==typeof h.unixPermissions&&(h.unixPermissions=parseInt(h.unixPermissions,8)),h.unixPermissions&&16384&h.unixPermissions&&(h.dir=!0),h.dosPermissions&&16&h.dosPermissions&&(h.dir=!0),h.dir&&(a=q(a)),h.createFolders&&(d=p(a))&&r.call(this,d,!0);var l="string"===e&&h.binary===!1&&h.base64===!1;c&&"undefined"!=typeof c.binary||(h.binary=!l);var o=b instanceof j&&0===b.uncompressedSize;(o||h.dir||!b||0===b.length)&&(h.base64=!1,h.binary=!0,b="",h.compression="STORE",e="string");var s=null;s=b instanceof j||b instanceof g?b:m.isNode&&m.isStream(b)?new n(a,b):f.prepareContent(a,b,h.binary,h.optimizedBinaryString,h.base64);var t=new k(a,s,h);this.files[a]=t},p=function(a){"/"===a.slice(-1)&&(a=a.substring(0,a.length-1));var b=a.lastIndexOf("/");return b>0?a.substring(0,b):""},q=function(a){return"/"!==a.slice(-1)&&(a+="/"),a},r=function(a,b){return b="undefined"!=typeof b?b:i.createFolders,a=q(a),this.files[a]||o.call(this,a,null,{dir:!0,createFolders:b}),this.files[a]},s={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(a){var b,c,d;for(b in this.files)this.files.hasOwnProperty(b)&&(d=this.files[b],c=b.slice(this.root.length,b.length),c&&b.slice(0,this.root.length)===this.root&&a(c,d))},filter:function(a){var b=[];return this.forEach(function(c,d){a(c,d)&&b.push(d)}),b},file:function(a,b,c){if(1===arguments.length){if(d(a)){var e=a;return this.filter(function(a,b){return!b.dir&&e.test(a)})}var f=this.files[this.root+a];return f&&!f.dir?f:null}return a=this.root+a,o.call(this,a,b,c),this},folder:function(a){if(!a)return this;if(d(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=this.root+a,c=r.call(this,b),e=this.clone();return e.root=c.name,e},remove:function(a){a=this.root+a;var b=this.files[a];if(b||("/"!==a.slice(-1)&&(a+="/"),b=this.files[a]),b&&!b.dir)delete this.files[a];else for(var c=this.filter(function(b,c){return c.name.slice(0,a.length)===a}),d=0;d<c.length;d++)delete this.files[c[d].name];return this},generate:function(a){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(a){var b,c={};try{if(c=f.extend(a||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:e.utf8encode}),c.type=c.type.toLowerCase(),c.compression=c.compression.toUpperCase(),"binarystring"===c.type&&(c.type="string"),!c.type)throw new Error("No output type specified.");f.checkSupport(c.type),"darwin"!==c.platform&&"freebsd"!==c.platform&&"linux"!==c.platform&&"sunos"!==c.platform||(c.platform="UNIX"),"win32"===c.platform&&(c.platform="DOS");var d=c.comment||this.comment||"";b=l.generateWorker(this,c,d)}catch(i){b=new g("error"),b.error(i)}return new h(b,c.type||"string",c.mimeType)},generateAsync:function(a,b){return this.generateInternalStream(a).accumulate(b)},generateNodeStream:function(a,b){return a=a||{},a.type||(a.type="nodebuffer"),this.generateInternalStream(a).toNodejsStream(b)}};b.exports=s},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(a,b,c){b.exports=a("stream")},{stream:void 0}],17:[function(a,b,c){"use strict";function d(a){e.call(this,a);for(var b=0;b<this.data.length;b++)a[b]=255&a[b]}var e=a("./DataReader"),f=a("../utils");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data[this.zero+a]},d.prototype.lastIndexOfSignature=function(a){for(var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.length-4;f>=0;--f)if(this.data[f]===b&&this.data[f+1]===c&&this.data[f+2]===d&&this.data[f+3]===e)return f-this.zero;return-1},d.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.readData(4);return b===f[0]&&c===f[1]&&d===f[2]&&e===f[3]},d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./DataReader":18}],18:[function(a,b,c){"use strict";function d(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}var e=a("../utils");d.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){},readInt:function(a){var b,c=0;for(this.checkOffset(a),b=this.index+a-1;b>=this.index;b--)c=(c<<8)+this.byteAt(b);return this.index+=a,c},readString:function(a){return e.transformTo("string",this.readData(a))},readData:function(a){},lastIndexOfSignature:function(a){},readAndCheckSignature:function(a){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},b.exports=d},{"../utils":32}],19:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./Uint8ArrayReader"),f=a("../utils");f.inherits(d,e),d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./DataReader"),f=a("../utils");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},d.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},d.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b},d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./DataReader":18}],21:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./ArrayReader"),f=a("../utils");f.inherits(d,e),d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./ArrayReader":17}],22:[function(a,b,c){"use strict";var d=a("../utils"),e=a("../support"),f=a("./ArrayReader"),g=a("./StringReader"),h=a("./NodeBufferReader"),i=a("./Uint8ArrayReader");b.exports=function(a){var b=d.getTypeOf(a);return d.checkSupport(b),"string"!==b||e.uint8array?"nodebuffer"===b?new h(a):e.uint8array?new i(d.transformTo("uint8array",a)):new f(d.transformTo("array",a)):new g(a)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(a,b,c){"use strict";c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\b"},{}],24:[function(a,b,c){"use strict";function d(a){e.call(this,"ConvertWorker to "+a),this.destType=a}var e=a("./GenericWorker"),f=a("../utils");f.inherits(d,e),d.prototype.processChunk=function(a){this.push({data:f.transformTo(this.destType,a.data),meta:a.meta})},b.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(a,b,c){"use strict";function d(){e.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}var e=a("./GenericWorker"),f=a("../crc32"),g=a("../utils");g.inherits(d,e),d.prototype.processChunk=function(a){this.streamInfo.crc32=f(a.data,this.streamInfo.crc32||0),this.push(a)},b.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(a,b,c){"use strict";function d(a){f.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}var e=a("../utils"),f=a("./GenericWorker");e.inherits(d,f),d.prototype.processChunk=function(a){if(a){var b=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=b+a.data.length}f.prototype.processChunk.call(this,a)},b.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(a,b,c){"use strict";function d(a){f.call(this,"DataWorker");var b=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(a){b.dataIsReady=!0,b.data=a,b.max=a&&a.length||0,b.type=e.getTypeOf(a),b.isPaused||b._tickAndRepeat()},function(a){b.error(a)})}var e=a("../utils"),f=a("./GenericWorker"),g=16384;e.inherits(d,f),d.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=g,b=null,c=Math.min(this.max,this.index+a);if(this.index>=this.max)return this.end();switch(this.type){case"string":b=this.data.substring(this.index,c);break;case"uint8array":b=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":b=this.data.slice(this.index,c)}return this.index=c,this.push({data:b,meta:{percent:this.max?this.index/this.max*100:0}})},b.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(a,b,c){"use strict";function d(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}d.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,b){return this._listeners[a].push(b),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var b=this;return a.on("data",function(a){b.processChunk(a)}),a.on("end",function(){b.end()}),a.on("error",function(a){b.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var a=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){return this.extraStreamInfo[a]=b,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},b.exports=d},{}],29:[function(a,b,c){"use strict";function d(a,b,c){switch(a){case"blob":return h.newBlob(h.transformTo("arraybuffer",b),c);case"base64":return k.encode(b);default:return h.transformTo(a,b)}}function e(a,b){var c,d=0,e=null,f=0;for(c=0;c<b.length;c++)f+=b[c].length;switch(a){case"string":return b.join("");case"array":return Array.prototype.concat.apply([],b);case"uint8array":for(e=new Uint8Array(f),c=0;c<b.length;c++)e.set(b[c],d),d+=b[c].length;return e;case"nodebuffer":return Buffer.concat(b);default:throw new Error("concat : unsupported type '"+a+"'")}}function f(a,b){return new m.Promise(function(c,f){var g=[],h=a._internalType,i=a._outputType,j=a._mimeType;a.on("data",function(a,c){g.push(a),b&&b(c)}).on("error",function(a){g=[],f(a)}).on("end",function(){try{var a=d(i,e(h,g),j);c(a)}catch(b){f(b)}g=[]}).resume()})}function g(a,b,c){var d=b;switch(b){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=b,this._mimeType=c,h.checkSupport(d),this._worker=a.pipe(new i(d)),a.lock()}catch(e){this._worker=new j("error"),this._worker.error(e)}}var h=a("../utils"),i=a("./ConvertWorker"),j=a("./GenericWorker"),k=a("../base64"),l=a("../support"),m=a("../external"),n=null;if(l.nodestream)try{n=a("../nodejs/NodejsStreamOutputAdapter")}catch(o){}g.prototype={accumulate:function(a){return f(this,a)},on:function(a,b){var c=this;return"data"===a?this._worker.on(a,function(a){b.call(c,a.data,a.meta)}):this._worker.on(a,function(){h.delay(b,arguments,c)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(a){if(h.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new n(this,{objectMode:"nodebuffer"!==this._outputType},a)}},b.exports=g},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(a,b,c){"use strict";if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,c.nodebuffer="undefined"!=typeof Buffer,c.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)c.blob=!1;else{var d=new ArrayBuffer(0);try{c.blob=0===new Blob([d],{type:"application/zip"}).size}catch(e){try{var f=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,g=new f;g.append(d),c.blob=0===g.getBlob("application/zip").size}catch(e){c.blob=!1}}}try{c.nodestream=!!a("readable-stream").Readable}catch(e){c.nodestream=!1}},{"readable-stream":16}],31:[function(a,b,c){"use strict";function d(){i.call(this,"utf-8 decode"),this.leftOver=null}function e(){i.call(this,"utf-8 encode")}for(var f=a("./utils"),g=a("./support"),h=a("./nodejsUtils"),i=a("./stream/GenericWorker"),j=new Array(256),k=0;k<256;k++)j[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;j[254]=j[254]=1;var l=function(a){var b,c,d,e,f,h=a.length,i=0;for(e=0;e<h;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=g.uint8array?new Uint8Array(i):new Array(i),f=0,e=0;f<i;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),c<128?b[f++]=c:c<2048?(b[f++]=192|c>>>6,b[f++]=128|63&c):c<65536?(b[f++]=224|c>>>12,b[f++]=128|c>>>6&63,b[f++]=128|63&c):(b[f++]=240|c>>>18,b[f++]=128|c>>>12&63,b[f++]=128|c>>>6&63,b[f++]=128|63&c);return b},m=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+j[a[c]]>b?c:b},n=function(a){var b,c,d,e,g=a.length,h=new Array(2*g);for(c=0,b=0;b<g;)if(d=a[b++],d<128)h[c++]=d;else if(e=j[d],e>4)h[c++]=65533,b+=e-1;else{for(d&=2===e?31:3===e?15:7;e>1&&b<g;)d=d<<6|63&a[b++],e--;e>1?h[c++]=65533:d<65536?h[c++]=d:(d-=65536,h[c++]=55296|d>>10&1023,h[c++]=56320|1023&d)}return h.length!==c&&(h.subarray?h=h.subarray(0,c):h.length=c),f.applyFromCharCode(h)};c.utf8encode=function(a){return g.nodebuffer?h.newBufferFrom(a,"utf-8"):l(a)},c.utf8decode=function(a){return g.nodebuffer?f.transformTo("nodebuffer",a).toString("utf-8"):(a=f.transformTo(g.uint8array?"uint8array":"array",a),n(a))},f.inherits(d,i),d.prototype.processChunk=function(a){var b=f.transformTo(g.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(g.uint8array){var d=b;b=new Uint8Array(d.length+this.leftOver.length),b.set(this.leftOver,0),b.set(d,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var e=m(b),h=b;e!==b.length&&(g.uint8array?(h=b.subarray(0,e),this.leftOver=b.subarray(e,b.length)):(h=b.slice(0,e),this.leftOver=b.slice(e,b.length))),this.push({data:c.utf8decode(h),meta:a.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=d,f.inherits(e,i),e.prototype.processChunk=function(a){this.push({data:c.utf8encode(a.data),meta:a.meta})},c.Utf8EncodeWorker=e},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(a,b,c){"use strict";function d(a){var b=null;return b=i.uint8array?new Uint8Array(a.length):new Array(a.length),f(a,b)}function e(a){return a}function f(a,b){for(var c=0;c<a.length;++c)b[c]=255&a.charCodeAt(c);return b}function g(a){var b=65536,d=c.getTypeOf(a),e=!0;if("uint8array"===d?e=n.applyCanBeUsed.uint8array:"nodebuffer"===d&&(e=n.applyCanBeUsed.nodebuffer),e)for(;b>1;)try{return n.stringifyByChunk(a,d,b)}catch(f){b=Math.floor(b/2)}return n.stringifyByChar(a)}function h(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];
return b}var i=a("./support"),j=a("./base64"),k=a("./nodejsUtils"),l=a("core-js/library/fn/set-immediate"),m=a("./external");c.newBlob=function(a,b){c.checkSupport("blob");try{return new Blob([a],{type:b})}catch(d){try{var e=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,f=new e;return f.append(a),f.getBlob(b)}catch(d){throw new Error("Bug : can't construct the Blob.")}}};var n={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(f<=c)return String.fromCharCode.apply(null,a);for(;e<f;)"array"===b||"nodebuffer"===b?d.push(String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f)))):d.push(String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join("")},stringifyByChar:function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(a){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,k.allocBuffer(1)).length}catch(a){return!1}}()}};c.applyFromCharCode=g;var o={};o.string={string:e,array:function(a){return f(a,new Array(a.length))},arraybuffer:function(a){return o.string.uint8array(a).buffer},uint8array:function(a){return f(a,new Uint8Array(a.length))},nodebuffer:function(a){return f(a,k.allocBuffer(a.length))}},o.array={string:g,array:e,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBufferFrom(a)}},o.arraybuffer={string:function(a){return g(new Uint8Array(a))},array:function(a){return h(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:e,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBufferFrom(new Uint8Array(a))}},o.uint8array={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:e,nodebuffer:function(a){return k.newBufferFrom(a)}},o.nodebuffer={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return o.nodebuffer.uint8array(a).buffer},uint8array:function(a){return h(a,new Uint8Array(a.length))},nodebuffer:e},c.transformTo=function(a,b){if(b||(b=""),!a)return b;c.checkSupport(a);var d=c.getTypeOf(b),e=o[d][a](b);return e},c.getTypeOf=function(a){return"string"==typeof a?"string":"[object Array]"===Object.prototype.toString.call(a)?"array":i.nodebuffer&&k.isBuffer(a)?"nodebuffer":i.uint8array&&a instanceof Uint8Array?"uint8array":i.arraybuffer&&a instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(a){var b=i[a.toLowerCase()];if(!b)throw new Error(a+" is not supported by this platform")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(a){var b,c,d="";for(c=0;c<(a||"").length;c++)b=a.charCodeAt(c),d+="\\x"+(b<16?"0":"")+b.toString(16).toUpperCase();return d},c.delay=function(a,b,c){l(function(){a.apply(c||null,b||[])})},c.inherits=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c},c.extend=function(){var a,b,c={};for(a=0;a<arguments.length;a++)for(b in arguments[a])arguments[a].hasOwnProperty(b)&&"undefined"==typeof c[b]&&(c[b]=arguments[a][b]);return c},c.prepareContent=function(a,b,e,f,g){var h=m.Promise.resolve(b).then(function(a){var b=i.blob&&(a instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(a))!==-1);return b&&"undefined"!=typeof FileReader?new m.Promise(function(b,c){var d=new FileReader;d.onload=function(a){b(a.target.result)},d.onerror=function(a){c(a.target.error)},d.readAsArrayBuffer(a)}):a});return h.then(function(b){var h=c.getTypeOf(b);return h?("arraybuffer"===h?b=c.transformTo("uint8array",b):"string"===h&&(g?b=j.decode(b):e&&f!==!0&&(b=d(b))),b):m.Promise.reject(new Error("Can't read the data of '"+a+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(a,b,c){"use strict";function d(a){this.files=[],this.loadOptions=a}var e=a("./reader/readerFor"),f=a("./utils"),g=a("./signature"),h=a("./zipEntry"),i=(a("./utf8"),a("./support"));d.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+f.pretty(b)+", expected "+f.pretty(a)+")")}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);var d=this.reader.readString(4),e=d===b;return this.reader.setIndex(c),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength),b=i.uint8array?"uint8array":"array",c=f.transformTo(b,a);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var a,b,c,d=this.zip64EndOfCentralSize-44,e=0;e<d;)a=this.reader.readInt(2),b=this.reader.readInt(4),c=this.reader.readData(b),this.zip64ExtensibleData[a]={id:a,length:b,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(g.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(g.CENTRAL_FILE_HEADER);)a=new h({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(g.CENTRAL_DIRECTORY_END);if(a<0){var b=!this.isSignature(0,g.LOCAL_FILE_HEADER);throw b?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(a);var c=a;if(this.checkSignature(g.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===f.MAX_VALUE_16BITS||this.diskWithCentralDirStart===f.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===f.MAX_VALUE_16BITS||this.centralDirRecords===f.MAX_VALUE_16BITS||this.centralDirSize===f.MAX_VALUE_32BITS||this.centralDirOffset===f.MAX_VALUE_32BITS){if(this.zip64=!0,a=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),a<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(a),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,g.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var e=c-d;if(e>0)this.isSignature(c,g.CENTRAL_FILE_HEADER)||(this.reader.zero=e);else if(e<0)throw new Error("Corrupted zip: missing "+Math.abs(e)+" bytes.")},prepareReader:function(a){this.reader=e(a)},load:function(a){this.prepareReader(a),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},b.exports=d},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(a,b,c){"use strict";function d(a,b){this.options=a,this.loadOptions=b}var e=a("./reader/readerFor"),f=a("./utils"),g=a("./compressedObject"),h=a("./crc32"),i=a("./utf8"),j=a("./compressions"),k=a("./support"),l=0,m=3,n=function(a){for(var b in j)if(j.hasOwnProperty(b)&&j[b].magic===a)return j[b];return null};d.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(a){var b,c;if(a.skip(22),this.fileNameLength=a.readInt(2),c=a.readInt(2),this.fileName=a.readData(this.fileNameLength),a.skip(c),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(b=n(this.compressionMethod),null===b)throw new Error("Corrupted zip : compression "+f.pretty(this.compressionMethod)+" unknown (inner file : "+f.transformTo("string",this.fileName)+")");this.decompressed=new g(this.compressedSize,this.uncompressedSize,this.crc32,b,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2),a.skip(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4);var b=a.readInt(2);if(this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");a.skip(b),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),a===l&&(this.dosPermissions=63&this.externalFileAttributes),a===m&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(a){if(this.extraFields[1]){var b=e(this.extraFields[1].value);this.uncompressedSize===f.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===f.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===f.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===f.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(a){var b,c,d,e=a.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});a.index<e;)b=a.readInt(2),c=a.readInt(2),d=a.readData(c),this.extraFields[b]={id:b,length:c,value:d}},handleUTF8:function(){var a=k.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=i.utf8decode(this.fileName),this.fileCommentStr=i.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(null!==b)this.fileNameStr=b;else{var c=f.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}var d=this.findExtraFieldUnicodeComment();if(null!==d)this.fileCommentStr=d;else{var e=f.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(e)}}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileName)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileComment)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null}},b.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(a,b,c){"use strict";var d=a("./stream/StreamHelper"),e=a("./stream/DataWorker"),f=a("./utf8"),g=a("./compressedObject"),h=a("./stream/GenericWorker"),i=function(a,b,c){this.name=a,this.dir=c.dir,this.date=c.date,this.comment=c.comment,this.unixPermissions=c.unixPermissions,this.dosPermissions=c.dosPermissions,this._data=b,this._dataBinary=c.binary,this.options={compression:c.compression,compressionOptions:c.compressionOptions}};i.prototype={internalStream:function(a){var b=null,c="string";try{if(!a)throw new Error("No output type specified.");c=a.toLowerCase();var e="string"===c||"text"===c;"binarystring"!==c&&"text"!==c||(c="string"),b=this._decompressWorker();var g=!this._dataBinary;g&&!e&&(b=b.pipe(new f.Utf8EncodeWorker)),!g&&e&&(b=b.pipe(new f.Utf8DecodeWorker))}catch(i){b=new h("error"),b.error(i)}return new d(b,c,"")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||"nodebuffer").toNodejsStream(b)},_compressWorker:function(a,b){if(this._data instanceof g&&this._data.compression.magic===a.magic)return this._data.getCompressedWorker();var c=this._decompressWorker();return this._dataBinary||(c=c.pipe(new f.Utf8EncodeWorker)),g.createWorkerFrom(c,a,b)},_decompressWorker:function(){return this._data instanceof g?this._data.getContentWorker():this._data instanceof h?this._data:new e(this._data)}};for(var j=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],k=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<j.length;l++)i.prototype[j[l]]=k;b.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(a,b,c){a("../modules/web.immediate"),b.exports=a("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(a,b,c){b.exports=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a}},{}],38:[function(a,b,c){var d=a("./_is-object");b.exports=function(a){if(!d(a))throw TypeError(a+" is not an object!");return a}},{"./_is-object":51}],39:[function(a,b,c){var d={}.toString;b.exports=function(a){return d.call(a).slice(8,-1)}},{}],40:[function(a,b,c){var d=b.exports={version:"2.3.0"};"number"==typeof __e&&(__e=d)},{}],41:[function(a,b,c){var d=a("./_a-function");b.exports=function(a,b,c){if(d(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}}},{"./_a-function":37}],42:[function(a,b,c){b.exports=!a("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(a,b,c){var d=a("./_is-object"),e=a("./_global").document,f=d(e)&&d(e.createElement);b.exports=function(a){return f?e.createElement(a):{}}},{"./_global":46,"./_is-object":51}],44:[function(a,b,c){var d=a("./_global"),e=a("./_core"),f=a("./_ctx"),g=a("./_hide"),h="prototype",i=function(a,b,c){var j,k,l,m=a&i.F,n=a&i.G,o=a&i.S,p=a&i.P,q=a&i.B,r=a&i.W,s=n?e:e[b]||(e[b]={}),t=s[h],u=n?d:o?d[b]:(d[b]||{})[h];n&&(c=b);for(j in c)k=!m&&u&&void 0!==u[j],k&&j in s||(l=k?u[j]:c[j],s[j]=n&&"function"!=typeof u[j]?c[j]:q&&k?f(l,d):r&&u[j]==l?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b[h]=a[h],b}(l):p&&"function"==typeof l?f(Function.call,l):l,p&&((s.virtual||(s.virtual={}))[j]=l,a&i.R&&t&&!t[j]&&g(t,j,l)))};i.F=1,i.G=2,i.S=4,i.P=8,i.B=16,i.W=32,i.U=64,i.R=128,b.exports=i},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(a,b,c){b.exports=function(a){try{return!!a()}catch(b){return!0}}},{}],46:[function(a,b,c){var d=b.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=d)},{}],47:[function(a,b,c){var d=a("./_object-dp"),e=a("./_property-desc");b.exports=a("./_descriptors")?function(a,b,c){return d.f(a,b,e(1,c))}:function(a,b,c){return a[b]=c,a}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(a,b,c){b.exports=a("./_global").document&&document.documentElement},{"./_global":46}],49:[function(a,b,c){b.exports=!a("./_descriptors")&&!a("./_fails")(function(){return 7!=Object.defineProperty(a("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(a,b,c){b.exports=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)}},{}],51:[function(a,b,c){b.exports=function(a){return"object"==typeof a?null!==a:"function"==typeof a}},{}],52:[function(a,b,c){var d=a("./_an-object"),e=a("./_ie8-dom-define"),f=a("./_to-primitive"),g=Object.defineProperty;c.f=a("./_descriptors")?Object.defineProperty:function(a,b,c){if(d(a),b=f(b,!0),d(c),e)try{return g(a,b,c)}catch(h){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(a,b,c){b.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},{}],54:[function(a,b,c){var d,e,f,g=a("./_ctx"),h=a("./_invoke"),i=a("./_html"),j=a("./_dom-create"),k=a("./_global"),l=k.process,m=k.setImmediate,n=k.clearImmediate,o=k.MessageChannel,p=0,q={},r="onreadystatechange",s=function(){var a=+this;if(q.hasOwnProperty(a)){var b=q[a];delete q[a],b()}},t=function(a){s.call(a.data)};m&&n||(m=function(a){for(var b=[],c=1;arguments.length>c;)b.push(arguments[c++]);return q[++p]=function(){h("function"==typeof a?a:Function(a),b)},d(p),p},n=function(a){delete q[a]},"process"==a("./_cof")(l)?d=function(a){l.nextTick(g(s,a,1))}:o?(e=new o,f=e.port2,e.port1.onmessage=t,d=g(f.postMessage,f,1)):k.addEventListener&&"function"==typeof postMessage&&!k.importScripts?(d=function(a){k.postMessage(a+"","*")},k.addEventListener("message",t,!1)):d=r in j("script")?function(a){i.appendChild(j("script"))[r]=function(){i.removeChild(this),s.call(a)}}:function(a){setTimeout(g(s,a,1),0)}),b.exports={set:m,clear:n}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(a,b,c){var d=a("./_is-object");b.exports=function(a,b){if(!d(a))return a;var c,e;if(b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;if("function"==typeof(c=a.valueOf)&&!d(e=c.call(a)))return e;if(!b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(a,b,c){var d=a("./_export"),e=a("./_task");d(d.G+d.B,{setImmediate:e.set,clearImmediate:e.clear})},{"./_export":44,"./_task":54}],57:[function(a,b,c){(function(a){"use strict";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode("");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||"undefined"==typeof a.MessageChannel)e="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var b=a.document.createElement("script");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(a,b,c){"use strict";function d(){}function e(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(e){return p.reject(a,e)}d===a?p.reject(a,new TypeError("Cannot resolve promise with itself")):p.resolve(a,d)})}function h(a){var b=a&&a.then;if(a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof b)return function(){b.apply(a,arguments)}}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);"error"===g.status&&c(g.value)}function j(a,b){var c={};try{c.value=a(b),c.status="success"}catch(d){c.status="error",c.value=d}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){function b(a,b){function d(a){g[b]=a,++h!==e||f||(f=!0,p.resolve(j,g))}c.resolve(a).then(d,function(a){f||(f=!0,p.reject(j,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=new Array(e),h=0,i=-1,j=new this(d);++i<e;)b(a[i],i);return j}function n(a){function b(a){c.resolve(a).then(function(a){f||(f=!0,p.resolve(h,a))},function(a){f||(f=!0,p.reject(h,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=-1,h=new this(d);++g<e;)b(a[g]);return h}var o=a("immediate"),p={},q=["REJECTED"],r=["FULFILLED"],s=["PENDING"];b.exports=e,e.prototype["catch"]=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if("function"!=typeof a&&this.state===r||"function"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){var e=this.state===r?a:b;g(c,e,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if("error"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},e.resolve=k,e.reject=l,e.all=m,e.race=n},{immediate:57}],59:[function(a,b,c){"use strict";var d=a("./lib/utils/common").assign,e=a("./lib/deflate"),f=a("./lib/inflate"),g=a("./lib/zlib/constants"),h={};d(h,e,f,g),b.exports=h},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=i.assign({level:s,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:t,to:""},a||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=h.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(c!==p)throw new Error(k[c]);if(b.header&&h.deflateSetHeader(this.strm,b.header),b.dictionary){var e;if(e="string"==typeof b.dictionary?j.string2buf(b.dictionary):"[object ArrayBuffer]"===m.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,c=h.deflateSetDictionary(this.strm,e),c!==p)throw new Error(k[c]);this._dict_set=!0}}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}function g(a,b){return b=b||{},b.gzip=!0,e(a,b)}var h=a("./zlib/deflate"),i=a("./utils/common"),j=a("./utils/strings"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=Object.prototype.toString,n=0,o=4,p=0,q=1,r=2,s=-1,t=0,u=8;d.prototype.push=function(a,b){var c,d,e=this.strm,f=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:b===!0?o:n,"string"==typeof a?e.input=j.string2buf(a):"[object ArrayBuffer]"===m.call(a)?e.input=new Uint8Array(a):e.input=a,e.next_in=0,e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new i.Buf8(f),e.next_out=0,e.avail_out=f),c=h.deflate(e,d),c!==q&&c!==p)return this.onEnd(c),this.ended=!0,!1;0!==e.avail_out&&(0!==e.avail_in||d!==o&&d!==r)||("string"===this.options.to?this.onData(j.buf2binstring(i.shrinkBuf(e.output,e.next_out))):this.onData(i.shrinkBuf(e.output,e.next_out)))}while((e.avail_in>0||0===e.avail_out)&&c!==q);return d===o?(c=h.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===p):d!==r||(this.onEnd(p),e.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===p&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Deflate=d,c.deflate=e,c.deflateRaw=f,c.gzip=g},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=h.assign({chunkSize:16384,windowBits:0,to:""},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=g.inflateInit2(this.strm,b.windowBits);if(c!==j.Z_OK)throw new Error(k[c]);this.header=new m,g.inflateGetHeader(this.strm,this.header)}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}var g=a("./zlib/inflate"),h=a("./utils/common"),i=a("./utils/strings"),j=a("./zlib/constants"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=a("./zlib/gzheader"),n=Object.prototype.toString;d.prototype.push=function(a,b){var c,d,e,f,k,l,m=this.strm,o=this.options.chunkSize,p=this.options.dictionary,q=!1;if(this.ended)return!1;d=b===~~b?b:b===!0?j.Z_FINISH:j.Z_NO_FLUSH,"string"==typeof a?m.input=i.binstring2buf(a):"[object ArrayBuffer]"===n.call(a)?m.input=new Uint8Array(a):m.input=a,m.next_in=0,m.avail_in=m.input.length;do{if(0===m.avail_out&&(m.output=new h.Buf8(o),m.next_out=0,m.avail_out=o),c=g.inflate(m,j.Z_NO_FLUSH),c===j.Z_NEED_DICT&&p&&(l="string"==typeof p?i.string2buf(p):"[object ArrayBuffer]"===n.call(p)?new Uint8Array(p):p,c=g.inflateSetDictionary(this.strm,l)),c===j.Z_BUF_ERROR&&q===!0&&(c=j.Z_OK,q=!1),c!==j.Z_STREAM_END&&c!==j.Z_OK)return this.onEnd(c),this.ended=!0,!1;m.next_out&&(0!==m.avail_out&&c!==j.Z_STREAM_END&&(0!==m.avail_in||d!==j.Z_FINISH&&d!==j.Z_SYNC_FLUSH)||("string"===this.options.to?(e=i.utf8border(m.output,m.next_out),f=m.next_out-e,k=i.buf2string(m.output,e),m.next_out=f,m.avail_out=o-f,f&&h.arraySet(m.output,m.output,e,f,0),this.onData(k)):this.onData(h.shrinkBuf(m.output,m.next_out)))),0===m.avail_in&&0===m.avail_out&&(q=!0)}while((m.avail_in>0||0===m.avail_out)&&c!==j.Z_STREAM_END);return c===j.Z_STREAM_END&&(d=j.Z_FINISH),d===j.Z_FINISH?(c=g.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===j.Z_OK):d!==j.Z_SYNC_FLUSH||(this.onEnd(j.Z_OK),m.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===j.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Inflate=d,c.inflate=e,c.inflateRaw=f,c.ungzip=e},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(a,b,c){"use strict";var d="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},c.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var e={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;b<c;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;b<c;b++)f=a[b],g.set(f,e),e+=f.length;return g}},f={arraySet:function(a,b,c,d,e){for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))},c.setTyped(d)},{}],63:[function(a,b,c){"use strict";function d(a,b){if(b<65537&&(a.subarray&&g||!a.subarray&&f))return String.fromCharCode.apply(null,e.shrinkBuf(a,b));for(var c="",d=0;d<b;d++)c+=String.fromCharCode(a[d]);return c}var e=a("./common"),f=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(h){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){g=!1}for(var i=new e.Buf8(256),j=0;j<256;j++)i[j]=j>=252?6:j>=248?5:j>=240?4:j>=224?3:j>=192?2:1;i[254]=i[254]=1,c.string2buf=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;f<h;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=new e.Buf8(i),g=0,f=0;g<i;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),c<128?b[g++]=c:c<2048?(b[g++]=192|c>>>6,b[g++]=128|63&c):c<65536?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},c.buf2binstring=function(a){return d(a,a.length)},c.binstring2buf=function(a){for(var b=new e.Buf8(a.length),c=0,d=b.length;c<d;c++)b[c]=a.charCodeAt(c);return b},c.buf2string=function(a,b){var c,e,f,g,h=b||a.length,j=new Array(2*h);for(e=0,c=0;c<h;)if(f=a[c++],f<128)j[e++]=f;else if(g=i[f],g>4)j[e++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;g>1&&c<h;)f=f<<6|63&a[c++],g--;g>1?j[e++]=65533:f<65536?j[e++]=f:(f-=65536,j[e++]=55296|f>>10&1023,j[e++]=56320|1023&f)}return d(j,e)},c.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+i[a[c]]>b?c:b}},{"./common":62}],64:[function(a,b,c){"use strict";function d(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do e=e+b[d++]|0,f=f+e|0;while(--g);e%=65521,f%=65521}return e|f<<16|0;
}b.exports=d},{}],65:[function(a,b,c){"use strict";b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=f,g=d+c;a^=-1;for(var h=d;h<g;h++)a=a>>>8^e[255&(a^b[h])];return a^-1}var f=d();b.exports=e},{}],67:[function(a,b,c){"use strict";function d(a,b){return a.msg=I[b],b}function e(a){return(a<<1)-(a>4?9:0)}function f(a){for(var b=a.length;--b>=0;)a[b]=0}function g(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(E.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function h(a,b){F._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,g(a.strm)}function i(a,b){a.pending_buf[a.pending++]=b}function j(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b}function k(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,E.arraySet(b,a.input,a.next_in,e,c),1===a.state.wrap?a.adler=G(a.adler,b,e,c):2===a.state.wrap&&(a.adler=H(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)}function l(a,b){var c,d,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-la?a.strstart-(a.w_size-la):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+ka,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do;while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&f<m);if(d=ka-(m-f),f=m-ka,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}while((b=l[b&k])>i&&0!==--e);return g<=a.lookahead?g:a.lookahead}function m(a){var b,c,d,e,f,g=a.w_size;do{if(e=a.window_size-a.lookahead-a.strstart,a.strstart>=g+(g-la)){E.arraySet(a.window,a.window,g,g,0),a.match_start-=g,a.strstart-=g,a.block_start-=g,c=a.hash_size,b=c;do d=a.head[--b],a.head[b]=d>=g?d-g:0;while(--c);c=g,b=c;do d=a.prev[--b],a.prev[b]=d>=g?d-g:0;while(--c);e+=g}if(0===a.strm.avail_in)break;if(c=k(a.strm,a.window,a.strstart+a.lookahead,e),a.lookahead+=c,a.lookahead+a.insert>=ja)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+ja-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,!(a.lookahead+a.insert<ja)););}while(a.lookahead<la&&0!==a.strm.avail_in)}function n(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(a.lookahead<=1){if(m(a),0===a.lookahead&&b===J)return ua;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,h(a,!1),0===a.strm.avail_out))return ua;if(a.strstart-a.block_start>=a.w_size-la&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.strstart>a.block_start&&(h(a,!1),0===a.strm.avail_out)?ua:ua}function o(a,b){for(var c,d;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c)),a.match_length>=ja)if(d=F._tr_tally(a,a.strstart-a.match_start,a.match_length-ja),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=ja){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function p(a,b){for(var c,d,e;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=ja-1,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c),a.match_length<=5&&(a.strategy===U||a.match_length===ja&&a.strstart-a.match_start>4096)&&(a.match_length=ja-1)),a.prev_length>=ja&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-ja,d=F._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-ja),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=e&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!==--a.prev_length);if(a.match_available=0,a.match_length=ja-1,a.strstart++,d&&(h(a,!1),0===a.strm.avail_out))return ua}else if(a.match_available){if(d=F._tr_tally(a,0,a.window[a.strstart-1]),d&&h(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return ua}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=F._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function q(a,b){for(var c,d,e,f,g=a.window;;){if(a.lookahead<=ka){if(m(a),a.lookahead<=ka&&b===J)return ua;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=ja&&a.strstart>0&&(e=a.strstart-1,d=g[e],d===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+ka;do;while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&e<f);a.match_length=ka-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=ja?(c=F._tr_tally(a,1,a.match_length-ja),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function r(a,b){for(var c;;){if(0===a.lookahead&&(m(a),0===a.lookahead)){if(b===J)return ua;break}if(a.match_length=0,c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function s(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}function t(a){a.window_size=2*a.w_size,f(a.head),a.max_lazy_match=D[a.level].max_lazy,a.good_match=D[a.level].good_length,a.nice_match=D[a.level].nice_length,a.max_chain_length=D[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=ja-1,a.match_available=0,a.ins_h=0}function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*ha),this.dyn_dtree=new E.Buf16(2*(2*fa+1)),this.bl_tree=new E.Buf16(2*(2*ga+1)),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(ia+1),this.heap=new E.Buf16(2*ea+1),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*ea+1),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(a){var b;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=Z,b=a.state,b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?na:sa,a.adler=2===b.wrap?0:1,b.last_flush=J,F._tr_init(b),O):d(a,Q)}function w(a){var b=v(a);return b===O&&t(a.state),b}function x(a,b){return a&&a.state?2!==a.state.wrap?Q:(a.state.gzhead=b,O):Q}function y(a,b,c,e,f,g){if(!a)return Q;var h=1;if(b===T&&(b=6),e<0?(h=0,e=-e):e>15&&(h=2,e-=16),f<1||f>_||c!==$||e<8||e>15||b<0||b>9||g<0||g>X)return d(a,Q);8===e&&(e=9);var i=new u;return a.state=i,i.strm=a,i.wrap=h,i.gzhead=null,i.w_bits=e,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=f+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+ja-1)/ja),i.window=new E.Buf8(2*i.w_size),i.head=new E.Buf16(i.hash_size),i.prev=new E.Buf16(i.w_size),i.lit_bufsize=1<<f+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new E.Buf8(i.pending_buf_size),i.d_buf=1*i.lit_bufsize,i.l_buf=3*i.lit_bufsize,i.level=b,i.strategy=g,i.method=c,w(a)}function z(a,b){return y(a,b,$,aa,ba,Y)}function A(a,b){var c,h,k,l;if(!a||!a.state||b>N||b<0)return a?d(a,Q):Q;if(h=a.state,!a.output||!a.input&&0!==a.avail_in||h.status===ta&&b!==M)return d(a,0===a.avail_out?S:Q);if(h.strm=a,c=h.last_flush,h.last_flush=b,h.status===na)if(2===h.wrap)a.adler=0,i(h,31),i(h,139),i(h,8),h.gzhead?(i(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),i(h,255&h.gzhead.time),i(h,h.gzhead.time>>8&255),i(h,h.gzhead.time>>16&255),i(h,h.gzhead.time>>24&255),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(i(h,255&h.gzhead.extra.length),i(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=H(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=oa):(i(h,0),i(h,0),i(h,0),i(h,0),i(h,0),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,ya),h.status=sa);else{var m=$+(h.w_bits-8<<4)<<8,n=-1;n=h.strategy>=V||h.level<2?0:h.level<6?1:6===h.level?2:3,m|=n<<6,0!==h.strstart&&(m|=ma),m+=31-m%31,h.status=sa,j(h,m),0!==h.strstart&&(j(h,a.adler>>>16),j(h,65535&a.adler)),a.adler=1}if(h.status===oa)if(h.gzhead.extra){for(k=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending!==h.pending_buf_size));)i(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=pa)}else h.status=pa;if(h.status===pa)if(h.gzhead.name){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.gzindex=0,h.status=qa)}else h.status=qa;if(h.status===qa)if(h.gzhead.comment){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.status=ra)}else h.status=ra;if(h.status===ra&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&g(a),h.pending+2<=h.pending_buf_size&&(i(h,255&a.adler),i(h,a.adler>>8&255),a.adler=0,h.status=sa)):h.status=sa),0!==h.pending){if(g(a),0===a.avail_out)return h.last_flush=-1,O}else if(0===a.avail_in&&e(b)<=e(c)&&b!==M)return d(a,S);if(h.status===ta&&0!==a.avail_in)return d(a,S);if(0!==a.avail_in||0!==h.lookahead||b!==J&&h.status!==ta){var o=h.strategy===V?r(h,b):h.strategy===W?q(h,b):D[h.level].func(h,b);if(o!==wa&&o!==xa||(h.status=ta),o===ua||o===wa)return 0===a.avail_out&&(h.last_flush=-1),O;if(o===va&&(b===K?F._tr_align(h):b!==N&&(F._tr_stored_block(h,0,0,!1),b===L&&(f(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),g(a),0===a.avail_out))return h.last_flush=-1,O}return b!==M?O:h.wrap<=0?P:(2===h.wrap?(i(h,255&a.adler),i(h,a.adler>>8&255),i(h,a.adler>>16&255),i(h,a.adler>>24&255),i(h,255&a.total_in),i(h,a.total_in>>8&255),i(h,a.total_in>>16&255),i(h,a.total_in>>24&255)):(j(h,a.adler>>>16),j(h,65535&a.adler)),g(a),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?O:P)}function B(a){var b;return a&&a.state?(b=a.state.status,b!==na&&b!==oa&&b!==pa&&b!==qa&&b!==ra&&b!==sa&&b!==ta?d(a,Q):(a.state=null,b===sa?d(a,R):O)):Q}function C(a,b){var c,d,e,g,h,i,j,k,l=b.length;if(!a||!a.state)return Q;if(c=a.state,g=c.wrap,2===g||1===g&&c.status!==na||c.lookahead)return Q;for(1===g&&(a.adler=G(a.adler,b,l,0)),c.wrap=0,l>=c.w_size&&(0===g&&(f(c.head),c.strstart=0,c.block_start=0,c.insert=0),k=new E.Buf8(c.w_size),E.arraySet(k,b,l-c.w_size,c.w_size,0),b=k,l=c.w_size),h=a.avail_in,i=a.next_in,j=a.input,a.avail_in=l,a.next_in=0,a.input=b,m(c);c.lookahead>=ja;){d=c.strstart,e=c.lookahead-(ja-1);do c.ins_h=(c.ins_h<<c.hash_shift^c.window[d+ja-1])&c.hash_mask,c.prev[d&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=d,d++;while(--e);c.strstart=d,c.lookahead=ja-1,m(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=ja-1,c.match_available=0,a.next_in=i,a.input=j,a.avail_in=h,c.wrap=g,O}var D,E=a("../utils/common"),F=a("./trees"),G=a("./adler32"),H=a("./crc32"),I=a("./messages"),J=0,K=1,L=3,M=4,N=5,O=0,P=1,Q=-2,R=-3,S=-5,T=-1,U=1,V=2,W=3,X=4,Y=0,Z=2,$=8,_=9,aa=15,ba=8,ca=29,da=256,ea=da+1+ca,fa=30,ga=19,ha=2*ea+1,ia=15,ja=3,ka=258,la=ka+ja+1,ma=32,na=42,oa=69,pa=73,qa=91,ra=103,sa=113,ta=666,ua=1,va=2,wa=3,xa=4,ya=3;D=[new s(0,0,0,0,n),new s(4,4,8,4,o),new s(4,5,16,8,o),new s(4,6,32,32,o),new s(4,4,16,16,p),new s(8,16,32,32,p),new s(8,16,128,128,p),new s(8,32,128,256,p),new s(32,128,258,1024,p),new s(32,258,258,4096,p)],c.deflateInit=z,c.deflateInit2=y,c.deflateReset=w,c.deflateResetKeep=v,c.deflateSetHeader=x,c.deflate=A,c.deflateEnd=B,c.deflateSetDictionary=C,c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(a,b,c){"use strict";function d(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}b.exports=d},{}],69:[function(a,b,c){"use strict";var d=30,e=12;b.exports=function(a,b){var c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;c=a.state,f=a.next_in,B=a.input,g=f+(a.avail_in-5),h=a.next_out,C=a.output,i=h-(b-a.avail_out),j=h+(a.avail_out-257),k=c.dmax,l=c.wsize,m=c.whave,n=c.wnext,o=c.window,p=c.hold,q=c.bits,r=c.lencode,s=c.distcode,t=(1<<c.lenbits)-1,u=(1<<c.distbits)-1;a:do{q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=r[p&t];b:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,0===w)C[h++]=65535&v;else{if(!(16&w)){if(0===(64&w)){v=r[(65535&v)+(p&(1<<w)-1)];continue b}if(32&w){c.mode=e;break a}a.msg="invalid literal/length code",c.mode=d;break a}x=65535&v,w&=15,w&&(q<w&&(p+=B[f++]<<q,q+=8),x+=p&(1<<w)-1,p>>>=w,q-=w),q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=s[p&u];c:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,!(16&w)){if(0===(64&w)){v=s[(65535&v)+(p&(1<<w)-1)];continue c}a.msg="invalid distance code",c.mode=d;break a}if(y=65535&v,w&=15,q<w&&(p+=B[f++]<<q,q+=8,q<w&&(p+=B[f++]<<q,q+=8)),y+=p&(1<<w)-1,y>k){a.msg="invalid distance too far back",c.mode=d;break a}if(p>>>=w,q-=w,w=h-i,y>w){if(w=y-w,w>m&&c.sane){a.msg="invalid distance too far back",c.mode=d;break a}if(z=0,A=o,0===n){if(z+=l-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}else if(n<w){if(z+=l+n-w,w-=n,w<x){x-=w;do C[h++]=o[z++];while(--w);if(z=0,n<x){w=n,x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}}else if(z+=n-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}for(;x>2;)C[h++]=A[z++],C[h++]=A[z++],C[h++]=A[z++],x-=3;x&&(C[h++]=A[z++],x>1&&(C[h++]=A[z++]))}else{z=h-y;do C[h++]=C[z++],C[h++]=C[z++],C[h++]=C[z++],x-=3;while(x>2);x&&(C[h++]=C[z++],x>1&&(C[h++]=C[z++]))}break}}break}}while(f<g&&h<j);x=q>>3,f-=x,q-=x<<3,p&=(1<<q)-1,a.next_in=f,a.next_out=h,a.avail_in=f<g?5+(g-f):5-(f-g),a.avail_out=h<j?257+(j-h):257-(h-j),c.hold=p,c.bits=q}},{}],70:[function(a,b,c){"use strict";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=L,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new s.Buf32(pa),b.distcode=b.distdyn=new s.Buf32(qa),b.sane=1,b.back=-1,D):G}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):G}function h(a,b){var c,d;return a&&a.state?(d=a.state,b<0?(c=0,b=-b):(c=(b>>4)+1,b<48&&(b&=15)),b&&(b<8||b>15)?G:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):G}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==D&&(a.state=null),c):G}function j(a){return i(a,sa)}function k(a){if(ta){var b;for(q=new s.Buf32(512),r=new s.Buf32(32),b=0;b<144;)a.lens[b++]=8;for(;b<256;)a.lens[b++]=9;for(;b<280;)a.lens[b++]=7;for(;b<288;)a.lens[b++]=8;for(w(y,a.lens,0,288,q,0,a.work,{bits:9}),b=0;b<32;)a.lens[b++]=5;w(z,a.lens,0,32,r,0,a.work,{bits:5}),ta=!1}a.lencode=q,a.lenbits=9,a.distcode=r,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new s.Buf8(f.wsize)),d>=f.wsize?(s.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),s.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(s.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,r,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa=0,Ba=new s.Buf8(4),Ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return G;c=a.state,c.mode===W&&(c.mode=X),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xa=D;a:for(;;)switch(c.mode){case L:if(0===c.wrap){c.mode=X;break}for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0),m=0,n=0,c.mode=M;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg="incorrect header check",c.mode=ma;break}if((15&m)!==K){a.msg="unknown compression method",c.mode=ma;break}if(m>>>=4,n-=4,wa=(15&m)+8,0===c.wbits)c.wbits=wa;else if(wa>c.wbits){a.msg="invalid window size",c.mode=ma;break}c.dmax=1<<wa,a.adler=c.check=1,c.mode=512&m?U:W,m=0,n=0;break;case M:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==K){a.msg="unknown compression method",c.mode=ma;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=ma;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=N;case N:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,Ba[2]=m>>>16&255,Ba[3]=m>>>24&255,c.check=u(c.check,Ba,4,0)),m=0,n=0,c.mode=O;case O:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=P;case P:if(1024&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=Q;case Q:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wa=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),s.arraySet(c.head.extra,e,g,q,wa)),512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=R;case R:if(2048&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.name+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=S;case S:if(4096&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.comment+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.comment=null);c.mode=T;case T:if(512&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg="header crc mismatch",c.mode=ma;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=W;break;case U:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=V;case V:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,F;a.adler=c.check=1,c.mode=W;case W:if(b===B||b===C)break a;case X:if(c.last){m>>>=7&n,n-=7&n,c.mode=ja;break}for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=Y;break;case 1:if(k(c),c.mode=ca,b===C){m>>>=2,n-=2;break a}break;case 2:c.mode=_;break;case 3:a.msg="invalid block type",c.mode=ma}m>>>=2,n-=2;break;case Y:for(m>>>=7&n,n-=7&n;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!==(m>>>16^65535)){a.msg="invalid stored block lengths",c.mode=ma;break}if(c.length=65535&m,m=0,n=0,c.mode=Z,b===C)break a;case Z:c.mode=$;case $:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;s.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=W;break;case _:for(;n<14;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=(31&m)+257,m>>>=5,n-=5,c.ndist=(31&m)+1,m>>>=5,n-=5,c.ncode=(15&m)+4,m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=ma;break}c.have=0,c.mode=aa;case aa:for(;c.have<c.ncode;){for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Ca[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Ca[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ya={bits:c.lenbits},xa=w(x,c.lens,0,19,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid code lengths set",c.mode=ma;break}c.have=0,c.mode=ba;case ba:for(;c.have<c.nlen+c.ndist;){for(;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(sa<16)m>>>=qa,n-=qa,c.lens[c.have++]=sa;else{if(16===sa){for(za=qa+2;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qa,n-=qa,0===c.have){a.msg="invalid bit length repeat",c.mode=ma;break}wa=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sa){for(za=qa+3;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=3+(7&m),m>>>=3,n-=3}else{for(za=qa+7;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=ma;break}for(;q--;)c.lens[c.have++]=wa}}if(c.mode===ma)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=ma;break}if(c.lenbits=9,ya={bits:c.lenbits},xa=w(y,c.lens,0,c.nlen,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid literal/lengths set",c.mode=ma;break}if(c.distbits=6,c.distcode=c.distdyn,ya={bits:c.distbits},xa=w(z,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ya),c.distbits=ya.bits,xa){a.msg="invalid distances set",c.mode=ma;break}if(c.mode=ca,b===C)break a;case ca:c.mode=da;case da:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,v(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===W&&(c.back=-1);break}for(c.back=0;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(ra&&0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.lencode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,c.length=sa,0===ra){c.mode=ia;break}if(32&ra){c.back=-1,c.mode=W;break}if(64&ra){a.msg="invalid literal/length code",c.mode=ma;break}c.extra=15&ra,c.mode=ea;case ea:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=fa;case fa:for(;Aa=c.distcode[m&(1<<c.distbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.distcode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,64&ra){a.msg="invalid distance code",c.mode=ma;break}c.offset=sa,c.extra=15&ra,c.mode=ga;case ga:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=ma;break}c.mode=ha;case ha:if(0===j)break a;if(q=p-j,c.offset>q){if(q=c.offset-q,q>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=ma;break}q>c.wnext?(q-=c.wnext,r=c.wsize-q):r=c.wnext-q,q>c.length&&(q=c.length),pa=c.window}else pa=f,r=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do f[h++]=pa[r++];while(--q);0===c.length&&(c.mode=da);break;case ia:if(0===j)break a;f[h++]=c.length,j--,c.mode=da;break;case ja:if(c.wrap){for(;n<32;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?u(c.check,f,p,h-p):t(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg="incorrect data check",c.mode=ma;break}m=0,n=0}c.mode=ka;case ka:if(c.wrap&&c.flags){for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=ma;break}m=0,n=0}c.mode=la;case la:xa=E;break a;case ma:xa=H;break a;case na:return I;case oa:default:return G}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<ma&&(c.mode<ja||b!==A))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=na,I):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?u(c.check,f,p,a.next_out-p):t(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===W?128:0)+(c.mode===ca||c.mode===Z?256:0),(0===o&&0===p||b===A)&&xa===D&&(xa=J),xa)}function n(a){if(!a||!a.state)return G;var b=a.state;return b.window&&(b.window=null),a.state=null,D}function o(a,b){var c;return a&&a.state?(c=a.state,0===(2&c.wrap)?G:(c.head=b,b.done=!1,D)):G}function p(a,b){var c,d,e,f=b.length;return a&&a.state?(c=a.state,0!==c.wrap&&c.mode!==V?G:c.mode===V&&(d=1,d=t(d,b,f,0),d!==c.check)?H:(e=l(a,b,f,f))?(c.mode=na,I):(c.havedict=1,D)):G}var q,r,s=a("../utils/common"),t=a("./adler32"),u=a("./crc32"),v=a("./inffast"),w=a("./inftrees"),x=0,y=1,z=2,A=4,B=5,C=6,D=0,E=1,F=2,G=-2,H=-3,I=-4,J=-5,K=8,L=1,M=2,N=3,O=4,P=5,Q=6,R=7,S=8,T=9,U=10,V=11,W=12,X=13,Y=14,Z=15,$=16,_=17,aa=18,ba=19,ca=20,da=21,ea=22,fa=23,ga=24,ha=25,ia=26,ja=27,ka=28,la=29,ma=30,na=31,oa=32,pa=852,qa=592,ra=15,sa=ra,ta=!0;c.inflateReset=g,c.inflateReset2=h,c.inflateResetKeep=f,c.inflateInit=j,c.inflateInit2=i,c.inflate=m,c.inflateEnd=n,c.inflateGetHeader=o,c.inflateSetDictionary=p,c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(a,b,c){"use strict";var d=a("../utils/common"),e=15,f=852,g=592,h=0,i=1,j=2,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],n=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,c,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C=s.bits,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=null,O=0,P=new d.Buf16(e+1),Q=new d.Buf16(e+1),R=null,S=0;for(D=0;D<=e;D++)P[D]=0;for(E=0;E<o;E++)P[b[c+E]]++;for(H=C,G=e;G>=1&&0===P[G];G--);if(H>G&&(H=G),0===G)return p[q++]=20971520,p[q++]=20971520,s.bits=1,0;for(F=1;F<G&&0===P[F];F++);for(H<F&&(H=F),K=1,D=1;D<=e;D++)if(K<<=1,K-=P[D],K<0)return-1;if(K>0&&(a===h||1!==G))return-1;for(Q[1]=0,D=1;D<e;D++)Q[D+1]=Q[D]+P[D];for(E=0;E<o;E++)0!==b[c+E]&&(r[Q[b[c+E]]++]=E);if(a===h?(N=R=r,y=19):a===i?(N=k,O-=257,R=l,S-=257,y=256):(N=m,R=n,y=-1),M=0,E=0,D=F,x=q,I=H,J=0,v=-1,L=1<<H,w=L-1,a===i&&L>f||a===j&&L>g)return 1;for(;;){z=D-J,r[E]<y?(A=0,B=r[E]):r[E]>y?(A=R[S+r[E]],B=N[O+r[E]]):(A=96,B=0),t=1<<D-J,u=1<<I,F=u;do u-=t,p[x+(M>>J)+u]=z<<24|A<<16|B|0;while(0!==u);for(t=1<<D-1;M&t;)t>>=1;if(0!==t?(M&=t-1,M+=t):M=0,E++,0===--P[D]){if(D===G)break;D=b[c+r[E]]}if(D>H&&(M&w)!==v){for(0===J&&(J=H),x+=F,I=D-J,K=1<<I;I+J<G&&(K-=P[I+J],!(K<=0));)I++,K<<=1;if(L+=1<<I,a===i&&L>f||a===j&&L>g)return 1;v=M&w,p[v]=H<<24|I<<16|x-q|0}}return 0!==M&&(p[x+M]=D-J<<24|64<<16|0),s.bits=H,0}},{"../utils/common":62}],72:[function(a,b,c){"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(a,b,c){"use strict";function d(a){for(var b=a.length;--b>=0;)a[b]=0}function e(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}function f(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function g(a){return a<256?ia[a]:ia[256+(a>>>7)]}function h(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255}function i(a,b,c){a.bi_valid>X-c?(a.bi_buf|=b<<a.bi_valid&65535,h(a,a.bi_buf),a.bi_buf=b>>X-a.bi_valid,a.bi_valid+=c-X):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function j(a,b,c){i(a,c[2*b],c[2*b+1])}function k(a,b){var c=0;do c|=1&a,a>>>=1,c<<=1;while(--b>0);return c>>>1}function l(a){16===a.bi_valid?(h(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}function m(a,b){var c,d,e,f,g,h,i=b.dyn_tree,j=b.max_code,k=b.stat_desc.static_tree,l=b.stat_desc.has_stree,m=b.stat_desc.extra_bits,n=b.stat_desc.extra_base,o=b.stat_desc.max_length,p=0;for(f=0;f<=W;f++)a.bl_count[f]=0;for(i[2*a.heap[a.heap_max]+1]=0,
c=a.heap_max+1;c<V;c++)d=a.heap[c],f=i[2*i[2*d+1]+1]+1,f>o&&(f=o,p++),i[2*d+1]=f,d>j||(a.bl_count[f]++,g=0,d>=n&&(g=m[d-n]),h=i[2*d],a.opt_len+=h*(f+g),l&&(a.static_len+=h*(k[2*d+1]+g)));if(0!==p){do{for(f=o-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[o]--,p-=2}while(p>0);for(f=o;0!==f;f--)for(d=a.bl_count[f];0!==d;)e=a.heap[--c],e>j||(i[2*e+1]!==f&&(a.opt_len+=(f-i[2*e+1])*i[2*e],i[2*e+1]=f),d--)}}function n(a,b,c){var d,e,f=new Array(W+1),g=0;for(d=1;d<=W;d++)f[d]=g=g+c[d-1]<<1;for(e=0;e<=b;e++){var h=a[2*e+1];0!==h&&(a[2*e]=k(f[h]++,h))}}function o(){var a,b,c,d,f,g=new Array(W+1);for(c=0,d=0;d<Q-1;d++)for(ka[d]=c,a=0;a<1<<ba[d];a++)ja[c++]=d;for(ja[c-1]=d,f=0,d=0;d<16;d++)for(la[d]=f,a=0;a<1<<ca[d];a++)ia[f++]=d;for(f>>=7;d<T;d++)for(la[d]=f<<7,a=0;a<1<<ca[d]-7;a++)ia[256+f++]=d;for(b=0;b<=W;b++)g[b]=0;for(a=0;a<=143;)ga[2*a+1]=8,a++,g[8]++;for(;a<=255;)ga[2*a+1]=9,a++,g[9]++;for(;a<=279;)ga[2*a+1]=7,a++,g[7]++;for(;a<=287;)ga[2*a+1]=8,a++,g[8]++;for(n(ga,S+1,g),a=0;a<T;a++)ha[2*a+1]=5,ha[2*a]=k(a,5);ma=new e(ga,ba,R+1,S,W),na=new e(ha,ca,0,T,W),oa=new e(new Array(0),da,0,U,Y)}function p(a){var b;for(b=0;b<S;b++)a.dyn_ltree[2*b]=0;for(b=0;b<T;b++)a.dyn_dtree[2*b]=0;for(b=0;b<U;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*Z]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function q(a){a.bi_valid>8?h(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function r(a,b,c,d){q(a),d&&(h(a,c),h(a,~c)),G.arraySet(a.pending_buf,a.window,b,c,a.pending),a.pending+=c}function s(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function t(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&s(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!s(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function u(a,b,c){var d,e,f,h,k=0;if(0!==a.last_lit)do d=a.pending_buf[a.d_buf+2*k]<<8|a.pending_buf[a.d_buf+2*k+1],e=a.pending_buf[a.l_buf+k],k++,0===d?j(a,e,b):(f=ja[e],j(a,f+R+1,b),h=ba[f],0!==h&&(e-=ka[f],i(a,e,h)),d--,f=g(d),j(a,f,c),h=ca[f],0!==h&&(d-=la[f],i(a,d,h)));while(k<a.last_lit);j(a,Z,b)}function v(a,b){var c,d,e,f=b.dyn_tree,g=b.stat_desc.static_tree,h=b.stat_desc.has_stree,i=b.stat_desc.elems,j=-1;for(a.heap_len=0,a.heap_max=V,c=0;c<i;c++)0!==f[2*c]?(a.heap[++a.heap_len]=j=c,a.depth[c]=0):f[2*c+1]=0;for(;a.heap_len<2;)e=a.heap[++a.heap_len]=j<2?++j:0,f[2*e]=1,a.depth[e]=0,a.opt_len--,h&&(a.static_len-=g[2*e+1]);for(b.max_code=j,c=a.heap_len>>1;c>=1;c--)t(a,f,c);e=i;do c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],t(a,f,1),d=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=d,f[2*e]=f[2*c]+f[2*d],a.depth[e]=(a.depth[c]>=a.depth[d]?a.depth[c]:a.depth[d])+1,f[2*c+1]=f[2*d+1]=e,a.heap[1]=e++,t(a,f,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],m(a,b),n(f,j,a.bl_count)}function w(a,b,c){var d,e,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;d<=c;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(h<j?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[2*$]++):h<=10?a.bl_tree[2*_]++:a.bl_tree[2*aa]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))}function x(a,b,c){var d,e,f=-1,g=b[1],h=0,k=7,l=4;for(0===g&&(k=138,l=3),d=0;d<=c;d++)if(e=g,g=b[2*(d+1)+1],!(++h<k&&e===g)){if(h<l){do j(a,e,a.bl_tree);while(0!==--h)}else 0!==e?(e!==f&&(j(a,e,a.bl_tree),h--),j(a,$,a.bl_tree),i(a,h-3,2)):h<=10?(j(a,_,a.bl_tree),i(a,h-3,3)):(j(a,aa,a.bl_tree),i(a,h-11,7));h=0,f=e,0===g?(k=138,l=3):e===g?(k=6,l=3):(k=7,l=4)}}function y(a){var b;for(w(a,a.dyn_ltree,a.l_desc.max_code),w(a,a.dyn_dtree,a.d_desc.max_code),v(a,a.bl_desc),b=U-1;b>=3&&0===a.bl_tree[2*ea[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}function z(a,b,c,d){var e;for(i(a,b-257,5),i(a,c-1,5),i(a,d-4,4),e=0;e<d;e++)i(a,a.bl_tree[2*ea[e]+1],3);x(a,a.dyn_ltree,b-1),x(a,a.dyn_dtree,c-1)}function A(a){var b,c=4093624447;for(b=0;b<=31;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return I;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return J;for(b=32;b<R;b++)if(0!==a.dyn_ltree[2*b])return J;return I}function B(a){pa||(o(),pa=!0),a.l_desc=new f(a.dyn_ltree,ma),a.d_desc=new f(a.dyn_dtree,na),a.bl_desc=new f(a.bl_tree,oa),a.bi_buf=0,a.bi_valid=0,p(a)}function C(a,b,c,d){i(a,(L<<1)+(d?1:0),3),r(a,b,c,!0)}function D(a){i(a,M<<1,3),j(a,Z,ga),l(a)}function E(a,b,c,d){var e,f,g=0;a.level>0?(a.strm.data_type===K&&(a.strm.data_type=A(a)),v(a,a.l_desc),v(a,a.d_desc),g=y(a),e=a.opt_len+3+7>>>3,f=a.static_len+3+7>>>3,f<=e&&(e=f)):e=f=c+5,c+4<=e&&b!==-1?C(a,b,c,d):a.strategy===H||f===e?(i(a,(M<<1)+(d?1:0),3),u(a,ga,ha)):(i(a,(N<<1)+(d?1:0),3),z(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),u(a,a.dyn_ltree,a.dyn_dtree)),p(a),d&&q(a)}function F(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(ja[c]+R+1)]++,a.dyn_dtree[2*g(b)]++),a.last_lit===a.lit_bufsize-1}var G=a("../utils/common"),H=4,I=0,J=1,K=2,L=0,M=1,N=2,O=3,P=258,Q=29,R=256,S=R+1+Q,T=30,U=19,V=2*S+1,W=15,X=16,Y=7,Z=256,$=16,_=17,aa=18,ba=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ca=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],da=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ea=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fa=512,ga=new Array(2*(S+2));d(ga);var ha=new Array(2*T);d(ha);var ia=new Array(fa);d(ia);var ja=new Array(P-O+1);d(ja);var ka=new Array(Q);d(ka);var la=new Array(T);d(la);var ma,na,oa,pa=!1;c._tr_init=B,c._tr_stored_block=C,c._tr_flush_block=E,c._tr_tally=F,c._tr_align=D},{"../utils/common":62}],74:[function(a,b,c){"use strict";function d(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}b.exports=d},{}]},{},[10])(10)});
/*!

JSZipUtils - A collection of cross-browser utilities to go along with JSZip.
<http://stuk.github.io/jszip-utils>

(c) 2014 Stuart Knightley, David Duponchel
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip-utils/master/LICENSE.markdown.

*/
!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.JSZipUtils=a():"undefined"!=typeof global?global.JSZipUtils=a():"undefined"!=typeof self&&(self.JSZipUtils=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";function c(){try{return new window.XMLHttpRequest}catch(a){}}function d(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}var e={};e._getBinaryFromXHR=function(a){return a.response||a.responseText};var f=window.ActiveXObject?function(){return c()||d()}:c;e.getBinaryContent=function(a,b){try{var c=f();c.open("GET",a,!0),"responseType"in c&&(c.responseType="arraybuffer"),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined"),c.onreadystatechange=function(){var d,f;if(4===c.readyState)if(200===c.status||0===c.status){d=null,f=null;try{d=e._getBinaryFromXHR(c)}catch(g){f=new Error(g)}b(f,d)}else b(new Error("Ajax error for "+a+" : "+this.status+" "+this.statusText),null)},c.send()}catch(d){b(new Error(d),null)}},b.exports=e},{}]},{},[1])(1)});
var _global="object"===typeof window&&window.window===window?window:"object"===typeof self&&self.self===self?self:"object"===typeof global&&global.global===global?global:this;
function bom(a,b){"undefined"===typeof b?b={autoBom:!1}:"object"!==typeof b&&(console.warn("Depricated: Expected third argument to be a object"),b={autoBom:!b});return b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a}
function download(a,b,e){var c=new XMLHttpRequest;c.open("GET",a);c.responseType="blob";c.onload=function(){saveAs(c.response,b,e)};c.onerror=function(){console.error("could not download file")};c.send()}function corsEnabled(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);b.send();return 200<=b.status&&299>=b.status}
function click(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(e){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null);a.dispatchEvent(b)}}
var saveAs=_global.saveAs||"object"!==typeof window||window!==_global?function(){}:"download"in HTMLAnchorElement.prototype?function(a,b,e){var c=_global.URL||_global.webkitURL,d=document.createElement("a");b=b||a.name||"download";d.download=b;d.rel="noopener";"string"===typeof a?(d.href=a,d.origin!==location.origin?corsEnabled(d.href)?download(a,b,e):click(d,d.target="_blank"):click(d)):(d.href=c.createObjectURL(a),setTimeout(function(){c.revokeObjectURL(d.href)},4E4),setTimeout(function(){click(d)},
0))}:"msSaveOrOpenBlob"in navigator?function(a,b,e){b=b||a.name||"download";if("string"===typeof a)if(corsEnabled(a))download(a,b,e);else{var c=document.createElement("a");c.href=a;c.target="_blank";setTimeout(function(){click(c)})}else navigator.msSaveOrOpenBlob(bom(a,e),b)}:function(a,b,e,c){if(c=c||open("","_blank"))c.document.title=c.document.body.innerText="downloading...";if("string"===typeof a)return download(a,b,e);b="application/octet-stream"===a.type;e=/constructor/i.test(_global.HTMLElement)||
_global.safari;var d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||b&&e)&&"object"===typeof FileReader){var f=new FileReader;f.onloadend=function(){var a=f.result;a=d?a:a.replace(/^data:[^;]*;/,"data:attachment/file;");c?c.location.href=a:location=a;c=null};f.readAsDataURL(a)}else{var h=_global.URL||_global.webkitURL,g=h.createObjectURL(a);c?c.location=g:location.href=g;c=null;setTimeout(function(){h.revokeObjectURL(g)},4E4)}};_global.saveAs=saveAs.saveAs=saveAs;
"undefined"!==typeof module&&(module.exports=saveAs);
